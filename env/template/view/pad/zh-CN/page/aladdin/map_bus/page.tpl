{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%$extData.feData.hasShowURLGap = true%} {%$tplData.title=$tplData.titleDesc%} {%$tplData.url=$tplData.titleUrl%} {%function fe_fn_bus_tag_map tag=''%}{%$colors=['yellow', 'blue']%}{%$tempDataColor=$colors[0]%}{%if $tag=='路'%}{%$tempDataColor=$colors[1]%}{%/if%}{%$tempDataColor%}{%/function%} {%function fe_fn_bus_font_size_zoom str='' zoomMap=''%}{%$tempDataSize=13%}{%$strLength=preg_match_all("/./us", $str, $match)%}{%foreach $zoomMap as $item%}{%if $strLength<=$item@key%}{%$tempDataSize=$item%}{%break%}{%/if%}{%/foreach%}{%$tempDataSize%}{%/function%} {%$tempDataNumFontSizeZoomMap=['2'=> '60', '3'=> '46', '4'=> '36', '5'=> '30']%} {%$tempDataStartEndFontSizeZoomMap=['11'=> '24', '12'=> '22', '13'=> '20', '14'=> '18', '15'=> '17', '16'=> '16', '17'=> '15', '18'=> '14', '19'=> '13', '20'=> '13']%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css="tabs"%}.op-map-bus-tabs .c-tabs-nav{border:0;background-color:#248bf2}.op-map-bus-tabs .c-tabs-nav .c-tabs-nav-sep{border-color:#389cff;border-left:none}.op-map-bus-tabs .c-tabs-nav .c-tabs-nav-li{background-color:#248bf2;color:#fff;_border-color:#248bf2}.op-map-bus-tabs .c-tabs-nav .c-tabs-nav-selected{border-color:#389cff;border-top-color:#248bf2;background-color:#389cff}.op-map-bus-content{background-color:#248bf2}.op-map-bus-info{border-collapse:collapse;border-spacing:0;color:#fff;width:100%}.op-m{%*i*%}ap-bus-info td{height:74px;padding:12px;background-color:#389cff;vertical-align:top;font-family:"Microsoft YaHei",微软雅黑}.op-map-bus-info td.op-map-bus-info-right{*padding-top:16px}.op-map-bus-info td.op-map-bus-info-left{padding-right:0}.op-map-bus-info-left{width:86px;text-align:center}.op-map-bus-info-right-container{position:relative;zoom:1}.op-map-bus-info-right-container a{color:#fff!important}.op-map-bus-info-num{height:48px;line-height:48px;padding-bottom:4px;margin:0 auto;font-family:aria{%*i*%}l}.op-map-bus-info-tag{width:68px;height:22px;line-height:20px;font-size:1.23em;margin:0 auto}.op-map-bus-info-tag-blue{background-color:#2d90f2}.op-map-bus-info-tag-yellow{background-color:#ffb522}.op-map-bus-info-start-end{height:30px;font-size:1.38em;display:inline-block;padding-top:4px;border-collapse:collapse;border-spacing:0}.op-map-bus-info-start-end td{height:auto;padding:0;line-height:auto}.op-map-bus-info-start-end td.op-map-bus-info-start{text-align:right;padding-right:8px}.op-map-bus{%*i*%}-info-start-end td.op-map-bus-info-end{text-align:left;padding-left:8px}.op-map-bus-info-start-end td.op-map-bus-info-derection,.op-map-bus-info-switcher,.op-map-bus-stop-tail,.op-map-bus-stop-sign-right,.op-map-bus-stop-sign-left,.op-map-bus-stop-warn-icon{background:url(http://www.baidu.com/aladdin/img/map_bus/map_bus_1.png) no-repeat}.op-map-bus-info-start-end td.op-map-bus-info-derection{width:54px;display:inline-block;height:20px;background-position:0 5px}.op-map-bus-info-info span{display:{%*i*%}inline-block;float:left;line-height:20px}.op-map-bus-info-starttime,.op-map-bus-info-endtime{width:108px}.op-map-bus-info-switcher-border{position:absolute;background:#fff;top:6px;background-position:-83px 6px;right:-1px;width:62px;height:24px;filter:alpha(opacity=60);opacity:.8}.op-map-bus-info-switcher{position:absolute;z-index:1;top:7px;right:0;width:36px;height:22px;background-position:-83px 6px;background-color:#389cff;padding-left:24px;cursor:pointer}.op-map-bus-info-switcher-border-hover{{%*i*%}filter:alpha(opacity=100);opacity:1}.op-map-bus-info-link{position:absolute;bottom:1px;right:0;color:#fff}.op-map-bus-station{border:2px solid #389cff;background-color:#fff;padding:0 3px 8px}.op-map-bus-stop{float:left;width:30px;height:132px;text-align:center;font-family:"Microsoft YaHei",微软雅黑;line-height:14px;_line-height:15px;cursor:pointer;word-break:normal}.op-map-bus-stop a{color:#333!important;width:20px;height:116px;padding:8px 3px;_padding:6px 1px;text-decoration:none;display:block}.op-{%*i*%}map-bus-stop-tail{display:block;background-position:-62px 2px;width:10px;height:12px}.op-map-bus-stop a.op-map-bus-stop-hover{padding:7px 2px;_padding:5px 0;border:1px solid #389cff}.op-map-bus-stop-num{display:inline-block;width:20px;font-family:arial;padding-bottom:6px;cursor:pointer}.op-map-bus-stop-text{display:inline-block;width:18px;text-align:left;margin-left:3px;cursor:pointer}.op-map-bus-showmore,.op-map-bus-showless{border-top:1px solid #ebebeb;cursor:pointer;padding-top:2px;margin-top{%*i*%}:12px}.op-map-bus-showmore i,.op-map-bus-showless i{cursor:pointer;_vertical-align:top}.op-map-bus-showmore-inner,.op-map-bus-showless-inner{text-align:center;color:#00c;position:relative;top:3px;_top:4px}.op-map-bus-tabs-content{position:relative;-webkit-perspective:1000px;-moz-perspective:1000px;-o-perspective:1000px}.op-map-bus-tabs-content-inner{-webkit-transform-style:preserve-3d;-webkit-transition:all .7s linear;-moz-transform-style:preserve-3d;-moz-transition:all .7s linear;-o-transform-s{%*i*%}tyle:preserve-3d;-o-transition:all .7s linear}.op-map-bus-z-index400{z-index:400}.op-map-bus-content{position:absolute;*position:static;width:100%;top:0;left:0;-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;-o-backface-visibility:hidden}.op-map-bus-tabs-content-inner-transform{-webkit-transform:rotateY(180deg);-moz-transform:rotateY(180deg);-o-transform:rotateY(180deg)}.op-map-bus-content-back{-webkit-transform:rotateY(180deg);-moz-transform:rotateY(180deg);-o-transform:rotat{%*i*%}eY(180deg)}.op-map-bus-stop-diff .op-map-bus-stop-sign-left{display:none}.op-map-bus-stop-diff .op-map-bus-stop-num{color:#f54545}.op-map-bus-stop-sign{position:relative;display:inline-block;width:24px;height:12px}.op-map-bus-stop-sign-right,.op-map-bus-stop-sign-left{position:absolute;left:4px;display:inline-block;width:12px;height:6px;overflow:hidden}.op-map-bus-stop-sign-right{top:0;background-position-y:-167px}.op-map-bus-stop-sign-left{bottom:0;background-position-y:-173px}.op-map-bus-stop-{%*i*%}diff .op-map-bus-stop-sign-right,.op-map-bus-stop-diff .op-map-bus-stop-sign-left{background-position-x:-22px}.op-map-bus-stop-tip{padding:5px 10px 5px 34px;width:280px}.op-map-bus-stop-warn-icon{position:absolute;top:11px;left:10px;width:17px;height:17px;display:block;background-position:0 -187px}.op-map-bus-red{color:#f55454}.op-map-bus-tip-con{position:absolute;z-index:1;top:22px;left:-35px;background:#fff;border:1px solid #dcdcdc;border:1px solid rgba(0,0,0,0.2);-webkit-transition:opacity .2{%*i*%}18s;transition:opacity .218s;-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);box-shadow:0 2px 4px rgba(0,0,0,0.2);padding:5px 0 5px 0;display:none;line-height:20px}.op-map-bus-tip-arrow{width:0;height:0;font-size:0;line-height:0;display:block;position:absolute;top:-16px}.op-map-bus-tip-arrow em,.op-map-bus-tip-arrow ins{width:0;height:0;font-size:0;line-height:0;display:block;position:absolute;border:8px solid #000;border-style:dashed dashed solid dashed}.op-map-bus-tip-arrow em{border-color:transp{%*i*%}arent transparent #d8d8d8 transparent}.op-map-bus-tip-arrow ins{border-color:transparent transparent #fff transparent;top:2px}</style>{%$multiLine=$tplData.lines|count>1%}<div class="op-map-bus-tabs{%if $multiLine%} c-tabs{%/if%}"> {%if $multiLine%} <ul class="c-tabs-nav" data-click="{fm:'beha'}"> {%foreach $tplData.lines as $tab%} <li class="c-tabs-nav-li{%if $tab@index==0%} c-tabs-nav-selected{%/if%} op-map-bus-tabs-nav-li">{%$tab.lineName|escape%}</li> {%if !$tab@last%}<li class="c-tabs-nav-sep"></li>{%/if%} {%/foreach%} </ul> {%/if%} {%foreach $tplData.lines as $tab%} <div class="{%if $multiLine%}c-tabs c-tabs-content {%/if%}op-map-bus-tabs-content" style="height:286px;*height:auto;{%if $tab@index>0%}display:none;{%/if%}"> <div class="op-map-bus-tabs-content-inner"> {%foreach $tab.detail as $item%} <div class="op-map-bus-content{%if $item@index==1%} op-map-bus-content-back{%/if%}" style="z-index:{%10-$item@index%};{%if $item@index>0%}*display:none;{%/if%}"> <table class="op-map-bus-info"> <tr> {%if $item.busName1||$item.busName2%} <td class="op-map-bus-info-left"> <div class="op-map-bus-info-num" style="font-size:{%fe_fn_bus_font_size_zoom str=$item.busName1 zoomMap=$tempDataNumFontSizeZoomMap%}px;">{%$item.busName1|escape%}</div> <div class="op-map-bus-info-tag op-map-bus-info-tag-{%fe_fn_bus_tag_map tag=$item.busName2%}">{%$item.busName2|escape%}</div> </td> {%/if%} <td class="op-map-bus-info-right"> <div class="op-map-bus-info-right-container"> <table class="op-map-bus-info-start-end"> <tr> {%$tempDataStartEndFontSize={%fe_fn_bus_font_size_zoom str=$item.startName|cat:$item.endName zoomMap=$tempDataStartEndFontSizeZoomMap%}%} <td class="op-map-bus-info-start" style="font-size:{%$tempDataStartEndFontSize%}px;line-height:{%if $tempDataStartEndFontSize<20%}20{%else%}{%$tempDataStartEndFontSize%}{%/if%}px;">{%$item.startName|escape%}</td> <td class="op-map-bus-info-derection">&nbsp;</td> <td class="op-map-bus-info-end" style="font-size:{%$tempDataStartEndFontSize%}px;line-height:{%if $tempDataStartEndFontSize<20%}20{%else%}{%$tempDataStartEndFontSize%}{%/if%}px;">{%$item.endName|escape%}</td> </tr> </table> <div class="op-map-bus-info-info"> <div class="c-clearfix"> <span class="op-map-bus-info-starttime">首车：{%$item.startTime|escape%}</span> <span class="op-map-bus-info-length"></span> </div> <div class="c-clearfix"> <span class="op-map-bus-info-endtime">末车：{%$item.endTime|escape%}</span> <span class="op-map-bus-info-price">票价：{%$item.price|escape%}</span> </div> </div> {%if $tab.detail|count > 1%} <div class="op-map-bus-info-switcher-border"></div><div class="op-map-bus-info-switcher OP_LOG_BTN" data-click="{fm:'beha'}">返程</div> {%/if%} <a href="{%$item.lineUrl%}" target="_blank" class="op-map-bus-info-link">在地图上显示路线</a> </div> </td> </tr> </table> <div class="op-map-bus-station"> <ul class="c-clearfix"> {%foreach $item.stopInfo as $stop%} {%$tempDataStopNameMaxLength=12%} {%$tempDataStopNameLength=$stop.stopName|string_display_len%} <li class="op-map-bus-stop{%if $stop.diffFlag%} op-map-bus-stop-diff{%/if%}"{%if $tempDataStopNameLength>$tempDataStopNameMaxLength%} title="{%$stop.stopName|escape%}"{%/if%} data-title="{%$stop.stopName|escape%}"> <a href="{%$stop.stopUrl%}" target="_blank"> <span class="op-map-bus-stop-num">{%$stop.stopNo|escape%}</span> <span class="op-map-bus-stop-sign"><span class="op-map-bus-stop-sign-right"></span><span class="op-map-bus-stop-sign-left"></span></span> <span class="op-map-bus-stop-text"> {%preg_replace('/\.\.\.$/', '<span class="op-map-bus-stop-tail"></span>', $stop.stopName|limitlen:$tempDataStopNameMaxLength)%} </span> </a> </li> {%if $stop@index!=0 && ($stop@index+1)%20==0 && $stop@index!=($item.stopInfo|count-1)%} </ul> {%if $stop@index==19%} <div class="op-map-bus-showmore OP_LOG_BTN" data-click="{fm:'beha'}"> <div class="op-map-bus-showmore-inner">查看完整站点 <i class="c-icon c-icon-chevron-bottom"></i></div> </div> {%/if%} <ul class="c-clearfix" style="display:none;"> {%/if%} {%/foreach%} </ul> {%if $item.stopInfo|count>20%} <div class="op-map-bus-showless OP_LOG_BTN" data-click="{fm:'beha'}" style="display:none;"> <div class="op-map-bus-showless-inner">收起 <i class="c-icon c-icon-chevron-top"></i></div> </div> {%/if%} </div> </div> {%/foreach%} </div> </div> {%/foreach%}</div><script data-merge>A.setup(function(){var baidu = A.baidu, _this = this;var tabs = _this.qq('op-map-bus-tabs');var tabContents = _this.q('op-map-bus-tabs-content');var timeout = null;var timer = null; var $stopTip = null;var stopTip = null;function hideTip(doc){if(stopTip){stopTip.style.display = 'none';}}A.use('jquery', function(){var $ = A.ui.jquery;var $body = $(document.body);function BUS(data){this.container = $(data.container);this.contents = this.container.find('.op-map-bus-content'{%*i*%});this.bindEvent();}BUS.prototype = {bindEvent: function(){var t = this;$.each(t.contents, function(i, n){var $n = $(n);var $switcherBorder = $n.find('.op-map-bus-info-switcher-border');var $switcher = $n.find('.op-map-bus-info-switcher');var $showmore = $n.find('.op-map-bus-showmore');var $showless = $n.find('.op-map-bus-showless');var $stations = $n.find('.op-map-bus-station>ul');var $stops = $n.find('.op-map-bus-stop');var start = $.trim($n.find('.op-map-bus-info-start').html());var end = $.t{%*i*%}rim($n.find('.op-map-bus-info-end').html());var lastClickStop = null;$stops.bind('click', function(e){$stops.find('.op-map-bus-stop-hover').removeClass('op-map-bus-stop-hover');var $t = $(this);$t.find('>a').addClass('op-map-bus-stop-hover');if(!lastClickStop || lastClickStop === this){}else{$stops.filter('.op-map-bus-stop-diff').data('showTip', false);if($stopTip){$stopTip.hide();}}lastClickStop = $t.get(0);if($t.is('.op-map-bus-stop-diff')){var offset = $t.offset();var stopName = $.trim($t.att{%*i*%}r('data-title'));if(!$t.data('showTip')){if(!$stopTip){$stopTip = $('<div class="op-map-bus-tip-con" style="position:absolute;top: '+(offset.top+142)+'px; left: '+offset.left+'px; z-index: 304; display: block;">'+'<div class="op-map-bus-tip-arrow" style="left: 3px;">'+'<em></em><ins></ins>'+'</div>'+'<div class="op-map-bus-stop-tip"><span class="op-map-bus-stop-warn-icon"></span><span class="op-map-bus-stop-tip-stopame"></span>站<span class="op-map-bus-stop-tip-start"></span><span class="op-map-b{%*i*%}us-red">返程不停靠</span>，乘车时请注意！</div>'+'</div>');$body.append($stopTip);}else{$stopTip.css({top:offset.top+142, left:offset.left}).show();}$stopTip.find('.op-map-bus-stop-tip-stopame').html(stopName);stopTip = $stopTip.get(0);$t.data('showTip', true);return false;}else{$t.data('showTip', false);$t.find('>a').removeClass('op-map-bus-stop-hover');if($stopTip){if(!$.contains($stopTip.get(0), e.relatedTarget)){$stopTip.hide();}}}}});n.showmore = function(){if($showmore.length){$showmore.hide();$showles{%*i*%}s.show();$stations.slice(1).show();$n.data('status', 'showmore');}};n.showless = function(){if($showless.length){$showless.hide();$showmore.show();$stations.slice(1).hide();$n.data('status', 'showless');}};$showmore.click(function(){n.showmore();t.container.height($n.height());});$showless.click(function(){n.showless();t.container.height($n.height());});$switcher.click(function(){$stops.find('.op-map-bus-stop-hover').removeClass('op-map-bus-stop-hover');$stops.filter('.op-map-bus-stop-diff').dat{%*i*%}a('showTip', false);if($n.data('status')){t.contents[i === 0 ? 1 : 0][$n.data('status')]();}var $buscontent=$('.op-map-bus-content',t.container);var zindex=[];$buscontent.each(function(){zindex.unshift($(this).css('z-index'))});$n.parent().toggleClass('op-map-bus-tabs-content-inner-transform');timeout=setTimeout(function(){$.each($buscontent,function(i,v){$(this).css('z-index',zindex[i]);}); clearTimeout(timeout);},700);t.container.addClass('op-map-bus-z-index400');t.container.height($(t.content{%*i*%}s[i === 0 ? 1 : 0]).height());timer = setTimeout(function(){t.container.removeClass('op-map-bus-z-index400');},700);});});$(document).bind('click', hideTip); }};if(tabs){var $tabs = $(tabs);A.use('tabs5', function(){A.ui.tabs5($tabs.get(0));});}if(tabContents.length > 0){$.each(tabContents, function(i, n){var bus = new BUS({container: n}); });var $tabContents0 = $(tabContents[0]);$tabContents0.height($tabContents0.find('.op-map-bus-content').height());}});this.dispose = function(){clearTimeout(t{%*i*%}imer);clearTimeout(timeout);if(hideTip){$(document).unbind('click', hideTip); }};});</script>{%/block%}