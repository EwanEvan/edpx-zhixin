{%extends 'c_base.tpl'%} {%block name='data_modifier'%} {%if !$tplData.link%} {%$extData.feData.hasShowURLGap=true%} {%/if%}{%/block%}{%block name='title'%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='table'%}{%fe_fn_c_css css='btn'%}.op_xsk_main{position:relative}.op_xsk_table{padding-right:9px;overflow:hidden}.op_xsk_contentmore{height:175px;border:1px solid #f8f8f8;border-right:0;border-top:0}.op_xsk_lastCol{width:11%}.op_xsk_table .c-icon-gift{*vertical-align:baseline}.op_xsk_gmain{position:absolute}.op_xsk_gmain .c-border{width:240px;padding-top:5px;padding-bottom:5px}.op_xsk_gmain dl{display:none;position:relative;background-color:#fff;font-size:.93em;line-height:1.67}.op_xsk_gmain dd{color:#666}.op_xsk_gmain dt,.op_xs{%*i*%}k_current{font-weight:bold}.op_xsk_gmain .op_xsk_dl_block{display:block}.op_xsk_arr{position:absolute;left:50%;top:0}.op_xsk_arr .c-icon{display:block;position:relative;left:-50%;top:-10px}.op_xsk_more{text-align:right}.op_xsk_current{text-decoration:none;cursor:default}</style>{%fe_fn_c_title_prefix%}<strong>{%$tplData.title%}</strong>{%fe_fn_c_title_suffix%}<table class="c-table op_xsk_feaktable" style="display:none;"> <tr class="op_xsk_feakhead"> <th>{%$tplData.cardTh[0].title%}</th> <th>{%$tplData.cardTh[0].cardSource%}</th> <th>{%$tplData.cardTh[0].cardNumber%}</th> </tr></table><div class="op_xsk_main"> <div class="op_xsk_table {%if $tplData.card|count > 5%} op_xsk_contentmore{%/if%}"></div> <div class="op_xsk_gmain"></div> {%$loop_maxcount=count($tplData.link)%} {%if $loop_maxcount>0%} <div class="c-gap-top"> {%for $op_loop_count=0 to 4%}{%if $op_loop_count<$loop_maxcount%}<a {%if $op_loop_count>0%}class="c-gap-left"{%/if%} href="{%$tplData.link[$op_loop_count]['url']|escape:'html'%}" target="_blank">{%$tplData.link[$op_loop_count]['txt']|escape:'html'%}</a>{%else%}{%break%}{%/if%}{%/for%} </div> {%/if%}</div><script >
  A.setup({'op_xsk_query': '{%preg_replace('/^'|cat:$extData.resourceid|cat:'_/','',$extData.fetchkey)|escape:'html'%}','op_xsk_resourceid':'{%$extData.resourceid|escape:'html'%}','op_xsk_pageitem':'{%$tplData.pageitem|escape:'html'%}'});
</script><script data-merge>A.setup(function() {var _this = this,vscrollx,$w = _this.find('.op_xsk_main').eq(0),$d = _this.find('.op_xsk_table').eq(0),$m = _this.find('.op_xsk_gmain').eq(0),op_xsk_query = _this.data.op_xsk_query,op_xsk_resourceid = _this.data.op_xsk_resourceid,op_xsk_pageitem = _this.data.op_xsk_pageitem,index = 0, iNow = 0, len = 0, iNowPre = 0, ipage = op_xsk_pageitem, gif = false;_this.ajax(op_xsk_query, op_xsk_resourceid, {success: fnSuccess,co: 'card|gifts|cardTh',error: fu{%*i*%}nction() {$d.html('抱歉！数据请求失败');}});function fnSuccess(data) {if (!data)return;var cards = data[0].card;var th = data[0].cardTh[0];var gifts = data[0].gifts;var newGifts={};if (gifts) {gif = true;$(gifts).each(function(i, v) {if(newGifts[v.id]){newGifts[v.id].push(v.title);}else{newGifts[v.id]=[v.title];} });}len = Math.ceil(cards.length / op_xsk_pageitem);var tabs = [], html = [], obj = [];tabs.push('<table class="c-table op_xsk_tab">');tabs.push('<tr style="display:none;"><th>' + th.title + '</t{%*i*%}h><th>' + th.cardSource + '</th><th>' + th.cardNumber + '</th></tr>');$(cards).each(function(i, o) {var giftHtml='';if (newGifts[o.id]) {html.push(['<dl class="c-border">','<dt>'+o.giftsTitle+'</dt>',str_select.arr(newGifts[o.id], 'dd'),str_select.str(o.moreTxt, '<dd class="op_xsk_more"><a href="'+o.moreLink+'" target="_blank">'+o.moreTxt+'</a></dd>'),'<div class="op_xsk_arr"><i class="c-icon c-icon-triangle-up-empty"></i></div>','</dl>'].join(''));giftHtml='<span class="c-icon c-icon-gift c-gap{%*i*%}-icon-left-small"></span>';}var td_1_inner = ['<a href="'+o.titleLink+'" target="_blank">'+o.title+'</a>', giftHtml].join('');var td_1 = '<td>' + td_1_inner + '</td>';var td_2_inner = o.cardSource;var td_2 = '<td>' + td_2_inner + '</td>';var td_3_inner = str_select.str(o.cardNumberLink, '<a href="'+o.cardNumberLink+'" target="_blank" class="c-btn c-btn-mini">领号</a>');var td_3 = '<td class="op_xsk_lastCol OP_LOG_BTN">' + td_3_inner + '</td>';obj.push('<tr class="op_xsk_tr">' + td_1 + td_2 + td_3 {%*i*%}+ '</tr>');});tabs.push(obj.join(''));tabs.push('</table>');$d.html(tabs.join(''));if(html.length){$m.html(html.join(''));}A.use('scrollbarv', function(){vscrollx = A.ui.scrollbarv({content:$d.get(0)});});showContent();}var str_select = {str: function(o,str) {return o.length > 0 ? str : '&nbsp';},arr: function(o,attr) {var c = '';$(o).each(function(i,item) {c += '<' + attr + '>' + item + '</' + attr + '>'; });return c;}};function isMouseLeaveOrEnter(e, handler) {if (e.type != 'mouseout' && e.typ{%*i*%}e != 'mouseover') return false;var reltg = e.relatedTarget ? e.relatedTarget : e.type == 'mouseout' ? e.toElement : e.fromElement;while (reltg && reltg != handler)reltg = reltg.parentNode;return (reltg != handler);}function showContent() {var $oTab = _this.find('.op_xsk_tab').eq(0),$feakheads = _this.find('.op_xsk_feakhead td'),$tds = _this.find('.op_xsk_tr:first td');$feakheads.each(function(i, v) {$(v).width($tds[i].offsetWidth);});_this.find('.op_xsk_feaktable').show()var $aSpan = $oTab.find({%*i*%}'span'),l = $aSpan.length, tStart = 0, tEnd = 0;if (gif) {var $aDl = $m.find('dl');$aSpan.each(function(i, o) {$aSpan[i].index = i;$(o).mouseover(function(){index = this.index;var iconL = $aSpan[index].offsetLeft - 120;if (iconL < 0) {iconL = 0;}else if (iconL > 380) {iconL = 380;}$aDl.eq(index).addClass('op_xsk_dl_block');$m.css('left',iconL);$m.css('top',$aSpan[index].parentNode.offsetTop + 32 - $d.scrollTop());}).mouseout(function(){$aDl.eq(index).removeClass('op_xsk_dl_block');});});$aDl.eac{%*i*%}h(function(i, o) {$(o).mouseover(function(ev){var oEvent = ev || event;if (isMouseLeaveOrEnter(oEvent, this)) {$(this).addClass('op_xsk_dl_block');tStart = new Date().getTime();}}).mouseout(function(ev){var oEvent = ev || event;if (isMouseLeaveOrEnter(oEvent, $aDl[index])) {$(this).removeClass('op_xsk_dl_block');tEnd = new Date().getTime(); var tSum = ((tEnd - tStart) / 1000).toFixed(2);return c({'fm': 'beha', 'url': 'http://nourl.ubs.baidu.com', 'title': tSum, 'p1': _this.p1, 'p2': 0, 'p3': (i {%*i*%}+ 1)});}});});}}this.dispose = function(){vscrollx&&vscrollx.dispose&&vscrollx.dispose();};});</script>{%/block%}