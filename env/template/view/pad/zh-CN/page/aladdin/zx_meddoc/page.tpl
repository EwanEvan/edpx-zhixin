{%extends 'base.tpl'%} {%block name='content'%}<style type="text/css">.op-zx-meddoc-title{margin-bottom:5px}.op-zx-meddoc-filter,.op-zx-meddoc-head,.op-zx-meddoc-body{position:relative;border-left:1px solid #f5f5f5;border-right:1px solid #f5f5f5}.op-zx-meddoc-filter{background:#fdfdfd}.op-zx-meddoc-filter a,.op-zx-meddoc-body a,.op-zx-meddoc-morelink a,.op-zx-meddoc-morelink a em{text-decoration:none}.op-zx-meddoc-filter{overflow:hidden;height:70px;padding:6px 10px 10px 10px;border-top:1px solid #f5f5f5;border-bottom:1px solid #ececec}.op-zx{%*i*%}-meddoc-filter-cont{margin:0 40px 0 50px}.op-zx-meddoc-filter-legend{position:absolute;top:7px;left:10px;line-height:20px;font-weight:bold}.op-zx-meddoc-filter-short{height:16px}.op-zx-meddoc-filter-more{position:absolute;display:inline-block;right:5px;top:6px;width:45px;height:20px;border:1px solid #fdfdfd;padding-left:5px;line-height:20px;font-size:14px;color:#333;cursor:pointer}.op-zx-meddoc .op-zx-meddoc-filter-more-text{color:#333}.op-zx-meddoc-filter-more-icondown,.op-zx-meddoc-filter-more{%*i*%}-iconup{position:absolute;top:2px;right:5px;width:10px;height:15px;background:url("http://www.baidu.com/aladdin/img/zhixin/triangle.png") no-repeat}.op-zx-meddoc-filter-more-icondown{background-position:-5px 2px}.op-zx-meddoc-filter-more-iconup{background-position:-19px 1px}.op-zx-meddoc-head li,.op-zx-meddoc-body li{height:30px;line-height:30px;padding:0 10px;border-bottom:1px solid #f5f5f5}.op-zx-meddoc-body .op-zx-meddoc-li{height:40px;padding:5px 10px}.op-zx-meddoc-head{color:#666}.op-zx-med{%*i*%}doc-filter span{color:#d9d9d9}.op-zx-meddoc-filter .op-zx-meddoc-filter-li{display:inline-block;height:18px;line-height:18px;color:#0000d1;cursor:pointer;white-space:nowrap;margin:0 0 4px 0;font-size:14px;padding:1px 4px}.op-zx-meddoc-filter .op-zx-meddoc-filter-li-select{padding:0 3px;color:white;background:#02a0f4;border:1px solid #008de9;border-radius:2px}.op-zx-meddoc-filter-divide{margin:0 3px}.op-zx-meddoc-s1,.op-zx-meddoc-s2,.op-zx-meddoc-s3,.op-zx-meddoc-s4,.op-zx-meddoc-s5{display:block{%*i*%};float:left;overflow:hidden}.op-zx-meddoc-li .op-zx-meddoc-s1,.op-zx-meddoc-li .op-zx-meddoc-s2,.op-zx-meddoc-li .op-zx-meddoc-s3,.op-zx-meddoc-li .op-zx-meddoc-s4,.op-zx-meddoc-li .op-zx-meddoc-s5{height:40px;line-height:20px}.op-zx-meddoc-s1{width:100px}.op-zx-meddoc-s2{width:130px;margin:0 5px}.op-zx-meddoc-s3{width:220px;margin-left:5px}.op-zx-meddoc-s4{width:64px;margin-left:10px;text-align:center}.op-zx-meddoc-s5{width:45px;margin-left:10px;text-align:center;color:#666}.op-zx-meddoc-norati{%*i*%}ng .op-zx-meddoc-s3{width:274px;margin-right:20px}.op-zx-meddoc-norating .op-zx-meddoc-s4{display:none}.op-zx-meddoc-reg{text-decoration:none;color:#000;width:40px}.op-zx-meddoc-reg,.op-zx-meddoc-regnull,.op-zx-meddoc-rating,.op-zx-meddoc-ratingnull{display:inline-block;margin:9px 0}.op-zx-meddoc-body .op-zx-meddoc-nodata{font-size:14px;color:#666;text-align:center;height:61px}.op-zx-meddoc-nodata span{display:inline-block;margin:15px 0}.op-zx-meddoc-nodata-icon{width:15px;height:15px;border:1px{%*i*%} solid #87aefb;color:white;line-height:12px;background:#98bafc;margin-right:8px}.op-zx-meddoc-body .op-zx-meddoc-button,.op-zx-meddoc-body .op-zx-meddoc-button:link{border:1px solid #bdc0c3;color:#333;background:#fafafa}.op-zx-meddoc-body .op-zx-meddoc-button:active{border:1px solid #a7aaaf;box-shadow:0 1px #c7c7c7 inset;background:#f0f0f0;background:-moz-linear-gradient(top,#ebebeb,#f5f5f5);background:-webkit-gradient(linear,0 0,0 bottom,from(#ebebeb),to(#f5f5f5))}.op-zx-meddoc-morelink span{fo{%*i*%}nt-family:simsun}.op-zx-meddoc-showurl{margin-top:5px}</style><div class="op-zx-meddoc c-clearfix"> <h3 class="op-zx-meddoc-title"><a target="_blank" href="{%$tplData.link%}">{%$tplData.title|limitlen:64|highlight:0%}</a></h3> <div class="op-zx-meddoc-filter op-zx-meddoc-filter-short" data-click="{fm:'beha'}"> <div class="op-zx-meddoc-filter-legend">地 区：</div> <a href="javascript:;" class="op-zx-meddoc-filter-more"><span class="op-zx-meddoc-filter-more-text">更多</span><span class="op-zx-meddoc-filter-more-icon op-zx-meddoc-filter-more-icondown"></span></a> <div class="op-zx-meddoc-filter-cont"> {%*地域扩展，获得ip所在省份，如果获取不到，则为null*%} {%if $extData.queryloc%} {%$loc = $extData.queryloc%} {%else%} {%if $tplData.location%}{%$loc = $tplData.location%}{%else%}{%$loc = $extData.ExtendedLocation%}{%/if%} {%/if%} {%*更多链接，初始化为第一个省份的链接数据*%} {%$defaultloc = $tplData.province[0].name%} {%$morelink = $tplData.province[0].link%} {%*选择的省份名，初始化为第一个省份名*%} {%$selloc = $defaultloc%} {%*循环省份列表，如果后端有地理位置，并且此地理位置有available值时，更改选定的地理位置*%} {%foreach $tplData.province as $item%}{%if !$loc%}{%if $item@index > 0%}<span class="op-zx-meddoc-filter-divide">|</span>{%/if%}<span class="op-zx-meddoc-filter-li OP_LOG_BTN">{%$item.name%}</span>{%else%}{%if $item@index == 0%}<span class="op-zx-meddoc-filter-li OP_LOG_BTN">{%$defaultloc|escape:"html"%}</span><span class="op-zx-meddoc-filter-divide">|</span><span class="op-zx-meddoc-filter-li OP_LOG_BTN">{%$loc|escape:"html"%}</span>{%elseif $item.name == $loc && $item.available%}{%$selloc = $item.name%}{%$morelink = $item.link%}{%elseif $item.name !=$loc%}<span class="op-zx-meddoc-filter-divide">|</span><span class="op-zx-meddoc-filter-li OP_LOG_BTN">{%$item.name%}</span>{%/if%}{%/if%}{%/foreach%} </div> </div> <ul class="op-zx-meddoc-head {%if $tplData.norating%}op-zx-meddoc-norating{%/if%}"> <li><span class="op-zx-meddoc-s1">专家名</span><span class="op-zx-meddoc-s2">医院/科室</span><span class="op-zx-meddoc-s3">咨询范围</span><span class="op-zx-meddoc-s4">患者评价</span><span class="op-zx-meddoc-s5">咨询</span></li> </ul> <ul class="op-zx-meddoc-body {%if $tplData.norating%}op-zx-meddoc-norating{%/if%}"> <div class="op-zx-meddoc-cont"> {%$listnum = 0%} {%foreach $tplData.list as $item%} {%if $item.prov == $selloc%} {%$listnum = $listnum + 1%} <li class="op-zx-meddoc-li"><span class="op-zx-meddoc-s1"><p><a target="_blank" href="{%$item.namelink%}">{%$item.name%}</a></p><p>{%$item.title1%}</p></span><span class="op-zx-meddoc-s2"><p>{%$item.hosp%}</p><p>{%$item.dept%}</p></span><span class="op-zx-meddoc-s3">{%$item.info|limitlen:56%}</span><span class="op-zx-meddoc-s4">{%if $item.ratinglink && $item.rating%}<a target="_blank" href="{%$item.ratinglink%}" class="op-zx-meddoc-rating">共{%$item.rating%}条</a>{%else%}<span class="op-zx-meddoc-ratingnull">-</span>{%/if%}</span><span class="op-zx-meddoc-s5">{%if $item.reglink%}<a target="_blank" href="{%$item.reglink%}" class="op-zx-meddoc-reg op-zx-meddoc-button">咨询</a>{%else%}<span class="op-zx-meddoc-regnull">-</span>{%/if%}</span></li> {%/if%} {%if $listnum > 2%}{%break%}{%/if%} {%/foreach%} </div> <li class="op-zx-meddoc-nodata" style="{%if $listnum > 0%}display:none;{%/if%};"><span class="op-zx-meddoc-nodata-icon">!</span> <span>筛选无结果，请尝试其他地区</span></li> <li class="op-zx-meddoc-morelink" style="{%if $listnum <3 || $morelink == ''%}display:none;{%/if%}"> <a target="_blank" href="{%$morelink|escape:'html'%}">更多推荐专家<span>&gt;&gt;</span></a> </li> </ul> {%if $tplData.showurl%}<div class="op-zx-meddoc-showurl c-showurl">{%$tplData.showurl|limitlen:40%}</div>{%/if%}</div><script >
    A.setup({
      'query': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}',
        'srcid': '{%$extData.resourceid%}',
        'provs': {%json_encode($tplData.province)%},
        'selectloc': '{%$selloc|escape:"javascript"%}'
    });
</script><script>A.init(function(){var _this = this;var T = A.baidu;var query = _this.data.query,srcid = _this.data.srcid,provs = _this.data.provs,selectloc = _this.data.selectloc;var listdata ={};var provinces = $('.op-zx-meddoc-filter-li'),filter = $('.op-zx-meddoc-filter')[0],filterlegend = $('.op-zx-meddoc-filter-legend')[0],filtermore = $('.op-zx-meddoc-filter-more')[0],filtertext = $('.op-zx-meddoc-filter-more-text')[0],filtericon = $('.op-zx-meddoc-filter-more-icon')[0],cont = $('.op-zx-m{%*i*%}eddoc-cont')[0],nodata = $('.op-zx-meddoc-nodata')[0],morelink = $('.op-zx-meddoc-morelink')[0];var tplstr = '<li class="op-zx-meddoc-li"><span class="op-zx-meddoc-s1"><p><a target="_blank" href="#{1}">#{0}</a></p><p>#{2}</p></span><span class="op-zx-meddoc-s2"><p>#{4}</p><p>#{5}</p></span><span class="op-zx-meddoc-s3">#{6}</span><span class="op-zx-meddoc-s4">#{7}</span><span class="op-zx-meddoc-s5">#{8}</span></li>';T.each(provinces,function(item,i){if(T.dom.getText(item) == selectloc){if (!T.d{%*i*%}om.hasClass(item, 'op-zx-meddoc-filter-li-select')) {T.addClass(item,'op-zx-meddoc-filter-li-select');}}T.on(item,'click',function(e){filterList(item);});});T.on(filtermore,'click',function(e){if(T.dom.hasClass(filter,'op-zx-meddoc-filter-short')){T.dom.removeClass(filter,'op-zx-meddoc-filter-short');filtertext.innerHTML = '收起';T.dom.addClass(filtericon,'op-zx-meddoc-filter-more-iconup');T.dom.removeClass(filtericon,'op-zx-meddoc-filter-more-icondown');}else{T.dom.addClass(filter,'op-zx-meddoc-f{%*i*%}ilter-short');filtertext.innerHTML = '更多';T.dom.addClass(filtericon,'op-zx-meddoc-filter-more-icondown');T.dom.removeClass(filtericon,'op-zx-meddoc-filter-more-iconup');}});function filterList(item){T.each(provinces,function(item,i){T.removeClass(item,'op-zx-meddoc-filter-li-select');});T.addClass(item,'op-zx-meddoc-filter-li-select');var text = T.dom.getText(item),link = '';T.each(provs,function(p,l){if(p.name == text){link = p.link;}});if(listdata[text]){renderList(listdata[text],link);}else{g{%*i*%}etList(text,link);}}function getList(text,link){_this.ajax(query,srcid,{co:'list[prov='+text+']',success:function(data){var list = [];if(data[0] && data[0].list){list = data[0].list;}if(list.length > 0){listdata[text] = list;renderList(listdata[text],link);}else{noList();}},error:function(e){noList();}});}function renderList(list,link){cont.innerHTML = '';T.each(list,function(item,i){if(i>2){return;}var ratinghtml = '<span class="op-zx-meddoc-ratingnull">-</span>',reglinkhtml= '<span class="op-z{%*i*%}x-meddoc-regnull">-</span>';if(item.ratinglink && item.rating){ratinghtml = '<a target="_blank" href="'+item.ratinglink+'" class="op-zx-meddoc-rating">共'+item.rating+'条</a>';}if(item.reglink){reglinkhtml = '<a target="_blank" href="'+item.reglink+'" class="op-zx-meddoc-reg op-zx-meddoc-button">咨询</a>';}T.insertHTML(cont,'beforeEnd',T.format(tplstr,[item.name,item.namelink,item.title1,item.title2,item.hosp,item.dept,item.info,ratinghtml,reglinkhtml]));});T.show(cont);T.hide(nodata);if(list.length{%*i*%} >= 3 && link){T.setAttr(T.dom.children(morelink)[0],'href',link);T.show(morelink);}else{T.hide(morelink);}}function noList(){cont.innerHTML = '';T.hide(cont);T.hide(morelink);T.show(nodata);}});</script>{%/block%}