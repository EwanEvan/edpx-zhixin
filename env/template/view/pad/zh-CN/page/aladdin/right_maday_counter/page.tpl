{%extends 'right_base.tpl'%} {%block name='content'%}<style>.opr-maday_counter{color:#747474;padding-bottom:10px;background:#f5f5f5 url(http://www.baidu.com/aladdin/img/51/fist.gif) right bottom no-repeat}.container_l .opr-maday_counter{width:440px}.container_s .opr-maday_counter{width:270px}.opr-maday_counter-title-s{display:none}.container_l .opr-maday_counter-title-l{display:block}.container_l .opr-maday_counter-title-s{display:none}.container_s .opr-maday_counter-title-l{display:none}.container_s .opr-maday_counter-title-s{display:block}.opr-m{%*i*%}aday_counter td{padding:0;vertical-align:top}.opr-maday_counter-left{width:58px}.opr-maday_counter-pot{width:30px;height:50px;overflow:hidden;margin:0 auto;background-color:#f5f5f5;background-image:url(http://www.baidu.com/aladdin/img/51/bg.gif)}.opr-maday_counter-pot1{background-position:-140px -50px}.opr-maday_counter-pot2{background-position:-140px 0}.opr-maday_counter-button{background:#de493b;padding:0;margin:0;border:0;width:84px;height:26px;text-align:center;color:#fff;cursor:pointer;marg{%*i*%}in-right:5px;float:left}.opr-maday_counter-button-disabled{background:#999;color:#ebebeb}.opr-maday_counter h3{font-family:'微软雅黑';font-size:18px;margin-top:8px}.opr-maday_counter-tip{position:absolute;display:none;color:#de493b;width:100px;text-align:center;left:0}.opr-maday_counter-counter-result{float:left;margin-top:3px}.opr-maday_counter-counter-result b{color:#d93535}</style><div class="opr-maday_counter"> <table style="margin:0;"> <tr> <td class="opr-maday_counter-left"> <div class="opr-ma{%*i*%}day_counter-pot opr-maday_counter-pot1" style="margin-top:10px;"> <div class="opr-maday_counter-pot opr-maday_counter-pot2"></div> </div> </td> <td> <h3 class="opr-maday_counter-title-l">{%$tplData.smalltitle|escape%}</h3> <h3 class="opr-maday_counter-title-s">{%$tplData.smalltitle|escape%}</h3> <div style="margin-top:7px;position:relative;" class="c-clearfix"> <span class="opr-maday_counter-tip">+1</span> <button class="opr-maday_counter-button">{%$tplData.buttontext%}</button> <span class="opr-maday_counter-counter-result"></span> <div> </td> </tr> </table></div> <script>A.setup('geturl', '{%$tplData.geturl|escape:'javascript'%}');A.setup('posturl', '{%$tplData.posturl|escape:'javascript'%}');</script><script>A.init(function(){var baidu = A.baidu, _this = this;var isCounterEnable = true, isLoading = false;var btn = _this.qq('opr-maday_counter-button');baidu.on(btn, 'click', function(){if(isCounterEnable && !isLoading){addone();}else{}isLoading = true;});baidu.sio.callByServer(_this.data.geturl, function(data){if(data.status == 0){shownum(data.data.sum);}},{timeOut:5000,queryField:'cb',onfailure:function(){shownum();}});function addone(){baidu.sio.callByServer(_this.data.posturl, f{%*i*%}unction(data){if(data.data){ animate(parseInt(data.data.sum));}isCounterEnable = false;isLoading = false;},{timeOut:5000,queryField:'cb',onfailure:function(){shownum();}});}function shownum(num){var elem = _this.qq('opr-maday_counter-counter-result');var num = parseInt(num);if(num >= 0){elem.innerHTML = '送出<b>'+num+'</b>份欢乐';}else{elem.innerHTML = '';}}function animate(num){A.use('animation', function(){var an = A.ui.animation(function(){var from = {height:50}, to = {height:0};var pot = _this.qq{%*i*%}('opr-maday_counter-pot2');this.tween(from).to(to, 1000).delay(500).onUpdate(function(){pot.style.height = this.height + 'px';}).easing( this.Easing.Sinusoidal.In ).onComplete(function(){an.stop();baidu.addClass(btn, 'opr-maday_counter-button-disabled');btn.innerHTML='感谢支持';shownum(num);}).start();var tip = _this.qq('opr-maday_counter-tip');tip.style.display = 'block';this.tween({x:0}).to({x:100}, 1000).onUpdate(function(){tip.style.top = 0 - this.x * 1.2 + 'px';tip.style.fontSize = this.x + 'px{%*i*%}';tip.style.opacity = (100 - this.x)/100;tip.style.filter = 'alpha(opacity='+(100 - this.x)+');';tip.style.lineHeight = this.x + 'px';}).start();}).start();});}});</script>{%/block%}