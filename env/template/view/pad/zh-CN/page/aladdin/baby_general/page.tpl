{%extends 'c_base.tpl'%} {%block name='content'%}{%* 选中tab index *%}{%$escaped_selectedTid=0%}{%foreach $tplData.tab as $tab%}{%if $tab.text == $tplData.selected[0].tab%}{%$escaped_selectedTid=$tab@index%}{%/if%}{%/foreach%}{%* 选中stab index *%}{%$escaped_selectedStid=0%}{%foreach $tplData.tab[$escaped_selectedTid].stab as $stab%}{%if $stab.text == $tplData.selected[0].stab%}{%$escaped_selectedStid=$stab@index%}{%/if%}{%/foreach%}{%* 无图时,文字摘要(summary)字节数限制 *%}{%$escaped_maxlen=146%}{%* 有图时,文字摘要(summary)字节数限制 *%}{%$escaped_maxlen_i=120%}{%* 无图时,文字链接(link)字节数限制 *%}{%$escaped_maxlen_link=36%}{%* 有图时,文字链接(link)字节数限制 *%}{%$escaped_maxlen_link_i=30%}{%function op_baby_general_content data=''%}<div class="c-row"> {%if $data.image%}{%* 图文 *%} <div class="c-span4"><a href="{%$data.image[0].url%}" target="_blank"><img class="c-img c-img4" src="{%$data.image[0].src|escape:'html'%}" alt="{%$data.image[0].alt|escape:'html'%}" /></a></div> <div class="c-span20 c-span-last"> <div>{%$data.summary|limitlen:$escaped_maxlen_i|escape:'html'%}<a href="{%$data.morelink[0].url|escape:'html'%}"  target="_blank" class="op-baby-general-more">{%$data.morelink[0].text|escape:'html'%}</a></div> <ul class="c-row c-gap-top-small"> {%foreach $data.link as $link%} <li class="c-span10{%if $link@index%2 != 0%} c-span-last{%/if%}">• <a href="{%$link.url|escape:'html'%}" title="{%$link.text|escape:'html'%}" target="_blank">{%$link.text|limitlen:$escaped_maxlen_link_i|escape:'html'%}</a></li> {%/foreach%} </ul> </div> {%else%}{%* 纯文字 *%} <div class="c-span24 c-span-last"> <div>{%$data.summary|limitlen:$escaped_maxlen|escape:'html'%}<a href="{%$data.morelink[0].url|escape:'html'%}"  target="_blank" class="op-baby-general-more">{%$data.morelink[0].text|escape:'html'%}</a></div> <ul class="c-row c-gap-top-small"> {%foreach $data.link as $link%} <li class="c-span12{%if $link@index%2 != 0%} c-span-last{%/if%}">• <a href="{%$link.url|escape:'html'%}" title="{%$link.text|escape:'html'%}" target="_blank">{%$link.text|limitlen:$escaped_maxlen_link|escape:'html'%}</a></li> {%/foreach%} </ul> </div> {%/if%}</div>{%/function%}<style data-merge>{%fe_fn_c_css css='tabs'%}{%fe_fn_c_css css='img'%}.op-baby-general img{min-height:1px}.op-baby-general-more{white-space:nowrap}.op-baby-general-loading{background:url(http://www.baidu.com/aladdin/img/videoidea/loading_L.gif) no-repeat 50% 50%;height:110px;overflow:hidden}.op-baby-general-loading *{visibility:hidden}.op-baby-general-none{padding-top:20px;text-align:center}</style><div class="op-baby-general"> {%if $tplData.tab.text%} <ul class="c-tabs-nav c-tabs-nav-one"> <li class="c-tabs-nav-li c-tabs-nav-selected OP_LOG_BTN" data-click="{fm:'beha'}">{%$tab.text|escape:'html'%}</li> </ul> <div class="c-tabs-content c-gap-top"> {%op_baby_general_content data=$tplData.tab%} </div> {%else%} <div class="c-tabs op-baby-general-tab"> <ul class="c-tabs-nav"> {%foreach $tplData.tab as $tab%} {%if !$tab@first%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}">{%$tab.text|escape:'html'%}</li> {%/foreach%} </ul> {%foreach $tplData.tab as $tab%} {%if $tab@index != $escaped_selectedTid%}<div class="c-tabs-content"></div>{%continue%}{%/if%} <div class="c-tabs c-tabs-content op-baby-general-stab"> {%if $tab.stab%}{%* 有二级TAB的情况 *%} <ul class="c-tabs-nav"> {%foreach $tab.stab as $stab%} {%if !$stab@first%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}">{%$stab.text|escape:'html'%}</li> {%/foreach%} </ul> {%foreach $tab.stab as $stab%} {%if $stab@index != $escaped_selectedStid%}<div class="c-tabs-content"></div>{%continue%}{%/if%} <div class="c-tabs-content"> {%op_baby_general_content data=$stab%} </div> {%/foreach%} {%else%}{%* 无二级TAB的情况 *%} <div class="c-tabs-content c-gap-top"> {%op_baby_general_content data=$tab%} </div> {%/if%} </div> {%/foreach%} </div> {%/if%}</div><script >
  A.setup({'selectedTid':'{%$escaped_selectedTid%}','selectedStid':'{%$escaped_selectedStid%}',
    'maxlen':'{%$escaped_maxlen%}','maxlen_i':'{%$escaped_maxlen_i%}',
    'maxlen_link':'{%$escaped_maxlen_link%}','maxlen_link_i':'{%$escaped_maxlen_link_i%}',
    'srcid':'{%$extData.resourceid%}','q':'{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:'html'|escape:'javascript'%}'});
</script><script>A.setup(function(){var _this = this,loaded=false,built = new Array(10),_e = function(str) {var s = ""; if (str.length == 0) return ""; s = str.replace(/&/g, "&gt;"); s = s.replace(/</g, "&lt;"); s = s.replace(/>/g, "&gt;"); s = s.replace(/ /g, "&nbsp;"); s = s.replace(/\'/g, "&apos"); s = s.replace(/\"/g, "&quot;"); s = s.replace(/\n/g, "<br>"); return s;};A.use('jquery,tabs5', function(){function build_tab(d) {var s = [];if(d.stab) {s.push('<ul class="c-tabs-nav">');$.each(d.st{%*i*%}ab, function(v,i){if(i){ s.push('<li class="c-tabs-nav-sep"></li>'); }s.push($.format('<li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:\'beha\'}">#{0}</li>', _e(v.text)));});s.push('</ul>');$.each(d.stab, function(v, i){s.push('<div class="c-tabs-content">');s.push(build_content(v));s.push('</div>');});} else {s.push(build_content(d));}return s.join('');}function build_content(d) {if(d.image && d.image[0]){return build_img(d);} else {return build_txt(d);}}function build_txt(d){var s=[];s.pu{%*i*%}sh('<div class="c-row"><div class="c-span24 c-span-last">');s.push($.format('<div>#{0}<a href="#{1}" target="_blank" class="op-baby-general-more">#{2}</a></div>',_e(limitlen(d.summary,_this.data.maxlen)), _e(d.morelink[0].url), _e(d.morelink[0].text)));s.push('<ul class="c-row c-gap-top-small">');$.each(d.link, function(v, i){s.push($.format('<li class="c-span12#{0}">• <a href="#{1}" title="#{2}" target="_blank">#{3}</a></li>', i%2!=0?' c-span-last':'', _e(v.url),_e(v.text), _e(limitlen(v.text, {%*i*%}_this.data.maxlen_link))));});s.push('</ul></div></div>');return s.join('');}function build_img(d){var s=[];s.push('<div class="c-row">');s.push($.format('<div class="c-span4"><a href="#{0}" target="_blank"><img class="c-img c-img4" src="#{1}" alt="#{2}" /></a></div>', _e(d.image[0].url), _e(d.image[0].src), _e(d.image[0].alt)));s.push('<div class="c-span20 c-span-last">');s.push($.format('<div>#{0}<a href="#{1}" target="_blank" class="op-baby-general-more">#{2}</a></div>',_e(limitlen(d.summary,{%*i*%}_this.data.maxlen_i)), _e(d.morelink[0].url), _e(d.morelink[0].text)));s.push('<ul class="c-row c-gap-top-small">');$.each(d.link, function(v, i){s.push($.format('<li class="c-span10#{0}">• <a href="#{1}" title="#{2}" target="_blank">#{3}</a></li>', i%2!=0?' c-span-last':'', _e(v.url),_e(v.text), _e(limitlen(v.text, _this.data.maxlen_link_i))));});s.push('</ul></div></div>');return s.join('');}function load_tab(cn, cc, scn) {if(built[cn]) {return;}var $cc = $(cc),rebuilt=false;if(!loaded) {$cc.a{%*i*%}ddClass('op-baby-general-loading');_this.ajax(_this.data.q, _this.data.srcid, {success:function(data){if(!data[0] || !data[0].tab || !data[0].tab[0]) {$cc.html('<p class="op-baby-general-none">暂无信息</p>');$cc.removeClass('op-baby-general-loading');return;}loaded = data[0].tab;$cc.html(build_tab(loaded[cn]));if(loaded[cn].stab){$cc.addClass('c-tabs');A.ui.tabs5($cc[0],{toggleSep:false, current:scn});} else {$cc.addClass('c-gap-top');}$cc.removeClass('op-baby-general-loading');built[cn]=true;},erro{%*i*%}r: function(){$cc.html('<p class="op-baby-general-none">暂无信息</p>');$cc.removeClass('op-baby-general-loading').removeClass('c-tabs');}});return;}$cc.html(build_tab(loaded[cn]));if(loaded[cn].stab){$cc.addClass('c-tabs');var opt = {toggleSep:false};if(!rebuilt && _this.data.selectedTid == cn) {opt.current = _this.data.selectedStid;rebuilt = true;}A.ui.tabs5($cc[0], opt);} else {$cc.addClass('c-gap-top');}built[cn]=true; }function getByteLength(str) {return str.replace(/[^\x00-\xff]/g, 'ci').length{%*i*%};}function subByte(str, len, tail) {if(len < 0 || getByteLength(str) <= len){return str.valueOf();}var source = str.substr(0, len).replace(/([^\x00-\xff])/g,"\x241 ").substr(0, len).replace(/[^\x00-\xff]$/,"").replace(/([^\x00-\xff]) /g,"\x241");return source + (tail || "");}function limitlen(str, len){var tail = '...', tail_len = getByteLength(tail);if (getByteLength(str) > len) {return subByte(str, len - tail_len, tail);}return str;}A.ui.tabs5(_this.find('.op-baby-general-tab').get(0),{toggleS{%*i*%}ep:true, current:_this.data.selectedTid, onChange:function(cn, cc){load_tab(cn, cc, 0);}});A.ui.tabs5(_this.find('.op-baby-general-stab').get(0),{toggleSep:false,current:_this.data.selectedStid,onChange:function(scn, scc){var cc = $('.op-baby-general-tab>.c-tabs-content').eq(_this.data.selectedTid).removeClass('c-tabs');load_tab(_this.data.selectedTid, cc, scn);}});});});</script>{%/block%}