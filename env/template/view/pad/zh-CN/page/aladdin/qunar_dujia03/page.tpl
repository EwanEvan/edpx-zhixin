{%extends 'c_base.tpl'%} {%block name='data_modifier'%}{%$extData.feData.hasShowURLGap = true%}{%$escaped_tpl="{%basename($smarty.current_dir)%}"%}{%if $tplData.sourcetype eq "sight"%}{%$tf="bd_zhixin_jingdian_"%}{%$extrack="bd_zhixin_dujia_jingdian_"%}{%elseif $tplData.sourcetype eq "resort"%}{%$tf="bd_zhixin_hotel_"%}{%$extrack="bd_zhixin_dujia_hotel_"%}{%/if%}{%/block%}{%block name='title'%}<style type="text/css">{%fe_fn_c_css css='input'%}{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='dropdown2'%}{%fe_fn_c_css css='img'%}.op-{%$escaped_tpl%}-label,.op-{%$escaped_tpl%}-dep-container,.op-{%$escaped_tpl%}-query-container,.op-{%$escaped_tpl%}-search-btn{float:left;display:inline}.op-{%$escaped_tpl%}-label{line-height:1.87em;width:55px}.op-{%$escaped_tpl%}-dep-container{width:89px;outline:0}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-dep-container{width:99px}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-query-container .c-input12{width:234px}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-query-container .c-input12 input{width:216px}.op-{%$escaped_tpl%}-query-container{position:relative}.op-{%$escaped_tpl%}-query-container-active{z-index:200}.op-{%$escaped_tpl%}-hot-title{font-weight:bold}.op-{%$escaped_tpl%}-hot-links span{color:#00c;display:inline-block;cursor:pointer;text-decoration:none}.op-{%$escaped_tpl%}-hot-links span:hover{color:#f60}.op-{%$escaped_tpl%}-query-container-active .op-{%$escaped_tpl%}-hot-query{display:block}.op-{%$escaped_tpl%}-hot-query{position:absolute;display:none;top:25px;left:0;background-color:#fff;border:1px solid #bbb;padding:5px 4px}.op-{%$escaped_tpl%}-dep-tabs{border-bottom:1px solid #ddd}.op-{%$escaped_tpl%}-dep-tab{position:relative;height:20px;line-height:1.33em;float:left;border:1px solid #ddd;border-bottom:0;padding:0 8px;cursor:pointer;color:#39f;background-color:#f9f9f9}.op-{%$escaped_tpl%}-dep-tab-active{margin-bottom:-1px;height:21px;background-color:#fff}.op-{%$escaped_tpl%}-dep-panel{display:none;padding:5px 0}.op-{%$escaped_tpl%}-dep-panel-active{display:block}.op-{%$escaped_tpl%}-dep-panel li{float:left;width:70px;text-align:center;line-height:1.87em;height:28px;overflow:hidden}.op-{%$escaped_tpl%}-dep-panel .c-dropdown2-selected{background-color:#fff;color:#f60}.op-{%$escaped_tpl%}-query-container .op-{%$escaped_tpl%}-large-input{width:388px}.op-{%$escaped_tpl%}-query-container .op-{%$escaped_tpl%}-large-input input{width:370px}.op-{%$escaped_tpl%}-hot-captain,.op-{%$escaped_tpl%}-hot-links{border-bottom:1px solid #ddd;padding-bottom:5px}.op-{%$escaped_tpl%}-hot-links-last{border-bottom:0}.op-{%$escaped_tpl%}-hot-query-box{padding:0 5px}.op-{%$escaped_tpl%}-info{position:relative}.op-{%$escaped_tpl%}-info .c-span18{padding-bottom:20px}.op-{%$escaped_tpl%}-info-more{display:block;right:3px;bottom:3px;background-color:#fff;position:absolute}.op-{%$escaped_tpl%}-price{color:#f60;font-weight:bold}.op-{%$escaped_tpl%}-desc{color:#aaa}.op-{%$escaped_tpl%}-routes,.op-{%$escaped_tpl%}-hotlinks{border-top:1px solid #eee;padding-top:5px}.op-{%$escaped_tpl%}-routes .op-{%$escaped_tpl%}-routes-title{font-weight:bold;line-height:1.6em}.op-{%$escaped_tpl%}-routes .op-{%$escaped_tpl%}-price{position:absolute;right:0;top:0}.op-{%$escaped_tpl%}-routes li{clear:both;line-height:1.6em;position:relative}.op-{%$escaped_tpl%}-hotlinks{height:20px;overflow:hidden}.op-{%$escaped_tpl%}-hotlinks-title{font-weight:bold}.op-{%$escaped_tpl%}-hotlinks *{white-space:nowrap}.op-{%$escaped_tpl%}-header-title .op-{%$escaped_tpl%}-icon{width:16px;height:16px;background:url(http://bcscdn.baidu.com/fcnp-ip/1013/pic/283772069bc05b531cbb6d45cf2b91a1.png) no-repeat left top}</style><h3 class="t c-gap-bottom-small"> <a class="op-{%$escaped_tpl%}-header-title" target="_blank" href="{%$tplData.url|escape%}"><span class="c-icon c-gap-icon-right-small op-{%$escaped_tpl%}-icon"></span>{%$tplData.title|limitlen:60|escape|highlight:0%}</a> <span class="tsuf tsuf-op"></span></h3>{%/block%}{%block name='content'%}<div class="op-{%$escaped_tpl%} c-border"> <div class="op-{%$escaped_tpl%}-title c-row c-gap-top"> <div class="op-{%$escaped_tpl%}-search"> {%if $tplData.sourcetype eq "sight"%} <div class="op-{%$escaped_tpl%}-label">出发地</div> <div class="op-{%$escaped_tpl%}-dep-container c-gap-right"> <div class="c-dropdown2 op-{%$escaped_tpl%}-dep"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tplData.dep|escape%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <div class="c-dropdown2-menubox"> <ul class="op-{%$escaped_tpl%}-dep-tabs c-row c-gap-top"> {%foreach $tplData.depsec as $sec%} <li class="op-{%$escaped_tpl%}-dep-tab c-gap-left{%if $sec@first%} op-{%$escaped_tpl%}-dep-tab-active{%/if%}">{%$sec.name|escape%}</li> {%/foreach%} </ul> {%$depinsec=0%} {%foreach $tplData.depsec as $sec%} <ul class="c-row op-{%$escaped_tpl%}-dep-panel{%if $sec@first%} op-{%$escaped_tpl%}-dep-panel-active{%/if%}"> {%foreach $sec.dep as $dep%} <li class="c-dropdown2-option" data-value="{%$dep.city|escape%}">{%$dep.city|escape%}</li> {%if $dep.city==$tplData.dep%} {%$depinsec=1%} {%/if%} {%/foreach%} </ul> {%/foreach%} {%if $depinsec==0 and $tplData.dep != ''%} <span style="display: none;" class="c-dropdown2-option" data-value="{%$tplData.dep|escape%}">{%$tplData.dep|escape%}</span> {%/if%} </div> </div> </div> </div> </div> {%/if%} <div class="op-{%$escaped_tpl%}-query-container c-gap-right"> <span class="c-input{%if $tplData.sourcetype eq "sight"%} c-input12{%/if%}{%if $tplData.sourcetype eq "resort"%} op-{%$escaped_tpl%}-large-input{%/if%}"> <input type="text" class="op-{%$escaped_tpl%}-query" value="{%$tplData.key|escape%}" placeholder="请输入内容"/> </span> <div class="op-{%$escaped_tpl%}-hot-query{%if $tplData.sourcetype eq "sight"%} c-input12{%/if%}{%if $tplData.sourcetype eq "resort"%} op-{%$escaped_tpl%}-large-input{%/if%}"> <div class="op-{%$escaped_tpl%}-hot-query-box"> <div class="c-row op-{%$escaped_tpl%}-hot-captain">热门搜索</div> {%foreach $tplData.hotstype as $type%} <div class="op-{%$escaped_tpl%}-hot-title c-row c-gap-top-small">{%$type.name|escape%}</div> <div class="op-{%$escaped_tpl%}-hot-links c-row{%if $type@last%} op-{%$escaped_tpl%}-hot-links-last{%/if%}"> {%foreach $type.link as $link%} <span class="c-gap-right op-{%$escaped_tpl%}-hot-query-link">{%$link.name|escape%}</span> {%/foreach%} </div> {%/foreach%} </div> </div> </div> <a href="" target="_blank" class="op-{%$escaped_tpl%}-search-btn c-btn OP_LOG_BTN c-btn-primary">去哪儿查询</a> </div> </div> <div class="op-{%$escaped_tpl%}-info c-gap-top c-row"> <div class="c-span6"><a href="http://dujia.qunar.com/p/slist?sight_id={%$tplData.sightid|escape:'url'%}&amp;query={%$tplData.key|escape:'url'%}&amp;ex_track={%$extrack|escape%}05&amp;tf={%$tf|escape%}img_01" target="_blank"><img src="{%$tplData.thumbnail|escape%}" class="c-img6" /></a></div> <div class="c-span18 c-span-last"> {%if $tplData.sourcetype eq "resort"%} <h3>{%$tplData.key|escape%}</h3> {%/if%} {%foreach $tplData.desc as $desc%} <p {%if !$desc@first%}class="c-gap-top"{%/if%}>{%$desc.content|limitlen:110|escape|highlight%}</p> {%/foreach%} </div> <a href="http://dujia.qunar.com/p/slist?sight_id={%$tplData.sightid|escape:'url'%}&amp;query={%$tplData.key|escape:'url'%}&amp;ex_track={%$extrack|escape%}05&amp;tf={%$tf|escape%}img_02" target="_blank" class="op-{%$escaped_tpl%}-info-more">查看全部</a> </div> <div class="op-{%$escaped_tpl%}-routes c-gap-top-small"> <div class="op-{%$escaped_tpl%}-routes-title">{%if $tplData.sourcetype eq "sight"%}相关线路推荐{%/if%}{%if $tplData.sourcetype eq "resort"%}相关度假线路{%/if%}</div> <ul class="c-row op-{%$escaped_tpl%}-routes-list"> {%foreach $tplData.route as $index => $route%} <li class="c-span24 c-span-last"> {%$reducelength=2%} {%if $route.type == "tuan"%} <i class="c-text c-text-warning">团</i> {%elseif $route.type == "discount"%} <i class="c-text c-text-warning">惠</i> {%elseif $route.type == "ticket"%} <i class="c-text c-text-warning">票</i> {%else%} {%$reducelength=0%} {%/if%} <a href="{%$route.link|escape%}{%if strpos($route.link,'?')==''%}?{%else%}&amp;{%/if%}tf={%$tf|escape%}route_{%($index+1)|escape%}&amp;ex_track={%$extrack|escape%}03" target="_blank"> {%$route.title|limitlen:(62-$reducelength)|escape|highlight%} </a> <span class="op-{%$escaped_tpl%}-price">&yen;{%$route.price|escape%}起</span> </li> {%/foreach%} </ul> {%$tfpattern='/tf=[_\w\d]+/i'%} {%$expattern='/ex_track=[_\w\d]+/i'%} {%$exstr="ex_track={%$extrack%}03"%} {%$tfstr="tf={%$tf%}route_more"%} <a class="op-{%$escaped_tpl%}-more-link" href="{%preg_replace($expattern,$exstr,preg_replace($tfpattern,$tfstr,$tplData.url))|escape%}" target="_blank">查看更多度假线路&gt;&gt;</a> </div> {%if $tplData.hotq and count($tplData.hotq)%} <div class="op-{%$escaped_tpl%}-hotlinks c-gap-top op-{%$escaped_tpl%}-clear"> <span class="op-{%$escaped_tpl%}-hotlinks-title c-gap-right">{%if $tplData.sourcetype eq "sight"%}其他周边景点推荐{%/if%}{%if $tplData.sourcetype eq "resort"%}其他度假村推荐{%/if%}</span> {%foreach $tplData.hotq as $link%} <a class="c-gap-right" href="http://dujia.qunar.com/p/slist?sight_id={%$link.sightid|escape:'url'%}&amp;query={%$link.name|escape:'url'%}&amp;tf={%$tf|escape%}other&amp;ex_track={%$extrack|escape%}04" target="_blank">{%$link.name|escape%}</a> {%/foreach%} </div> {%/if%} <img src="http://dujia.qunar.com/bs.png?checkstats={%$tplData.checkstats|escape:'url'%}&amp;r={%time()%}{%100000000+rand(0,100000000)%}" style="position: absolute;" /></div><script >
    A.setup({dep:'{%$tplData.dep|escape:"javascript"%}',tpl:'{%$escaped_tpl|escape:"javascript"%}',type:'{%$tplData.sourcetype|escape:"javascript"%}',key:'{%$tplData.key|escape:"javascript"%}',sightid:'{%$tplData.sightid|escape:"javascript"%}',tf:'{%$tf|escape:"javascript"%}',extrack:'{%$extrack|escape:"javascript"%}'});
</script><script data-merge>A.setup(function(){var _this = this;var dep=_this.data.dep||'';var ex_track="";var _tf="";if(_this.data.type=="sight"){_tf="02";ex_track="&ex_track=bd_zhixin_dujia_jingdian_02";}else if(_this.data.type=="resort"){_tf="03";ex_track="&ex_track=bd_zhixin_dujia_hotel_02";}var replaceCls=function(str){return (str||'').replace(/##tpl##/g,'op-'+_this.data.tpl);};var Deppanel=(function(){var depselector;var $title=_this.find('.'+replaceCls('##tpl##-title'));var $dom = _this.f{%*i*%}ind('.'+replaceCls('##tpl##-dep-container'));if($dom.length){A.use('dropdown21', function(){ depselector = A.ui.dropdown21($dom.get(0),{type: 'custom',width: 350,onchange: function(){dep=depselector.getValue();if(List&&List.changeDep){List.changeDep(dep);}_update();}});var _update=function(){dep=depselector.getValue();if(dep.length>3){$title.find('.'+replaceCls('##tpl##-title-longdep'));}else{$title.find('.'+replaceCls('##tpl##-title-longdep'));}};if(dep){depselector.setValue(dep);}_update();var{%*i*%} $tabs=_this.find('.'+replaceCls('##tpl##-dep-tab'));var $panels=_this.find('.'+replaceCls('##tpl##-dep-panel'));var currentindex=0;var activeCls=replaceCls('##tpl##-dep-tab-active');var panelactiveCls=replaceCls('##tpl##-dep-panel-active');$tabs.each(function(index,tab){if(index<$panels.length){$(tab).bind('click',function(){$tabs.eq(currentindex).removeClass(activeCls);$panels.eq(currentindex).removeClass(panelactiveCls);currentindex=index;$tabs.eq(currentindex).addClass(activeCls);$panels.eq({%*i*%}currentindex).addClass(panelactiveCls);});}});});}return {dispose: function(){if(depselector&&depselector.dispose){depselector.dispose();}}};})();var Search=(function(){var $querydom=_this.find('.'+replaceCls('##tpl##-query-container'));var $searchdom=_this.find('.'+replaceCls('##tpl##-query'));var enter=false;var activeCls=replaceCls('##tpl##-query-container-active');$searchdom.bind('focus',function(e){if(!$searchdom.val()){$querydom.addClass(activeCls);}});$searchdom.bind('keyup',function(e){i{%*i*%}f(!$searchdom.val()){$querydom.addClass(activeCls);}else{$querydom.removeClass(activeCls);}});$querydom.bind('mouseenter',function(){enter=true;});$querydom.bind('mouseleave',function(){enter=false;});var qnmousedown = function(){if(!enter){$querydom.removeClass(activeCls);}};$(document).bind('mousedown',qnmousedown);var search=function(){var v=$searchdom.val();var params=[];if(dep){params.push('dep='+encodeURIComponent(dep));}if(v){params.push('query='+encodeURIComponent(v));}if(v==_this.data.k{%*i*%}ey){params.push('sight_id='+encodeURIComponent(_this.data.sightid));}return 'http://dujia.qunar.com/p/slist?'+params.join('&');};var $ns=_this.find('.'+replaceCls('##tpl##-hot-query-link')),linkdom;$ns.each(function(i,linkdom){var city=(linkdom.innerText||linkdom.textContent);$(linkdom).bind('click',function(){$querydom.removeClass(activeCls);$searchdom.val(city);});});var $button=_this.find('.'+replaceCls('##tpl##-search-btn'));$button.bind('click',function(e){$button.attr('href',search()+'&tf={%*i*%}bd_zhixin_search_'+_tf+ex_track);});return {dispose: function(){$(document).unbind('mousedown',qnmousedown);}};})();var List=(function(){var ajaxFinished = false;var _bytelen=function(source){return String(source).replace(/[^\x00-\xff]/g,"ci").length;};var _cutstr=function (source,length,tail){source=String(source);tail=tail||"...";var bytelen=source.replace(/[^\x00-\xff]/g,"ci").length;if(length<0||bytelen<=length){return source;}length=length-tail.length;source=source.substr(0,length).replace({%*i*%}/([^\x00-\xff])/g,"\x241 ").substr(0,length).replace(/[^\x00-\xff]$/,"").replace(/([^\x00-\xff]) /g,"\x241");return source+tail;};var cutstr=function(str,length){if(length<_bytelen(str.replace(/(<em>|<\/em>)/g,''))){var highlights=[];str=str.replace(/<em>.*?<\/em>/g,function(matchstr,index){var flag={start: index,end: index+matchstr.length-9};highlights.push(flag);return matchstr.substring(4,matchstr.length-5);});var newstr=_cutstr(str,length);for( var i=0; i<highlights.length; i++){if(highlight{%*i*%}s[i].start>=newstr.length-1){break;}if(highlights[i].end>newstr.length-1){highlights[i].end=newstr.length-1;}newstr=newstr.substring(0,highlights[i].start) + '<em>'+newstr.substring(highlights[i].start,highlights[i].end)+'</em>'+newstr.substring(highlights[i].end);}return newstr;}return str;};var getData=function(depstr){if(ajaxFinished) return; var url='http://www.baidu.com/qunarui/api/zhixin/searchSightRoute?query='+encodeURIComponent(_this.data.key)+'&departure='+encodeURIComponent(depstr);$.{%*i*%}ajax({url: url,dataType: 'jsonp',success: render,error: function(){},timeout:5000});};var tpl='<li class="c-span24 #{cls}">#{icon}<a href="#{link}" target="_blank">#{title}</a><span class="##tpl##-price">&yen;#{price}起</span></li>';var _format=function (source, opts) {source = String(source);var data = Array.prototype.slice.call(arguments,1), toString = Object.prototype.toString;if(data.length){data = data.length == 1 ? (opts !== null && (/\[object Array\]|\[object Object\]/.test(toString.call(o{%*i*%}pts))) ? opts : data) : data;return source.replace(/#\{(.+?)\}/g, function (match, key){var replacer = data[key];if('[object Function]' == toString.call(replacer)){replacer = replacer(key);}return ('undefined' == typeof replacer ? '' : replacer);});}return source;};var render=function(data){if(ajaxFinished) return;if(data.ret&&data.data&&data.data.length){var html=[];$.each(data.data,function(index,v){if(index==3){v.cls='c-span-last';}var titlelength=62;if(v.type){if(v.type=="tuan"){v.icon='<i c{%*i*%}lass="c-text c-text-warning">团</i> ';}else if(v.type=="discount"){v.icon='<i class="c-text c-text-warning">惠</i> ';}else if(v.type=="ticket"){v.icon='<i class="c-text c-text-warning">票</i> ';}titlelength-=2;}v.title=cutstr(v.title,titlelength);if(v.link.indexOf('?')>-1){v.link+='&amp;';}else{v.link+='?';}v.link+='tf='+_this.data.tf+'route_'+(index+1)+'&amp;ex_track='+_this.data.extrack+'03';html.push(_format(tpl,v));});_this.find('.'+replaceCls('##tpl##-routes-list')).html(replaceCls(html.join('{%*i*%}')));}};return {changeDep: getData,dispose: function(){if(!ajaxFinished){ajaxFinished=true;}}};})();this.dispose = function(){Deppanel.dispose();Search.dispose();List.dispose();};});</script>{%/block%}