{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='foot'%}{%/block%}{%block name='data_modifier'%} {%**************数据预处理开始**************%} {%*定义endLevel为trace中最后一层*%} {%if $tplData.trace.level && count(end($tplData.trace.level)) == 1%} {%$endLevel = end($tplData.trace.level)%} {%/if%} {%*additional逻辑*%} {%if $tplData.search_property%} {%$AdditionalKey = $tplData.search_property%} {%elseif $tplData.cmpbrief[0]%} {%$AdditionalKey = $tplData.cmpbrief[0]%} {%elseif count($tplData.result) > 1%} {%$AdditionalKey = "remark"%} {%/if%} {%foreach $tplData.result as $item%} {%if $AdditionalKey && $item[$AdditionalKey]%} {%$tplData.result[$item@index].additional = $item[$AdditionalKey]%} {%elseif $item.additional%} {%$tplData.result[$item@index].additional = $item.additional%} {%/if%} {%/foreach%} {%*单实体答案*%} {%if !$tplData.result[0].attrquery%} {%if $tplData.result[0].additional%} {%$tplData.result[0].attrquery = $tplData.result[0].additional%} {%elseif $tplData.result[0].dspdata && !$endLevel[0].property%} {%*大S逻辑*%} {%$tplData.result[0].attrquery = $tplData.result[0].dspdata%} {%else%} {%$tplData.result[0].attrquery = $tplData.result[0].ename%} {%/if%} {%/if%} {%*单实体标题*%} {%if count($tplData.result) == 1%} {%$tplData.SingleTitle = []%} {%if $tplData.search_property%} {%$tplData.SingleTitle.entity = $tplData.result[0].ename%} {%$tplData.SingleTitle.append = $tplData.result[0].appendinfo%} {%$tplData.SingleTitle.attr = $tplData.result[0].searchp%} {%/if%} {%if $endLevel%} {%$tplData.SingleTitle.entity = ($tplData.SingleTitle.entity) ? $tplData.SingleTitle.entity : $tplData.hash[$endLevel[0].sign].ename%} {%$tplData.SingleTitle.append = ($tplData.SingleTitle.append) ? $tplData.SingleTitle.append : $tplData.hash[$endLevel[0].sign].appendinfo%} {%$tplData.SingleTitle.attr = ($tplData.SingleTitle.attr) ? $tplData.SingleTitle.attr : $endLevel[0].property%} {%/if%} {%if $tplData.result[0].dspdata && !$endLevel[0].property%} {%*大S逻辑*%} {%$tplData.SingleTitle.entity = ($tplData.SingleTitle.entity) ? $tplData.SingleTitle.entity : $tplData.result[0].ename%} {%if !$tplData.SingleTitle.attr && in_array('诗词', $tplData.cate_di)%} {%$tplData.SingleTitle.attr = '全文'%} {%elseif !$tplData.SingleTitle.attr && in_array('诗词句', $tplData.cate_di)%} {%$tplData.SingleTitle.attr = '出处'%} {%/if%} {%/if%} {%/if%} {%***************数据预处理结束******************%} {%*跳转链接方法 优先级jumpquery>jumplink>ename*%} {%$EndParams = "&rsv_cq={%$extData.OriginQuery%}&rsv_dl=0_left_exactqadetail_{%$extData.resourceid%}"%} {%function op_exactqa_get_href jumpquery='' jumplink='' ename=''%}{%strip%} {%if $jumpquery%} {%$escaped_jumpquery = $jumpquery%} {%build_search_url params="wd={%$escaped_jumpquery%}"%}{%$EndParams|escape:'html'%} {%elseif $jumplink%} {%$jumplink|escape:'html'%} {%else%} {%$escaped_ename = $ename%} {%build_search_url params="wd={%$escaped_ename%}"%}{%$EndParams|escape:'html'%} {%/if%} {%/strip%}{%/function%} {%$showEXT = '0'%} {%*默认不显示扩展区*%} {%if $tplData.attr_di && $tplData.SingleTitle.entity && $tplData.result[0].sourcename && $tplData.result[0].sourcelink%} {%$plist = explode(',', $tplData.result[0].plist)%} {%$pidlist = explode(',', $tplData.result[0].pidlist)%} {%foreach array_slice($tplData.attr_di, 0) as $item%} {%if $tplData.result[0][$item]%} {%$showEXT = '1'%} {%*如果结构化富摘要内容存在，则显示扩展区*%} {%break%} {%/if%} {%/foreach%} {%/if%}{%/block%}{%block name='content'%}<style>{%fe_fn_c_css css='img'%}.op_exactqa_detail_main a,.op_exactqa_detail_tools a{text-decoration:none}.op_exactqa_detail_main a:hover,.op_exactqa_detail_tools a:hover{text-decoration:underline}.op_exactqa_detail_tools{color:#999;font-size:.92em;text-align:right;margin:-15px 0 -3px 0}.op_exactqa_detail_tools a{color:#999}.op_exactqa_detail_tools_sep{color:#ccc;margin:0 8px}.op_exactqa_detail_s_item{overflow:hidden}.op_exactqa_detail_s_area{padding-bottom:20px}.op_exactqa_detail_s_prop{font-size:1.07em;font-weight:bold;color{%*i*%}:#999}.op_exactqa_detail_s_prop a,.op_exactqa_detail_s_prop a:hover{color:#999}.op_exactqa_detail_s_answer span,.op_exactqa_detail_s_answer .op_exactqa_detail_s_answer_scroll_content{font-family:"Microsoft YaHei",SimHei;{%if $tplData.result[0].attrquery|string_display_len < 30%}font-size:1.85em;{%elseif $tplData.result[0].attrquery|string_display_len < 72%}font-size:1.54em;{%elseif $tplData.result[0].attrquery|string_display_len < 138%}font-size:1.23em;{%else%}font-size:1.07em;{%/if%}}.op_exactqa_detail_s_answer_showall{width:80px;display:block;position:relative;top:4px;margin-bottom:-20px}.op_exactqa_detail_s_answer_scroll{height:190px;position:relative;overflow:hidden}.op_exactqa_detail_s_answer_scroll_content{height:190px;overflow:hidden}.op_exactqa_detail_ext{border-top:1px solid #f0f0f0}.op_exactqa_detail_ext p{font-size:1.17em}.op_exactqa_detail_ext table{margin-left:-4px}.op_exactqa_detail_ext td{font-size:15px;text-align:left;vertical-align:top}.op_exactqa_detail_ext{%*i*%} .op_exactqa_detail_ext_th{color:#666;white-space:nowrap}.op_exactqa_detail_ext_showall{display:inline-block;white-space:nowrap}</style><div class="c-border"> <div class="op_exactqa_detail_main"> <div class="op_exactqa_detail_s_item c-row"> <div class="op_exactqa_detail_s_area c-span24 c-span-last"> <p class="op_exactqa_detail_s_prop c-gap-bottom-small"> {%if $tplData.SingleTitle.entity && $tplData.SingleTitle.attr && $tplData.trace.level_num == 1%} <a href='{%op_exactqa_get_href ename=$tplData.SingleTitle.entity%}' target="_blank">{%$tplData.SingleTitle.entity|escape:'html'%}</a>{%if $tplData.SingleTitle.append%}<span>({%$tplData.SingleTitle.append|escape:'html'%})</span>{%/if%}{%$tplData.SingleTitle.attr|escape:'html'%}： {%else%} {%$extData.OriginQuery%}： {%/if%} </p>  {%if $tplData.SingleTitle.attr == '全文' && $tplData.result[0].literature_author%} <p class="op_exactqa_detail_s_author">作者：<a href='{%op_exactqa_get_href ename=$tplData.result[0].literature_author%}' target="_blank">{%$tplData.result[0].literature_author%}</a></p> {%/if%}  <div class="op_exactqa_detail_s_answer"> {%if !$tplData.search_property && !($tplData.result[0].dspdata && !$endLevel[0].property && in_array('诗词', $tplData.cate_di))%}  <span><a href='{%op_exactqa_get_href ename=$tplData.result[0].attrquery%}' target="_blank">{%$tplData.result[0].attrquery|replace:',':'、'|limitlen:200|escape:'html'%}</a></span> {%else%} {%$formatBR = explode('<br />', nl2br($tplData.result[0].attrquery|replace:',':'、'))%} {%*按换行切分为数组*%} {%if $tplData.result[0].attrquery|string_display_len <= 200%} <span>{%foreach $formatBR as $item%}{%$item|escape:'html'%}{%if !$item@last%}<br/>{%/if%}{%/foreach%}</span> {%elseif $tplData.result[0].attrquery|string_display_len <= 720%} <span> {%$formatBRLength = 0%} {%foreach $formatBR as $item%} {%if $formatBRLength <= 200 && (!$item@last || $item@index == 0)%} {%if !$item@first%}<br/>{%/if%}{%$item|escape:'html'|limitlen:200%} {%$formatBRLength = $formatBRLength + $item|string_display_len%} {%else%} {%break%} {%/if%} {%/foreach%} </span> <a class="op_exactqa_detail_s_answer_showall OP_LOG_BTN" href="javascript:;" data-click="{fm:'beha'}" content='{%foreach $formatBR as $item%}{%$item|escape:"html"%}{%if !$item@last%}<br/>{%/if%}{%/foreach%}'>显示全部<i class="c-icon c-icon-triangle-down-blue"></i></a> {%else%} <div class="op_exactqa_detail_s_answer_scroll"> <div class="op_exactqa_detail_s_answer_scroll_content c-gap-right"> <div>{%foreach $formatBR as $item%}{%$item|escape:'html'%}{%if !$item@last%}<br/>{%/if%}{%/foreach%}</div> </div> </div> {%/if%} {%/if%} </div> </div> </div> </div>   <div class="op_exactqa_detail_tools"> {%if $tplData.result[0].sourcename && $tplData.result[0].sourcelink%}来自<a href="{%$tplData.result[0].sourcelink|escape:'html'%}" target="_blank">{%$tplData.result[0].sourcename|escape:'html'%}</a><span class="op_exactqa_detail_tools_sep">|</span>{%/if%}<span class="op_exactqa_detail_tools_fb_area"><a class="op_exactqa_detail_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:'报错'}">报错</a></span> </div>  {%if $showEXT == '1' && !($tplData.SingleTitle.attr == '全文' && $tplData.result[0].literature_author)%} {%*showEXT && 诗词独有“作者”逻辑*%}  <div class="op_exactqa_detail_ext c-gap-top"> <p class="c-gap-top-small c-gap-bottom-small"><a href="{%$tplData.result[0].sourcelink|escape:'html'%}" target="_blank"><em>{%if $tplData.result[0].subtitle%}{%$tplData.result[0].subtitle|escape:'html'%}{%else%}{%$tplData.result[0].ename|escape:'html'%}{%/if%}</em>_{%$tplData.result[0].sourcename|escape:'html'%}</a></p> <table> <tbody> {%foreach array_slice($tplData.attr_di, 0) as $item%} {%if $tplData.result[0][$item]%} <tr> <td class="op_exactqa_detail_ext_th">[{%$plist[array_search($item,$pidlist)]%}]</td> <td><span class="c-gap-right-small">{%nl2br($tplData.result[0][$item]|limitlen:138)%}</span>{%if $tplData.result[0][$item]|string_display_len > 140%}<a href="javascript:;" class="op_exactqa_detail_ext_showall OP_LOG_BTN" data-click="{fm:'beha'}" content='{%nl2br($tplData.result[0][$item]|limitlen:720)%}'>显示全部<i class="c-icon c-icon-triangle-down-blue"></i></a>{%/if%}</td> </tr> {%/if%} {%/foreach%} </tbody> </table> </div>  {%/if%}</div><script data-merge>A.setup(function(){var Ala = this;Ala.find('.op_exactqa_detail_tools_fb').on('click', function(){$(this).replaceWith('<span>感谢反馈</span>');});var $dom_showallBtn = Ala.find('.op_exactqa_detail_s_answer_showall'),$dom_answerArea = Ala.find('.op_exactqa_detail_s_answer'),$dom_scrollContent = Ala.find('.op_exactqa_detail_s_answer_scroll_content');$dom_showallBtn.length && $dom_showallBtn.on('click', function(){$dom_answerArea.html('<span>' + $(this).attr('content') + '</span{%*i*%}>');});$dom_scrollContent.length && A.use('baidu', function(){A.use('scrollbarv',function(){var poemScrollbar = A.ui.scrollbarv({content : $dom_scrollContent[0],length : 190});});});var $dom_showallBtnEXT = Ala.find('.op_exactqa_detail_ext_showall'); $dom_showallBtnEXT.length && $dom_showallBtnEXT.on('click', function(){$(this).parent().html($(this).attr('content'));});this.dispose = function(){poemScrollbar && poemScrollbar.dispose && poemScrollbar.dispose();};});</script>{%/block%}