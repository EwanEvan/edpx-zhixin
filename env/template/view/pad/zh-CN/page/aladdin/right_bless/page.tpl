{%extends 'c_right_base.tpl'%} {%block name='content'%}<style>.opr-bless,.opr-bless-btn{background:url({%$tplData.bgurl%}) no-repeat}.opr-bless-num{color:{%$tplData.blesscount[0].fontcolor|escape:'html'%}}.opr-bless-num b{color:{%$tplData.blesscount[0].strongcolor|escape:'html'%}}.opr-bless-btn{color:{%$tplData.btn[0].fontcolor|escape:'html'%}}.opr-bless{color:#333;height:52px;padding-top:13px;position:relative;zoom:1;overflow:hidden}.container_l .opr-bless{width:351px}.container_s .opr-bless{width:259px}{%if $tplData.shownarrow%}.container_l .opr-bless{width:259px}{%/if%}.opr-bless .opr-bless-prey{color:#fff;margin-top:23px;*margin-top:35px}.opr-bless-btn{background-position:0 -65px;width:69px;height:23px;line-height:22px;*line-height:23px;padding-left:23px;display:inline-block;cursor:pointer;text-align:center}.opr-bless-btn2{background-position:-92px -65px;cursor:default}.opr-bless-heart{position:absolute;top:80px;left:175px}.opr-bless-num b{margin:0 2px}.opr-bless-version{font-size:.923em;margin-top:3px}</style>{%if $tplData.showgray%}<div class="opr-bless-graystyle"> <style type="text/css">html{filter:grayscale(100%);-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);-webkit-filter:grayscale(1)}</style></div>{%/if%}<div class="opr-bless"> <div class="opr-bless-prey c-gap-left c-gap-top"> <span class="opr-bless-btn OP_LOG_BTN" data-click="{fm:'beha'}">{%$tplData.btn[0].text|escape:'html'%}</span><span class="opr-bless-num c-gap-left">{%str_replace( '[number]', '<b></b>', $tplData.blesscount[0].text )%}</span> </div> <div class="opr-bless-player"></div></div>{%if $tplData.music && $tplData.music[0].version%}<div class="opr-bless-version c-gray">{%$tplData.music[0].version|escape:'html'%}</div>{%/if%}<script >
    A.setup({
        upurl: '{%$tplData.upurl%}',
        fetchurl: '{%$tplData.fetchurl%}',
        musicUrl: '{%if $tplData.music%}{%$tplData.music[0].url%}{%/if%}'
    });
</script><script data-merge>A.setup(function(){var _this = this,isMotionPlay = false,isFirstClick = false,btn = _this.find('.opr-bless-btn').eq(0),gray = _this.find( '.opr-bless-graystyle' ).get(0),playerBox = _this.find( '.opr-bless-player' ).get(0),upurl = _this.data.upurl,fetchurl = _this.data.fetchurl,num = 0,ajaxFinished = false,playMusic;btn.on('click', function(){if(isFirstClick)return;btn.addClass('opr-bless-btn2');var numDom = _this.find('.opr-bless-num').get(0).getElementsByTagName('b'{%*i*%})[0];if (numDom && numDom.innerHTML != '') {num = parseInt(numDom.innerHTML, 10);numDom.innerHTML = num + 1;}up();if ( gray ) {gray.parentNode.removeChild( gray );gray = null;}isFirstClick = true;});function buildurl( url ) {return url + ( url.indexOf( '?' ) > -1 ? "&t=" : "?t=" ) + new Date().getTime();}function up(){$.ajax({url:buildurl( upurl )+'&cb=ribless',dataType:'jsonp',jsonpCallback:'ribless'});}$.ajax({url:buildurl( fetchurl )+'&cb=ribless',dataType:'jsonp',success:function(data){if(aj{%*i*%}axFinished) return;num = data.data.sum || 0;_this.find('.opr-bless-num').get(0).getElementsByTagName('b')[0].innerHTML = num;},error:function(){ num = -1;},timeout:5000,jsonpCallback:'ribless'});playMusic = (function() {var support, audio, swf;if ( isFirstClick ) {return;}try{if(document.createElement("audio").play){support = true;playerBox.innerHTML = '<audio class="opr-bless-music-player"></audio>';audio = _this.find( '.opr-bless-music-player' ).get(0);}}catch(e){}if ( !support ) {playerBox.in{%*i*%}nerHTML = '<object id="opr-bless-music-player" width="1" height="1" type="application/x-shockwave-flash" data="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="movie" value="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="allowScriptAccess" value="always" /></object>';swf = _this.find( '#opr-bless-music-player' ).get(0);}return {play: function( src ) {var self = this;try {audio && ( audio.src = src, audio.play() );swf && ( swf.uri(src), swf.{%*i*%}playMp3() );} catch( e ) {rmtimer = setTimeout(function() {self.play( src );}, 13);}},pause: function() {audio ? ( audio.pause() ) : ( swf.stopMp3() );}}}());if ( _this.data.musicUrl ) {playMusic.play( _this.data.musicUrl );}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}