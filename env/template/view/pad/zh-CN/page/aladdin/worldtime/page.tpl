{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%if !$tplData.showurl%} {%$tplData.showurl = 'open.baidu.com/'%} {%/if%} {%if !$tplData.daylight%}{%$tplData.daylight = [ ['start' => '8:00:00','end' => '20:00:00' ] ]%} {%/if%} {%if !isset($tplData.timezone)%}{%$tplData.timezone = 8%} {%/if%}{%/block%}{%block name="title"%}{%/block%}{%block name='content'%}<style data-merge>.op-worldtime{position:relative;height:170px;font-family:'Microsoft Yahei',Arial}.op-worldtime-box{position:absolute;left:51px;top:47px;height:65px}.op-worldtime-mark{position:absolute;left:0;top:0}.op-worldtime-box{color:#fff;font-family:Microsoft Yahei}.op-worldtime-hands{position:relative;display:block;float:left;margin-right:18px}.op-worldtime-box p{float:left;white-space:nowrap}.op-worldtime-time{margin-right:40px;line-height:65px;letter-spacing:1px;overflow:hidden;height:{%*i*%}65px}.op-worldtime-big{font-size:4.231em}.op-worldtime-time .op-worldtime-small{top:0;font-size:2.308em}.op-worldtime-datebox{padding-top:6px}.op-worldtime-datebox span{display:block;text-align:center}.op-worldtime-datebox .op-worldtime-week{font-size:1.538em;text-align:left}.op-worldtime-date{font-size:1.154em}.op-worldtime-toptext{position:absolute;top:10px;left:10px;color:#fff;font-size:1.15em;line-height:1;z-index:1;zoom:1}.op-worldtime-bottomtext{position:absolute;bottom:0;left:0;color:#fff{%*i*%};height:35px;width:100%;font-size:1.15em;display:none}.op-worldtime-bjbg{position:absolute;top:0;left:0;background:#000;opacity:.1;filter:alpha(opacity = 10);width:100%;height:100%}.op-worldtime-bjbox{position:relative;z-index:1;padding:0 10px;line-height:35px}.op-worldtime-bjtime{width:60px;margin:0 15px}.op-worldtime-compare{float:right}</style><style>{%if $extData.feData.platform == 'pc'%}.op-worldtime-time{width:200px}{%else%}.op-worldtime-time{width:230px}{%/if%}</style><div class="op-worldtime"></div><script >
    A.setup({
        {%if $tplData.dst%}
        dst: {%json_encode($tplData.dst[0])%},
        {%/if%}
        timeZone: '{%$tplData.timezone|escape:'javascript'%}',
        dayLight: {%json_encode($tplData.daylight[0])%},
        toptext: '{%$tplData.toptext|escape:'javascript'%}'
    });
</script><script data-merge>A.setup(function(){var _this = this,getServerTime,drawBackground,drawMark,drawHands,STAR_NUM = 200,TIME_ZONE = 8,realtime,now,countTimeZone,timeZone = _this.data.timeZone || 8,ensureTime,dst = _this.data.dst,isDst,countDayLight,dayLight = _this.data.dayLight,dayLightStatus,toptext = _this.data.toptext,secondTimer,minuteTimer,timeFormat,setDateTime,dateSetter,stringToDate,contextFlag,contextEvent,beijingtimeBox,initialize,initForIE,hourTime = 60 * 60 * 1000,$topBox,set{%*i*%}Toptext,supportCanvas = !!document.createElement('canvas').getContext,$container = _this.find( '.op-worldtime' ),bgCanvas,markCanvas,handsCanvas,actmenufn;stringToDate = function( str ) {var ret = str.split( /:|\s|-/ );return new Date( ret[0], ret[1] - 1, ret[2], ret[3], ret[4], ret[5] );};countTimeZone = function( time, timeZone, dst ) {var curZone = time.getTimezoneOffset(),curDate,month,day,hour;curDate = new Date( time.getTime() + curZone * 60000 );curDate.setTime( curDate.getTime() + timeZo{%*i*%}ne * hourTime );if ( dst ) {if ( stringToDate( dst.start ) < curDate && stringToDate( dst.end ) > curDate ) {curDate.setTime( curDate.getTime() + hourTime );isDst = true;} else {isDst = false;}}return curDate;};ensureTime = function( time, timeZone) {var curTimezone = time.getTimezoneOffset();return new Date( time.getTime() + ( time.getTimezoneOffset() - timeZone ) * 60000 );};getServerTime = function( callback ) {var request, oncallback;if ( typeof callback != 'function' ) {return;}oncallback ={%*i*%} function() {var time = request && request.getResponseHeader("Date");if ( time ) {callback( new Date( time ) );}};request = $.ajax({url:'/?t=' + new Date().getTime(),success: oncallback,error: oncallback});};setDateTime = function( date, time ) {var t = time.split( ':' );date.setHours( t[0] );date.setMinutes( t[1] || 0 );date.setSeconds( t[2] || 0 );return date;};countDayLight = function() {var startTime = dayLight.start,endTime = dayLight.end;startTime = setDateTime( new Date( now.getTime() ), {%*i*%}startTime );endTime = setDateTime( new Date( now.getTime() ), endTime );return startTime < now && endTime > now ? 'daylight' : 'night';};drawBackground = function( isNight ) {var ctx = bgCanvas.getContext( '2d' ),width = bgCanvas.offsetWidth,height = bgCanvas.offsetHeight,grd,drawStar;if ( dayLightStatus && dayLightStatus == isNight ) {return;}dayLightStatus = isNight;ctx.clearRect( 0, 0, width, height );drawStar = function() {var i, x, y, radGrd, radius, startColor, opacity, unit;unit = support{%*i*%}Canvas ? 1 : 0.5;for ( i = 0; i < STAR_NUM; i++ ) {x = Math.random() * width;y = Math.random() * height;radius = Math.random() + unit;opacity = radius - unit;supportCanvas && ( opacity /= 2 );radGrd = ctx.createRadialGradient( x, y, 1, x, y, radius );radGrd.addColorStop( 0, 'rgba( 175, 175, 175, ' + opacity + ' )' );radGrd.addColorStop( 1, 'rgba( 175, 175, 175, 0 )' );ctx.fillStyle = radGrd;ctx.beginPath();ctx.arc( x, y, radius, 0, Math.PI * 2, true );ctx.fill();ctx.closePath();}};if ( isNight ){%*i*%} {grd = ctx.createLinearGradient( 0, 0, 0, height );grd.addColorStop( 0, 'rgb(24, 50, 89)' );grd.addColorStop( 1, 'rgb(52, 130, 186)' );} else {grd = ctx.createLinearGradient( 0, 0, 0, height );grd.addColorStop( 0, '#0067bf' );grd.addColorStop( 1, '#6eabe2' );}ctx.fillStyle = grd;ctx.fillRect( 0, 0, width, height );if ( isNight ) {drawStar();}};drawMark = function() {var ctx = markCanvas.getContext( '2d' ),i,lineLength,radius = markCanvas.offsetWidth / 2;ctx.translate( radius, radius ); for ( i {%*i*%}= 0; i < 60; i++ ) {ctx.lineWidth = 1;ctx.strokeStyle = 'rgba( 255, 255, 255, 0.3 )';lineLength = 4;if ( i % 5 == 0 ) {lineLength = 8;ctx.strokeStyle = '#fff';}ctx.beginPath();ctx.moveTo( 0, lineLength - radius );ctx.lineTo( 0, -radius );ctx.stroke();ctx.closePath();ctx.rotate( Math.PI / 30 );}};drawHands = function( date ) {var hour = date.getHours(),minute = date.getMinutes(),second = date.getSeconds(),ctx = handsCanvas.getContext( '2d' ),radius = handsCanvas.offsetWidth / 2,draw;hour > 12 && {%*i*%}( hour -= 12 );hour += minute / 60;minute += second / 60;ctx.clearRect( 0, 0, radius * 2, radius * 2 );draw = function( lineWidth, strokeStyle, rotate, start, end ) {ctx.save();ctx.lineWidth = lineWidth;ctx.strokeStyle = strokeStyle;ctx.translate( radius, radius );ctx.rotate( rotate );ctx.beginPath();ctx.moveTo( 0, start );ctx.lineTo( 0, end );ctx.stroke();ctx.closePath();ctx.restore();};draw( 3, '#fff', Math.PI / 6 * hour, 6, -16 );draw( 2, '#fff', Math.PI / 30 * minute, 6, -24 );draw( 1, '#d93{%*i*%}c3c', Math.PI / 30 * second, 6, -24 );};timeFormat = function( str ) {return ( '0' + str ).slice( -2 );};dateSetter = {time: null,week: null,date: null,init: function() {this.$time = _this.find( '.op-worldtime-time' );this.$week = _this.find( '.op-worldtime-week' );this.$date = _this.find( '.op-worldtime-date' );this.$bjbox = _this.find( '.op-worldtime-bjbox' );this.setTime();this.minuteSet();this.setBjbox();},setTime: function() {this.$time.html('<span class="op-worldtime-big">' + timeFormat( n{%*i*%}ow.getHours() ) + '</span>' + '<span class="op-worldtime-big">:</span>' + '<span class="op-worldtime-big">' + timeFormat( now.getMinutes()) + '</span>'+ '<span class="op-worldtime-small c-gap-left">' + timeFormat( now.getSeconds() ) + '</span>') ;},setWeek: function() {this.$week.html('星期' + '日一二三四五六'.charAt( now.getDay() ));},setDate: function() {this.$date.html( now.getFullYear() + '年' + ( now.getMonth() + 1 ) + '月' + now.getDate() + '日');},minuteSet: function() {this.setWeek();this.setDate();{%*i*%}},setBjbox: function() {var bjnow = countTimeZone( realtime, 8 );this.$bjbox.html('<span class="op-worldtime-compare">比北京' + (timeZone > 8 ? '快' : '慢') + Math.abs( 8 - timeZone - (isDst ? 1 : 0) ) + '小时</span>北京时间<span class="op-worldtime-bjtime"></span>星期' + '日一二三四五六'.charAt( bjnow.getDay() )+'，'+( bjnow.getMonth() + 1 ) + '月' + bjnow.getDate() + '日'), this.$bjtime = _this.find( '.op-worldtime-bjtime' );this.setBjtime( bjnow );},setBjtime: function( bjtime ) {var bjnow = bjtime || countTimeZone{%*i*%}( realtime, 8 );this.$bjtime.html([timeFormat( bjnow.getHours() ),timeFormat( bjnow.getMinutes() ),timeFormat( bjnow.getSeconds() )].join( ':' )); }};minuteTimer = function() {getServerTime(function( time ) {realtime = time;now = countTimeZone( time, timeZone, dst );setToptext();drawBackground( countDayLight() == 'night' );dateSetter.minuteSet();});};contextEvent = function() {actmenufn = function() {contextFlag = true;};$(document).on("contextmenu", actmenufn);};setToptext = function() {if ( !${%*i*%}topBox ) {$topBox = _this.find( '.op-worldtime-toptext' );}$topBox.html(toptext + ( isDst ? '-正在实行夏令时' : '' ));};initialize = function() {var tpl = '<p class="op-worldtime-toptext">'+toptext+'</p>\<canvas class="op-worldtime-background" width="'+_this.container.offsetWidth+'" height="170"></canvas>\<div class="op-worldtime-box c-clearfix">\<canvas class="op-worldtime-hands" width="65" height="65"></canvas>\<canvas class="op-worldtime-mark" width="65" height="65"></canvas>\<p class="op-worldtime-{%*i*%}time"></p>\<p class="op-worldtime-datebox"><span class="op-worldtime-week"></span><span class="op-worldtime-date"></span>\</div>\<div class="op-worldtime-bottomtext">\<div class="op-worldtime-bjbg"></div>\<div class="op-worldtime-bjbox"></div>\</div>';$container.html(tpl);bgCanvas = _this.find( '.op-worldtime-background' )[0];markCanvas = _this.find( '.op-worldtime-mark' )[0];handsCanvas = _this.find( '.op-worldtime-hands' )[0];beijingtimeBox = _this.find( '.op-worldtime-bottomtext' )[0];if ( !s{%*i*%}upportCanvas ) {A.ui.canvas.init( [ bgCanvas, markCanvas, handsCanvas ] );}_this.ready(function(e) {getServerTime(function( time ) {now = realtime = time;contextEvent();now = countTimeZone( now, timeZone, dst );setToptext();drawBackground( countDayLight() == 'night' );drawMark();drawHands( now );dateSetter.init();beijingtimeBox.style.display = 'block';secondTimer = window.setInterval(function() {var timeObj,timezone;if ( now.getSeconds() == 0 || contextFlag == true ) {minuteTimer();contextFlag ={%*i*%} false;}timezone = now.getTimezoneOffset();now = new Date( now.getTime() + 1000 );if ( now.getTimezoneOffset() != timezone ) {now = ensureTime( now, timezone );}realtime = new Date( realtime.getTime() + 1000 );drawHands( now );dateSetter.setTime();dateSetter.setBjtime();}, 1000);});});};if ( supportCanvas ) {initialize();} else {A.use('canvas', function(){initialize();});}this.dispose = function(){window.clearInterval(secondTimer);$(document).unbind("contextmenu", actmenufn);};});</script>{%/block%}