{%extends 'c_base.tpl'%} {%block name='data_modifier'%} {%$escaped_tpl="{%basename($smarty.current_dir)%}"%}{%/block%}{%block name="title"%}<style type="text/css">{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='input'%}{%fe_fn_c_css css='img'%}.op-qunar_hotel02-header-title{color:#00c}.op-qunar_hotel02-header-title .op-qunar_hotel02-icon-qunar{display:inline-block;vertical-align:text-bottom;font-style:normal;overflow:hidden;width:16px;height:16px;background:url(http://bcscdn.baidu.com/fcnp-ip/1013/pic/283772069bc05b531cbb6d45cf2b91a1.png) no-repeat left top}.op-qunar_hotel02-footersafe{color:#4bad37;font-weight:bold}.op-qunar_hotel02-find{height:1.27em;line-height:1.27em;margin-top:9px}.op-qunar_hotel02-find-price{margin-top:10px;_mar{%*i*%}gin-top:8px}.op-qunar_hotel02-input{float:left;display:inline}.op-qunar_hotel02-form{padding-bottom:10px;border-bottom:1px solid #eaeaea}.op-qunar_hotel02-form .op-qunar_hotel02-cityrow{width:178px}.op-qunar_hotel02-form .op-qunar_hotel02-queryrow{width:398px}.op-qunar_hotel02-form .op-qunar_hotel02-queryrow input{width:214px}.op-qunar_hotel02-hotcity{font-size:.93em;position:absolute;left:-9999px;top:-9999px;border:1px solid #d0d0d0;color:#666;background:#fff;width:300px;z-index:2;*zoom:1;paddi{%*i*%}ng-bottom:5px}.op-qunar_hotel02-hotcity h4{border-bottom:1px solid #d0d0d0;color:#000;background:#fff;line-height:1.87em;height:1.87em;margin:0 10px;font-weight:400}.op-qunar_hotel02-hotcity .op-qunar_hotel02-hotcitytitle{color:#666}.op-qunar_hotel02-hotcity .op-qunar_hotel02-hotcitycount{color:#000}.op-qunar_hotel02-hotcity ul{*zoom:1;padding:5px 0 0 0}.op-qunar_hotel02-hotcity ul:before,.op-qunar_hotel02-hotcity ul:after{content:"";display:table}.op-qunar_hotel02-hotcity ul:after{clear:both}.o{%*i*%}p-qunar_hotel02-hotcity li{float:left;width:20%;height:1.54em;line-height:1.54em}.op-qunar_hotel02-hotcity a{display:block;text-align:left;text-decoration:none;padding-left:10px}.op-qunar_hotel02-hotcity a:visited{color:#00c}.op-qunar_hotel02-hotcity a:link{color:#00c}.op-qunar_hotel02-hotcity a:hover{color:#00c;background-color:#f5f5f5;text-decoration:underline}.op-qunar_hotel02-hotcity a:active{color:#00c}.op-qunar_hotel02-hotkey{background:none repeat scroll 0 0 #fff;border:1px solid #d0d0d0;{%*i*%}color:#666;left:-9999px;position:absolute;top:-9999px;z-index:2}.op-qunar_hotel02-hotkey .showblock{background:none repeat scroll 0 0 #fff;font-size:.93em;line-height:1.54em;margin:0;padding:5px 10px;width:275px}.op-qunar_hotel02-hotkey .showblock b.oymTitle{display:block;font-size:.93em;font-weight:400;color:#333}.op-qunar_hotel02-hotkey .showblock p{border-bottom:1px solid #e3e3e3;margin-bottom:5px;padding-bottom:5px;word-spacing:12px}.op-qunar_hotel02-hotkey .showblock p.last{border-bottom:0 {%*i*%}none;margin-bottom:0;padding-bottom:0}.op-qunar_hotel02-hotkey .showblock a{color:#00c;cursor:pointer;white-space:nowrap}.op-qunar_hotel02-hotkey .showblock a:hover{color:#00c;text-decoration:underline}.op-qunar_hotel02-hotkey b{background:0;cursor:default;float:none;height:100%;width:100%}.op-qunar_hotel02-find ul{float:left;height:1.27em;width:458px;overflow:hidden}.op-qunar_hotel02-find span{float:left;margin-right:0;color:#666}.op-qunar_hotel02-container .op-qunar_hotel02-find li{float:left;{%*i*%}white-space:nowrap;*margin-right:4px}.op-qunar_hotel02-find a{color:#00c;text-decoration:none}.op-qunar_hotel02-find a:hover{text-decoration:underline}.op-qunar_hotel02-hotels{background:#fff}.op-qunar_hotel02-hotel{padding:10px 0 0 0}.op-qunar_hotel02-hotels a{text-decoration:none;color:#00c}.op-qunar_hotel02-hotels a:hover{text-decoration:underline}.op-qunar_hotel02-img{position:relative}.op-qunar_hotel02-img img{height:91px}.op-qunar_hotel02-img .op-qunar_hotel02-img-tag{position:absolute;bot{%*i*%}tom:0;_bottom:-1px;left:0;color:#fff;width:138px;height:1.2em;line-height:1.2em;text-align:center;background:-moz-linear-gradient(top,rgba(0,0,0,0.4) 0,rgba(0,0,0,0.4) 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(0,0,0,0.4)),color-stop(100%,rgba(0,0,0,0.4)));background:-webkit-linear-gradient(top,rgba(0,0,0,0.4) 0,rgba(0,0,0,0.4) 100%);background:-o-linear-gradient(top,rgba(0,0,0,0.4) 0,rgba(0,0,0,0.4) 100%);background:-ms-linear-gradient(top,rgba(0,0,0,0.4) 0{%*i*%},rgba(0,0,0,0.4) 100%);background:linear-gradient(to bottom,rgba(0,0,0,0.4) 0,rgba(0,0,0,0.4) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#66000000",endColorstr="#66000000",GradientType=0)}.op-qunar_hotel02-hotel-intro{padding-top:5px}.op-qunar_hotel02-hotel-price{position:relative}.op-qunar_hotel02-hotel-price span a{color:#868686}.op-qunar_hotel02-hotel-price em{position:absolute;top:0;right:0}.op-qunar_hotel02-hotel-price em a{color:#ff6c00;text-decoration:none}.op-{%*i*%}qunar_hotel02-hide{display:none}.op-qunar_hotel02-clearfix:after{clear:both;display:block;height:0;visibility:hidden;content:"."}.op-qunar_hotel02-clearfix{zoom:1}.op-qunar_hotel02-hotel-noborder{border-right:0}.op-qunar_hotel02-title{float:left;height:2em;line-height:2em}.op-qunar_hotel02-querybtn{float:right}.op-qunar_hotel02-hide{display:none}.op-qunar_hotel02-random{position:absolute;top:-9999px;left:-9999px}</style><h3 class="t c-gap-bottom-small"> <a class="op-{%$escaped_tpl%}-header-title" target="_blank" href="{%$tplData.url%}"><span class="c-gap-icon-right-small op-{%$escaped_tpl%}-icon-qunar"></span>{%$tplData.title|limitlen:56|highlight:0%}</a> </h3>{%/block%}{%block name='foot'%}<div class="c-gap-top-small">{%fe_fn_c_showurl%}</div> {%/block%}{%block name='content'%}{%$qunarurltemp="?"|explode:$tplData.url%}{%$escaped_qunarurl=$qunarurltemp[0]%}{%$escaped_qhfptemp="&"|explode:$tplData.url%}{%$escaped_qhfp="{%$escaped_qhfptemp[1]%}&queryid={%$tplData.queryid%}"%}{%if $tplData.hotellinks%} {%if $tplData.hotellinks|@count < 4%} {%$status=0%} {%else%} {%$status=1%} {%/if%}{%else%}{%$status=0%}{%/if%}{%if $tplData.curcity%}{%$escaped_curcity=$tplData.curcity|escape:'html'%}{%elseif $tplData.ipcity%}{%$escaped_curcity=$tplData.ipcity|escape:'html'%}{%else%}{%$escaped_curcity="北京"%}{%/if%}<div class="c-border">{%$escaped_random="{%$smarty.now%}{%math equation=rand(100, 999)%}"%}<img class="op-{%$escaped_tpl%}-random" src="http://hotel.qunar.com/zhixin_trans.gif?type=2&_t={%$escaped_random%}&key={%urlencode($tplData.key)%}&srcid={%$tplData.StdStg%}&queryid={%$tplData.queryid%}&source=pad"/><div class="op-{%$escaped_tpl%}-container op-{%$escaped_tpl%}-form"> <div class="c-row"> <div class="c-span8 op-{%$escaped_tpl%}-cityrow"> <span class="op-{%$escaped_tpl%}-title c-gap-right">目的地</span> <div class="op-{%$escaped_tpl%}-input "> <input class="c-input c-input-mini op-{%$escaped_tpl%}-city-input" autocomplete="off" type="text" maxlength="50" value="{%$escaped_curcity%}" /> <div class="op-{%$escaped_tpl%}-hotcity" data-click="{fm:'beha'}"> <h4>国内城市top<em class="c-gap-left-small c-gap-right op-{%$escaped_tpl%}-hotcitycount">{%$tplData.hotcity|@count%}</em><span class="c-gap-left op-{%$escaped_tpl%}-hotcitytitle">更多城市可直接输入搜索</span></h4> <ul> {%foreach $tplData.hotcity as $item%} <li><a data-city="{%$item['name']|escape:'html'%}" href="return false;">{%$item['name']|escape:'html'%}</a></li> {%/foreach%} </ul> </div> </div> </div> <div class="c-span16 c-span-last op-{%$escaped_tpl%}-queryrow"> <span class="op-{%$escaped_tpl%}-title c-gap-right">关键词</span> <div class="op-{%$escaped_tpl%}-input "> <input autocomplete="off" class="op-{%$escaped_tpl%}-keyword-input c-input c-input10" type="text" maxlength="50" value=""/> <div class="op-{%$escaped_tpl%}-hotkey" data-click="{fm:'beha'}"></div> </div> <a class="op-{%$escaped_tpl%}-querybtn op-{%$escaped_tpl%}-jsquerybtn c-btn c-btn-primary c-btn-small OP_LOG_BTN" href="http://hotel.qunar.com/search.jsp" target="_blank">快速查询</a> </div> </div></div><div class="op-{%$escaped_tpl%}-container"> <div class="c-row op-{%$escaped_tpl%}-hotels op-{%$escaped_tpl%}-jshotels {%if $status == 0%}op-{%$escaped_tpl%}-hide{%/if%} op-{%$escaped_tpl%}-clearfix"> {%if $status == 1%} {%foreach $tplData.hotellinks as $hotel%} {%$escaped_lastclass=""%} {%if $hotel@index === 0%} {%$escaped_ext_param="?ex_track=bd_zhixin_hotel_bsc_lowprice_pad"%} {%elseif $hotel@index === 1%} {%$escaped_ext_param="?ex_track=bd_zhixin_hotel_bsc_highlevel_pad"%} {%elseif $hotel@index === 2%} {%$escaped_ext_param="?ex_track=bd_zhixin_hotel_bsc_bestscore_pad"%} {%else%} {%$escaped_lastclass="c-span-last"%} {%$escaped_ext_param="?ex_track=bd_zhixin_hotel_bsc_highrank_pad"%} {%$hotel.intro = "搜索最高酒店推荐"%} {%/if%} {%$escaped_hotelurl= "{%$escaped_qunarurl%}{%$hotel.url%}{%$escaped_ext_param%}&{%$escaped_qhfp%}"%} {%if $hotel@index === 0%} {%$escaped_hotelurl="{%$escaped_hotelurl%}#sort=price-asc"%} {%/if%} {%if $hotel@index === 1%} {%$escaped_hotelurl="{%$escaped_hotelurl%}#sort=price-asc"%} {%/if%} {%if $hotel@index === 2%} {%$escaped_hotelurl="{%$escaped_hotelurl%}#sort=score-desc"%} {%/if%} <div class="c-span6 {%$escaped_lastclass%}"> <div class="op-{%$escaped_tpl%}-hotel"> <div class="op-{%$escaped_tpl%}-img"> <a target="_blank" href="{%$escaped_hotelurl%}"> <img class="c-img c-img6" src="{%$hotel.img|escape:'html'%}"/> <div class="op-{%$escaped_tpl%}-img-tag">{%$hotel.tag|escape:'html'%}</div> </a> </div> <p class="op-{%$escaped_tpl%}-hotel-intro"><a target="_blank" href="{%$escaped_hotelurl%}">{%$hotel.intro|escape:'html'%}</a></p> <p class="op-{%$escaped_tpl%}-hotel-price"> <span><a target="_blank" href="{%$escaped_hotelurl%}">{%$hotel.count|escape:'html'%}家酒店</a></span> <em><a target="_blank" href="{%$escaped_hotelurl%}"><b>&yen;{%$hotel.price|escape:'html'%}</b>起</a></em> </p> </div> </div> {%/foreach%} {%/if%} </div> {%if $tplData.pricelinks and $tplData.pricelinks|@count>0%} {%$escaped_hide=""%} {%else%} {%$escaped_hide="op-{%$escaped_tpl%}-hide"%} {%/if%} <div class="op-{%$escaped_tpl%}-find op-{%$escaped_tpl%}-find-price op-{%$escaped_tpl%}-clearfix {%$escaped_hide%}"> <span class="c-gap-right-small">价格：</span> <ul class="op-{%$escaped_tpl%}-jsprice"> {%foreach $tplData.pricelinks as $link%} {%$escaped_url= "{%$escaped_qunarurl%}{%$link.url%}?ex_track=bd_zhixin_hotel_bsc_hotprice_pad&{%$escaped_qhfp%}"%} {%$escaped_name=str_replace("%26","&","{%$link.name|escape:'html'%}")%} <li class="c-gap-right"><a target="_blank" href="{%$escaped_url%}">{%$escaped_name%}</a></li> {%/foreach%} </ul> </div> {%if $tplData.dangcilinks and $tplData.dangcilinks|@count>0%} {%$escaped_hide=""%} {%else%} {%$escaped_hide="op-{%$escaped_tpl%}-hide"%} {%/if%} <div class="op-{%$escaped_tpl%}-find op-{%$escaped_tpl%}-clearfix {%$escaped_hide%}"> <span class="c-gap-right-small">档次：</span> <ul class="op-{%$escaped_tpl%}-jsdangci"> {%foreach $tplData.dangcilinks as $link2%} {%$escaped_url2= "{%$escaped_qunarurl%}{%$link2.url%}?ex_track=bd_zhixin_hotel_bsc_hotlevel_pad&{%$escaped_qhfp%}"%} <li class="c-gap-right"><a target="_blank" href="{%$escaped_url2%}">{%$link2.name|escape:'html'%}</a></li> {%/foreach%} </ul> </div> {%if $tplData.brandlinks and $tplData.brandlinks|@count>0%} {%$escaped_hide=""%} {%else%} {%$escaped_hide="op-{%$escaped_tpl%}-hide"%} {%/if%} <div class="op-{%$escaped_tpl%}-find op-{%$escaped_tpl%}-clearfix {%$escaped_hide%}"> <span class="c-gap-right-small">品牌：</span> <ul class="op-{%$escaped_tpl%}-jsbrand"> {%foreach $tplData.brandlinks as $link1%} {%$escaped_url1= "{%$escaped_qunarurl%}{%$link1.url%}?ex_track=bd_zhixin_hotel_bsc_hotbrand_pad&{%$escaped_qhfp%}"%} <li class="c-gap-right"><a target="_blank" href="{%$escaped_url1%}">{%$link1.name|escape:'html'%}</a></li> {%/foreach%} </ul> </div></div></div><script >
A.setup({
    TPL_NAME: '{%$escaped_tpl%}',
    QHFP: "{%$escaped_qhfp%}",
    QUERYID : "{%$tplData.queryid%}"
});
</script><script data-merge>A.setup(function(){var card = this;var domainurl = "http://www.baidu.com/qunarui/hotel";var ajaxFinished = false;var util = (function(card) {var classPrefix = 'op-'+ card.data.TPL_NAME +'-';var eventCallbacksMap = {};var pub;return pub = {isIE6: function(){return /msie 6/i.test(navigator.userAgent);},isIE7: function(){return /msie 7/i.test(navigator.userAgent);},getClass: function(cls) {return (classPrefix + cls);},getTags: function ( domElement, tagName ) {if ( !domE{%*i*%}lement ) {return [];}return domElement.getElementsByTagName( tagName ) || [];},getElementByClassName: function(className, parentDom){if(parentDom){return $(parentDom).find('.'+className)[0];}else{return $('.'+className)[0];}},getChildrens: function(dom){return dom && dom.childNodes || [];},hasClass: function(el, name) {return $(el).hasClass(name);},addClass: function(el,name){$(el).addClass(name);},removeClass: function(el,name){$(el).removeClass(name);},getOffset: function(input) {var parentNod{%*i*%}e = input.parentNode;var offset = $(parentNode).offset();return offset;},on: function(dom, eventName, callback){$(dom).bind(eventName, callback);},one: function(dom, eventName, callback){$(dom).one(eventName, callback);},unbind: function(dom, eventName, callback){$(dom).unbind(eventName, callback);},jsonToQuery: function(json){var urlparams = [];var encodeitem = null;$.each(json, function( key, item ) {if ( /[^\x00-\xFF]/.test( item ) ) {encodeitem = encodeURIComponent( item );}else{encodeitem ={%*i*%} item;}urlparams.push(key+ '='+ encodeitem);});return urlparams.join('&');},ajax: function(url, params, success, fail){fail = fail || function() {};$.ajax({type: "POST",url: url,data: util.jsonToQuery( params),success: function ( results ) {success && success(results);},error: function ( xhr ) {fail(xhr);}});},jsonp: function(url, params, queryField, success, fail){fail = fail || function() {};queryField = queryField || '__jscallback';$.ajax({type: "POST",url: url + '?' + queryField + '=?&' + ut{%*i*%}il.jsonToQuery( params),dataType: 'jsonp',success: function ( results ) {try {success && success(results);}catch( e ) {fail();return;}},error: function ( xhr ) {fail(xhr);}});},extend: function(result, src1, src2){var s = null;for(s in src1){if(src1.hasOwnProperty(s)){result[s] = src1[s];}}for(s in src2){if(src2.hasOwnProperty(s)){result[s] = src2[s];}}return result;},trim: function(str){return str.replace(/(^\s*)|(\s*$)/g, "");},bind: function(eventName, callback){if(!eventCallbacksMap[eventNam{%*i*%}e]){eventCallbacksMap[eventName] = [];}eventCallbacksMap[eventName].push(callback);},trigger: function(eventName){var args = arguments || [];var callbacks = eventCallbacksMap[eventName] || [];if(callbacks.length === 0) return;var temp = [];for(var i=1; i<args.length; i++){temp.push(args[i]);}for(var j=0; j<callbacks.length;j++){callbacks[j].apply(card, temp);}},GetZoomFactor : function() {var factor = 1;if (document.body.getBoundingClientRect) {var rect = document.body.getBoundingClientRect();va{%*i*%}r physicalW = rect.right - rect.left;var logicalW = document.body.offsetWidth;factor = Math.round ((physicalW / logicalW) * 100) / 100;}return factor;},format: function(tpl, json){var temp = tpl;var reg = null;$.each(json, function(key, item){reg = new RegExp("#{"+ key +"}","g");temp = temp.replace(reg, item);});return temp;}}})(card);function Popup(options){options = options || {};if(!options.dom || !options.offsetdom) return;this.offsetdom = options.offsetdom;this.display = options.display || {%*i*%}'none';this.dom = options.dom;this.url = options.url;this.success = options.success;this.error = options.error;this.cache = {};this.params = {};if(options.html){options.dom.innerHTML = options.html;}if(this.display !== 'none'){this.show();}}Popup.prototype.render = function(){var queryKey = this.getQuerykey();if(this.cache[queryKey]){this._callback(1, this.cache[queryKey]);}else{this._getData();}};Popup.prototype.show = function(){if(this.dom){var offsetHeight = this.offsetdom.offsetHeight;var p{%*i*%}osition = util.getOffset(this.offsetdom);this.top = position.top + offsetHeight -1;this.left = position.left;if(util.isIE7()){var _factor = util.GetZoomFactor() || 0.1;this.top = (position.top/_factor) + offsetHeight -1;this.left = position.left/_factor;}this.dom.style.top = this.top + 'px';this.dom.style.left = this.left + 'px';this.display = 'block';}};Popup.prototype.hide = function(){if(this.dom){this.dom.style.top = '-9999px';this.dom.style.left = '-9999px';this.display = 'none';}};Popup.pr{%*i*%}ototype.setQueryParams = function(params){params = params || {};if(!params.queryName) return;var p = {};p[params.queryName] = util.trim(params.queryKey);this.params = util.extend({}, this.params, p);};Popup.prototype.getQueryParams = function(){return this.params || {};};Popup.prototype.clearCache = function(){if(this.getCacheSize()>20){this.cache = {};}};Popup.prototype.getCacheSize = function(){var n = 0;for(var s in this.cache){if(this.cache.hasOwnProperty(s)){n++;}}return n;};Popup.prototype{%*i*%}._getData = function(){var me = this;me.onsuccess = function(data){ajaxFinished = true;if(!data){me._callback();return;}me._callback(1, data);me.clearCache();me.cache[me.getQuerykey()] = data;};me.onerror = function(xhr){ajaxFinished = true;me._callback(0, xhr);};util.jsonp(this.url,util.extend({}, {_t: new Date().getTime()}, this.params),'__jscallback',me.onsuccess,me.onerror);};Popup.prototype.getQuerykey = function(){var querykey = '';for(var s in this.params){if(this.params.hasOwnProperty(s){%*i*%}){querykey = querykey + this.params[s];}}return querykey;};Popup.prototype._callback = function(status, data){if(!this.dom) return;if(status === 1){if(this.success){this.success(data);}}else{if(this.error){this.error(data);}}};var hotHotel = (function(card){var pub = {};var cache = {};var pricedom = util.getElementByClassName(util.getClass('jsprice'));var priceParent = pricedom.parentNode;var dangcidom = util.getElementByClassName(util.getClass('jsdangci'));var dangciParent = dangcidom.parentNod{%*i*%}e;var branddom = util.getElementByClassName(util.getClass('jsbrand'));var brandParent = branddom.parentNode;var hotelsdom = util.getElementByClassName(util.getClass('jshotels'));var hideClassName = util.getClass('hide');var cityname='';var callback = function(){};var getCacheSize = function(){var n = 0;for(var s in cache){if(cache.hasOwnProperty(s)){n++;}}return n;};pub.onsuccess = function(data){ajaxFinished = true;if(getCacheSize()>=20) cache={};cache[cityname] = data;callback(data);};pub.oner{%*i*%}ror = function(xhr){ajaxFinished = true;};var getData = function(_cityname, _callback){cityname = _cityname;callback = _callback;if(cache[cityname]) {callback(cache[cityname]);return;}util.jsonp(domainurl+'/basicCard.jsp',{cityName: cityname, queryid: card.data.QUERYID},'__jscallback',pub.onsuccess,pub.onerror);};var getFilterHtml = function(data, dom ,parentDom, url, ext_param){var html = [];if(!data || data && data.length===0){util.addClass(parentDom, hideClassName);}else{for(i=0; i<data.lengt{%*i*%}h; i++){var filterurl = url + data[i].url + ext_param + "&" + card.data.QHFP;name = data[i].name;html.push('<li class="c-gap-right"><a target="_blank" href="', filterurl,'">', name.replace(/%26/g,"&"),'</a></li>');}dom.innerHTML= html.join('');util.removeClass(parentDom, hideClassName);}};var getHotelsHtml = function(data, url){var html = [];var ext_params = ["?ex_track=bd_zhixin_hotel_bsc_lowprice_pad", "?ex_track=bd_zhixin_hotel_bsc_highlevel_pad", "?ex_track=bd_zhixin_hotel_bsc_bestscore_pad"{%*i*%}, "?ex_track=bd_zhixin_hotel_bsc_highrank_pad"];var i, tplname=card.data.TPL_NAME;var hotelTpl = ['<div class="c-span6 #{lastclass}"><div class="op-#{tplname}-hotel">','<div class="op-#{tplname}-img">','<a target="_blank" href="#{hotelurl}">','<img class="c-img c-img6" src="#{imgurl}"/>','<div class="op-#{tplname}-img-tag">#{tag}</div>','</a>','</div>','<p class="op-#{tplname}-hotel-intro"><a target="_blank" href="#{hotelurl}">#{intro}</a></p>','<p class="op-#{tplname}-hotel-price">','<span><a t{%*i*%}arget="_blank" href="#{hotelurl}">#{count}家酒店</a></span>','<em><a target="_blank" href="#{hotelurl}"><b>&yen;#{price}</b>起</a></em>','</p>','</div></div>'].join('');if(!data || data && data.length<4){util.addClass(hotelsdom, hideClassName);}else{for(i=0; i<data.length; i++){html.push(util.format(hotelTpl, {lastclass: i===3? 'c-span-last': '',tplname: tplname,hotelurl: url + data[i].url + ext_params[i] + "&" + card.data.QHFP + (i===2?"#sort=score-desc":(i==0 || i==1 ? '#sort=price-asc' : '')),img{%*i*%}url: data[i].img,name: data[i].name,tag: data[i].tag,intro: i === 3 ? "搜索最高酒店推荐" : data[i].intro,count: data[i].count,price: data[i].price}));}hotelsdom.innerHTML= html.join('');util.removeClass(hotelsdom, hideClassName);}};return util.extend({}, pub, {render: function(cityname){var show = function(data){if(data.ret === true && data.data){data = data.data;var _url = data.url || "http://hotel.qunar.com/city/beijing_city/";var url = _url.split('?')[0];if(url.lastIndexOf('/')<0) {url = url + '/';}g{%*i*%}etFilterHtml(data.brandlinks, branddom, brandParent, url, "?ex_track=bd_zhixin_hotel_bsc_hotbrand_pad");getFilterHtml(data.pricelinks, pricedom, priceParent, url, "?ex_track=bd_zhixin_hotel_bsc_hotprice_pad");getFilterHtml(data.dangcilinks, dangcidom, dangciParent, url, "?ex_track=bd_zhixin_hotel_bsc_hotlevel_pad");getHotelsHtml(data.hotellinks, url);}};getData(cityname, show);}});})(card);var tempScrollTop = 0;var cityInputEl = util.getElementByClassName(util.getClass('city-input'));var hotCity{%*i*%}LayerEl = util.getElementByClassName(util.getClass('hotcity'));var keyInputEl = util.getElementByClassName(util.getClass('keyword-input'));var hotKeyLayerEl = util.getElementByClassName(util.getClass('hotkey'));var hotCity = new Popup({dom: hotCityLayerEl,offsetdom: cityInputEl});var hotKey = new Popup({dom: hotKeyLayerEl,offsetdom: keyInputEl,url: domainurl + "/sugg.jsp",success: function(data){if(data && data.data){hotKey.dom.style.borderWidth = '1px';hotKey.dom.innerHTML = data.data.replace(/o{%*i*%}nmousedown="return searchword\(.*\)"/ig, "");var cityguidedom = util.getElementByClassName('js_cityguide', hotKeyLayerEl);if(cityguidedom){var url = cityguidedom.getAttribute('data-url') + "&ex_track=bd_zhixin_hotel_divcityguide_pad"+ "&" + card.data.QHFP;cityguidedom.setAttribute('data-url', url);}}},error: function(xhr){hotKey.dom.innerHTML = '';hotKey.dom.style.borderWidth = '0px';}});hotKey.setQueryParams({queryName: 'v',queryKey: '1'});hotKey.setQueryParams({queryName: 'queryid',queryKey: c{%*i*%}ard.data.QUERYID});var documentClickHandler = function(e) {hotCity.hide();hotKey.hide();};util.on(document, 'click', documentClickHandler);var windowBlurHandler = function(e) {hotCity.hide();hotKey.hide();};util.on(window, 'blur', windowBlurHandler);util.on(cityInputEl,'click',function(e) {hotKey.hide();card._sug && card._sug.hide();if (hotCity.display === 'block') {hotCity.hide();}else {hotCity.show();}e.stopPropagation();e.preventDefault();});util.on(hotCityLayerEl,'click',function(e) {e.stopP{%*i*%}ropagation();e.preventDefault();var target = e.target || e.srcElement;if (target.tagName.toUpperCase() === 'A') {var v = target.getAttribute('data-city');if(cityInputEl.value != v){util.trigger('citychanged',v);}if(v){if(card._sug ){card._sug.hide();card._sug.pick('<span class="js_cityname" data-cityname="'+v+'">'+v+'</span>');}else{cityInputEl.value = v;}hotCity.hide();}}});util.on(keyInputEl,'click',function(e) {if (hotKey.display === 'block') {hotKey.hide();}else {hotKey.setQueryParams({query{%*i*%}Name: 'city',queryKey: cityInputEl.value});hotKey.render();hotKey.show();hotCity.hide();}e.stopPropagation();e.preventDefault();});util.on(hotKeyLayerEl,'click',function(e) {e.stopPropagation();e.preventDefault();var target = e.target || e.srcElement;if (target.tagName.toUpperCase() === 'A') {var v = util.trim(target.innerHTML);if(v){keyInputEl.value = v;hotKey.hide();$(window).scrollTop(tempScrollTop);}}});util.on(hotCityLayerEl,'touchmove',function(e) {cityInputEl.blur();}); util.on(hotKeyLaye{%*i*%}rEl,'touchmove',function(e) {keyInputEl.blur();}); util.one(hotKeyLayerEl,'touchstart',function(e) {tempScrollTop = $(window).scrollTop();}); util.bind('citychanged', function(cityname){hotHotel && hotHotel.render(cityname);});var querybtn = util.getElementByClassName(util.getClass('jsquerybtn'));util.on(querybtn,'click',function(e){var cityname = encodeURIComponent(cityInputEl.value);var key = encodeURIComponent(keyInputEl.value);querybtn.href = 'http://hotel.qunar.com/search.jsp?ex_track=bd_zh{%*i*%}ixin_hotel_bsc_search_pad&toCity='+ cityname +'&q='+key + "&"+ card.data.QHFP;});card.dispose = function(){if(!ajaxFinished){if(hotKey.onsuccess){hotKey.onsuccess = null;}if(hotKey.onerror){hotKey.onerror = null;}if(hotHotel.onsuccess){hotHotel.onsuccess = null;}if(hotHotel.onerror){hotHotel.onerror = null;}}util.unbind(document, 'click', documentClickHandler);util.unbind(window, 'blur', windowBlurHandler);};});</script>{%/block%}