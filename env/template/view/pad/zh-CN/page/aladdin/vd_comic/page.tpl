{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%if !$tplData.showurl%} {%$tplData.showurl='v.baidu.com'%} {%/if%}{%if $extData.resourceid&&$extData.resourceid lt 5999%}{%$extData.feData.fm='alop'%}{%/if%}{%if $tplData.ty && strstr($tplData.ty,'22') %} {%$extData.feData.urData="{pid:'video',type:'tvplay'}"%} {%else%} {%$extData.feData.urData="{pid:'video',type:'comic'}"%}{%/if%} {%if !$tplData.url&&$tplData.titleEnc%} {%$tplData.url="http://video.baidu.com/v?word={%$tplData.titleEnc%}&ct=301989888&rn=20&pn=0&db=0&s=8&fr=ala8"%} {%/if%} {%if $tplData.al_title%} {%$tplData.title=$tplData.al_title|cat:'_高清视频在线观看_百度视频'%} {%elseif  $tplData.al_title_new%} {%$tplData.title=$tplData.al_title_new%} {%/if%}{%if !$tplData.sites[0]%}{%$tplData.sites=array($tplData.sites)%}{%/if%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='img'%}{%fe_fn_c_css css='tabs'%}{%fe_fn_c_css css='numberset'%}.vd-comic-icon{width:16px;height:16px;margin:4px 2px 0 0;background-repeat:no-repeat;float:left}.vd-comic-new-jmore{clear:both}.vd-comic-jmoreo,.vd-comic-jmorec{position:relative}.vd-comic-jmoreo a.vd-comic-jmoreo-a{display:block}.vd-comic-jmoreo a.vd-comic-jmorec-a{display:none}.vd-comic-jmorec a.vd-comic-jmoreo-a{display:none}.vd-comic-jmorec a.vd-comic-jmorec-a{display:block}.vd-comic-jmoreo .c-icon,.vd-comic-jmorec .c-icon{_vertical-align:middle}.vd-comic-jmoreo a,.vd-comic-jmorec a{cursor:p{%*i*%}ointer;color:#00c;text-decoration:underline}.vd-comic-pagebar{border-bottom:1px solid #eee;color:#666;padding:5px 0 10px 0}.vd-comic-pagebar div{cursor:pointer;zoom:1;display:inline-block;width:16.6%;color:#0000ce;float:left}.vd-comic-pagebar a{text-decoration:underline}.vd-comic-pagebar .vd-comic-pageon a{cursor:default;color:#000;text-decoration:none}.vd-comic-content{position:relative;height:1%}.vd-comic-loading{position:absolute;left:0;top:0;height:77px;width:100%;background:#fff;z-index:1;t{%*i*%}ext-align:center;display:none}.vd-comic-loading-icon{width:30px;height:30px;display:inline-block;background:url(http://www.baidu.com/aladdin/img/videoidea/loading_L.gif) no-repeat}.vd-comic-new-ulbox li{position:relative}.vd-comic-new-ulbox li i{position:absolute;overflow:hidden;display:none}.vd-comic-new-ulbox li div{display:none}.vd-comic-new-ulbox li.vd-comic-new i{*zoom:1;display:block;right:-10px;top:-3px}.vd-comic-finish,.vd-comic-update{padding:0 1px;text-align:center;color:#fff;font-size{%*i*%}:.92em;background:#2b99ff}.vd-comic-first{width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:#333}.vd-comic-split{color:#d8d8d8}.vd-comic-summary{padding-left:3em;text-indent:-3em}</style><div class="vd-comic c-abstract"> <div class="c-row"> <div class="c-span6"> <a target="_blank" href="{%$tplData.url%}"> <img class="c-img c-img6" alt="图片" src="{%$tplData.poster%}" title="{%$tplData.al_title|escape%}"> </a> </div> <div class="c-span18 c-span-last"> {%if $tplData.finish == 1%} <span class="vd-comic-finish c-gap-icon-right-small">已完结</span><span>共 {%$tplData.max_episode%}集</span> {%else%} <span class="vd-comic-update c-gap-icon-right-small">更新至</span><span> {%$tplData.cur_episodes%}集{%if $tplData.max_episode%}/共{%$tplData.max_episode%}集{%/if%}</span> {%/if%} {%$firstRowInfo = []%} {%if $tplData.al_date%}{%$firstRowInfo[] = $tplData.al_date%}{%/if%} {%if $tplData.area%}{%if is_array($tplData.area)%}{%$firstRowInfo[] = implode(' ',$tplData.area)%}{%else%}{%$firstRowInfo[] = $tplData.area%}{%/if%}{%/if%} {%if $tplData.language%}{%$firstRowInfo[] = $tplData.language%}{%/if%} {%if $firstRowInfo%} <p class="vd-comic-first"> {%foreach $firstRowInfo as $item%}{%if $item@index != 0%}<span class="c-gap-left-small c-gap-right-small vd-comic-split">|</span>{%/if%}{%$item%}{%/foreach%} </p> {%/if%} {%if is_array($tplData.author)%} <p> <span class="c-gray">作者：</span>{%if $tplData.author[0] && $tplData.author[0].link%}<a target="_blank" href="{%$tplData.author[0].link%}">{%$tplData.author[0].name%}</a>{%else%}{%$tplData.author[0].name%}{%/if%} </p> {%/if%} {%if $tplData.type_new|count > 0%} <p> <span class="c-gray">类型：</span>{%foreach  array_slice($tplData.type_new, 0, 3) as $item%}{%if $item.link%}<a target="_blank" href="{%$item.link%}">{%$item.name%}</a>{%else%}{%$item.name%}{%/if%}{%if !$item@last%}<span class="c-gap-left-small c-gap-right-small vd-comic-split">|</span>{%/if%}{%/foreach%} </p> {%/if%} <p class="vd-comic-summary"><span class="c-gray">简介：</span>{%$tplData.brief_short|limitlen:140%}<a class="c-gap-left-small" href="{%$tplData.url%}" target="_blank">更多&gt;&gt;</a></p> </div> </div> <div class="c-tabs c-gap-top"> <ul class="c-tabs-nav{%if count($tplData.sites) == 1%} c-tabs-nav-one{%/if%}"> {%*前端限制只显示4个站点*%} {%foreach array_slice($tplData.sites,0 , 4) as $item%} <li class="c-tabs-li {%if $item@index eq 0%}c-tabs-nav-selected{%/if%} OP_LOG_BTN"> <b class="vd-comic-icon" style="background-image:url({%$item.site_logo%})"></b>{%$item.site_name|escape%} </li> {%if !$item@last%}<li class="c-tabs-nav-sep" {%if $item@first%}style="visibility:hidden;"{%/if%}></li>{%/if%} {%/foreach%} </ul> <div class="vd-comic-content"> {%foreach $tplData.sites as $item%} <div style="display:{%if $item@first%}block{%else%}none{%/if%}" class="vd-comic-box vd-comic-box{%$item@iteration%}"> <div class="c-clearfix c-gap-bottom-small vd-comic-new-ulbox c-numberset"> </div> </div> {%/foreach%} <table class="vd-comic-loading" cellspacing="0" cellpadding="0"> <tr><td><div class="vd-comic-loading-icon"></div></td></tr> </table> </div> </div></div><script type="text/javascript" >
    //为阿拉丁单条结果实例创建数据
A.setup({
    sites: {%json_encode($tplData.sites)%},
    lessSize: 16,
    pageSize: 96,
    finish: parseInt('{%$tplData.finish%}'),
	ty: '{%$tplData.ty%}',
    videoResourceId : '{%$tplData.id%}',
    title: '{%$tplData.al_title|escape:'javascript'|escape%}'
});
</script><script data-merge>A.setup(function(){var T = A.baidu, _this = this;var sites = _this.data.sites;var lessSize = _this.data.lessSize;var pageSize = _this.data.pageSize;var finish = _this.data.finish;var initIndex = 0;var ajaxFinished = false;A.use('jquery', function(){var $ = A.ui.jquery;var $con = $(_this.container);var boxes = $con.find(".vd-comic-box");var loading = $con.find('.vd-comic-loading')[0];var $tabs = $con.find('.c-tabs-li');var $contents = $(boxes);var episode = sites[initI{%*i*%}ndex].episode;var $curTab = $tabs.eq(initIndex); var $curContent = $contents.eq(initIndex); var $loading = $(loading);bindTabEvent();showLoading();asyncGetData(initIndex);function bindTabEvent(){$tabs.click(function(){var $tab = $(this);var index = $tab.index('.c-tabs-li');var $content = $contents.eq(index);if($tab.get(0) !== $curTab.get(0)){showLess();$curTab.toggleClass('c-tabs-nav-selected');$curTab.prev('.c-tabs-nav-sep').css('visibility', 'visible');$curTab.next('.c-tabs-nav-sep').css('visi{%*i*%}bility', 'visible');$tab.toggleClass('c-tabs-nav-selected');$tab.prev('.c-tabs-nav-sep').css('visibility', 'hidden');$tab.next('.c-tabs-nav-sep').css('visibility', 'hidden');$content.show();$curContent.hide();}$curTab = $tab;$curContent = $content;if(index > 0 && !$curContent.data('loaded')){showLoading();asyncGetData(index);}});}function showLoading(){$curContent.css({height: '77px'});$loading.show();}function hideLoading(){$curContent.css('height', '');$loading.hide();}function asyncGetData(in{%*i*%}dex){var ty=_this.data.ty;if(ty.indexOf('22')>=0){var url='http://v.baidu.com/htvplaysingles/?id=';}else{var url='http://v.baidu.com/hcomicsingles/?id=';}$.ajax({ url: url+_this.data.videoResourceId+'&site='+sites[index]['site_url'],dataType : 'jsonp', success: function(data){if(ajaxFinished) return;initContent(prepareData(data.videos, finish), index);hideLoading();}});}function prepareData(episode, finish){return finish ? episode : episode.reverse();}function initContent(episode, index){var $co{%*i*%}ntent = $contents.eq(index);var $ulbox = $content.find('.vd-comic-new-ulbox:first');var contentArray = buildContent(episode, index);if(!$ulbox.find('ul.vd-comic-new-ulbox_ul_less').length){$ulbox.append(contentArray[0]);}$ulbox.append(contentArray[1]);var $pager = $(buildPager(episode, index));$ulbox.after($pager);bindPagerEvent($pager);var $more = $content.find('.vd-comic-new-jmore');if(!$more.length && episode.length > lessSize){$more = $(buildMore(episode));$content.append($more);}bindMoreEve{%*i*%}nt($more);$content.data('loaded',true);}function buildContent(episode, index){var counter = 0,less = '',more = '';less += '<ul class="vd-comic-new-ulbox_ul_less">';$.each(episode, function(k, ee){if(k == lessSize){return false;}liHtmlClass = "";if(k == 0 && !finish) liHtmlClass += 'vd-comic-new';if((k+1)%8 == 0) liHtmlClass += ' c-numberset-last';less += '<li class="c-gap-top '+ liHtmlClass +'"><a href="'+ ee["url"] +'" target="_blank">'+ ee["episode"] +'集</a><div></div><i class="c-text c-text-d{%*i*%}anger">新</i></li>';});less += '</ul>';if(episode.length > lessSize){more = '<ul class="vd-comic-new-ulbox_ul_more vd-comic-new-ulbox_ul_more_1" style="display:none;">';$.each(episode, function(j, ee){counter = j + 1;liHtmlClass = "";if(j == 0 && !finish) liHtmlClass += 'vd-comic-new';if((j+1)%8 == 0) liHtmlClass += ' c-numberset-last';more += '<li class="c-gap-top '+ liHtmlClass +'"><a href="'+ ee["url"] +'" target="_blank">'+ ee["episode"] +'集</a><div></div><i class="c-text c-text-danger">新</i>{%*i*%}</li>';if(counter && counter % pageSize == 0 && counter != episode.length){more += '</ul><ul class="vd-comic-new-ulbox_ul_more vd-comic-new-ulbox_ul_more_'+ (counter / pageSize + 1) +'" style="display:none;">';}});more += '</ul>';} return [less, more];}function buildPager(episode, index){var html = '';var pageNum = Math.floor(episode.length / pageSize);if(episode.length % pageSize > 0){pageNum++;}if(pageNum > 1){html = '<div class="c-gap-top c-gap-bottom vd-comic-pagebar" style="display:none;ove{%*i*%}rflow:hidden;zoom:1">';for(var n = 0; n < pageNum; n++){var eon = (n == 0) ? 'vd-comic-pageon' : '';var startNum, endNum;if(finish){startNum = pageSize*n+1;endNum = ((startNum + pageSize - 1) > episode.length) ? episode.length : startNum + pageSize - 1;html += '<div class="'+eon+' OP_LOG_BTN"><a>'+startNum+'~'+endNum+'集</a></div>';}else{startNum = episode.length-pageSize*n;endNum = ((startNum - pageSize + 1) <= 0) ? 1 : startNum - pageSize + 1;html += '<div class="'+eon+' OP_LOG_BTN"><a>'+endNum{%*i*%}+'~'+startNum+'集</a></div>';}}html += '</div>';}return html;}function bindPagerEvent($pager){var $episodes = $pager.parent().find('ul.vd-comic-new-ulbox_ul_more');var $pagers = $pager.find('div');$pagers.click(function(){var $p = $(this);if(!$p.is('.vd-comic-pageon')){$pagers.filter('.vd-comic-pageon').removeClass('vd-comic-pageon');$p.addClass('vd-comic-pageon');$episodes.filter(':visible').hide();$episodes.eq($p.index()).show();}});}function buildMore(episode){var html = '<div class="vd-comic-{%*i*%}new-jmore vd-comic-jmoreo OP_LOG_BTN" style="display:block">'+'<a class="vd-comic-jmoreo-a"><i class="c-icon c-icon-unfold c-gap-icon-right-small"></i>显示全部《<em>'+_this.data.title+'</em>》视频</a>'+'<a class="vd-comic-jmorec-a"><i class="c-icon c-icon-fold c-gap-icon-right-small"></i>收起</a>'+'</div>';return html;}function bindMoreEvent($more){$more.click(function(){$more.is(".vd-comic-jmoreo") ? showMore() : showLess();});}function showMore(){$curContent.find(".vd-comic-new-ulbox_ul_less").hide();$c{%*i*%}urContent.find(".vd-comic-new-ulbox_ul_more_1").show();$curContent.find(".vd-comic-pagebar").show();$curContent.find(".vd-comic-new-jmore").removeClass("vd-comic-jmoreo").addClass("vd-comic-jmorec");}function showLess(){$curContent.find(".vd-comic-new-ulbox_ul_less").show();$curContent.find(".vd-comic-pagebar>div:first").click();$curContent.find(".vd-comic-new-ulbox_ul_more").hide();$curContent.find(".vd-comic-pagebar").hide();$curContent.find(".vd-comic-new-jmore").removeClass("vd-comic-jmorec"{%*i*%}).addClass("vd-comic-jmoreo");}});this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}