{%extends 'c_right_base.tpl'%} {%block name="data_modifier"%}{%$extData.feData.narrow = true%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css="btn"%}{%fe_fn_c_css css="input"%}{%fe_fn_c_css css="img"%}{%fe_fn_c_css css='dropdown2'%}.opr-map-book-container{padding:10px 4px}.opr-map-booking{background-color:#fafafa}.opr-map-book-container .opr-map-book-radio{position:relative;top:2px;right:-2px;margin:0;padding:0;+width:13px;+height:13px}.opr-map-book-container label{zoom:1;+position:relative;+top:4px}.opr-map-unbooking .opr-map-book-box{display:none}.opr-map-booking .opr-map-book-box{display:block}.opr-map-unbooking .opr-map-book-expand-btn{display:inline}.opr-map-unbooking .opr-map-book-fold-btn{display:none}.opr-map-booki{%*i*%}ng .opr-map-book-expand-btn{display:none}.opr-map-booking .opr-map-book-fold-btn{display:inline}.opr-map-book-expand-btn{color:#00c;_position:relative;_top:2px}.opr-map-book-fold-btn{color:#999;_position:relative;_top:2px}.opr-map-book-price{color:#f70}.opr-map-book-comment{color:#999;zoom:1}.opr-map-book-title{padding:0 4px}.opr-map-book-title span{float:left}.opr-map-book-title a{float:right;color:#999;font-weight:normal;font-size:13px}.opr-map-book-right{position:relative;top:-3px;float:left;{%*i*%}width:185px;overflow-y:hidden}.opr-map-book-input{width:140px;padding-left:2px}.opr-map-book-customer-name-container{float:left}.opr-map-book-sex-container{float:left;margin-left:11px;+margin-left:7px;margin-top:2px}.opr-map-book-date-container{background-color:#fff;float:left}.opr-map-book-date-container .opr-map-book-input-date{width:118px;width:106px\9;+width:103px}.opr-map-book-date-input-container{width:147px;padding-right:2px;padding-left:2px}.opr-map-book-container .c-dropdown2-btn{paddin{%*i*%}g-left:2px}.opr-map-book-time-container{float:left}.opr-map-book-customer-number-dropdown-container{width:153px;float:left;margin-right:4px}.opr-map-book-room-or-hall-container{float:left;margin-top:2px;margin-left:7px}.opr-map-book-time-dropdown-container{width:84px;+width:90px}.opr-map-book-error-input{border:1px solid #c00;color:#c00}.opr-map-book-error-dropdown .c-dropdown2 .c-dropdown2-btn-group{border:1px solid #c00;border-bottom-color:#c00;border-right-color:#c00;-moz-user-select:none;-we{%*i*%}bkit-user-select:none;user-select:none}.opr-map-book-error-dropdown .c-dropdown2 .c-dropdown2-btn{color:#c00}.opr-map-book-getvcode-btn{margin-left:8px}.opr-map-book-getvcode-btn-disable{padding:0 4px}.opr-map-book-result{position:relative;padding-left:44px;display:none;line-height:1.4em;color:#666;zoom:1}.opr-map-book-result i{position:absolute;top:1px;left:22px}.opr-map-book-result-success .opr-map-book-result-success-box{display:block}.opr-map-book-result-success .opr-map-book-result-fail-box{%*i*%}{display:none}.opr-map-book-result-fail .opr-map-book-result-fail-box{display:block}.opr-map-book-result-fail .opr-map-book-result-success-box{display:none}.opr-map-book-container .c-icon-chevron-bottom{margin-left:2px}.opr-map-book-container .c-icon-chevron-top{margin-left:2px}.opr-map-book-submit-container{position:relative}.opr-map-book-more{position:absolute;right:17px;top:4px}</style><div class="cr-title opr-map-book-title c-clearfix"> <span>{%$tplData.title|escape%}预订</span> <a href="http://nlbc.baidu.com/lbs-lbc/index.action" target="_blank">推广</a></div>{%foreach array_slice($tplData.shops, 0, 2) as $item%}{%$tempDataId=$item@iteration%}<div class="opr-map-book-container opr-map-unbooking" data-shopid="{%$item.shopid|escape:'none'%}" data-id="{%$tempDataId|escape:'none'%}"> <div class="c-row">{%$tempDataHeight={%fe_fn_c_get_img_height col=4 rate=1%}%} <div class="c-span4" style="height:{%$tempDataHeight%}px;"> <a href="{%$item.placeUrl%}" target="_blank"> <img class="c-img c-img4" src="http://webmap3.map.bdimg.com/maps/services/thumbnails?width=100&height=100&align=center,center&src={%urlencode($item.shopimg)%}"> </a> </div> <div class="opr-map-book-right"> <a href="{%$item.placeUrl%}" target="_blank"{%if $item.name|string_display_len>22%} title="{%$item.name|escape%}"{%/if%}>{%$item.name|limitlen:22|escape%}</a> <div> <span>人均：</span><span class="opr-map-book-price"><strong>{%$item.price|escape%}</strong>元</span> </div> <div> <span>评分：</span><i class="c-icon c-icon-star-gray"> <i class="c-icon c-icon-star" style="width:{%intval($item.starCount)*20%}%;"></i> </i> </div> <div> <a class="opr-map-book-expand-btn OP_LOG_BTN" href="#" onclick="return false;" data-click="{fm: 'beha'}">点击预订<i class="c-icon c-icon-chevron-bottom"></i></a> <a class="opr-map-book-fold-btn OP_LOG_BTN" href="#" onclick="return false;" data-click="{fm: 'beha'}">收起<i class="c-icon c-icon-chevron-top"></i></a> <a class="opr-map-book-comment c-gap-left-small" href="{%$item.commentUrl%}" target="_blank">{%$item.commentNum|escape%}篇评论</a> </div> </div> </div> <div class="opr-map-book-box c-gap-top"> <div class="c-clearfix"> <div class="opr-map-book-date-container" data-type="calendar" data-empty="" data-error=""> <span class="c-input opr-map-book-date-input-container OP_LOG_BTN" data-click="{fm:'beha'}"> <i data-click="{fm:'beha'}" class="c-icon c-icon-calendar"></i> <input type="text" class="opr-map-book-input-date" readonly="readonly" name="date" value=""> <div class="opr-map-book-calendar-container"></div> </span> </di{%*i*%}v> <div class="opr-map-book-time-container c-gap-left"> <div class="opr-map-book-time-dropdown-container" data-type="time" data-empty="" data-error=""></div> </div> </div> <div class="c-gap-top c-clearfix"> <div class="opr-map-book-customer-number-dropdown-container" data-form-type="dropdown" data-type="number" data-empty="请选择人数" data-error=""></div> <div class="opr-map-book-room-or-hall-container"> <input class="opr-map-book-radio" id="opr-map-book-hall-{%$tempDataId%}" type="radio" name="opr-map-book-room-or-hall-{%$tempDataId%}" value="1" data-name="hall"> <label for="opr-map-book-hall-{%$tempDataId%}" data-name="hall">大厅</label> <input class="opr-map-book-radio" id="opr-map-book-room-{%$tempDataId%}" type="radio" name="opr-map-book-room-or-hall-{%$tempDataId%}" value="0" data-name="room" style="margin-left: 6px;"> <label for="opr-map-book-room-{%$tempDataId%}" data-name="room" style="+left:-6px;">包房</label> </div> </div> <div class="c-gap-top c-clearfix"> <div class="opr-map-book-customer-name-container"> <input class="c-input opr-map-book-input opr-map-book-customer-name" maxlength="30" placeholder="联系人" data-placeholder="联系人" data-form-type="input" data-type="customer" data-empty="请留下联系人姓名" data-error="姓名格式有误"> </div> <div class="opr-map-book-sex-container"> <input class="opr-map-book-radio" id="opr-map-book-customer-sex-female-{%$tempDataId%}" type="radio" name="opr-map-book-customer-sex-{%$tempDataId%}" value="1" checked="checked"> <label for="opr-map-book-customer-sex-female-{%$tempDataId%}">女士</label> <input class="opr-map-book-radio" id="opr-map-book-customer-sex-male-{%$tempDataId%}" type="radio" name="opr-map-book-customer-sex-{%$tempDataId%}" value="0" style="margin-left: 6px;"> <label for="opr-map-book-customer-sex-male-{%$tempDataId%}" style="+left:-6px;">男士</label> </div> </div> <div class="c-gap-top"> <input class="c-input opr-map-book-input opr-map-book-customer-phone" maxlength="11" placeholder="手机号" data-placeholder="手机号" data-form-type="input" data-type="phone" data-empty="请输入11位手机号" data-error="手机号有误，请重填"> <a class="c-btn opr-map-book-getvcode-btn OP_LOG_BTN" href="#" onclick="return false;" data-click="{fm: 'beha'}" data-ajaxing="发送中...">获取验证码</a> </div> <div class="c-gap-top"> <input class="c-input opr-map-book-inpu{%*i*%}t opr-map-book-vcode" maxlength="10" placeholder="验证码" data-placeholder="验证码" data-form-type="input" data-type="vcode" data-empty="请输入验证码" data-error="验证码有误，请重填"> </div> <div class="c-gap-top opr-map-book-submit-container"> <a class="c-btn c-btn-primary opr-map-book-submit-btn OP_LOG_BTN" href="#" onclick="return false;" data-click="{fm: 'beha'}" data-ajaxing="预订中...">马上预订</a> <a class="opr-map-book-more" href="{%$tplData.referrallinks%}" target="_blank">从更多店铺中挑选&gt;&gt;</a> </div> </div> <div class="opr-map-book-result opr-map-book-result-success c-gap-top"> <div class="opr-map-book-result-success-box"> <i class="c-icon c-icon-right-large"></i> <span></span> </div> <div class="opr-map-book-result-fail-box"> <i class="c-icon c-icon-wrong-large"></i> <span></span> </div> </div></div>{%/foreach%}<script >
    A.setup({
        'srcid':{%$extData.resourceid%}
    });
</script><script data-merge>A.setup(function(){var _this = this;var ajaxFinished = false;var urlPrefix = 'http://map.baidu.com/detail?';var placeholderable = 'placeholder' in document.createElement('input');var rbList = [];var time = ( bds && bds.comm && bds.comm.serverTime )? bds.comm.serverTime * 1000: ( +new Date() );var today = new Date(time);var sDate = formatDate(today);function RB(options){this.$container = options.container; this.init();}RB.prototype = {init: function(){var t = this;t.id{%*i*%} = t.$container.attr('data-id');t.thirdId = t.$container.attr('data-shopid');t.vcoding = false;t.commiting = false;t.loaded = false;t.calendar = null; t.timeDropdown = null;t.numberDropdown = null;t.thirdName = '';t.shopId = '';t.fd = [];t.$formBox = t.$container.find('.opr-map-book-box');t.$cInput = t.$container.find('.opr-map-book-input-date');t.$timeDropdownContainer = t.$container.find('.opr-map-book-time-dropdown-container');t.$dateDropdownContainer = t.$container.find('.opr-map-book-date-c{%*i*%}ontainer');t.fd.push(t.$numberDropdownContainer = t.$container.find('.opr-map-book-customer-number-dropdown-container'));t.fd.push(t.$customerNameInput = t.$container.find('.opr-map-book-customer-name'));t.fd.push(t.$phoneInput = t.$container.find('.opr-map-book-customer-phone'));t.fd.push(t.$vcodeInput = t.$container.find('.opr-map-book-vcode'));t.$bookExpandBtn = t.$container.find('.opr-map-book-expand-btn');t.$bookFoldBtn = t.$container.find('.opr-map-book-fold-btn');t.$getVcodeBtn = t.$conta{%*i*%}iner.find('.opr-map-book-getvcode-btn');t.$submitBtn = t.$container.find('.opr-map-book-submit-btn');t.$roomOrHallContainer = t.$container.find('.opr-map-book-room-or-hall-container');t.$sexRadio = t.$container.find('input[name="opr-map-book-customer-sex-' + t.id + '"]'); t.$cBox = t.$container.find('.opr-map-book-calendar-container');t.$result = t.$container.find('.opr-map-book-result');t.bindEvent();},bindEvent: function(){var t = this;t.$bookExpandBtn.bind('click', function(){if(!t.loaded){t.{%*i*%}loadInfo();t.loaded = true;}t.open(); }); t.$bookFoldBtn.bind('click', function(){t.close(); });t.$dateDropdownContainer.bind('click', function(){t.calendar && t.calendar.show();return false;});$.each(t.fd, function(i, $n){var dataFormType = $n.attr('data-form-type');var errorClass = 'opr-map-book-error-' + dataFormType;if(dataFormType === 'input'){$n.bind('focus', function(){if($n.is('.' + errorClass)){var preValue = $n.data('preValue');if(preValue){$n.val(preValue);if(!placeholderable){$n.css({%*i*%}'color', '#000');}}else{$n.val(placeholderable ? '' : $n.attr('data-placeholder'));}$n.removeClass(errorClass);}}).bind('blur', function(){var value = $.trim($n.val());$n.data('preValue', value);if(value && value !== $n.attr('data-placeholder')){t.check($n); }});}else{}});t.$submitBtn.bind('click', function(){ if(t.commiting === true){ return; }var flag = true;$.each(t.fd, function(i, $n){var cf = t.check($n);flag = cf ? flag : cf;});if(!flag){ return; }t.disableSubmit(); var getBookInfoParams ={%*i*%} {qt: 'cater_bookconfirm',personNum: parseInt(t.numberDropdown.getValue(), 10), userName: $.trim(t.$customerNameInput.val()), mobile: $.trim(t.$phoneInput.val()), shopId: t.shopId, thirdName: t.thirdName, needRoom: 0, acceptHall: 0, orderTime: t.calendar.value + ' ' + t.timeDropdown.getValue(), pcode: $.trim(t.$vcodeInput.val()), from: 'webapp', srcFrom: 'right_map_book_' + _this.data.srcid, gender: parseInt(t.$sexRadio.filter(":checked").val()) }; var $rh = t.$container.find('input[type=radio][{%*i*%}name^="opr-map-book-room-or-hall"]:checked');if($rh.length === 1){var rhSelected = $rh.eq(0).attr('data-name');if(rhSelected === 'hall'){getBookInfoParams.acceptHall = 1;}else{getBookInfoParams.needRoom = 1;}}var originText = t.$submitBtn.text();t.$submitBtn.text(t.$submitBtn.attr('data-ajaxing'));$.ajax({url: urlPrefix + $.param(getBookInfoParams),dataType: 'jsonp'}).done(function(data, textStatus, jqXHR){if(ajaxFinished){ return; } t.$submitBtn.text(originText);if(data && data.errorNo == 0){va{%*i*%}r msg = '';if(data.data && data.data.book_feedback){msg = data.data.book_feedback;}t.success(msg);}else{if(parseInt(data.errorNo, 10) === 9001){t.tip('error', t.$vcodeInput); }else{t.fail(data.errorMsg);}}t.enableSubmit();}).fail(function(jqXHR, textStatus, errorThrown){if(ajaxFinished){ return; } t.$submitBtn.text(originText);t.bookFail();t.enableSubmit();}).error(function(jqXHR, textStatus, errorThrown){if(ajaxFinished){ return; } t.$submitBtn.text(originText);t.bookFail();t.enableSubmit();});{%*i*%} });t.$getVcodeBtn.bind('click', function(){if(t.vcoding === true){ return; }if(!t.check(t.$phoneInput)){ return; }t.$getVcodeBtn.addClass('c-btn-disable opr-map-book-getvcode-btn-disable');t.vcoding = true;t.$phoneInput.attr('disabled', true);t.vcodeTimerCount = 60;if(t.vcodeTimer){clearInterval(t.vcodeTimer);}t.$getVcodeBtn.html((t.vcodeTimerCount--) + '秒后重新获取');t.vcodeTimer = setInterval(function(){if(t.vcodeTimerCount > 0){t.$getVcodeBtn.html((t.vcodeTimerCount--) + '秒后重新获取');}else{t.vcoding{%*i*%} = false;if(t.vcodeTimer){clearInterval(t.vcodeTimer);}t.$phoneInput.removeAttr('disabled');t.$getVcodeBtn.html('获取验证码').removeClass('c-btn-disable opr-map-book-getvcode-btn-disable');}}, 1000);var getVcodeParams = {qt: 'cater_phonecaptcha',phone_num: $.trim(t.$phoneInput.val())};var originText = t.$getVcodeBtn.text();t.$getVcodeBtn.text(t.$getVcodeBtn.attr('data-ajaxing')); $.ajax({url: urlPrefix + $.param(getVcodeParams),dataType: 'jsonp'}).done(function(data, textStatus, jqXHR){if(ajaxFinishe{%*i*%}d){ return; } t.$getVcodeBtn.text(originText);}).fail(function(jqXHR, textStatus, errorThrown){t.$getVcodeBtn.text(originText);}).error(function(jqXHR, textStatus, errorThrown){t.$getVcodeBtn.text(originText);});});if(!placeholderable){bindPlaceholder(t.$customerNameInput.get(0));bindPlaceholder(t.$phoneInput.get(0));bindPlaceholder(t.$vcodeInput.get(0));}},loadInfo: function(date){var t = this,getBookInfoParams = {qt: 'cater_bookinfo',thirdId: t.thirdId};if(date){getBookInfoParams.date = date;}{%*i*%}$.ajax({url: urlPrefix + $.param(getBookInfoParams),dataType: 'jsonp'}).done(function(data, textStatus, jqXHR){if(ajaxFinished){ return; } if(data && data.data && data.errorNo == 0){data = data.data;var bookInfo = data.book_info,shopInfo = data.shop_info,haveHall = shopInfo.have_hall,haveRoom = shopInfo.have_room,bookDate = bookInfo.book_date,dateList = bookInfo.time.date_list,timeList = bookInfo.time.detail,bookDateList = [],bookTimeList = [],selected = 'hall', y, m, d;t.thirdName = shopInfo.ag{%*i*%}ent;t.shopId = shopInfo.shop_id;if(haveHall === '1' && haveRoom === '1'){}else if(haveHall === '1'){t.$roomOrHallContainer.find('[data-name="room"]').remove();}else if(haveRoom === '1'){selected = 'room';t.$roomOrHallContainer.find('[data-name="hall"]').remove();}else{t.$roomOrHallContainer.remove();}t.$container.find('input[type=radio][name^="opr-map-book-room-or-hall"][data-name="' + selected + '"]').attr('checked', true);var person = bookInfo.person, max, min, personArray = [{value: 0, text: {%*i*%}'请选择人数'}];if(person){max = person.max ? parseInt(person.max, 10) : 50;min = person.min ? parseInt(person.min, 10) : 1;}for(var i = min; i <= max; i++){personArray.push({value: i, text: i + '人'});}for(var i = 0; i < dateList.length; i++){var sDate = dateList[i].replace(/(\d{4})\-(\d{1,2})\-(\d{1,2})/, function(match, _y, _m, _d){y = _y;m = _m*1 < 10 ? '0' + _m*1 : _m;d = _d*1 < 10 ? '0' + _d*1 : _d;return y + m + d;});bookDateList.push({sDate: sDate, dDate: new Date(y*1, m*1 - 1, d*1)});} for(var{%*i*%} i = 0; i < timeList.length; i++){ if(timeList[i] && timeList[i].bookable == 1){bookTimeList.push({value: timeList[i].time, text: timeList[i].time});}} t.setCalendar(bookDateList); t.setDropdown(bookTimeList, personArray); }}).fail(function(jqXHR, textStatus, errorThrown){if(ajaxFinished){ return; } }).error(function(jqXHR, textStatus, errorThrown){if(ajaxFinished){ return; } });},setCalendar: function(bookDateList){var t = this;if(!t.calendar){A.use('calendar', function(){t.calendar = A.ui.cale{%*i*%}ndar({input: t.$cInput.get(0),element: t.$cBox.get(0),position: t.$dateDropdownContainer.get(0),count: 1,between: [bookDateList[0].sDate, bookDateList[bookDateList.length - 1].sDate],onShow: function(popup){$(popup).css('zIndex', 250);t.timeDropdown && t.timeDropdown.close();t.numberDropdown && t.numberDropdown.close();},onSelectDay: function(date, week){date = formatDate(date);if(date !== t.calendar.value){t.loadInfo(date);}t.calendar.value = date;}});t.calendar.toInput(bookDateList[0].sDate, b{%*i*%}ookDateList[0].dDate.getDay());t.calendar.value = formatDate(bookDateList[0].sDate);});}},setDropdown: function(bookTimeList, personArray){var t = this;if(!t.timeDropdown){ A.use('dropdown21', function(){ t.timeDropdown = A.ui.dropdown21(bookTimeList, {number: 6,appendTo: t.$timeDropdownContainer.get(0),onopen: function(){t.calendar && t.calendar.hide();}});t.numberDropdown = A.ui.dropdown21(personArray, {number: 6,appendTo: t.$numberDropdownContainer.get(0),onopen: function(){t.$numberDropdownC{%*i*%}ontainer.removeClass('opr-map-book-error-' + t.$numberDropdownContainer.attr('data-form-type'));t.calendar && t.calendar.hide();}});});}else{t.timeDropdown.removeAll().add(bookTimeList);t.numberDropdown.removeAll().add(personArray);}},open: function(){var t = this;t.$formBox.show();t.$result.hide();t.$container.removeClass('opr-map-unbooking').addClass('opr-map-booking');if(rbList.length > 0){$.each(rbList, function(i, n){if(t !== n && n.close){n.close(); }});}},close: function(){var t = this;t.{%*i*%}$formBox.hide();t.$result.hide();t.$container.removeClass('opr-map-booking').addClass('opr-map-unbooking');},disableSubmit: function(){var t = this;t.commiting = true;t.$submitBtn.removeClass('c-btn-primary').addClass('c-btn-disable'); },enableSubmit: function(){var t = this;t.commiting = false;t.$submitBtn.removeClass('c-btn-disable').addClass('c-btn-primary');},reset: function(){var t = this;t.timeDropdown.setIndex(0);t.numberDropdown.setIndex(0);t.$customerNameInput.val(placeholderable ? '' :{%*i*%} t.$customerNameInput.attr('data-placeholder'));t.$phoneInput.val(placeholderable ? '' : t.$phoneInput.attr('data-placeholder'));t.$vcodeInput.val(placeholderable ? '' : t.$vcodeInput.attr('data-placeholder'));t.enableSubmit();},success: function(msg){var t = this;msg = $.trim(msg);msg = msg ? msg : '您已预订成功，<br>订单详情请见手机短信。';t.$formBox.hide();t.reset();t.$result.removeClass('opr-map-book-result-fail').addClass('opr-map-book-result-success').show().find('.opr-map-book-result-success-box>span').htm{%*i*%}l(msg);},fail: function(msg){var t = this;msg = $.trim(msg);msg = msg ? msg : '预订失败，<br>系统繁忙，请稍后再试。';t.$formBox.hide();t.$result.removeClass('opr-map-book-result-success').addClass('opr-map-book-result-fail').show().find('.opr-map-book-result-fail-box>span').html(msg);},tip: function(type, $d){var formType = $d.attr('data-form-type');$d.addClass('opr-map-book-error-' + formType).val($d.attr('data-' + type));if(!placeholderable && formType === 'input'){$d.css('color', '#cc0000');}},check : functi{%*i*%}on($d){if( $d.is( '.opr-map-book-error-' + $d.attr('data-form-type') ) ){ return false; }var value = $.trim($d.val()), flag = true, type = $d.attr('data-type'), t = this;var map = {number: {empty: function(){return !t.numberDropdown.getValue();}}, customer: {empty: function(){return !value || value === $d.attr('data-placeholder');},error: function(){var specialPattern = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");return /^\d+$/.test(value) || specialPattern.test(v{%*i*%}alue);} },phone: {empty: function(){return !value || value === $d.attr('data-placeholder');},error: function(){return !/^(1(([35][0-9])|(47)|(45)|[8]\d{1}))\d{8}$/.test(value);} },vcode: {empty: function(){return !value || value === $d.attr('data-placeholder');}}};if(type in map){for(var o in map[type]){if(map[type].hasOwnProperty(o)){var flag = !map[type][o]();if(flag){continue;}else{t.tip(o, $d);return flag;}}}}return true;}};function formatDate(_template, _date){var template = _template, date{%*i*%} = _date;if(arguments.length === 1){template = '#{y}-#{m}-#{d}';date = arguments[0];}var y, m, d, match;if($.type(date) === 'date'){y = date.getFullYear();m = date.getMonth() + 1;d = date.getDate();}else{date = String(date);match = date.match(/(\d{4})\-(\d{1,2})-(\d{1,2})/) || date.match(/(\d{4})(\d{2})(\d{2})/);y = match[1];m = match[2];d = match[3];}m = m*1 < 10 ? '0' + m*1 : m;d = d*1 < 10 ? '0' + d*1 : d;return $.format(template, { y: y, m: m, d: d });}function bindPlaceholder(input){var pla{%*i*%}ceholder = input.getAttribute('data-placeholder');var errorTip = input.getAttribute('data-error');var emptyTip = input.getAttribute('data-empty');if(placeholder){var $input = $(input);input.value = placeholder;input.style.color = "#666";$input.on('focus', function(){if(input.value == placeholder || input.value == errorTip || input.value == emptyTip){input.value = ''; input.style.color = "#000";} }); $input.on('blur', function(){if($.trim(input.value) == ''){input.value = placeholder;input.style.{%*i*%}color = "#666";} }); } } _this.find('.opr-map-book-container').each(function(i, n){if(i <= 1){var $container = $(n);rbList.push( new RB({container: $container}) );}});_this.dispose = function(){ajaxFinished = true;$.each(rbList, function(i, n){if(n){if(n.vcodeTimer){clearInterval(n.vcodeTimer);}if(n.calendar && n.calendar.dispose){n.calendar .dispose();}if(n.timeDropdown && n.timeDropdown.dispose){n.timeDropdown.dispose();}if(n.numberDropdown && n.numberDropdown.dispose){n.numberDropdown.dispose{%*i*%}();}}});}});</script>{%/block%}