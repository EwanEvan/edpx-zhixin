{%extends 'base.tpl'%} {%block name='content'%}<style type="text/css">.op-zx-medhosp-title{margin-bottom:5px}.op-zx-medhosp-filter,.op-zx-medhosp-head,.op-zx-medhosp-body{position:relative;border-left:1px solid #f5f5f5;border-right:1px solid #f5f5f5}.op-zx-medhosp-filter{background:#fdfdfd}.op-zx-medhosp-filter a,.op-zx-medhosp-body a,.op-zx-medhosp-morelink a,.op-zx-medhosp-morelink a em{text-decoration:none}.op-zx-medhosp-filter{overflow:hidden;height:70px;padding:6px 10px 10px 10px;border-top:1px solid #f5f5f5;border-bottom:1px solid #ece{%*i*%}cec}.op-zx-medhosp-filter-cont{margin:0 40px 0 50px}.op-zx-medhosp-filter-legend{position:absolute;top:7px;left:10px;line-height:20px;font-weight:bold}.op-zx-medhosp-filter-short{height:16px}.op-zx-medhosp-filter-more{position:absolute;display:inline-block;right:5px;top:6px;width:45px;height:20px;border:1px solid #fdfdfd;padding-left:5px;line-height:20px;font-size:14px;color:#333;cursor:pointer}.op-zx-medhosp .op-zx-medhosp-filter-more-text{color:#333}.op-zx-medhosp-filter-more-icondown,.op-zx-m{%*i*%}edhosp-filter-more-iconup{position:absolute;top:4px;right:4px;width:10px;height:15px;background:url("http://www.baidu.com/aladdin/img/zhixin/triangle.png") no-repeat}.op-zx-medhosp-filter-more-icondown{background-position:-5px 2px}.op-zx-medhosp-filter-more-iconup{background-position:-19px 1px}.op-zx-medhosp-head li,.op-zx-medhosp-body li{height:30px;line-height:30px;padding:0 10px;border-bottom:1px solid #f5f5f5}.op-zx-medhosp-head{color:#666}.op-zx-medhosp-filter span{color:#d9d9d9}.op-zx-medh{%*i*%}osp-filter .op-zx-medhosp-filter-li{display:inline-block;height:20px;line-height:20px;color:#0000d1;cursor:pointer;font-size:14px;white-space:nowrap;margin:0 0 4px 0;padding:1px 4px}.op-zx-medhosp-filter .op-zx-medhosp-filter-li-select{padding:0 3px;color:white;background:#02a0f4;border:1px solid #008de9;border-radius:2px}.op-zx-medhosp-filter-divide{margin:0 3px}.op-zx-medhosp-s1,.op-zx-medhosp-s2,.op-zx-medhosp-s3,.op-zx-medhosp-s4,.op-zx-medhosp-s5{display:block;float:left;overflow:hidden;tex{%*i*%}t-align:center}.op-zx-medhosp-li .op-zx-medhosp-s1,.op-zx-medhosp-li .op-zx-medhosp-s2,.op-zx-medhosp-li .op-zx-medhosp-s3,.op-zx-medhosp-li .op-zx-medhosp-s4,.op-zx-medhosp-li .op-zx-medhosp-s5{height:30px;line-height:30px}.op-zx-medhosp-s1{width:200px;text-align:left}.op-zx-medhosp-s2{width:125px}.op-zx-medhosp-s3{width:105px}.op-zx-medhosp-s4{width:105px}.op-zx-medhosp-s5{width:45px;margin-left:15px;color:#666}.op-zx-medhosp-li .op-zx-medhosp-s5{margin-left:15px}.op-zx-medhosp-reg{text-decora{%*i*%}tion:none;color:#000;display:inline-block;width:40px;line-height:20px;background:#f9f9f9;border:1px solid #babec2}.op-zx-medhosp-body .op-zx-medhosp-nodata{font-size:14px;color:#666;text-align:center;height:61px}.op-zx-medhosp-nodata span{display:inline-block;margin:15px 0}.op-zx-medhosp-nodata .op-zx-medhosp-nodata-icon{width:15px;height:15px;border:1px solid #87aefb;color:white;line-height:12px;background:#98bafc;margin:20px 8px 20px 0}.op-zx-medhosp-body .op-zx-medhosp-button,.op-zx-medhosp-b{%*i*%}ody .op-zx-medhosp-button:link{border:1px solid #bdc0c3;color:#333;background:#fafafa}.op-zx-medhosp-body .op-zx-medhosp-button:active{border:1px solid #a7aaaf;box-shadow:0 1px #c7c7c7 inset;background:#f0f0f0;background:-moz-linear-gradient(top,#ebebeb,#f5f5f5);background:-webkit-gradient(linear,0 0,0 bottom,from(#ebebeb),to(#f5f5f5))}.op-zx-medhosp-morelink span{font-family:simsun}.op-zx-medhosp-showurl{margin-top:5px}</style><div class="op-zx-medhosp c-clearfix"> <h3 class="op-zx-medhosp-titl{%*i*%}e"><a target="_blank" href="{%$tplData.link%}">{%$tplData.title|limitlen:64|highlight:0%}</a></h3> <div class="op-zx-medhosp-filter op-zx-medhosp-filter-short" data-click="{fm:'beha'}"> <div class="op-zx-medhosp-filter-legend">地 区：</div> <a href="javascript:;" class="op-zx-medhosp-filter-more"><span class="op-zx-medhosp-filter-more-text">更多</span><span class="op-zx-medhosp-filter-more-icon op-zx-medhosp-filter-more-icondown"></span></a> <div class="op-zx-medhosp-filter-cont"> {%*地域扩展，获得ip所在省份，如果获取不到，则为null*%} {%if $extData.queryloc%} {%$loc = $extData.queryloc%} {%else%} {%if $tplData.location%}{%$loc = $tplData.location%}{%else%}{%$loc = $extData.ExtendedLocation%}{%/if%} {%/if%} {%*更多链接，初始化为第一个省份的链接数据*%} {%$defaultloc = $tplData.province[0].name%} {%$morelink = $tplData.province[0].link%} {%*选择的省份名，初始化为第一个省份名*%} {%$selloc = $defaultloc%} {%*循环省份列表，如果后端有地理位置，并且此地理位置有available值时，更改选定的地理位置*%} {%foreach $tplData.province as $item%}{%if !$loc%}{%if $item@index > 0%}<span class="op-zx-medhosp-filter-divide">|</span>{%/if%}<span class="op-zx-medhosp-filter-li OP_LOG_BTN">{%$item.name%}</span>{%else%}{%if $item@index == 0%}<span class="op-zx-medhosp-filter-li OP_LOG_BTN">{%$defaultloc|escape:"html"%}</span><span class="op-zx-medhosp-filter-divide">|</span><span class="op-zx-medhosp-filter-li OP_LOG_BTN">{%$loc|escape:"html"%}</span>{%elseif $item.name == $loc && $item.available%}{%$selloc = $item.name%}{%$morelink = $item.link%}{%elseif $item.name !=$loc%}<span class="op-zx-medhosp-filter-divide">|</span><span class="op-zx-medhosp-filter-li OP_LOG_BTN">{%$item.name%}</span>{%/if%}{%/if%}{%/foreach%} </div> </div> <ul class="op-zx-medhosp-head"> <li><span class="op-zx-medhosp-s1">医院</span><span class="op-zx-medhosp-s2">医院等级</span><span class="op-zx-medhosp-s3">好评大夫</span><span class="op-zx-medhosp-s4">好评率</span><span class="op-zx-medhosp-s5">挂号</span></li> </ul> <ul class="op-zx-medhosp-body"> <div class="op-zx-medhosp-cont"> {%$listnum = 0%} {%foreach $tplData.list as $item%} {%if $item.prov == $selloc%} {%$listnum = $listnum + 1%} <li class="op-zx-medhosp-li"><span class="op-zx-medhosp-s1"><p><a target="_blank" href="{%$item.namelink%}">{%$item.name|limitlen:26%}</a></p>{%if $item.dept && false%}<p>{%$item.dept|limitlen:26%}</p>{%/if%}</span><span class="op-zx-medhosp-s2">{%$item.type%}</span><span class="op-zx-medhosp-s3">{%if $item.doclink && $item.docnum%}<a target="_blank" href="{%$item.doclink%}" class="op-zx-medhosp-doc">{%$item.docnum%}人</a>{%else%}-{%/if%}</span><span class="op-zx-medhosp-s4">{%if $item.rating%}{%$item.rating%}%{%else%}-{%/if%}</span><span class="op-zx-medhosp-s5">{%if $item.reglink%}<a target="_blank" href="{%$item.reglink%}" class="op-zx-medhosp-reg op-zx-medhosp-button">挂号</a>{%else%}-{%/if%}</span></li> {%/if%} {%if $listnum > 2%}{%break%}{%/if%} {%/foreach%} </div> <li class="op-zx-medhosp-nodata" style="{%if $listnum > 0%}display:none;{%/if%}"><span class="op-zx-medhosp-nodata-icon">!</span> <span>筛选无结果，请尝试其他地区</span></li> <li class="op-zx-medhosp-morelink" style="{%if $listnum <3 || $morelink == ''%}display:none;{%/if%}"> <a target="_blank" href="{%$morelink|escape:'html'%}">更多推荐医院<span>&gt;&gt;</span></a> </li> </ul> {%if $tplData.showurl%}<div class="op-zx-medhosp-showurl c-showurl">{%$tplData.showurl|limitlen:40%}</div>{%/if%}</div><script >
    A.setup({
      'query': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}',
        'srcid': '{%$extData.resourceid%}',
        'provs': {%json_encode($tplData.province)%},
        'selloc': '{%$selloc|escape:"javascript"%}'
    });
</script><script>A.init(function(){var _this = this;var T = A.baidu;var query = _this.data.query,srcid = _this.data.srcid,provs = _this.data.provs,selloc = _this.data.selloc;var listdata ={};var provinces = $('.op-zx-medhosp-filter-li'),filter = $('.op-zx-medhosp-filter')[0],filterlegend = $('.op-zx-medhosp-filter-legend')[0],filtermore = $('.op-zx-medhosp-filter-more')[0],filtertext = $('.op-zx-medhosp-filter-more-text')[0],filtericon = $('.op-zx-medhosp-filter-more-icon')[0],cont = $('.op-zx-m{%*i*%}edhosp-cont')[0],nodata = $('.op-zx-medhosp-nodata')[0],morelink = $('.op-zx-medhosp-morelink')[0];var tplstr = '<li class="op-zx-medhosp-li"><span class="op-zx-medhosp-s1"><p><a target="_blank" href="#{1}">#{0}</a></p><p>#{2}</p></span><span class="op-zx-medhosp-s2">#{3}</span><span class="op-zx-medhosp-s3">#{4}</span><span class="op-zx-medhosp-s4">#{5}</span><span class="op-zx-medhosp-s5">#{6}</span></li>';T.each(provinces,function(item,i){if(T.dom.getText(item) == selloc){if (!T.dom.hasClass({%*i*%}item, 'op-zx-medhosp-filter-li-select')) {T.addClass(item, 'op-zx-medhosp-filter-li-select');}}T.on(item,'click',function(e){filterList(item);});});T.on(filtermore,'click',function(e){if(T.dom.hasClass(filter,'op-zx-medhosp-filter-short')){T.dom.removeClass(filter,'op-zx-medhosp-filter-short');filtertext.innerHTML = '收起';T.dom.addClass(filtericon,'op-zx-medhosp-filter-more-iconup');T.dom.removeClass(filtericon,'op-zx-medhosp-filter-more-icondown');}else{T.dom.addClass(filter,'op-zx-medhosp-filte{%*i*%}r-short');filtertext.innerHTML = '更多';T.dom.addClass(filtericon,'op-zx-medhosp-filter-more-icondown');T.dom.removeClass(filtericon,'op-zx-medhosp-filter-more-iconup');}});function filterList(item){T.each(provinces,function(li,i){T.removeClass(li,'op-zx-medhosp-filter-li-select');});T.addClass(item,'op-zx-medhosp-filter-li-select');var text = T.dom.getText(item),link = '';T.each(provs,function(p,l){if(p.name == text){link = p.link;}});if(listdata[text]){renderList(listdata[text],link);}else{getLi{%*i*%}st(text,link);}}function getList(text,link){_this.ajax(query,srcid,{co:'list[prov='+text+']',success:function(data){var list = [];if(data[0] && data[0].list){list = data[0].list;}if(list.length > 0){listdata[text] = list;renderList(listdata[text],link);}else{noList();}},error:function(e){noList();}});}function renderList(list,link){cont.innerHTML = '';T.each(list,function(item,i){if(i>2){return;}var dochtml = '-',ratinghtml = '-',reghtml = '-';item.dept = item.dept || '';if(item.docnum && item.d{%*i*%}oclink){dochtml = '<a target="_blank" href="'+item.doclink+'" class="op-zx-medhosp-doc">'+item.docnum+'人</a>' ;}if(item.rating){ratinghtml = ''+item.rating+'%' ;}if(item.reglink){reghtml = '<a target="_blank" href="'+item.reglink+'" class="op-zx-medhosp-reg op-zx-medhosp-button">挂号</a>' ;}T.insertHTML(cont,'beforeEnd',T.format(tplstr,[item.name,item.namelink,item.dept,item.type,dochtml,ratinghtml,reghtml]));});T.show(cont);T.hide(nodata);if(list.length >= 3 && link){T.setAttr(T.dom.children(more{%*i*%}link)[0],'href',link);T.show(morelink);}else{T.hide(morelink);}}function noList(){cont.innerHTML = '';T.hide(cont);T.hide(morelink);T.show(nodata);}});</script>{%/block%}