{%extends 'c_base.tpl'%} {%block name='data_modifier'%} {%if !$tplData.link%} {%$extData.feData.hasShowURLGap=true%} {%/if%}{%/block%}{%block name='title'%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='table'%}{%fe_fn_c_css css='btn'%}.op_gifts_main{position:relative}.op_gifts_table{padding-right:9px;overflow:hidden}.op_gifts_contentmore{height:175px;border:1px solid #f8f8f8;border-right:0;border-top:0}.op_gifts_lastCol{width:20%}.op_gifts_table .c-icon-gift{*vertical-align:baseline}.op_gifts_gmain{position:absolute}.op_gifts_gmain .c-border{width:240px;padding-top:5px;padding-bottom:5px}.op_gifts_gmain dl{display:none;position:relative;background-color:#fff;font-size:.93em;line-height:1.67}.op_gifts_gmain dd{color:#666;margi{%*i*%}n-left:0}.op_gifts_gmain dt,.op_gifts_current{font-weight:bold}.op_gifts_gmain .op_gifts_dl_block{display:block;margin-top:0;margin-bottom:0}.op_gifts_arr{position:absolute;left:50%;top:0}.op_gifts_arr .c-icon{display:block;position:relative;left:-50%;top:-10px}.op_gifts_more{text-align:right}.op_gifts_current{text-decoration:none;cursor:default}</style>{%fe_fn_c_title_prefix%}<strong>{%$tplData.title%}</strong>{%$now = date('Y-m-d')%}{%$longtime = date('Y-m-d', strtotime("2024-01-01"))%}{%$startDate = date('Y-m-d', strtotime($tplData.gMsg[0].start))%}{%$endDate = date('Y-m-d', strtotime($tplData.gMsg[0].end))%}{%*出提示信息*%}{%if $tplData.gMsg%} {%if $now >= $startDate && $now <= $endDate%} {%$status="领取中"%} {%/if%} {%if $now < $startDate%} {%$status="未开启"%} {%/if%} {%if $now > $endDate%} {%$status="已过期"%} {%/if%} <span class="c-text c-text-mult c-gap-left-small {%if $status=='领取中'%}c-text-public{%/if%}{%if $status=='未开启'%}c-text-warning{%/if%}{%if $status=='已过期'%}c-text-danger{%/if%}">{%$status|escape:'html'%}</span>{%/if%}{%fe_fn_c_title_suffix%}{%if $status=='已过期'%}<span class="c-gap-bottom-small">提醒：该礼包已于{%date('Y年m月d日',strtotime($tplData.gMsg[0].end))%}过期，请谨慎甄别领取信息</span>{%*当礼包状态未过期时，才显示下面的列表信息*%}{%else%} {%if $status=='未开启'%}<span class="c-gap-bottom-small">提醒：将于{%if $startDate > $longtime%}近期{%else%}{%date('Y年m月d日',strtotime($tplData.gMsg[0].start))%}{%/if%}开启使用，请提前预定</span> {%elseif $status=='领取中'%} <span class="c-gap-bottom-small">提醒：请于{%date('Y年m月d日',strtotime($tplData.gMsg[0].start))%}-{%date('Y年m月d日',strtotime($tplData.gMsg[0].end))%}使用该礼包</span> {%/if%}{%if $tplData.card%}<table class="c-table op_gifts_feaktable"> <tr class="op_gifts_feakhead"> <th style="width:60%;">{%$tplData.cardTh[0].title%}</th> <th style="width:20%;">{%$tplData.cardTh[0].cardSource%}</th> <th>{%$tplData.cardTh[0].cardNumber%}</th> </tr></table> <div class="op_gifts_main"> <div class="op_gifts_table {%if $tplData.card|count > 5%} op_gifts_contentmore{%/if%}"></div> <div class="op_gifts_gmain"></div></div><script >
  A.setup({
      'op_gifts_query':'{%preg_replace('/^'|cat:$extData.resourceid|cat:'_/','',$extData.fetchkey)|escape:'html'%}',
      'op_gifts_resourceid':'{%$extData.resourceid|escape:'html'%}',
      'gifts':{%json_encode($tplData.gifts)%},
      'card':{%json_encode($tplData.card)%},
      'cardTh':{%json_encode($tplData.cardTh)%}
  });
</script><script data-merge>A.setup(function() {var _this = this,vscrollx,$w = _this.find('.op_gifts_main').eq(0),$d = _this.find('.op_gifts_table').eq(0),$m = _this.find('.op_gifts_gmain').eq(0),op_gifts_query = _this.data.op_gifts_query,op_gifts_resourceid = _this.data.op_gifts_resourceid,index = 0, iNow = 0, iNowPre = 0, gif = false;function fnSuccess(data) {if (!data)return;var cards = data.card;var th = data.cardTh[0];var gifts = data.gifts;var newGifts={};if (gifts) {gif = true;$(gifts).ea{%*i*%}ch(function(i, v) {if(newGifts[v.id]){newGifts[v.id].push(v.title);}else{newGifts[v.id]=[v.title];} });}var tabs = [], html = [], obj = [];tabs.push('<table class="c-table op_gifts_tab">'); $(cards).each(function(i, o) {var giftHtml='';if (newGifts[o.id]) {html.push(['<dl class="c-border">','<dt>'+o.giftsTitle+'</dt>',str_select.arr(newGifts[o.id], 'dd'),str_select.str(o.moreTxt, '<dd class="op_gifts_more"><a href="'+o.moreLink+'" target="_blank">'+o.moreTxt+'</a></dd>'),'<div class="op_gifts_ar{%*i*%}r"><i class="c-icon c-icon-triangle-up-empty"></i></div>','</dl>'].join(''));giftHtml='<span class="c-icon c-icon-gift c-gap-icon-left-small"></span>';}var td_1_inner = ['<a href="'+o.titleLink+'" target="_blank">'+o.title+'</a>', giftHtml].join('');var td_1 = '<td style="width:61%;">' + td_1_inner + '</td>';var td_2_inner = o.cardSource;var td_2 = '<td style="width:19%;">' + td_2_inner + '</td>';var td_3_inner = str_select.str(o.cardNumberLink, '<a href="'+o.cardNumberLink+'" target="_blank" cl{%*i*%}ass="c-btn c-btn-mini">'+((new Date(o.start) <= new Date())?'领号':'预定')+'</a>');var td_3 = '<td class="op_gifts_lastCol OP_LOG_BTN">' + td_3_inner + '</td>';obj.push('<tr class="op_gifts_tr">' + td_1 + td_2 + td_3 + '</tr>');});tabs.push(obj.join(''));tabs.push('</table>');$d.html(tabs.join(''));if(html.length){$m.html(html.join(''));}A.use('scrollbarv', function(){vscrollx = A.ui.scrollbarv({content:$d.get(0)});});showContent();}var str_select = {str: function(o,str) {return o.length > 0 ? str :{%*i*%} '&nbsp';},arr: function(o,attr) {var c = '';$(o).each(function(i,item) {if(i<8){c += '<' + attr + '>' + item + '</' + attr + '>'; }});return c;}};function isMouseLeaveOrEnter(e, handler) {if (e.type != 'mouseout' && e.type != 'mouseover') return false;var reltg = e.relatedTarget ? e.relatedTarget : e.type == 'mouseout' ? e.toElement : e.fromElement;while (reltg && reltg != handler)reltg = reltg.parentNode;return (reltg != handler);}function showContent() {var $oTab = _this.find('.op_gifts_tab'){%*i*%}.eq(0),$feakheads = _this.find('.op_gifts_feakhead td'),$tds = _this.find('.op_gifts_tr:first td');$feakheads.each(function(i, v) {$(v).width($tds[i].offsetWidth);});_this.find('.op_gifts_feaktable').show();var $aSpan = $oTab.find('span'),l = $aSpan.length, tStart = 0, tEnd = 0;if (gif) {var $aDl = $m.find('dl');$aSpan.each(function(i, o) {$aSpan[i].index = i;$(o).mouseover(function(){index = this.index;var arrow = $aDl.eq(index).find("div").eq(0);var iconL = $aSpan[index].offsetLeft - 120;if (i{%*i*%}conL < 0) {iconL = 0;arrow.css('left',$aSpan[index].offsetLeft + 8 + 'px');}else if (iconL > 380) {iconL = 380;}$aDl.eq(index).addClass('op_gifts_dl_block');$m.css('left',iconL);$m.css('top',$aSpan[index].parentNode.offsetTop + 32 - $d.scrollTop());}).mouseout(function(){$aDl.eq(index).removeClass('op_gifts_dl_block');});});$aDl.each(function(i, o) {$(o).mouseover(function(ev){var oEvent = ev || event;if (isMouseLeaveOrEnter(oEvent, this)) {$(this).addClass('op_gifts_dl_block');tStart = new Date{%*i*%}().getTime();}}).mouseout(function(ev){var oEvent = ev || event;if (isMouseLeaveOrEnter(oEvent, $aDl[index])) {$(this).removeClass('op_gifts_dl_block');tEnd = new Date().getTime(); var tSum = ((tEnd - tStart) / 1000).toFixed(2);return c({'fm': 'beha', 'url': 'http://nourl.ubs.baidu.com', 'title': tSum, 'p1': _this.p1, 'p2': 0, 'p3': (i + 1)});}});});}}fnSuccess(_this.data);this.dispose = function(){vscrollx&&vscrollx.dispose&&vscrollx.dispose();};});</script>{%/if%}{%/if%}{%$loop_maxcount=count($tplData.link)%}{%if $loop_maxcount>0%} <div class="c-gap-top"> {%if $tplData.moreLink%} <a class="c-gap-right" href="{%$tplData.moreLink[0]['url']|escape:'html'%}" target="_blank">{%$tplData.moreLink[0]['txt']|escape:'html'%}</a> {%/if%} {%foreach $tplData.link as $link%}<a class="c-gap-right" href="{%$link.url|escape:'html'%}" target="_blank">{%$link.txt|escape:'html'%}</a>{%/foreach%} </div>{%/if%}{%/block%}