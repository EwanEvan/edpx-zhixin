{%extends 'c_right_base.tpl'%} {%block name='data_modifier'%} {%if !$tplData.dataapi%} {%$tplData.dataapi='http://opendata.baidu.com/nba.php?type=3&flag=2&ie=utf-8&oe=utf-8'%} {%/if%} {%if !$tplData.voteapi%} {%$tplData.voteapi='http://opendata.baidu.com/nba.php?type=3&flag=1&ie=utf-8&oe=utf-8'%} {%/if%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='table'%}.opr-right-musicvote-content i{width:14px;height:14px;line-height:14px;display:inline-block;background-color:#8eb9f5;color:#fff;text-align:center;font-style:normal}.opr-right-musicvote-content i.opr-right-musicvote-first{background-color:#f54545}.opr-right-musicvote-content i.opr-right-musicvote-second{background-color:#ff8547}.opr-right-musicvote-content i.opr-right-musicvote-third{background-color:#ffac38}.opr-right-musicvote-content .c-table th{color:#333;font-weight:bold;font-size:15px;backg{%*i*%}round-color:#fff;border:0}.opr-right-musicvote-content td{border-bottom:1px solid #f3f3f3}.opr-right-musicvote-content td.opr-right-musicvote-col-index{width:14px;padding-left:0;font-size:12px}.opr-right-musicvote-content td.opr-right-musicvote-col-num{color:#888}.opr-right-musicvote-content td.opr-right-musicvote-col-btn{width:57px;text-align:right}.opr-right_musicvote-banner{margin-bottom:16px}.opr-right-musicvote-box{margin-top:16px}.opr-right-musicvote-banner-l,.opr-right-musicvote-banner-s,{%*i*%}.opr-right-musicvote-btn,.opr-right-musicvote-btn-hover,.opr-right-musicvote-btn-voted,.opr-right-musicvote-btn span{background:url(http://www.baidu.com/aladdin/img/right_musicvote/right_musicvote_1.png) no-repeat;cursor:pointer;-moz-user-select:none;-webkit-user-select:none;user-select:none}.opr-right-musicvote-btn{position:relative;height:22px;line-height:22px;overflow:hidden;width:32px;padding-left:25px;text-align:left}.opr-right-musicvote-btn span{position:absolute;top:0;left:0;display:inlin{%*i*%}e-block;*zoom:1;width:25px;height:22px}.opr-right-musicvote-default .opr-right-musicvote-btn{background-position:-258px 0}.opr-right-musicvote-default .opr-right-musicvote-btn span{background-position:-325px 0}.opr-right-musicvote-default .opr-right-musicvote-btn-hover{background-position:-258px -32px}.opr-right-musicvote-default .opr-right-musicvote-btn-hover span{background-position:-325px -32px}.opr-right-musicvote-disabled .opr-right-musicvote-btn{background-position:-258px -96px;cursor:defa{%*i*%}ult}.opr-right-musicvote-disabled .opr-right-musicvote-btn span{background-position:-325px -96px;cursor:default}.opr-right-musicvote-disabled .opr-right-musicvote-btn-voted{background-position:-258px -64px;color:#fff;cursor:default}.opr-right-musicvote-disabled .opr-right-musicvote-btn-voted span{background-position:-325px -64px;color:#fff;cursor:default}.opr-right-musicvote-bottom-total{font-weight:bold;margin-top:16px}.opr-right-musicvote-bottom-total span{color:#ff8a00;font-weight:bold;margin{%*i*%}:16px 4px 0}.opr-right-musicvote-rule{color:#aaa}.opr-right-musicvote-content td.opr-right-musicvote-col-name{width:70px}.opr-right-musicvote-banner-s{background-position:0 -217px}.opr-right-musicvote-banner-l{display:none}.opr-right-musicvote-banner-s{display:block}.opr-right-musicvote-content{width:100%}.opr-right-musicvote-content td.opr-right-musicvote-col-name{width:110px}.opr-right-musicvote-content td{padding-left:4px!important}.opr-right-musicvote-share-title{color:#333}.opr-right-musicv{%*i*%}ote-share-container .bdsharebuttonbox a{margin:4px 6px 0 0}</style><style>{%if $tplData.rule%}.opr-right-musicvote-content{border-bottom:1px solid #e1e1e1;padding-bottom:18px}{%/if%}</style><div class="c-abstract opr-right-musicvote-content"> {%*临时trick处理，只有音乐风云榜投票出顶部banner,其他资源不出顶部的banner*%} {%if $extData.resourceid==12031%} <div class="opr-right_musicvote-banner"> <div class="opr-right-musicvote-banner-l"></div> <div class="opr-right-musicvote-banner-s"></div> </div> {%/if%} {%if $tplData.maletitle%} <div class="opr-right-musicvote-box opr-right-musicvote-default" style="margin-top:0px;"></div> {%/if%} {%if $tplData.femaletitle%} <div class="opr-right-musicvote-box opr-right-musicvote-default"></div> {%/if%} {%if $tplData.grouptitle%} <div class="opr-right-musicvote-box opr-right-musicvote-default"></div> {%/if%} <div class="opr-right-musicvote-bottom-total"></div> {%if $tplData.rule%}<div class="opr-right-musicvote-rule">{%$tplData.rule|escape%}</div>{%/if%} {%if $tplData.sharetitle%} <p class="opr-right-musicvote-share-title c-gap-top-small">分享：</p> <div class="opr-right-musicvote-share-container" data-click="{fm:'beha'}"></div> {%/if%}</div><script >
    A.setup({
        order: '{%$tplData.order|escape|escape:'javascript'%}',
        titles: {'male':'{%$tplData.maletitle|escape|escape:'javascript'%}', 'female':'{%$tplData.femaletitle|escape|escape:'javascript'%}', 'group':'{%$tplData.grouptitle|escape|escape:'javascript'%}'},
        {%if $tplData.malelist%}
        malelist:[{%foreach $tplData.malelist as $item%}{name:'{%$item.name%}',link:'{%$item.link%}'}{%if !$item@last%},{%/if%}{%/foreach%}],
        {%/if%}
        {%if $tplData.femalelist%}
        femalelist:[{%foreach $tplData.femalelist as $item%}{name:'{%$item.name%}',link:'{%$item.link%}'}{%if !$item@last%},{%/if%}{%/foreach%}],
        {%/if%}
        {%if $tplData.grouplist%}
        grouplist:[{%foreach $tplData.grouplist as $item%}{name:'{%$item.name%}',link:'{%$item.link%}'}{%if !$item@last%},{%/if%}{%/foreach%}],
        {%/if%}
        dataapi: '{%$tplData.dataapi%}',
        voteapi: '{%$tplData.voteapi%}',
        {%if $tplData.endtime%}
        endtime: '{%$tplData.endtime%}',
        {%/if%}
        listtotal: '{%$tplData.listtotal|escape|escape:'javascript'%}',
        bottomtotal: '{%$tplData.bottomtotal|escape|escape:'javascript'%}',
        sharetitle: '{%$tplData.sharetitle|escape|escape:'javascript'%}',
        sharedesc: '{%$tplData.sharedesc|escape|escape:'javascript'%}'
    });
</script><script>A.setup(function(){$ && $.extend($,{_isValidKey : function (key) {return (new RegExp("^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+\x24")).test(key);},setCookie : function (key, value, options) {value = encodeURIComponent(value);if (!$._isValidKey(key)) {return;}options = options || {};var expires = options.expires;if ('number' == typeof options.expires) {expires = new Date();expires.setTime(expires.getTime() + options.expires);}document.cookie =key{%*i*%} + "=" + value+ (options.path ? "; path=" + options.path : "")+ (expires ? "; expires=" + expires.toGMTString() : "")+ (options.domain ? "; domain=" + options.domain : "")+ (options.secure ? "; secure" : ''); },getCookie : function (key) {var value = '';if ($._isValidKey(key)) {var reg = new RegExp("(^| )" + key + "=([^;]*)(;|\x24)"),result = reg.exec(document.cookie);if (result) {value = result[2] || null;if ('string' == typeof value) {value = decodeURIComponent(value);return value;}}}return nu{%*i*%}ll;},removeCookie : function (key, options) {options = options || {};options.expires = new Date(0);$.setCookie(key, '', options);}});var _this = this;var ajaxFinished = false;var boxes = _this.find('.opr-right-musicvote-box');var total = _this.find('.opr-right-musicvote-bottom-total').get(0);var listColors = ['opr-right-musicvote-first', 'opr-right-musicvote-second', 'opr-right-musicvote-third'];var dataapi = /\?/.test(_this.data.dataapi)?_this.data.dataapi:_this.data.dataapi+'?';var voteapi = /\{%*i*%}?/.test(_this.data.voteapi)?_this.data.voteapi:_this.data.voteapi+'?';var voteMale = null, voteFemale = null, voteGroup = null;var votes = _this.data.order.split(',');var isVoteEnd = _this.data.endtime&&((+new Date())>=_this.data.endtime*1000)?true:false;var $shareContainer = _this.find('.opr-right-musicvote-share-container');var share = null;loadData();function Vote(ops){this.box = $(ops.box);this.data = ops.data;isVoteEnd&&this.data&&(this.data.voted=isVoteEnd);this.name = this.data.name;this.{%*i*%}title = this.data.title;this.state = 'default';this.init();return this;}Vote.prototype = {init: function(){this.initDoms();this.bindEvents();},initDoms: function(){var t = this;var html = ''+'<table class="c-table">'+'<thead><th style="padding-left:0;" colspan="4">'+this.title+'</th></thead>'+'<tbody>';for(var i = 0, o; o = this.data.list[i]; i++){var subBytedStr = subByte(o.name, 14);var tempList = _this.data[t.name+'list'];var link = null;if(tempList && tempList.length > 0){for(var j = 0; j < {%*i*%}tempList.length; j++){if(this.data.list[i]['name'] == tempList[j]['name']){link = tempList[j]['link'];break;}}}html+='<tr>'+'<td class="opr-right-musicvote-col-index"><i'+(i<3?(' class="'+listColors[i]+'"'):'')+'>'+(i+1)+'</i></td>'+ '<td class="opr-right-musicvote-col-name">'+(link ? ('<a href="'+ link +'" target="_blank">') : '')+rmencodeHTML(subBytedStr)+(link ? ('</a>') : '')+'</td>'+'<td class="opr-right-musicvote-col-num"><span>'+getFormatNum(o.num, _this.data.listtotal)+'</span></td>'+'<t{%*i*%}d class="opr-right-musicvote-col-btn"><div class="opr-right-musicvote-btn'+((o.voted||isVoteEnd)?' opr-right-musicvote-btn-voted':( (t.data&&o.name==t.data.votedName) ? ' opr-right-musicvote-btn-voted' : '' ))+' OP_LOG_BTN"'+(this.data.voted?' data-nolog="1"':'')+' data-click="{fm:&apos;beha&apos;}" data-name="'+$.trim(o.name)+'"><span'+(this.data.voted?' data-nolog="1"':'')+'>&nbsp;</span>支持</div></td>'+'</tr>';}html+='</tbody>'+'</table>';this.box.html(html);if(this.data.voted){t.box.removeCla{%*i*%}ss('opr-right-musicvote-default');t.box.addClass('opr-right-musicvote-disabled');}this.btns = this.box.find('.opr-right-musicvote-btn'); },bindEvents: function(){var t = this, $temp;if(!t.data.voted){this.btns.click(function(){if(t.data.voted){return;}$temp = $(this);$temp.addClass('opr-right-musicvote-btn-voted');t.box.removeClass('opr-right-musicvote-default');t.box.addClass('opr-right-musicvote-disabled');var offset = $temp.offset();var $div = $('<div style="position:absolute;left:'+(offset.l{%*i*%}eft-20)+'px;top:'+(offset.top+5)+'px;color:#ed4040;">+1</div>');$div.appendTo(document.body).animate({top: (offset.top-12),opacity: 0}, function(){$div.remove();});t.voted = true;t.votedName = $temp.attr('data-name');if(t.data){t.data.voted = true;t.data.votedName = t.votedName;}$.ajax({url:voteapi+'&name='+encodeURIComponent($temp.attr('data-name'))+'&vid='+encodeURIComponent($.getCookie('BAIDUID'))+'&t='+ new Date().getTime()+'&cb=?',dataType:'jsonp', jsonp:'cb',success:function(data){ if(ajax{%*i*%}Finished) return;if(data && data.status == '0'){if(data.data){data = data.data; if(data && data[t.name] && data[t.name]['list'] && data[t.name]['list'].length){t.refresh(data);var allnum = data.allnum;if(allnum){$(total).html(getFormatNum(allnum, _this.data.bottomtotal).replace(/(\d+)/, '<span>\x241</span>'));}}else{ var $num = $temp.parent().prev().find('span'); var curNum = $num.html();if(!/[\u4e07\u4ebf]/.test(curNum)){$num.html(curNum.replace(/(\d+)/,function(originStr, num){if(num){num = pa{%*i*%}rseInt(num, 10);if(num){return ++num;}}}));} } }}else{ var $num = $temp.parent().prev().find('span'); var curNum = $num.html();if(!/[\u4e07\u4ebf]/.test(curNum)){$num.html(curNum.replace(/(\d+)/,function(originStr, num){if(num){num = parseInt(num, 10);if(num){return ++num;}}}));}} },timeout: 5000,jsonp:'cb'});});}},refresh: function(data){var t = this;this.data = {name: this.name,title: this.title, voted: data[this.name]['voted'] || t.voted || isVoteEnd,list: data[this.name]['list'],votedName: t{%*i*%}.votedName};this.initDoms();this.bindEvents();}};function loadData(){$.ajax({url:dataapi+'&vid='+encodeURIComponent($.getCookie('BAIDUID'))+'&t='+ new Date().getTime()+'&cb=?',dataType:'jsonp',jsonp:'cb',success:function(data){ if(ajaxFinished) return;if(data && data.status == '0'){data = data.data;if(data){for(var i = 0; i < votes.length; i++){data[votes[i]]['name'] = votes[i];data[votes[i]]['title'] = _this.data.titles[votes[i]];}render(data);}}},timeout:5000,jsonp:'cb'});}function rmencodeHTM{%*i*%}L(source) {return String(source).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g, "&quot;").replace(/'/g, "&#39;");};function render(data){for(var i = 0; i < votes.length; i++){new Vote({box: boxes[i], data: data[votes[i]]});}var allnum = data.allnum;if(allnum){$(total).html(getFormatNum(allnum, _this.data.bottomtotal).replace(/(\d+)/, '<span>\x241</span>'));}}function subByte(str, len, tail){var a = [], s = str.split('');tail = tail || '…';for(var i = 0, l = s.lengt{%*i*%}h; i < l; i++){if(s[i].charCodeAt(0) > 255){a.push("*");}a.push(s[i]);}if(len && len > 0 && a.length > len){s = a.join("").substring(0, len - 1).replace(/\*/g,'') + tail;}else{return str;}return s;};function getFormatNum(num, formatStr){var reg = /(\{)(\d*)(.*?)(\})/;var str = formatStr.replace(reg, function(originStr, leftDelimiter, number, unit, rightDelimiter){var rs = num;num = parseInt(num, 10);if(num && number){number = parseInt(number, 10);if(number){if(num < number){rs = num;}else{rs = M{%*i*%}ath.floor(num/number);if(unit){rs += unit;}}}}return rs;});return str;}if(_this.data.sharetitle){bds.ready(function(){A.use('share', function(){share = A.ui.share($shareContainer.get(0),{text:_this.data.sharetitle,desc:_this.data.sharedesc,iconSize:32,hideMore:true});}); });}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}if(share && share.dispose){share.dispose();}};});</script>{%/block%}