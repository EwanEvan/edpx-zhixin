{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='foot'%}{%/block%}{%block name='data_modifier'%} {%$tplData.title = $tplData.title|cat:'_'|cat:$tplData.source[0].sourcetitle%} {%*判断实体展现*%} {%$ViewType = 'P'%} {%*P-图片; T-文本*%} {%foreach array_slice($tplData.entity, 0, 6) as $item%} {%if !$item.pic%} {%$ViewType = 'T'%} {%break%} {%/if%} {%/foreach%}{%/block%}{%block name='content'%}<style>{%fe_fn_c_css css='img'%}.op_entity_clusters_summary a,.op_entity_clusters_entitys a,.op_entity_clusters_tools a{text-decoration:none}.op_entity_clusters_summary a:hover,.op_entity_clusters_entitys a:hover,.op_entity_clusters_tools a:hover{text-decoration:underline}.op_entity_clusters_tools{color:#999;font-size:.92em;text-align:right}.op_entity_clusters_tools a{color:#999}.op_entity_clusters_tools_sep{color:#ccc;margin:0 8px}.op_entity_clusters_summary{font-size:1.07em;line-height:1.9em}.op_entity_clusters_subtitle{colo{%*i*%}r:#666;font-size:1.07em;font-weight:bold}.op_entity_clusters_subtitle_right{text-align:right}{%if $ViewType == 'P'%}.op_entity_clusters_entity{text-align:center}.op_entity_clusters_entity img{height:{%fe_fn_c_get_img_height col=4 rate=1 border=1%}px}.op_entity_clusters_entity_noimg{background:#dee0e3 url(http://www.baidu.com/aladdin/img/exactqa/exactqa_nopic.png) center center no-repeat;height:{%fe_fn_c_get_img_height col=4 rate=1 border=1%}px}.op_entity_clusters_entitys .op_entity_clusters_nonelink{color:#333}{%elseif $ViewType == 'T'%}{%fe_fn_c_css css='table'%}.op_entity_clusters_entitys table{color:#333;border-top:1px solid #f3f3f3}.op_entity_clusters_entitys .op_entity_clusters_nonelink{color:#333}{%if count($tplData.entity)>6%}.op_entity_clusters_entitys table td{width:16%}{%/if%}{%/if%}.op_entity_clusters_entitys_more{margin-bottom:-7px}.op_entity_clusters_entitys_more a,.op_entity_clusters_subtitle_right a{color:#333;text-decoration:none;cursor:pointer}.op_entity_clusters_entitys_more a:hover,.op_entity_clusters_subtitle_right a:hover{text-decoration:underline}</style><div class="c-border"> {%fe_fn_c_title_prefix%}{%fe_fn_c_title%}{%fe_fn_c_title_suffix%} {%if $tplData.summary[0]%} <div class="op_entity_clusters_summary"> {%$tplData.summary[0].content|limitlen:190|escape:'html'%} {%if $tplData.summary[0].moreurl && $tplData.summary[0].content|string_display_len > 190%}<a href="{%$tplData.summary[0].moreurl|escape:'html'%}" target="_blank">详情&gt;&gt;</a>{%/if%} </div> {%/if%} <div class="c-row c-gap-top c-gap-bottom-small"> <div class="op_entity_clusters_subtitle c-span20">{%$tplData.subtitle|limitlen:50|escape:'html'%}</div> <div class="op_entity_clusters_subtitle_right c-span4 c-span-last"></div> </div> <div class="op_entity_clusters_entitys c-row"> {%if $ViewType == 'P'%} {%foreach array_slice($tplData.entity, 0, 6) as $item%} <div class="op_entity_clusters_entity c-gap-bottom c-span4 {%if $item@iteration is div by 6%}c-span-last{%/if%}"> <p class="op_entity_clusters_entity_img"> {%if $item.jumplink%}<a href="{%$item.jumplink%}" title="{%$item.ename|escape:'html'%}" target="_blank">{%elseif $item.nonelink%}<a href="{%$item.nonelink%}" title='"{%$item.ename|escape:'html'%}"词条尚未收录，点击创建' target="_blank">{%/if%}{%if $item.pic%}<img class="c-img c-img4" src="{%$item.pic|escape:'html'%}"/>{%else%}<span class="c-img c-img4 op_entity_clusters_entity_noimg"></span>{%/if%}{%if $item.jumplink || $item.nonelink%}</a>{%/if%} </p> <p class="c-gap-top-small"> {%if $item.jumplink%}<a href="{%$item.jumplink%}" title="{%$item.ename|escape:'html'%}" target="_blank">{%elseif $item.nonelink%}<a href="{%$item.nonelink%}" class="op_entity_clusters_nonelink" title='"{%$item.ename|escape:'html'%}"词条尚未收录，点击创建' target="_blank">{%/if%}{%$item.ename|limitlen:11|escape:'html'%}{%if $item.jumplink || $item.nonelink%}</a>{%/if%} </p> </div> {%/foreach%} {%elseif $ViewType == 'T'%} <table class="c-table c-gap-bottom"> {%foreach array_slice($tplData.entity, 0, 24) as $item%} {%if $item@index % 6 == 0%}<tr>{%/if%} <td>{%if $item.jumplink%}<a href="{%$item.jumplink%}" title="{%$item.ename|escape:'html'%}" target="_blank">{%elseif $item.nonelink%}<a href="{%$item.nonelink%}" class="op_entity_clusters_nonelink" title='"{%$item.ename|escape:'html'%}"词条尚未收录，点击创建' target="_blank">{%/if%}{%$item.ename|limitlen:11|escape:'html'%}{%if $item.jumplink || $item.nonelink%}</a>{%/if%}</td> {%if $item@last && $item@index > 5 && $item@index % 6 != 5%} {%for $foo=1 to 5 - $item@index % 6%}<td></td>{%/for%} {%/if%} {%if $item@index % 6 == 5 || $item@last%}</tr>{%/if%} {%/foreach%} </table> {%/if%} </div> {%if ($ViewType == 'P' && count($tplData.entity) > 6) || ($ViewType == 'T' && count($tplData.entity) > 24)%} <div class="op_entity_clusters_entitys_more" data-click="{fm:'beha'}"> <a class="OP_LOG_BTN"><i class="c-icon c-icon-triangle-down"></i>展开更多</a> </div> {%/if%}  <div class="op_entity_clusters_tools"> {%if $tplData.source[0].sourcetitle && $tplData.source[0].sourceurl%}来自<a href="{%$tplData.source[0].sourceurl|escape:'html'%}" target="_blank">{%$tplData.source[0].sourcetitle|escape:'html'%}</a><span class="op_entity_clusters_tools_sep">|</span>{%/if%}<span class="op_entity_clusters_tools_fb_area"><a class="op_entity_clusters_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:'报错'}">报错</a></span> </div> </div><script type="text/javascript" >
    A.setup({
        OriginQuery: "{%str_replace($extData.resourceid|cat:'_', '', $extData.fetchkey)|escape:'html'|escape:'javascript'%}",
        EntityNum: "{%count($tplData.entity)|escape:'javascript'%}",    //entity总数
        ViewType: "{%$ViewType|escape:'javascript'%}"                   //展现样式
    });
</script><script data-merge>A.setup(function(){var Ala = this,ajaxFinished = false;Ala.find('.op_entity_clusters_tools_fb').on('click', function(){$(this).replaceWith('<span>感谢反馈</span>');});var srcid = Ala.srcid, originQuery = encodeURIComponent(Ala.data.OriginQuery), entityNum = Math.min(Number(Ala.data.EntityNum), 120), viewType = Ala.data.ViewType; var asyncPrm = {apn: (viewType == 'P') ? 6 : 24,arn: (viewType == 'P') ? entityNum : entityNum};var $dom_moreArea = Ala.find('.op_entity_clusters{%*i*%}_entitys_more'),$dom_dataArea = Ala.find('.op_entity_clusters_entitys');initMoreBtnClick();function initMoreBtnClick(){var $dom_moreBtn = $('a', $dom_moreArea);$dom_moreBtn.length && $dom_moreBtn.on('click', function(){asyncGetData(asyncPrm.apn, asyncPrm.arn);});}function asyncGetData(pn,rn){var asyncUrl = 'http://opendata.baidu.com/api.php?resource_id=' + srcid + '&format=json&ie=utf-8&oe=utf-8&query=' + originQuery + '&apn=' + pn + '&arn=' + rn + '&co=entity';$.ajax({dataType : 'jsonp',scriptC{%*i*%}harset : 'utf-8',jsonp : 'cb',timeout : 6000,url : asyncUrl,success : initData});}function initData(data){if (ajaxFinished) return;if (data.status == '0' && data.data[0].entity) { var dispData = data.data[0].entity,dispHtml = [];if (viewType == 'P') {for (var i = 0; i < dispData.length; i++) {dispHtml = dispHtml.concat(['<div class="op_entity_clusters_entity c-gap-bottom c-span4 ', (i % 6 == 5) ? 'c-span-last' : '', '">','<p class="op_entity_clusters_entity_img">',dispData[i].jumplink ? '<a href{%*i*%}="' + dispData[i].jumplink + '" title="' + dispData[i].ename + '" target="_blank">' : (dispData[i].nonelink ? '<a href="' + dispData[i].nonelink + '" title="\"' + dispData[i].ename + '\"词条尚未收录，点击创建" target="_blank">' : ''),(dispData[i].pic) ? '<img class="c-img c-img4" src="' + dispData[i].pic + '"/>' : '<span class="c-img c-img4 op_entity_clusters_entity_noimg"></span>',dispData[i].jumplink || dispData[i].nonelink ? '</a>' : '','</p>','<p class="c-gap-top-small">',dispData[i].jumplink ? '<a hre{%*i*%}f="' + dispData[i].jumplink + '" title="' + dispData[i].ename + '" target="_blank">' : (dispData[i].nonelink ? '<a href="' + dispData[i].nonelink + '" class="op_entity_clusters_nonelink" title="\"' + dispData[i].ename + '\"词条尚未收录，点击创建" target="_blank">' : ''),$.subByte(dispData[i].ename, 10),dispData[i].jumplink || dispData[i].nonelink ? '</a>' : '','</p>','</div>']);};} else if (viewType == 'T') {for (var i = 0; i < dispData.length; i++) {var lastTdHtml = ''; if (i == dispData.length - 1 && i >{%*i*%} 5 && i % 6 != 5) {for (var j = 0; j < 5 - i % 6; j++) {lastTdHtml += '<td></td>';};};dispHtml = dispHtml.concat([(i % 6 == 0) ? '<tr>' : '','<td>',dispData[i].jumplink ? '<a href="' + dispData[i].jumplink + '" title="' + dispData[i].ename + '" target="_blank">' : (dispData[i].nonelink ? '<a href="' + dispData[i].nonelink + '" class="op_entity_clusters_nonelink" title="\"' + dispData[i].ename + '\"词条尚未收录，点击创建" target="_blank">' : ''),$.subByte(dispData[i].ename, 10),dispData[i].jumplink || dispD{%*i*%}ata[i].nonelink ? '</a>' : '','</td>',lastTdHtml ? lastTdHtml : '',(i % 6 == 5 || i == dispData.length - 1) ? '</tr>' : '']);};};showData(dispHtml.join(''));}}function showData(data){ if (viewType == 'P') {$dom_dataArea.append(data);} else if (viewType == 'T') {$('table', $dom_dataArea).append(data);};var $dom_subtitleRight = Ala.find('.op_entity_clusters_subtitle_right'),hideBtnHTML = '<a class="op_entity_clusters_entitys_hide OP_LOG_BTN"><i class="c-icon c-icon-triangle-up"></i>收起</a>';$dom_mo{%*i*%}reArea.html(hideBtnHTML);if ((viewType == 'P' && entityNum > 18) || (viewType == 'T' && entityNum > 48)) {$dom_subtitleRight.html(hideBtnHTML);};Ala.find('.op_entity_clusters_entitys_hide').on('click', function(){if (viewType == 'P') {$('.op_entity_clusters_entity:gt(5)', $dom_dataArea).remove();} else if (viewType == 'T') {$('table tr:gt(3)', $dom_dataArea).remove();};$dom_moreArea.html('<a class="OP_LOG_BTN"><i class="c-icon c-icon-triangle-down"></i>展开更多</a>');$dom_subtitleRight.empty();initM{%*i*%}oreBtnClick();});}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}