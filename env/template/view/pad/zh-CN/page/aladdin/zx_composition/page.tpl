{%extends 'c_base.tpl'%} {%block name="data_modifier"%}{%$noContentWord = '抱歉，没有找到符合条件的结果，您可以更换一个筛选条件。'%}{%/block%}{%block name='content'%}<style data-merge>.op-zx-composition-tabcon{height:1.23;line-height:1.23}.op-zx-composition-tab-title{font-weight:bold}.op-zx-composition-tabcon a{display:inline-block;overflow:hidden;width:3.85em;height:1.23;line-height:1.23;text-align:center;text-decoration:none;color:#00c;white-space:nowrap;vertical-align:text-bottom;_font-family:Simsun}.op-zx-composition-tabcon .op-zx-composition-tab-select{background:#388bff;color:#fff}.op-zx-composition-tab-sp{margin:0 6px;color:#d8d8d8}.op-zx-composition-{%*i*%}content{position:relative;zoom:1}.op-zx-composition-content h4{margin:0;font-size:1em;font-weight:normal}.op-zx-composition-time{position:absolute;top:0;right:0;width:30%;overflow:hidden;font-size:.92em;text-align:right}.op-zx-composition-nocontent{color:#999;padding:10px 0}.op-zx-composition-content h4,.op-zx-composition-abstract{margin-bottom:2px}.op-zx-composition-more-con{margin-bottom:-3px}</style><div class="c-border"> {%* tab 标签 *%} <div class="op-zx-composition-tab"> {%if $tplData.tab.title%} {%$tplData.tab = array( $tplData.tab )%} {%/if%} {%foreach $tplData.tab as $item%} <div class="op-zx-composition-tabcon {%if !$item@last%}c-gap-bottom{%else%}c-gap-bottom-small{%/if%}"> <span class="op-zx-composition-tab-title">{%$item.title|limitlen:12|escape:'html'%}</span> {%* 去掉 inline-block 中间的空格，所以连在一起写..... *%} {%foreach $item.option as $ls%}<a href="javascript:;" data-click="{fm:'beha'}" class="OP_LOG_BTN{%if $ls.default%} op-zx-composition-tab-select{%/if%}">{%$ls.name|escape:'html'%}</a>{%if !$ls@last%}<span class="op-zx-composition-tab-sp">|</span>{%/if%}{%/foreach%} </div> {%/foreach%} </div> {%* 内容 *%} <div class="op-zx-composition-content-con"> {%if $tplData.content%} {%if $tplData.content.title%} {%$tplData.content = array( $tplData.content )%} {%/if%} {%foreach $tplData.content as $item%} <div class="op-zx-composition-content"> <h4><a href="{%$item.url%}" target="_blank">{%$item.title|limitlen:48|highlight:0%}</a></h4> {%if $item.abstract%} <p class="op-zx-composition-abstract">{%$item.abstract|limitlen:120|highlight:0%}</p> {%/if%} {%if $item.time%} <div class="op-zx-composition-time c-gray">{%$item.time%}</div> {%/if%} </div> {%/foreach%} {%else%} <p class="op-zx-composition-nocontent">{%$noContentWord|escape:'html'%}</p> {%/if%} {%* 查看更多 *%} <p class="op-zx-composition-more-con" {%if !$tplData.morelink || ( $tplData.content && $tplData.content|count < 3)%}style="display:none"{%/if%}> {%if $tplData.morelink%} <a href="{%$tplData.morelink[0].url%}" target="_blank">{%$tplData.morelink[0].text|escape:'html'%}</a> {%/if%} </p> </div></div>{%* 其它话题 *%}<p class="op-zx-composition-othertopic c-gap-top-small" {%if !$tplData.othertopic%}style="display:none"{%/if%}>{%if $tplData.othertopic%} {%if !$tplData.othertopic[0]%} {%$tplData.othertopic = array( $tplData.othertopic )%} {%/if%} <span class="op-zx-composition-othertopic-title">{%$tplData.othertopic[0].title|limitlen:20|escape:'html'%}</span>{%foreach $tplData.othertopic[0].link as $item%}<a href="{%$item.url%}" target="_blank">{%$item.text|escape:'html'%}</a>{%if $item.desc%}{%$item.desc|escape:'html'%}{%/if%}　{%/foreach%}{%/if%}</p><script >
  A.setup({
    'srcid': '{%$extData.resourceid%}',
    'noContentWord': '{%$noContentWord|escape:'javascript'%}',
     'type': '{%if $tplData.type%}{%$tplData.type|escape:'javascript'%}{%/if%}'
  });
</script><script data-merge>A.setup(function() {var _this = this,cache = {},srcid = _this.data.srcid,noContentWord = _this.data.noContentWord,type = _this.data.type,selectClass = 'op-zx-composition-tab-select',$contentContainer = _this.find( '.op-zx-composition-content-con' ).eq(0),$tabContainer = _this.find( '.op-zx-composition-tab' ).eq(0),morelink = _this.find( '.op-zx-composition-more-con' ).get(0),$othertopic = _this.find( '.op-zx-composition-othertopic' ).eq(0),contentTpl,getData,buildCont{%*i*%}ent;var ajaxFinished = false;getData = function( query, callback ) {var url = 'http://opendata.baidu.com/api.php?resource_id=#{srcid}&co=#{co}&query=#{query}&ie=utf8&oe=gbk&format=json&hilight=#{hilight}&limit=#{limit}&t=#{t}';if ( cache[ query ] == 'pending' ) {return;}if ( cache[ query ] ) {callback( cache[ query ] );} else {cache[ query ] = 'pending';url = $.format( url, {srcid: srcid,query: encodeURIComponent(query),limit: 'content.*.abstract:120,content.*.title:48,othertopic.title:20,conten{%*i*%}t.abstract:120,content.title:48',hilight: 'content.*.abstract,content.*.title,content.abstract,content.title',t: +new Date()});$.ajax({url:url,dataType:"jsonp",jsonp:"cb",timeout:5000,success: function(data){if(ajaxFinished) return;cache[ query ] = data.data[ 0 ];callback( data.data[0] );}});}};contentTpl = '<div class="op-zx-composition-content">\<h4><a href="#{url}" target="_blank">#{title}</a></h4>\#{abstract1}\#{time}\</div>'; buildContent = function() {var query = type == '' ? [] : [ type ]{%*i*%},anchorText = '<a href="#{url}" target="_blank" #{classname}>#{text}</a>#{desc}　';_this.find(selectClass).each(function(i, v) {if ( v.innerHTML != '全部' ) {query.push( v.innerHTML );}});getData( query.join( ' ' ), function( data ) {var i, l, ret = [], content, morelink;if ( data && (content = data.content) ) {if ( !content.length ) {content = [ content ];}for ( i = 0, l = content.length; i < l; i++ ) {ret.push( $.format( contentTpl, {url: content[i].url,title: content[i].title,abstract1: content[{%*i*%}i]['abstract'] ? ( '<p class="op-zx-composition-abstract">' + content[i]['abstract'] + '</p>' ) : '',time: content[i].time ? ( '<div class="op-zx-composition-time">' + content[i].time + '</div>' ) : '',morelink: morelink || ''}));}if ( data.morelink && content.length >= 3 ) {morelink = [ '<p class="op-zx-composition-more-con" >', $.format( anchorText, {url: data.morelink[0].url,text: data.morelink[0].text,classname: ''}), '</p>'].join('');ret.push( morelink );}} else {ret.push( '<p class="op-zx-{%*i*%}composition-nocontent">' + noContentWord + '</p>' );}$contentContainer.html(ret.join( '' ));if ( data && data.othertopic ) {if ( !data.othertopic.length ) {data.othertopic = [ data.othertopic ];}ret = [];for ( i = 0, l =data.othertopic[0].link.length; i < l; i++ ) {ret.push( $.format( anchorText, {url: data.othertopic[0].link[i].url,text: data.othertopic[0].link[i].text,desc: data.othertopic[0].link[i].desc || '',classname: ""}));}$othertopic.html('<span class="op-zx-composition-othertopic-title{%*i*%}">'+data.othertopic[0].title || ''+'</span>'+ret.join( '' ));$othertopic.css('display','');} else {$othertopic.css('display','none');}});};$tabContainer.on( 'click', function( e ) {var evt = e || window.event,target = e.target || e.srcElement,$target=$(target),$oldSelect;if ( target.tagName.toLowerCase() == 'a' && target.className.indexOf( selectClass ) == -1 ) {evt.returnValue = false;$target.addClass(selectClass).siblings('a').removeClass(selectClass); buildContent( target );}});this.dispose ={%*i*%} function(){if(!ajaxFinished){ajaxFinished = true;}};}); </script>{%/block%}