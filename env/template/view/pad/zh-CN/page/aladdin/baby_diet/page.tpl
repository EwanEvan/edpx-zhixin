{%extends 'c_base.tpl'%} {%block name='content'%}{%* 选中tab index *%}{%$escaped_selectedTid=0%}{%foreach $tplData.tab as $tab%}{%if $tab.text == $tplData.selected[0].tab%}{%$escaped_selectedTid=$tab@index%}{%/if%}{%/foreach%}{%* 选中stab index *%}{%$escaped_selectedStid=0%}{%foreach $tplData.tab[$escaped_selectedTid].stab as $stab%}{%if $stab.text == $tplData.selected[0].stab%}{%$escaped_selectedStid=$stab@index%}{%/if%}{%/foreach%}{%function op_baby_diet_content data=''%} {%if $data.image%}{%* 有图就不显示tip *%} <div class="c-row"> {%foreach $data.image as $image%} <div class="c-span6{%if $image@last%} c-span-last{%/if%}"> <a href="{%$image.url%}" target="_blank"><img class="c-img c-img6" src="{%$image.src|escape:'html'%}" /></a> <div class="op-baby-diet-label c-gap-top"><a href="{%$image.textUrl%}"  target="_blank">{%$image.text|escape:'html'%}</a></div> </div> {%/foreach%} </div> {%else%}{%* 无图就显示tip *%} {%foreach $data.tip as $tip%} <div>{%$tip.text|escape:'html'%}</div> {%/foreach%} {%/if%} {%if $data.morelink || $data.morecat%} <div class="c-row{%if $data.image%} c-gap-top{%else%} c-gap-top-small{%/if%}"> {%if $data.morelink%} <div class="{%if $data.morecat%}c-span6 {%else%}c-span24 c-span-last{%/if%}"> {%foreach $data.morelink as $link%}{%if !$link@first%} - {%/if%}<a href="{%$link.url%}" target="_blank">{%$link.text|escape:'html'%}</a>{%if $data.morecat%}{%break%}{%/if%}{%/foreach%} </div> {%/if%} {%if $data.morecat%} <div class="{%if $data.morelink%}c-span18 {%else%}c-span24 {%/if%}c-span-last"> {%if $data.morecat.text%}<b>{%$data.morecat.text|escape:'html'%}</b>{%/if%} {%foreach $data.morecat.link as $link%}{%if !$link@first%} - {%/if%}<a href="{%$link.url%}" target="_blank">{%$link.text|escape:'html'%}</a>{%/foreach%} </div> {%/if%} </div> {%/if%}{%/function%}<style>{%fe_fn_c_css css='tabs'%}{%fe_fn_c_css css='img'%}.op-baby-diet-label{text-align:center}.op-baby-diet img{min-height:1px}.op-baby-diet-more{white-space:nowrap}.op-baby-diet-loading{background:url(http://www.baidu.com/aladdin/img/videoidea/loading_L.gif) no-repeat 50% 50%;height:100px;overflow:hidden}.op-baby-diet-loading *{visibility:hidden}.op-baby-diet-none{padding-top:20px;text-align:center}</style><div class="c-tabs op-baby-diet-tab"> {%if $tplData.tab.text%} {%$tab=$tplData.tab%} <ul class="c-tabs-nav c-tabs-nav-one"> <li class="c-tabs-nav-li c-tabs-nav-selected OP_LOG_BTN" data-click="{fm:'beha'}">{%$tab.text|escape:'html'%}</li> </ul> <div class="c-tabs-content c-gap-top"> {%op_baby_diet_content data=$tab%} </div> {%else%} <ul class="c-tabs-nav"> {%foreach $tplData.tab as $tab%} {%if !$tab@first%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}">{%$tab.text|escape:'html'%}</li> {%/foreach%} </ul> {%foreach $tplData.tab as $tab%} {%if $tab@index != $escaped_selectedTid%}<div class="c-tabs-content"></div>{%continue%}{%/if%}{%* TAB没被选中的情况 *%} {%if $tab.stab%}{%* 有二级TAB的情况 *%} <div class="c-tabs c-tabs-content op-baby-diet-stab"> <ul class="c-tabs-nav"> {%foreach $tab.stab as $stab%} {%if !$stab@first%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}">{%$stab.text|escape:'html'%}</li> {%/foreach%} </ul> {%foreach $tab.stab as $stab%} {%if $stab@index != $escaped_selectedStid %}<div class="c-tabs-content c-gap-top-small"></div>{%continue%}{%/if%} <div class="c-tabs-content c-gap-top-small"> {%op_baby_diet_content data=$stab%} </div> {%/foreach%} </div> {%else%}{%* 无二级TAB的情况 *%} <div class="c-tabs-content c-gap-top"> {%op_baby_diet_content data=$tab%} </div> {%/if%} {%/foreach%} {%/if%}</div><script >
  A.setup({
    'selectedTid':'{%$escaped_selectedTid%}',
    'selectedStid':'{%$escaped_selectedStid%}',
    'srcid':'{%$extData.resourceid%}',
    'q':'{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:'html'|escape:'javascript'%}'
  });
</script><script>A.setup(function(){var _this = this,loaded=false,built = new Array(10),_e = function(str) {var s = "";if (str.length == 0) return "";s = str.replace(/&/g, "&gt;");s = s.replace(/</g, "&lt;");s = s.replace(/>/g, "&gt;");s = s.replace(/ /g, "&nbsp;");s = s.replace(/\'/g, "&apos");s = s.replace(/\"/g, "&quot;");s = s.replace(/\n/g, "<br>");return s;};A.use('jquery,tabs5', function(){function build_tab(d) {var s = [];if(d.stab) {s.push('<ul class="c-tabs-nav">');$.each(d.stab, funct{%*i*%}ion(v,i){if(i){ s.push('<li class="c-tabs-nav-sep"></li>'); }s.push($.format('<li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:\'beha\'}">#{0}</li>', _e(v.text)));});s.push('</ul>');$.each(d.stab, function(v, i){s.push('<div class="c-tabs-content c-gap-top-small">');s.push(build_content(v));s.push('</div>');});} else {s.push(build_content(d));}return s.join('');}function build_content(d) {var s=[];if(d.image && d.image[0]){s.push(build_img(d));s.push('<div class="c-row c-gap-top">');} else {{%*i*%}s.push(build_txt(d));s.push('<div class="c-row c-gap-top-small">');}if (d.morecat && d.morecat.link) {s.push('<div class="c-span6">');} else {s.push('<div class="c-span24">');}$.each(d.morelink||[], function(v, i) {s.push($.format('#{0}<a href="#{1}" target="_blank">#{2}</a>', i==0?'':' - ', _e(v.url), _e(v.text)));if(d.morecat && d.morecat.link) return false;});s.push('</div>');if(d.morecat && d.morecat.link) {s.push($.format('<div class="c-span18 c-span-last"><b>#{0}</b>',_e(d.morecat.text)));{%*i*%}$.each(d.morecat.link||[], function(v, i) {s.push($.format('#{0}<a href="#{1}" target="_blank">#{2}</a>', i!=0?' - ':'', _e(v.url), _e(v.text)));});s.push('</div>');}s.push('</div>');return s.join('');}function build_txt(d){var s=[];s.push('<div class="c-row">');$.each(d.tip, function(v, i) {s.push($.format('<div>#{0}</div>', _e(v.text)));});s.push('</div>');return s.join('');}function build_img(d){var s=[];s.push('<div class="c-row">');$.each(d.image, function(v, i) {s.push($.format('<div class{%*i*%}="c-span6#{0}">', i==3?' c-span-last':''));s.push($.format('<a href="#{0}" target="_blank"><img class="c-img c-img6" src="#{1}" /></a>', _e(v.url), _e(v.src)));s.push($.format('<div class="op-baby-diet-label c-gap-top"><a href="#{0}" target="_blank">#{1}</a></div></div>', _e(v.textUrl), _e(v.text)));});s.push('</div>');return s.join('');}function load_tab(cn, cc, scn) {if(built[cn]) {return;}var $cc = $(cc),rebuilt=false;if(!loaded) {$cc.addClass('op-baby-diet-loading');_this.ajax(_this.data.q, {%*i*%}_this.data.srcid, {success:function(data){if(!data[0] || !data[0].tab || !data[0].tab[0]) {$cc.html('<p class="op-baby-diet-none">暂无信息</p>');$cc.removeClass('op-baby-diet-loading');return;}loaded = data[0].tab;$cc.html(build_tab(loaded[cn]));if(loaded[cn].stab){$cc.addClass('c-tabs');A.ui.tabs5($cc[0],{toggleSep:false, current:scn});} else {$cc.addClass('c-gap-top');}$cc.removeClass('op-baby-diet-loading');built[cn] = true;},error: function(){$cc.html('<p class="op-baby-diet-none">暂无信息</p>');$cc{%*i*%}.removeClass('op-baby-diet-loading').removeClass('c-tabs');}});return;}$cc.html(build_tab(loaded[cn]));if(loaded[cn].stab){$cc.addClass('c-tabs');var opt = {toggleSep:false};if(!rebuilt && _this.data.selectedTid == cn) {opt.current = _this.data.selectedStid;rebuilt = true;}A.ui.tabs5($cc[0], opt);} else {$cc.addClass('c-gap-top');}built[cn]=true;}A.ui.tabs5(_this.find('.op-baby-diet-tab').get(0), {toggleSep:true, current:_this.data.selectedTid, onChange:function(cn,cc){load_tab(cn, cc, 0);}});A.{%*i*%}ui.tabs5(_this.find('.op-baby-diet-stab').get(0), {toggleSep:false, current:_this.data.selectedStid, onChange:function(scn,scc){var cc = $('.op-baby-diet-tab>.c-tabs-content').eq(_this.data.selectedTid).removeClass('c-tabs');load_tab(_this.data.selectedTid, cc, scn);}});});});</script>{%/block%}