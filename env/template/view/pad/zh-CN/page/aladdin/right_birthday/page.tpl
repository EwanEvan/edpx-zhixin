{%extends 'c_right_base.tpl'%} {%block name='content'%}<style>.opr-birthday{position:relative}.opr-birthday-bg{position:absolute;z-index:-1}.opr-birthday-title{font-family:"微软雅黑" arial;font-size:20px;padding-top:8px;color:{%$tplData.tip[0].fontcolor%}}.opr-birthday-btn{color:{%$tplData.btn[0].fontcolor|escape:'html'%}}.opr-birthday-btn{background:url({%$tplData.btn[0].img%}) no-repeat}.opr-birthday-btn{width:50px;height:21px;line-height:22px;*line-height:23px;padding-left:23px;display:inline-block;cursor:pointer;text-align:center}.opr-birthday-btn2{background-position:-73px 0;cursor:default}.opr-birthday-num{color:{%$tplData.blesscount[0].fontcolor|escape:'html'%}}.opr-birthday-num b{color:{%$tplData.blesscount[0].strongcolor|escape:'html'%}}.opr-birthday-version{font-size:.923em}</style>{%if $tplData.showgray%}<div class="opr-birthday-graystyle"> <style type="text/css">html{filter:grayscale(100%);-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);-webkit-filter:grayscale(1)}</style></div>{%/if%}<div class="opr-birthday"> <img class="opr-birthday-bg" src="{%$tplData.bgurl%}"> <div class="opr-birthday-title c-gap-left">{%$tplData.tip[0].text%}</div> <div class="opr-birthday-prey c-gap-left c-gap-top"> <span class="opr-birthday-btn OP_LOG_BTN" data-click="{fm:'beha'}">{%$tplData.btn[0].text|escape:'html'%}</span><span class="opr-birthday-num c-gap-left">{%str_replace( '[number]', '<b></b>', $tplData.blesscount[0].text )%}</span> </div> <div class="opr-birthday-player"></div></div>{%if $tplData.music && $tplData.music[0].version%}<div class="opr-birthday-version c-gap-top c-gray">{%$tplData.music[0].version|escape:'html'%}</div>{%/if%}<script >
    A.setup({
        upurl: '{%$tplData.upurl%}',
        fetchurl: '{%$tplData.fetchurl%}',
        musicUrl: '{%if $tplData.music%}{%$tplData.music[0].url%}{%/if%}'
    });
</script><script data-merge>A.setup(function(){var _this = this,isMotionPlay = false,isFirstClick = false,btn = _this.find('.opr-birthday-btn').eq(0),gray = _this.find( '.opr-birthday-graystyle' ).get(0),playerBox = _this.find( '.opr-birthday-player' ).get(0),upurl = _this.data.upurl,fetchurl = _this.data.fetchurl,num = 0,ajaxFinished = false,playMusic;btn.on('click', function(){if(isFirstClick)return;btn.addClass('opr-birthday-btn2');var numDom = _this.find('.opr-birthday-num').get(0).getElemen{%*i*%}tsByTagName('b')[0];if (numDom && numDom.innerHTML != '') {num = parseInt(numDom.innerHTML, 10);numDom.innerHTML = num + 1;}up();if ( gray ) {gray.parentNode.removeChild( gray );gray = null;}isFirstClick = true;});function buildurl( url ) {return url + ( url.indexOf( '?' ) > -1 ? "&t=" : "?t=" ) + new Date().getTime();}function up(){$.ajax({url:buildurl( upurl ),dataType:'jsonp'});}$.ajax({url:buildurl( fetchurl ),dataType:'jsonp',success:function(data){if(ajaxFinished) return;num = data.data.su{%*i*%}m || 0;_this.find('.opr-birthday-num').get(0).getElementsByTagName('b')[0].innerHTML = num;},error:function(){ num = -1;},timeout:5000});playMusic = (function() {var support, audio, swf;if ( isFirstClick ) {return;}try{if(document.createElement("audio").play){support = true;playerBox.innerHTML = '<audio class="opr-birthday-music-player"></audio>';audio = _this.find( '.opr-birthday-music-player' ).get(0);}}catch(e){}if ( !support ) {playerBox.innerHTML = '<object id="opr-birthday-music-player" wi{%*i*%}dth="1" height="1" type="application/x-shockwave-flash" data="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="movie" value="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="allowScriptAccess" value="always" /></object>';swf = _this.find( '#opr-birthday-music-player' ).get(0);}return {play: function( src ) {var self = this;try {audio && ( audio.src = src, audio.play() );swf && ( swf.uri(src), swf.playMp3() );} catch( e ) {rmtimer = setTimeout{%*i*%}(function() {self.play( src );}, 13);}},pause: function() {audio ? ( audio.pause() ) : ( swf.stopMp3() );}}}());if ( _this.data.musicUrl ) {playMusic.play( _this.data.musicUrl );}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}