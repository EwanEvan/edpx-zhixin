{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='foot'%}{%/block%}{%block name='data_modifier'%}{%$extData.feData.hasTitleGap=false%}{%$extData.feData.hasShowURLGap=false%}{%/block%}{%block name='content'%}<style data-merge>.op_zx_illness2_main{padding-bottom:2px;border-bottom:1px solid #f5f5f5;overflow:hidden}.op_zx_illness2_condition{width:100%}.op_zx_illness2_condition td{padding:3px 0;font-size:.7em}.op_zx_illness2_condition input{margin:0 3px 0;_margin-top:-3px}.op_zx_illness2_condition input,.op_zx_illness2_condition label{vertical-align:middle}.op_zx_illness2_sex label{margin-right:16px;*margin-right:10px}.op_zx_illness2_age label{margin-right:16px;*margin-right:10px}.op_zx_illness2_sign la{%*i*%}bel{margin-right:16px;*margin-right:10px}.op_zx_illness2_sign span{white-space:nowrap;display:inline-block}.op_zx_illness2_info div{height:20px;line-height:20px}.op_zx_illness2_info a{color:#666;outline:0}.op_zx_illness2_info a.op_zx_illness2_infoB{color:#00c}.op_zx_illness2_info a:hover em{text-decoration:underline}.op_zx_illness2_split{margin:0 3px}.op_zx_illness2_infotitle{width:230px;height:20px;line-height:20px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;display:inline-block;m{%*i*%}argin-right:10px}.op_zx_illness2_infosign{width:225px;height:20px;line-height:20px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;display:inline-block;margin-right:10px}.op_zx_illness2_open{margin-top:2px;clear:left;float:none;display:inline-block}.op_zx_illness2_open span{color:#008000}.op_zx_illness2_infomain_t{padding-top:5px;font-weight:bold}.op_zx_illness2_dis{margin-right:8px;text-decoration:none}.op_zx_illness2_note{padding-top:5px;font-weight:bold}.op_zx_illness2_note_btn,.op_{%*i*%}zx_illness2_note_btn:link{display:inline-block;padding:0 6px;margin-right:8px;height:24px;line-height:24px;font-weight:normal;border:1px solid #bdc0c3;text-decoration:none;background:#fafafa;color:#333}.op_zx_illness2_note_btn:hover{border-color:#279cf1;background:#f5f5f5;background:-moz-linear-gradient(top,#fff,#ececec);background:-webkit-gradient(linear,0 0,0 bottom,from(#fff),to(#ececec))}.op_zx_illness2_item{margin-right:10px}</style><div class="op_zx_illness2_panel">  <div class="op_zx_illn{%*i*%}ess2_top">{%fe_fn_c_title_prefix%}<a target="_blank" href="javascript:;" class="op_zx_illness2_mainlink">{%$extData.OriginQuery|limitlen:36|highlight:0%}_病例问答({%$tplData.dispNum%}条结果)_百度知道</a></h3></div> <div class="op_zx_illness2_main"> <table class="op_zx_illness2_condition" cellpadding="0" cellspacing="0" width="100%" data-click="{'fm':'beha'}"> <tr> <td> <b>性别：</b> <select class="op_zx_illness2_item OP_LOG_BTN op_zx_illness2_sex"> <option name="sex" value="0" data-click="{'title':'不限'}" {%if !isset($tplData.query_sex) || (isset($tplData.query_sex) && $tplData.query_sex==0) %} selected="selected"{%/if%}>不限</option> <option name="sex" value="1" data-click="{'title':'男性'}"{%if isset($tplData.query_sex) && $tplData.query_sex==1%} selected="selected"{%/if%}{%if isset($tplData.query_sex) && $tplData.query_sex==2%} disabled="disabled"{%/if%}>男性</option> <option name="sex" value="2" data-click="{'title':'女性'}"{%if isset($tplData.query_sex) && $tplData.query_sex==2%} selected="selected"{%/if%}{%if isset($tplData.query_sex) && $tplData.query_sex==1%} disabled="disabled"{%/if%}>女性</option> </select> <b style="margin-left:10px;" class="op_zx_illness2_item">所属人群：</b> <select class="op_zx_illness2_item OP_LOG_BTN op_zx_illness2_age"> <option name="age" value="0" data-click="{'title':'不限'}"{%if !isset($tplData.grouptype) || (isset($tplData.grouptype) && $tplData.grouptype==0)%} selected="selected"{%/if%}>不限</option> <option name="age" value="4" data-click="{'title':'婴幼儿'}"{%if isset($tplData.grouptype) && $tplData.grouptype==4%} selected="selected"{%/if%}>婴幼儿</option> <option name="age" value="5" data-click="{'title':'儿童'}"{%if isset($tplData.grouptype) && $tplData.grouptype==5%} selected="selected"{%/if%}>儿童</option> <option name="age" value="1" data-click="{'title':'孕妇'}"{%if isset($tplData.grouptype) && $tplData.grouptype==1%} selected="selected"{%/if%}{%if isset($tplData.query_sex) && $tplData.query_sex==1%} disabled="disabled"{%/if%}>孕妇</option> <option name="age" value="6" data-click="{'title':'产妇'}"{%if isset($tplData.grouptype) && $tplData.grouptype==6%} selected="selected"{%/if%}{%if isset($tplData.query_sex) && $tplData.query_sex==1%} disabled="disabled"{%/if%}>产妇</option> <option class="OP_LOG_BTN" type="radio" name="age" value="2" data-click="{'title':'中老年人'}"{%if isset($tplData.grouptype) && $tplData.grouptype==2%} selected="selected"{%/if%}>中老年人</option> </select> </td> </tr> <tr> <td valign="top"> <b>症状：</b> <span class="op_zx_illness2_sign"> {%$tmpDataSign = []%} {%foreach $tplData.dtag as $item%} {%if !in_array($item, $tmpDataSign)%}{%$tmpDataSign[] = $item%}{%/if%} {%/foreach%} {%$signLen = count($tmpDataSign) - 1%} {%$tmpDataBool = array_fill(0, $signLen + 1, TRUE)%} {%for $i = 0 to $signLen%} {%for $j = 0 to $signLen%} {%if $i == $j%}{%continue%}{%/if%} {%if strstr($tmpDataSign[$j]['sa'], $tmpDataSign[$i]['sa']) != FALSE%}{%$tmpDataBool[$j] = FALSE%}{%/if%} {%/for%} {%/for%} {%$tmpSign = []%} {%$tmpSignCount = 0%} {%for $i =0 to $signLen%} {%if $tmpSignCount > 6%}{%break%}{%/if%} {%if $tmpDataBool[$i]%} {%$tmpSign[] = $tmpDataSign[$i]['sa']%} {%$tmpSignCount = $tmpSignCount + 1%} {%/if%} {%/for%} {%foreach $tplData.query_tag as $item%} {%if !in_array($item, $tmpSign)%} {%foreach $tmpSign as $itemTag%} {%if strstr($item, $itemTag) != FALSE%}{%$tmpSign[$itemTag@index] = NULL%}{%/if%} {%/foreach%} {%$garbage = array_unshift($tmpSign, $item)%} {%/if%} {%/foreach%} {%$tmpSignCount = 0%} {%foreach $tmpSign as $item%} {%if $tmpSignCount >6 %}{%break%}{%/if%} {%if $item == NULL %}{%continue%}{%/if%} {%if in_array($item,$tplData.query_tag)%} <span><input class="OP_LOG_BTN" type="checkbox" data-key="{%$item|escape:'html'%}" data-click="{'title':'{%$item|escape:'html'%}'}" data-flag="1" checked="checked" disabled="disabled" /><label class="OP_LOG_BTN" style="color:gray;">{%$item|escape:'html'%}</label></span> {%else%} <span><input class="OP_LOG_BTN" type="checkbox" data-key="{%$item|escape:'html'%}" data-click="{'title':'{%$item|escape:'html'%}'}" data-flag="0" /><label class="OP_LOG_BTN">{%$item|escape:'html'%}</label></span> {%/if%} {%$tmpSignCount = $tmpSignCount + 1%} {%/foreach%} </span> </td> </tr> </table> <div class="op_zx_illness2_no" style="display:none;"> <table style="height:100%;margin:auto;"><tbody><tr><td><div>没有符合所选条件的病例，请修改条件重新查询！</div></td></tr></tbody></table> </div> <div class="op_zx_illness2_bad" style="display:none;"> <table style="height:100%;margin:auto;"><tbody><tr><td><div>抱歉，网络发生错误，请<a href="#" onclick="return false;" hidefocus="true">点击刷新</a></div></td></tr></tbody></table> </div> </div> <div class="c-gray"> <div class="op_zx_illness2_info"> {%if $tplData.disease%} <div class="op_zx_illness2_infomain_t">需要关注的疾病：</div><div> {%*疾病信息*%} {%foreach $tplData.disease as $dis%} <a target="_blank" class="op_zx_illness2_infoB op_zx_illness2_dis" href="{%if $dis.url%}{%$dis.url%}{%else%}http://www.baidu.com/s?wd={%$dis.name|escape:url%}{%/if%}">{%$dis.name|escape%}</a> {%/foreach%} </div> {%/if%} {%foreach $tplData.result as $item%} {%if $item@index === 0%} <div class="op_zx_illness2_infomain_t">其他患者在问：</div> {%/if%} {%if $item@index > 2%}{%break%}{%/if%} <div> <span class="op_zx_illness2_infotitle"> <a class="op_zx_illness2_infoB" target="_blank" href="{%$item.loc%}" hidefocus="true" title="{%$item.title|escape:'html'%}">{%$item.title|escape:'html'|limitlen:34|highlight:0%}</a> </span> <span class="op_zx_illness2_infosign">症状：{%$item.tag|escape:'html'|limitlen:26|highlight:0%}</span> </div> {%/foreach%} </div> {%if $tplData.tag%}<div class="op_zx_illness2_note">{%foreach $tplData.tag as $tag%}{%if $tag.url%}<a class="op_zx_illness2_note_btn" target="_blank" href="{%$tag.url%}">{%$tag.desc|escape%}</a>{%else%}{%$tag.desc|escape%}{%/if%}{%/foreach%}</div>{%/if%} </div> <span class="op_zx_illness2_open"> <span>zhidao.baidu.com/</span> </span></div><script >
    A.setup({'originQuery': '{%$extData.OriginQuery|escape:'javascript'%}','srcid':'{%$extData.resourceid|escape:'javascript'%}', 'sex': '{%$tplData.sex|escape:'javascript'%}', 'age':'{%$tplData.grouptype|escape:'javascript'%}'});
</script><script data-merge>A.init(function(){var _this = this,$label = _this.find('label'),$sexDom = _this.find('.op_zx_illness2_sex').eq(0),$ageDom = _this.find('.op_zx_illness2_age').eq(0),$signDom = _this.find('.op_zx_illness2_sign').eq(0),$infoDom = _this.find('.op_zx_illness2_info').eq(0),sexOpts = $sexDom.get(0).options,ageOpts = $ageDom.get(0).options,$no = _this.find('.op_zx_illness2_no').eq(0),$bad = _this.find('.op_zx_illness2_bad').eq(0),$mainlink = _this.find('.op_zx_illness2_mainli{%*i*%}nk').eq(0),sex = 0, age = 0, sing = [];var ajaxFinished = false;if (_this.data.sex != '') {sex = _this.data.sex;}if (_this.data.age != '') {age = _this.data.age;}$mainlink.on('click', function(){tomid(this);});$sexDom.on('change', function(){sex = this.value;getData();if(sex == '1'){ageOpts[3] && (ageOpts[3].disabled=true);ageOpts[4] && (ageOpts[4].disabled=true); }else{for(var i=0;i<ageOpts.length;i++){ageOpts[i] && (ageOpts[i].disabled=false);}}});$ageDom.on('change', function(){age = this.val{%*i*%}ue;getData();if( (age == '1' || age == '6') && sexOpts[1]){sexOpts[1].disabled=true; }else{for(var i=0;i<sexOpts.length;i++){ageOpts[i] && (sexOpts[i].disabled=false);}}});$signDom.find('input').click(function(){if($(this).attr('data-flag')==1){$(this).attr('data-flag',0);}else{$(this).attr('data-flag',1)}getData();});function getData(){var url = "http://zhidao.baidu.com/search/api/symptom?query=#{0}&tosymptom=1&ie=utf-8&symptom_query=#{1}&sex=#{2}&grouptype=#{3}&t=#{5}",signStr = getSign().join{%*i*%}('_'),height = getHeight();$.ajax({url:$.format(url,encodeURIComponent(_this.data.originQuery), encodeURIComponent(signStr),encodeURIComponent(sex),encodeURIComponent(age), _this.data.srcid, (new Date().getTime())),dataType:"jsonp",timeout:6000,jsonp:'cb',success:function(data){if(ajaxFinished) return;if (data.data[0] && data.data[0].result) {show($infoDom);$no.css('display','none');$bad.css('display','none');$infoDom.html(buildHTML(data.data[0]));} else {$infoDom.css('display','none');$bad.css({%*i*%}'display','none');show($no, height);}},error: function(){show($bad, height);$infoDom.css('display','none');$no.css('display','none');}}); }function buildHTML(data){var res=data.result,len = res.length,dis=('disease' in data && data.disease instanceof Array)?data.disease:null,html=[];if(dis){html.push('<div class="op_zx_illness2_infomain_t">需要关注的疾病：</div><div>');for(var i=0; i < dis.length; i++){var item=dis[i];html.push('<a target="_blank" class="op_zx_illness2_infoB op_zx_illness2_dis" href="'+{%*i*%}('url' in item ? item.url : ('http://www.baidu.com/s?wd=' + item.name))+'">'+item.name+'</a>');}html.push('</div>');}html.push('<div class="op_zx_illness2_infomain_t">其他患者在问：</div>');for(var i = 0; i < len && i < 3; i++) {html = html.concat(['<div><span class="op_zx_illness2_infotitle"><a class="op_zx_illness2_infoB" hidefocus="true" target="_blank" href="',res[i].loc,'" title="',res[i].title,'">',cutstr(hilight(res[i].title),34),'</a></span><span class="op_zx_illness2_infosign">症状：',cutstr(hili{%*i*%}ght(res[i].tag),26),'</span></div>']);}return html.join('');}$bad.find('a:first').click(getData);function getSign(){sign = [];$signDom.find('input').each(function(i, el) {if (el.getAttribute('data-flag') == 1) {sign.push(el.getAttribute('data-key'));}});return sign;}$label.click(function(){modSelect($(this).get(0));});function modSelect(el){var pre = el.previousSibling;pre.click();}function getHeight(){return Math.max.apply(null,[$infoDom.get(0).offsetHeight, $no.get(0).offsetHeight, $bad.get(0){%*i*%}.offsetHeight]) - 1;};function show($el, height){if (height) {$el.css('height',height);}$el.css('display','');}function hide(el){el.style.display = 'none';}function hilight(str){var len = sign.length;for (var i = 0; i < len; i++) {str = str.replace(sign[i], '<em>' + sign[i] + '</em>')}return str;}function tomid(o){var url = 'http://zhidao.baidu.com/search?rn=10&pn=0&fr=ps&ie=utf-8&tosymptom=1&word=' + encodeURIComponent(_this.data.originQuery) + '&grouptype=' + encodeURIComponent(age) + '&sex=' {%*i*%}+ encodeURIComponent(sex) + '&symptom_query=' + encodeURIComponent(getSign().join('_'));o.href = url;}function cutstr(str,length){if(length<$.getByteLength(str.replace(/(<em>|<\/em>)/g,''))){var highlights=[];str=str.replace(/<em>.*?<\/em>/g,function(matchstr,index){var flag={start: index,end: index+matchstr.length-9};highlights.push(flag);return matchstr.substring(4,matchstr.length-5);});var newstr=$.subByte(str,length-3,'...');for( var i=0; i<highlights.length; i++){if(highlights[i].start>=new{%*i*%}str.length-3){break;}if(highlights[i].end>newstr.length-3){highlights[i].end=newstr.length-3;}newstr=newstr.substring(0,highlights[i].start) + '<em>'+newstr.substring(highlights[i].start,highlights[i].end)+'</em>'+newstr.substring(highlights[i].end);}return newstr;}return str;};this.dispose = function(){ if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}