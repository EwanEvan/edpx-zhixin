{%extends 'c_base.tpl'%} {%block name="foot"%}<div class="c-gap-top-small"><span class="c-showurl">{%$tplData.showurl%}</span> - <a href="{%$tplData.url%}" target="_blank">查看更多</a></div> {%/block%}{%block name='data_modifier'%}{%$extData.feData.hasBorder=true%}{%$extData.feData.hasShowURLGap=false%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='btn'%}.op-joke-titlerow{padding-bottom:10px;position:relative}.op-joke-title{font-size:1.2em;text-align:center;font-weight:bold;color:#333;text-align:center;padding-top:2px}.op-joke-content{padding:9px 0 0;border-top:1px solid #f5f5f5;text-indent:2em;color:#333}.op-joke-contentimg{text-indent:0;text-align:center}.op-joke-aimg{max-height:450px;overflow:hidden}.op-joke-btn{padding-left:30px;background-image:url('http://www.baidu.com/aladdin/img/joke/ico.png');_background-image:url('http://www.baidu.com/a{%*i*%}laddin/img/joke/ico8.png');background-repeat:no-repeat;background-position:10px 5px;position:absolute;right:10px;top:0}.c-btn-primary:hover{background-image:url('http://www.baidu.com/aladdin/img/joke/ico.png');_background-image:url('http://www.baidu.com/aladdin/img/joke/ico8.png');background-repeat:no-repeat;background-position:10px 5px}.op-joke-btnnone{background-color:#f9f9f9;cursor:default;border:1px solid #ccc;color:#ccc!important}.op-joke-btnnone:hover{background-color:#f9f9f9;cursor:defaul{%*i*%}t;border:1px solid #ccc;color:#ccc!important}</style><div class="c-row op-joke-titlerow"><div class="op-joke-title">{%$tplData.data[0].title|limitlen:32|escape%}</div><span class="c-btn c-btn-primary op-joke-btn OP_LOG_BTN" data-click="{fm:'beha'}">换一个</span></div><div class="op-joke-content">{%$tplData.data[0].content|escape%}</div><script >
    A.setup({
        'originQuery': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}',
        'rn':'{%$tplData.rn%}',
        'pnMax':'{%ceil(count($tplData.data)/$tplData.rn)%}'
    });
</script><script data-merge>A.setup(function(){var _this = this,title = _this.find('.op-joke-title')[0],content = _this.find('.op-joke-content')[0],btn = _this.find('.op-joke-btn')[0],originQuery = _this.data.originQuery,srcid = _this.srcid,pnMax = _this.data.pnMax,rn = _this.data.rn;function setString(str,len){if(str.length*2 <= len){return str;}var strlen = 0; var newstr = "";for(var i = 0;i < str.length; i++){if(str.charCodeAt(i) > 128){ strlen = strlen + 2;if(strlen > len){return newstr.subs{%*i*%}tring(0,newstr.length-1) + "...";}}else{strlen = strlen + 1;if(strlen > len){return newstr.substring(0,newstr.length-2) + "...";}}newstr = newstr + str.charAt(i);}return newstr;};var datas=0,pn=0,clicknum= 0;$(btn).on('click',function(){if(pn==pnMax && clicknum>=datas.length) {return false;}if(clicknum>=rn && pn<pnMax || pn==0){if(pn==0){var i=1;clicknum=1;}else{var i=0;clicknum = 0; }pn++;_this.ajax(originQuery, srcid, {co:'data[pn='+pn+']',success:function(data){datas = data[0].data;title.inne{%*i*%}rHTML = setString(datas[i].title,32);if(datas[i].tag==1){$(content).addClass('op-joke-contentimg');content.innerHTML = '<a class="op-joke-aimg" href="'+datas[i].href+'" target="_blank"><img src="'+datas[i].imgsrc+'" /></a>';}else{$(content).removeClass('op-joke-contentimg');content.innerHTML = datas[i].content;}},error: function(){}});}else if(pn){title.innerHTML = setString(datas[clicknum].title,32);if(datas[clicknum].tag==1){$(content).addClass(content,'op-joke-contentimg');content.innerHTML ={%*i*%} '<a class="op-joke-aimg" href="'+datas[clicknum].href+'" target="_blank"><img src="'+datas[clicknum].imgsrc+'" /></a>';}else{$(content).removeClass('op-joke-contentimg');content.innerHTML = datas[clicknum].content;}}clicknum++;if(pn==pnMax && clicknum>=datas.length) {$(btn).addClass('op-joke-btnnone');}});});</script>{%/block%}