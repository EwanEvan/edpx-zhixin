{%extends 'c_base.tpl'%} {%block name='data_modifier'%}{%$extData.feData.hasShowURLGap = true%}{%$escaped_tpl="{%basename($smarty.current_dir)%}"%}{%/block%}{%block name='title'%}<style type="text/css">{%fe_fn_c_css css='input'%}{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='dropdown2'%}{%fe_fn_c_css css='img'%}.op-{%$escaped_tpl%}-label,.op-{%$escaped_tpl%}-dep-container,.op-{%$escaped_tpl%}-query-container,.op-{%$escaped_tpl%}-search-btn{float:left;display:inline}.op-{%$escaped_tpl%}-label{line-height:1.87em;width:55px}.op-{%$escaped_tpl%}-dep-container{width:89px;outline:0}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-dep-container{width:99px}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-query-container .c-input12{width:234px}.op-{%$escaped_tpl%}-title-longdep .op-{%$escaped_tpl%}-query-container .c-input12 input{width:216px}.op-{%$escaped_tpl%}-query-container{position:relative}.op-{%$escaped_tpl%}-query-container-active{z-index:200}.op-{%$escaped_tpl%}-hot-title{font-weight:bold}.op-{%$escaped_tpl%}-hot-links span{color:#00c;display:inline-block;cursor:pointer;text-decoration:none}.op-{%$escaped_tpl%}-hot-links span:hover{color:#f60}.op-{%$escaped_tpl%}-query-container-active .op-{%$escaped_tpl%}-hot-query{display:block}.op-{%$escaped_tpl%}-hot-query{position:absolute;display:none;top:25px;left:0;background-color:#fff;border:1px solid #bbb;padding:5px 4px}.op-{%$escaped_tpl%}-dep-tabs{border-bottom:1px solid #ddd}.op-{%$escaped_tpl%}-dep-tab{position:relative;line-height:1.33em;float:left;border:1px solid #ddd;border-bottom:0;padding:0 8px;cursor:pointer;color:#39f;background-color:#f9f9f9}.op-{%$escaped_tpl%}-dep-tab-active{margin-bottom:-1px;height:21px;background-color:#fff}.op-{%$escaped_tpl%}-dep-panel{display:none;padding:5px 0}.op-{%$escaped_tpl%}-dep-panel-active{display:block}.op-{%$escaped_tpl%}-dep-panel li{float:left;width:70px;text-align:center;line-height:1.87em;height:28px;overflow:hidden}.op-{%$escaped_tpl%}-dep-panel .c-dropdown2-selected{background-color:#fff;color:#f60}.op-{%$escaped_tpl%}-query-container .op-{%$escaped_tpl%}-large-input{width:388px}.op-{%$escaped_tpl%}-query-container .op-{%$escaped_tpl%}-large-input input{width:370px}.op-{%$escaped_tpl%}-hot-captain,.op-{%$escaped_tpl%}-hot-links{border-bottom:1px solid #ddd;padding-bottom:5px}.op-{%$escaped_tpl%}-hot-links-last{border-bottom:0}.op-{%$escaped_tpl%}-hot-query-box{padding:0 5px}.op-{%$escaped_tpl%}-filters{position:relative}.op-{%$escaped_tpl%}-filter{position:relative;padding-left:70px;display:none}.op-{%$escaped_tpl%}-filters .op-{%$escaped_tpl%}-filter-first,.op-{%$escaped_tpl%}-filters-active .op-{%$escaped_tpl%}-filter{display:block}.op-{%$escaped_tpl%}-filters-unactive .c-icon-chevron-top,.op-{%$escaped_tpl%}-filters-active .c-icon-chevron-bottom{display:none}.op-{%$escaped_tpl%}-filter-more{position:absolute;right:0;top:3px;cursor:pointer;color:#00c}.op-{%$escaped_tpl%}-filter *{font-size:.93em}.op-{%$escaped_tpl%}-filter-label{position:absolute;font-weight:bold;left:0;top:0}.op-{%$escaped_tpl%}-filter-seperator{color:#ddd}.op-{%$escaped_tpl%}-filter-disabled{color:#ccc;cursor:default}.op-{%$escaped_tpl%}-filter-item,.op-{%$escaped_tpl%}-filter-disabled{padding:0 3px}.op-{%$escaped_tpl%}-filter-item{color:#00c;cursor:pointer}.op-{%$escaped_tpl%}-filter-item:hover,.op-{%$escaped_tpl%}-filter-item-hover{text-decoration:underline}.op-{%$escaped_tpl%}-filter-selected{color:#fff;background-color:#67a5eb;border:1px solid #418ce5;padding:0 2px;cursor:default}.op-{%$escaped_tpl%}-routes li{border-top:1px solid #eee;padding:10px 0 5px}.op-{%$escaped_tpl%}-route-thumb{position:relative;height:90px;overflow:hidden}.op-{%$escaped_tpl%}-route-thumb img{float:left}.op-{%$escaped_tpl%}-route-thumb a,.op-{%$escaped_tpl%}-route-thumb a *{text-decoration:none}.op-{%$escaped_tpl%}-route-mask,.op-{%$escaped_tpl%}-route-type{color:#fff;position:absolute;bottom:0;left:0;height:20px;line-height:1.33em;text-align:center}.op-{%$escaped_tpl%}-route-mask{background-color:#000;opacity:.4;_filter:alpha(opacity=40)}.op-{%$escaped_tpl%}-route-title{font-size:110%}.op-{%$escaped_tpl%}-route-title a,.op-{%$escaped_tpl%}-route-title a em{text-decoration:none}.op-{%$escaped_tpl%}-route-title a:hover,.op-{%$escaped_tpl%}-route-title a:hover em{text-decoration:underline}.op-{%$escaped_tpl%}-desc span{color:#666}.op-{%$escaped_tpl%}-route-booking{padding-top:15px}.op-{%$escaped_tpl%}-route-hasdiscount{padding-top:0}.op-{%$escaped_tpl%}-route-booking p{text-align:center;margin-left:14px}.op-{%$escaped_tpl%}-route-booking .op-{%$escaped_tpl%}-price{color:#f60;font-weight:bold}.op-{%$escaped_tpl%}-route-discount{color:#777}.op-{%$escaped_tpl%}-pager{text-align:center;overflow:hidden;padding:4px 0}.op-{%$escaped_tpl%}-pager span{display:inline-block;_display:inline;border:1px solid #d5d5d5;overflow:hidden;padding:3px 7px;margin:0 1px;color:#00c;text-decoration:none;line-height:1.2em;font:normal 12px Arial,Helvetica,sans-serif;text-align:center;vertical-align:middle}.op-{%$escaped_tpl%}-pager .op-{%$escaped_tpl%}-pager-current,.op-{%$escaped_tpl%}-pager .op-{%$escaped_tpl%}-pager-seperator,.op-{%$escaped_tpl%}-pager .op-{%$escaped_tpl%}-pager-loading{border:0;padding:4px 8px;color:#666}.op-{%$escaped_tpl%}-pager .op-{%$escaped_tpl%}-pager-current{color:#000}.op-{%$escaped_tpl%}-pager .op-{%$escaped_tpl%}-pager-item{cursor:pointer}.op-{%$escaped_tpl%}-header-title .op-{%$escaped_tpl%}-icon{width:16px;height:16px;background:url(http://bcscdn.baidu.com/fcnp-ip/1013/pic/283772069bc05b531cbb6d45cf2b91a1.png) no-repeat left top}</style><h3 class="t c-gap-bottom-small"> <a class="op-{%$escaped_tpl%}-header-title" target="_blank" href="{%$tplData.url|escape%}"><span class="c-icon c-gap-icon-right-small op-{%$escaped_tpl%}-icon"></span>{%$tplData.title|limitlen:60|escape|highlight:0%}</a> <span class="tsuf tsuf-op"></span></h3>{%/block%}{%block name='content'%}<div class="op-{%$escaped_tpl%} c-border"> <div class="op-{%$escaped_tpl%}-title c-row c-gap-top"> <div class="op-{%$escaped_tpl%}-search"> <div class="op-{%$escaped_tpl%}-label">出发地</div> <div class="op-{%$escaped_tpl%}-dep-container c-gap-right"> <div class="c-dropdown2 op-{%$escaped_tpl%}-dep"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tplData.dep|escape%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <div class="c-dropdown2-menubox"> <ul class="op-{%$escaped_tpl%}-dep-tabs c-row c-gap-top"> {%foreach $tplData.depsec as $sec%} <li class="op-{%$escaped_tpl%}-dep-tab c-gap-left{%if $sec@first%} op-{%$escaped_tpl%}-dep-tab-active{%/if%}">{%$sec.name|escape%}</li> {%/foreach%} </ul> {%$depinsec=0%} {%foreach $tplData.depsec as $sec%} <ul class="c-row op-{%$escaped_tpl%}-dep-panel{%if $sec@first%} op-{%$escaped_tpl%}-dep-panel-active{%/if%}"> {%foreach $sec.dep as $dep%} <li class="c-dropdown2-option" data-value="{%$dep.city|escape%}">{%$dep.city|escape%}</li> {%if $dep.city==$tplData.dep%} {%$depinsec=1%} {%/if%} {%/foreach%} </ul> {%/foreach%} {%if $depinsec==0 and $tplData.dep != ''%} <span style="display: none;" class="c-dropdown2-option" data-value="{%$tplData.dep|escape%}">{%$tplData.dep|escape%}</span> {%/if%} </div> </div> </div> </div> </div> <div class="op-{%$escaped_tpl%}-query-container c-gap-right"> <span class="c-input c-input12"> <input type="text" class="op-{%$escaped_tpl%}-query" value="{%$tplData.key|escape%}" placeholder="请输入内容"/> </span> <div class="op-{%$escaped_tpl%}-hot-query c-input12"> <div class="op-{%$escaped_tpl%}-hot-query-box"> <div class="c-row op-{%$escaped_tpl%}-hot-captain">热门搜索</div> {%foreach $tplData.hotstype as $type%} <div class="op-{%$escaped_tpl%}-hot-title c-row c-gap-top-small">{%$type.name|escape%}</div> <div class="op-{%$escaped_tpl%}-hot-links c-row{%if $type@last%} op-{%$escaped_tpl%}-hot-links-last{%/if%}"> {%foreach $type.link as $link%} <span class="c-gap-right op-{%$escaped_tpl%}-hot-query-link">{%$link.name|escape%}</span> {%/foreach%} </div> {%/foreach%} </div> </div> </div> <a href="" target="_blank" class="op-{%$escaped_tpl%}-search-btn c-btn OP_LOG_BTN c-btn-primary">去哪儿查询</a> </div> </div> <div class="op-{%$escaped_tpl%}-filters op-{%$escaped_tpl%}-filters-unactive c-row c-gap-top"> {%foreach $tplData.filter as $filter%} <div class="op-{%$escaped_tpl%}-filter c-row{%if $filter@first%} op-{%$escaped_tpl%}-filter-first{%else%} c-gap-top{%/if%}" data-filter="{%$filter.param|escape%}" data-name="{%$filter.name|escape%}"> <div class="op-{%$escaped_tpl%}-filter-label">{%$filter.name|escape%}：</div> {%foreach $filter.item as $item%} {%if !$item@first%}<span class="op-{%$escaped_tpl%}-filter-seperator">|</span>{%/if%} {%if $item.count == "0"%} <span class="op-{%$escaped_tpl%}-filter-disabled">{%$item.content|escape%}</span> {%elseif $item.selected%} <span class="op-{%$escaped_tpl%}-filter-selected" data-value="{%$item.value|escape%}">{%$item.content|escape%}</span> {%else%} <span class="op-{%$escaped_tpl%}-filter-item OP_LOG_OTHERS" data-click="{fm:'beha',qunartype:'filter'}" data-value="{%$item.value|escape%}">{%$item.content|escape%}</span> {%/if%} {%/foreach%} </div> {%/foreach%} {%if count($tplData.filter) > 0%} <span class="op-{%$escaped_tpl%}-filter-more">更多筛选<i class="c-icon c-icon-chevron-bottom"></i><i class="c-icon c-icon-chevron-top"></i></span> {%/if%} </div> <ul class="op-{%$escaped_tpl%}-routes c-gap-top"> {%foreach $tplData.route as $route%} <li class="c-row"> <div class="op-{%$escaped_tpl%}-route-thumb c-span6"> <a href="{%$route.link|escape%}" target="_blank"> <img src="{%$route.image|escape%}" class="c-img6" /> <span class="op-{%$escaped_tpl%}-route-mask c-img6"></span> <span class="op-{%$escaped_tpl%}-route-type c-img6">{%$route.type|escape%}</span> </a> </div> <div class="op-{%$escaped_tpl%}-route-content c-span13"> <p class="op-{%$escaped_tpl%}-route-title"><a href="{%$route.link|escape%}" target="_blank">{%$route.title|limitlen:72|escape|highlight%}</a></p> {%if $route.date%} <p class="op-{%$escaped_tpl%}-desc"><span>出发日期：</span>{%$route.date|limitlen:28|escape%}</p> {%/if%} <p class="op-{%$escaped_tpl%}-desc"><span>供 应 &nbsp;商：</span>{%$route.supplier|limitlen:28|escape%}</p> </div> <div class="op-{%$escaped_tpl%}-route-booking c-span5 c-span-last{%if $route.discount%} op-{%$escaped_tpl%}-route-hasdiscount{%/if%}"> {%$escaped_price=intval($route.price)%} <p class="op-{%$escaped_tpl%}-price">&yen;{%$escaped_price%}起</p> {%$escaped_discount=intval($route.discount)%} {%if $escaped_discount>0%} <p class="op-{%$escaped_tpl%}-route-discount c-gap-top-small"> {%if $escaped_discount>(($escaped_discount+$escaped_price)*0.2)%}{%(round($escaped_price*10/($escaped_discount+$escaped_price),1))%}折{%else%}节省&yen;{%$escaped_discount%}{%/if%} </p> {%/if%} <p class="op-{%$escaped_tpl%}-action c-gap-top-small"><a class="c-btn" href="{%$route.link|escape%}" target="_blank">查看详情</a></p> </div> </li> {%/foreach%} </ul> <div class="op-{%$escaped_tpl%}-pager c-gap-top-small" data-count="{%$tplData.count|escape%}"></div> <img src="http://dujia.qunar.com/bs.png?checkstats={%$tplData.checkstats|escape:'url'%}&amp;r={%time()%}{%100000000+rand(0,100000000)%}" style="position: absolute;" /></div><script >
    A.setup({dep:'{%$tplData.dep|escape:"javascript"%}',tpl:'{%$escaped_tpl|escape:"javascript"%}',query:'{%$tplData.key|escape:"javascript"%}'});
</script><script data-merge>A.setup(function(){var _this = this;var replaceCls=function(str){return (str||'').replace(/##tpl##/g,'op-'+_this.data.tpl);};var rewriteurl=function(url,tf){if(!url||/(^javascript:.*$)|(^#.*$)/.test(url)){return '';}if(/^http:\/\/.*$/.test(url)&&!(/^http:\/\/([a-zA-Z0-9_]+\.){0,1}(tuan|package|dujia|piao|visa)\.qunar\.com.*$/.test(url))){return url;}var base, _search='', hash='';if(url.indexOf("#")>-1){var index=url.indexOf("#");hash=url.substring(index);url=url.subst{%*i*%}ring(0,index);}if(url.indexOf("?")>-1){var index=url.indexOf("?");_search=url.substring(index+1);url=url.substring(0,index);}base=url;_search=_search.replace(/&amp;/g,'&');var _params=_search.length?_search.split('&'):[];for( var i=0; i<_params.length; i++){if(_params[i].split('=')[0]=='tf'){_params.splice(i,1);break;}}_params.push('tf='+tf);_search=_params.join('&');return base+'?'+_search+hash;};var config={pageSize: 4};var dep=_this.data.dep||'';var query=_this.data.query||'';var Deppanel=(fu{%*i*%}nction(){var depselector;var $title=_this.find('.'+replaceCls('##tpl##-title'));var $dom = _this.find('.'+replaceCls('##tpl##-dep-container'));if($dom.length){A.use('dropdown21', function(){ depselector = A.ui.dropdown21($dom.get(0),{type: 'custom',width: 350,onchange: function(){dep=depselector.getValue();_update();if(List&&List.changeDep){List.changeDep(dep);}}});var _update=function(){dep=depselector.getValue();if(dep.length>3){$title.addClass(replaceCls('##tpl##-title-longdep'));}else{$title{%*i*%}.removeClass(replaceCls('##tpl##-title-longdep'));}};if(dep){depselector.setValue(dep);}_update();var $tabs=_this.find('.'+replaceCls('##tpl##-dep-tab'));var $panels=_this.find('.'+replaceCls('##tpl##-dep-panel'));var currentindex=0;var activeCls=replaceCls('##tpl##-dep-tab-active');var panelactiveCls=replaceCls('##tpl##-dep-panel-active');$tabs.each(function(index,tab){if(index<$panels.length){$(tab).bind('click',function(){$tabs.eq(currentindex).removeClass(activeCls);$panels.eq(currentindex).{%*i*%}removeClass(panelactiveCls);currentindex=index;$tabs.eq(currentindex).addClass(activeCls);$panels.eq(currentindex).addClass(panelactiveCls);});}});});}return {dispose: function(){if(depselector&&depselector.dispose){depselector.dispose();}}};})();var Search=(function(){var $querydom=_this.find('.'+replaceCls('##tpl##-query-container'));var $searchdom=_this.find('.'+replaceCls('##tpl##-query'));var enter=false;var activeCls=replaceCls('##tpl##-query-container-active');$searchdom.bind('focus',func{%*i*%}tion(e){if(!$searchdom.val()){$querydom.addClass(activeCls);}});$searchdom.bind('keyup',function(e){if(!$searchdom.val()){$querydom.addClass(activeCls);}else{$querydom.removeClass(activeCls);}});$querydom.bind('mouseenter',function(){enter=true;});$querydom.bind('mouseleave',function(){enter=false;});var qmousedown=function(){if(!enter){$querydom.removeClass(activeCls);}};$(document).bind('mousedown',qmousedown);var search=function(){var v=$searchdom.val();var params=['p'];var values=['list'];if{%*i*%}(v){params.push('q');values.push(v);}if(dep){params.push('d');values.push(dep);} return 'http://dujia.qunar.com/'+params.join('')+'/'+values.join('_');};var $ns=_this.find('.'+replaceCls('##tpl##-hot-query-link')),linkdom;$ns.each(function(i,linkdom){var city=(linkdom.innerText||linkdom.textContent);$(linkdom).bind('click',function(){$querydom.removeClass(activeCls);$searchdom.val(city);});});var $button=_this.find('.'+replaceCls('##tpl##-search-btn'));$button.bind('click',function(e){$button.at{%*i*%}tr('href',search()+'?tf=bd_zhixin_search_01&ex_track=bd_zhixin_dujia_arrive_02');});return {dispose: function(){$(document).unbind('mousedown',qmousedown);}};})();var List=(function(){var params={pageSize: config.pageSize,departure: dep||'',query: query||''};var ajaxFinished = false;var _bytelen=function(source){return String(source).replace(/[^\x00-\xff]/g,"ci").length;};var _cutstr=function (source,length,tail){source=String(source);tail=tail||"...";var bytelen=source.replace(/[^\x00-\xff]/g,"{%*i*%}ci").length;if(length<0||bytelen<=length){return source;}length=length-tail.length;source=source.substr(0,length).replace(/([^\x00-\xff])/g,"\x241 ").substr(0,length).replace(/[^\x00-\xff]$/,"").replace(/([^\x00-\xff]) /g,"\x241");return source+tail;};var cutstr=function(str,length){if(length<_bytelen(str.replace(/(<em>|<\/em>)/g,''))){var highlights=[];str=str.replace(/<em>.*?<\/em>/g,function(matchstr,index){var flag={start: index,end: index+matchstr.length-9};highlights.push(flag);return matc{%*i*%}hstr.substring(4,matchstr.length-5);});var newstr=_cutstr(str,length);for( var i=0; i<highlights.length; i++){if(highlights[i].start>=newstr.length-1){break;}if(highlights[i].end>newstr.length-1){highlights[i].end=newstr.length-1;}newstr=newstr.substring(0,highlights[i].start) + '<em>'+newstr.substring(highlights[i].start,highlights[i].end)+'</em>'+newstr.substring(highlights[i].end);}return newstr;}return str;};var escapeHTML=function(str){if(typeof str=="undefined"){return '';}return String(st{%*i*%}r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");};var searching=false;var search=function(_config){if(ajaxFinished) {return;}config=config||{};if(searching){return;}searching=true;var url="http://www.baidu.com/qunarui/api/zhixin/searchRoute";var args=[];for( var method in params){args.push(encodeURIComponent(method)+'='+encodeURIComponent(params[method]));}if(args.length){url=url+'?'+args.join('&');}var callback=function(data){if(aj{%*i*%}axFinished) {return;}searching=false;if(data.filter&&data.filter.length){renderFilters(data.filter);initFilters();}if(data.route&&data.route.length){renderRoutes(data.route);}pageCount=parseInt(((data.count||0)+config.pageSize-1)/config.pageSize,10);renderPager();updateURLs();};$.ajax({url: url,dataType: 'jsonp',success: callback,error:function(){searching=false;if(_config.onfail){_config.onfail();}},timeout: 5000});};var $filterparent=_this.find('.'+replaceCls('##tpl##-filters'));var _unactive={%*i*%}true;var defaultSelectedFilters=[];var initDefaultMore=function(){if(defaultSelectedFilters.length<2){return;}for( var i=1; i<defaultSelectedFilters.length; i++){if(defaultSelectedFilters[i]&&defaultSelectedFilters[i]!='不限'){_unactive=false;}}var unacitveCls=replaceCls('##tpl##-filters-unactive'), activeCls=replaceCls('##tpl##-filters-active');if(!_unactive){$filterparent.addClass(activeCls);$filterparent.removeClass(unacitveCls);}else{$filterparent.addClass(unacitveCls);$filterparent.removeClas{%*i*%}s(activeCls);}};var initFilters=function(){var $filters=_this.find('.'+replaceCls('##tpl##-filter'));var $morelink=_this.find('.'+replaceCls('##tpl##-filter-more'));if($morelink.length){var unacitveCls=replaceCls('##tpl##-filters-unactive'), activeCls=replaceCls('##tpl##-filters-active');$morelink.bind('click',function(){if(_unactive){$filterparent.addClass(activeCls);$filterparent.removeClass(unacitveCls);}else{$filterparent.addClass(unacitveCls);$filterparent.removeClass(activeCls);}_unactive={%*i*%}!_unactive;});}$filters.each(function(filterindex,_filter){var $filter=$(_filter);var paramname=$filter.data('filter');var filtername=$filter.data('name');defaultSelectedFilters[filterindex]=0;if(paramname){params[paramname]='';$filter.find('.'+replaceCls('##tpl##-filter-item')).each(function(i,_item){var $item=$(_item);$item.bind('mouseenter',function(){$item.addClass(replaceCls('##tpl##-filter-item-hover'));});$item.bind('mouseleave',function(){$item.removeClass(replaceCls('##tpl##-filter-item{%*i*%}-hover'));});$item.bind('click',function(){if(searching){return;}var oldParam=params[paramname];var oldPage=currentPage;params[paramname]=$item.data('value');params['hasFilter']=1;currentPage=1;search({onfail: function(){params[paramname]=oldParam;currentPage=oldPage;}});delete params['hasFilter'];});});var $checked=$filter.find('.'+replaceCls('##tpl##-filter-selected'));if($checked.length){params[paramname]=String($checked.eq(0).data('value'))||'';updateType(filtername,$checked.eq(0).text());de{%*i*%}faultSelectedFilters[filterindex]=$checked.eq(0).text();}}});};var currentType="unlimit", updateType=function(name,content){if(name=="游玩方式"){if(content=="不限"){currentType="unlimit";}else if(content=="跟团游"){currentType="group";}else if(content=="自由行"){currentType="free";}else if(content.indexOf('当地游')>-1){currentType="around";}}};var renderFilters=function(data){var html=[];for( var i=0; i<data.length; i++){html.push('<div class="##tpl##-filter c-row c-gap-top');html.push(i?'':' ##tpl##-filter-fi{%*i*%}rst');html.push('" data-name="'+escapeHTML(data[i].name)+'" data-filter="'+escapeHTML(data[i].param)+'">');html.push('<div class="##tpl##-filter-label">'+escapeHTML(data[i].name)+'：</div>');$.each(data[i].item||[],function(j,item){if(j){html.push(' <span class="##tpl##-filter-seperator">|</span> ');}if(!item.count){html.push('<span class="##tpl##-filter-disabled">'+escapeHTML(item.content)+'</span>');}else if(item.selected){html.push('<span class="##tpl##-filter-selected" data-value="'+escapeHTM{%*i*%}L(item.value)+'">'+escapeHTML(item.content)+'</span>');}else{html.push('<span class="##tpl##-filter-item OP_LOG_OTHERS" data-click="{fm:\'beha\',qunartype:\'filter\'}" data-value="'+escapeHTML(item.value)+'">'+escapeHTML(item.content)+'</span>');}});html.push('</div>');}if(data.length>1){html.push('<span class="##tpl##-filter-more OP_LOG_OTHERS" data-click="{fm:\'beha\',qunartype:\'filter-switch\'}">更多筛选<i class="c-icon c-icon-chevron-bottom"></i><i class="c-icon c-icon-chevron-top"></i></span>'{%*i*%});}$filterparent.html(replaceCls(html.join('')));};var tpl=['<li class="c-row">','<div class="##tpl##-route-thumb c-span6">','<a href="#{link}" target="_blank"><img src="#{image}" class="c-img6" />','<span class="##tpl##-route-mask c-img6"></span>','<span class="##tpl##-route-type c-img6">#{type}</span></a>','</div>','<div class="##tpl##-route-content c-span13">','<p class="##tpl##-route-title"><a href="#{link}" target="_blank">#{title}</a></p>','#{datestr}','<p class="##tpl##-desc"><span>供 应 &n{%*i*%}bsp;商：</span>#{supplier}</p>','</div>','<div class="##tpl##-route-booking c-span5 c-span-last#{cls}">','<p class="##tpl##-price">&yen;#{price}起</p>#{distext}','<p class="##tpl##-action c-gap-top-small"><a class="c-btn" href="#{link}" target="_blank">查看详情</a></p>','</div>','</li>'].join('');var $listparent=_this.find('.'+replaceCls('##tpl##-routes'));var renderRoutes=function(data){ var html=[];var _format=function (source, opts) {source = String(source);var data = Array.prototype.slice.call(argu{%*i*%}ments,1), toString = Object.prototype.toString;if(data.length){data = data.length == 1 ? (opts !== null && (/\[object Array\]|\[object Object\]/.test(toString.call(opts))) ? opts : data) : data;return source.replace(/#\{(.+?)\}/g, function (match, key){var replacer = data[key];if('[object Function]' == toString.call(replacer)){replacer = replacer(key);}return ('undefined' == typeof replacer ? '' : replacer);});}return source;};for( var i=0; i<data.length; i++){if(data[i].discount){data[i].cls=' {%*i*%}##tpl##-route-hasdiscount';}else{data[i].cls='';}data[i].title=cutstr(data[i].title,72);data[i].supplier=cutstr(data[i].supplier,28);if(data[i].date){data[i].datestr='<p class="##tpl##-desc"><span>出发日期：</span>'+cutstr(data[i].date,28)+'</p>';}else{data[i].datestr='';}var discount=parseInt(data[i].discount,10)||0;var price=parseInt(data[i].price,10)||0;if(discount){if(discount/(price+discount)>0.2){discount=(price*10/(price+discount)).toFixed(1)+'折';}else{discount='节省&yen;'+discount;}data[i].dist{%*i*%}ext='<p class="##tpl##-route-discount c-gap-top-small">'+discount+'</p>';}else{data[i].distext='';}html.push(_format(tpl,data[i]));}$listparent.html(replaceCls(html.join('')));};var currentPage=1, $pager=_this.find('.'+replaceCls('##tpl##-pager'));var count=(parseInt($pager.data('count')||'1',10)||1);var pageCount=parseInt((count+config.pageSize-1)/config.pageSize,10);var renderPager=function(){var count=pageCount;if(count<1){return;}var html=[];var shown={};var draw=function(index){if(shown[ind{%*i*%}ex]){return '';}shown[index]=true;if(index==currentPage){return '<span class="##tpl##-pager-current">'+currentPage+'</span>';}else{return '<span class="##tpl##-pager-item" data-page="'+index+'">'+index+'</span>';}};if(currentPage>1){html.push('<span class="##tpl##-prev ##tpl##-pager-item" data-page="'+(currentPage-1)+'">上一页</span>');}var point=currentPage;if(count-2<point){point=count-2;}if(point<5){if(count<5){point=count;}else{point=5;}}if(point>5){html.push(draw(1));html.push('<span class="##{%*i*%}tpl##-pager-seperator">...</span>');html.push(draw(point-2));html.push(draw(point-1));}else{for( var i=1; i<point; i++){html.push(draw(i));}}html.push(draw(point));point=currentPage;if(point<3){point=3;}if(count-point<4){point=count-2;if(point<1){point=1;}}if(count-point>4){html.push(draw(point+1));html.push(draw(point+2));html.push('<span class="##tpl##-pager-seperator">...</span>');html.push(draw(count));}else{for( var i=point; i<=count; i++){html.push(draw(i));}}if(currentPage<count){html.pus{%*i*%}h('<span class="##tpl##-next ##tpl##-pager-item" data-page="'+(currentPage+1)+'">下一页</span>');}$pager.html(replaceCls(html.join('')));var $items=$pager.find('.'+replaceCls('##tpl##-pager-item'));$items.each(function(){var $item=$(this);var index=parseInt($item.data('page'),10);$item.bind('click',function(){if(searching){return;}var oldPage=currentPage;currentPage=index;$pager.html(replaceCls('<span class="##tpl##-pager-loading">加载中...</span>'));params['start']=(currentPage-1)*config.pageSize;sea{%*i*%}rch({onfail: function(){currentPage=oldPage;renderPager();}});delete params['start'];});});};var updateURLs=function(){var places=['img','title','button'];$listparent.find('.c-row').each(function(index){var links=[], $item=$(this);var $p=$item.find('.'+replaceCls('##tpl##-route-thumb')).eq(0);links.push($p.find('a').eq(0));$p=$item.find('.'+replaceCls('##tpl##-route-title')).eq(0);links.push($p.find('a').eq(0));$p=$item.find('.'+replaceCls('##tpl##-action')).eq(0);links.push($p.find('a').eq(0));{%*i*%}$.each(links,function(i,$link){if($link.length){$link.attr('href',rewriteurl($link.attr('href'),'bd_zhixin_'+currentType+'_'+places[i]+'_'+currentPage+'_'+(index+1))+'&ex_track=bd_zhixin_dujia_arrive_03');}});});};renderPager();initFilters();updateURLs();initDefaultMore();return {changeDep: function(dep){var oldPage=currentPage;params['departure']=dep;params['hasFilter']=1;currentPage=1;search({onfail: function(){currentPage=oldPage;}});delete params['hasFilter'];},dispose: function(){if(!ajaxFi{%*i*%}nished){ajaxFinished = true;}}};})();this.dispose = function(){Deppanel.dispose();Search.dispose();List.dispose();};});</script>{%/block%}