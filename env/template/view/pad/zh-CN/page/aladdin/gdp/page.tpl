{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='foot'%}{%/block%}{%block name='data_modifier'%}{%$extData.feData.hasBorder = true%}{%*canvas 宽度值*%}{%$escaped_canvasWidth = 405%}{%*canvas 高度值*%}{%$escaped_canvasHeight = 192%}{%*canvas x轴单元格宽度百分比*%}{%$canvasXCellWidth = round(100/count($tplData.xcell.cell))%}{%*canvas y轴单元格宽度百分比*%}{%$canvasYCellWidth = round(100/count($tplData.ycell.cell))%}{%/block%}{%block name='content'%}<style data-merge>.op_gdp_title{font-size:1.07em;color:#666;font-weight:bold}.op_gdp_subtitle{font-size:1.84em;color:#000;font-family:"Microsoft YaHei",SimHei}.op_gdp_map_canvas{margin:0 140px 35px 50px;display:block}.op_gdp_map_mask,.op_gdp_map_bg{position:absolute;top:0;left:50px}.op_gdp_map_bg{z-index:-1}.op_gdp_map_x{position:absolute;bottom:0;left:50px;height:25px}.op_gdp_map_y{position:absolute;left:0;top:0;width:50px}.op_gdp_info{position:absolute;right:-8px;top:0;width:142px}.op_gdp_map_{%*i*%}x span,.op_gdp_map_y span{position:absolute;font-size:.92em;white-space:nowrap;color:#666}.op_gdp_map_y span{display:block;text-align:right;width:90%}.op_gdp_map_x span i{position:absolute;left:50%;top:-8px;border:0;border-left:1px solid #ebebeb;width:1px;height:4px;line-height:4px;display:block}.op_gdp_info li{padding-left:30px;font-size:.92em;display:block}.op_gdp_info_icon{position:absolute;left:15px}.op_gdp_info a{text-decoration:none;color:#333}.op_gdp_map_x .op_gdp_tips{position:absolute;b{%*i*%}ackground:#bdc1c7;color:#fff;white-space:nowrap;padding:0 5px;height:20px;line-height:20px;font-size:.77em}.op_gdp_tools a{text-decoration:none}.op_gdp_tools a:hover{text-decoration:underline}.op_gdp_tools{color:#999;font-size:.92em;text-align:right}.op_gdp_tools a{color:#999}.op_gdp_tools_sep{color:#ccc;margin:0 8px}</style><style>.op_gdp_content{position:relative;width:{%$escaped_canvasWidth+180%}px;height:{%$escaped_canvasHeight+35%}px}.op_gdp_map_x{width:{%$escaped_canvasWidth%}px}.op_gdp_map_y{height:{%$escaped_canvasHeight+10%}px}.op_gdp_info{height:{%$escaped_canvasHeight+10%}px}</style><!--[if IE]><script>document.createElement('canvas');</script><![endif]--><p class="op_gdp_title">{%$tplData.title|escape%}</p><p class="op_gdp_subtitle">{%$tplData.subTitle|escape%}</p><div class="op_gdp_content"> <div class="op_gdp_map_x"> </div> <canvas class="op_gdp_map_bg" width="{%$escaped_canvasWidth+8%}" height="{%$escaped_canvasHeight+10%}"></canvas> <canvas class="op_gdp_map_canvas" width="{%$escaped_canvasWidth+8%}" height="{%$escaped_canvasHeight+10%}"></canvas> <canvas class="op_gdp_map_mask" width="{%$escaped_canvasWidth+8%}" height="{%$escaped_canvasHeight+10%}"></canvas> <div class="op_gdp_map_y"> </div> <ol class="op_gdp_info"></ol></div> <div class="op_gdp_tools c-gap-top"> {%if $tplData.sourcetitle%}数据来自<a href="{%if $tplData.sourceurl%}{%$tplData.sourceurl%}{%/if%}" target="_blank">{%$tplData.sourcetitle|escape%}</a><span class="op_gdp_tools_sep">|</span>{%/if%}<span class="op_gdp_tools_fb_area"><a class="op_gdp_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:'报错'}">报错</a></span> </div><script >
    A.setup({
        "escaped_canvasWidth":"{%$escaped_canvasWidth%}",
        "escaped_canvasHeight":"{%$escaped_canvasHeight%}",
        "currency":"{%$tplData.currency%}",
        "xmin":"{%$tplData.xmin%}",
        "xmax":"{%$tplData.xmax%}",
        "ymin":"{%$tplData.ymin%}",
        "ymax":"{%$tplData.ymax%}",
        "xcell": {%json_encode($tplData.xcell.cell)%},
        "ycell": {%json_encode($tplData.ycell.cell)%},
        "data": {%json_encode($tplData.data)%}
    });
</script><script data-merge>A.setup(function(){var _this = this;var color = ["rgb(56,139,255)","rgb(255,179,26)","rgb(88,199,88)"];var acolor = ["rgba(56,139,255,0.3)","rgba(255,179,26,0.3)","rgba(88,199,88,0.3)"];var bcolor = ["rgba(255,185,178,0.1)","rgba(178,217,255,0.1)","rgba(179,255,178,0.1)"];var gdpcanvas = _this.find(".op_gdp_map_canvas")[0];var bgcanvas = _this.find(".op_gdp_map_bg",_this)[0];var maskcanvas = _this.find(".op_gdp_map_mask",_this)[0];var QueryLineWidth = 3,NormalLineWidt{%*i*%}h =1;var queryYear = null;var queryData =null;var T = null;var $info = $(".op_gdp_info");_this.find(".op_gdp_tools_fb").on("click",function(){$(this).hide().after('<span>感谢反馈</span>');});if(gdpcanvas){var supportCanvas = !!document.createElement('canvas').getContext;if(!supportCanvas){A.use('canvas', function(){A.ui.canvas.init(gdpcanvas);A.ui.canvas.init(maskcanvas);A.ui.canvas.init(bgcanvas);initCanvas();});}else{initCanvas();}}function initCanvas(){var gdpcontext = gdpcanvas.getContext('2d');{%*i*%}var maskcontext = maskcanvas.getContext('2d');var bgcontext = bgcanvas.getContext('2d');var _data = [];for(var i=0;i<_this.data.data.length;i++){_this.data.data[i].p = _this.data.data[i].p.replace(/\;$/, '');var tempArr = _this.data.data[i].p.split(";");_data[i] =[];for(var j=0;j<tempArr.length;j++){var x = tempArr[j].split(",")[0];var y = tempArr[j].split(",")[1];_data[i].push({"x":x,"y":y});}if(_this.data.data[i].order == "1"){queryYear = _data[i][_data[i].length-1].x;}};bgcontext.strokeStyle {%*i*%}='#ebebeb';op_gdp_drawSingleLine(bgcontext,0,gdpcanvas.height-0.5,gdpcanvas.width,gdpcanvas.height-0.5);var yspan =[];_this.data.ycell.reverse();for(var i=0;i<_this.data.ycell.length;i++){var _top = op_gdp_sY(_this.data.ycell[i].value);if(_top >0 ){op_gdp_drawSingleLine(bgcontext,0,_top,gdpcanvas.width,_top); yspan.push("<span style='top:"+_top+"px'>"+_this.data.ycell[i].text+"</span>"); }};yspan.push("<span style='top:100%'>0</span>");_this.find(".op_gdp_map_y").html(yspan.join(""));var xspan ={%*i*%}[];for(var i=0;i<_this.data.xcell.length;i++){var _left = op_gdp_sX(_this.data.xcell[i].value);xspan.push("<span class='c-gap-top' style='left:"+_left+"px'><i></i>"+_this.data.xcell[i].text+"</span>"); }_this.find(".op_gdp_map_x").html(xspan.join(""));$("span",".op_gdp_map_y").each(function(){$(this).css("margin-top",-($(this).height()/2));});$("span",".op_gdp_map_x").each(function(){$(this).css("margin-left",-($(this).width()/2));});var infoHmtl=[];for(var i=0;i<_data.length;i++){if(_this.data.{%*i*%}data[i].order == 1){queryData = _data[i];}var firstPoint = _data[i][0],firstPointX = firstPoint.x,firstPointY = firstPoint.y;var lastPoint = _data[i][_data[i].length-1],lastPointX = lastPoint.x,lastPointY = lastPoint.y;op_gdp_drawData(gdpcontext,_data[i],color[_this.data.data[i].order-1],_this.data.data[i].order == 1?QueryLineWidth:NormalLineWidth);if(queryYear == _data[i][_data[i].length-1].x){var showGDPNum = op_gdp_showNumber(lastPointY) + _this.data.currency;}else{var showGDPNum = "-";}infoH{%*i*%}mtl.push("<li class='c-gap-bottom'><span class='op_gdp_info_icon' style='color:"+color[_this.data.data[i].order-1]+"'>●</span><a href='http://wwww.baidu.com/s?ie=utf-8&wd="+_this.data.data[i].queryWord+"'><span>"+_this.data.data[i].name +"</span>：<p>"+ showGDPNum +"</p><p>&nbsp;</p></a></li>");};if(queryData){op_gdp_drawData(gdpcontext,queryData,color[0],QueryLineWidth);}$info.html(infoHmtl.join(""));var curX = null;function op_gdp_touchMoveEventHandle(e){var mapOffset = op_gdp_getOffset(gdpcanv{%*i*%}as);var crood = {x: (e.pageX || (e.clientX + document.documentElement.scrollLeft)) - mapOffset.left, y: (e.pageY || (e.clientY + document.documentElement.scrollTop)) - mapOffset.top};var sclosest = op_gdp_getClosest(op_gdp_vX(crood.x), _data);var closest = {x:op_gdp_sX(sclosest.x),y:op_gdp_sY(sclosest.y)};if(curX === null || closest['x'] !== curX){maskcontext.clearRect(0, 0, _this.data.escaped_canvasWidth*2, _this.data.escaped_canvasHeight*2);maskcontext.strokeStyle ="#bdc1c7";op_gdp_drawDashedL{%*i*%}ine(maskcontext,closest['x'],0,closest['x'], gdpcanvas.height,1);var queryPoint =null;for(var i = 0;i< _data.length; i++){if(_this.data.data[i].order == 1){queryPoint = _data[i];}maskcontext.fillStyle = color[_this.data.data[i].order-1];var r = (_this.data.data[i].order == 1)?5:3; op_gdp_drawCircle(maskcontext,closest['x'],op_gdp_sY(op_gdp_getY(sclosest['x'],_data[i])),r);}maskcontext.fillStyle = color[0];op_gdp_drawCircle(maskcontext,closest['x'],op_gdp_sY(op_gdp_getY(sclosest['x'],queryPoint)){%*i*%},5);curX = closest['x'];if(_this.find(".op_gdp_tips").length <= 0){_this.find(".op_gdp_map_x").append("<span class='op_gdp_tips'></span>");}var $tips = _this.find(".op_gdp_tips");$tips.html(sclosest['x']);$tips.show();$tips.each(function(){$(this).css({"left":closest['x'],"margin-left":-($(this).width()/2)});});var $infoItem = $info.find("li");$infoItem.each(function(i){var tempData = op_gdp_getY(sclosest['x'],_data[i]);if(tempData == "-10"){$("p",this).first().html("-");$("p",this).last().html({%*i*%}"");}else{$("p",this).first().html( op_gdp_showNumber(tempData) + _this.data.currency);$("p",this).last().html("("+ sclosest['x'] +"年)");}});}}_this.find(maskcanvas).on('touchstart',function(e){op_gdp_touchMoveEventHandle(e);});_this.find(maskcanvas).on('touchmove',function(e){op_gdp_touchMoveEventHandle(e);});_this.find(maskcanvas).on('touchend',function(e){curX = null;maskcontext.clearRect(0, 0, _this.data.escaped_canvasWidth*2, _this.data.escaped_canvasHeight*2);_this.find(".op_gdp_tips").hid{%*i*%}e();var $infoItem = $info.find("li");$infoItem.each(function(i){if(queryYear == _data[i][_data[i].length-1].x){$("p",this).first().html(op_gdp_showNumber(_data[i][_data[i].length-1].y) + _this.data.currency); }else{$("p",this).first().html("-");}$("p",this).last().html("&nbsp;")});});$info.find("li").on("touchstart",function(e){op_gdp_infoTouchMoveEventHandle(e);});$info.find("li").on("touchmove",function(e){op_gdp_infoTouchMoveEventHandle(e);});$info.find("li").on("touchend",function(){$info.fi{%*i*%}nd("a>span").css("text-decoration","none");$info.find("a").css("color","#333");$info.find(".op_gdp_info_icon").css({"opacity":"1","filter":"alpha(opacity=100)"});gdpcontext.clearRect(0,0,gdpcanvas.width*2,gdpcanvas.height*2);for(var i=0;i<_data.length;i++){op_gdp_drawData(gdpcontext,_data[i],color[_this.data.data[i].order-1],_this.data.data[i].order == 1?QueryLineWidth:NormalLineWidth);}if(queryData){op_gdp_drawData(gdpcontext,queryData,color[0],QueryLineWidth);}});function op_gdp_infoTouchMoveE{%*i*%}ventHandle(e){var _target = e.target;if(_target.tagName == "li"){_target = $(e.target);}else{_target = $(e.target).parents("li .c-gap-bottom");}var $target = $(_target);$info.find("a").css("color","#999");$info.find(".op_gdp_info_icon").css({"opacity":"0.3","filter":"alpha(opacity=50)"});$target.find("a").css("color","#333");$target.find(".op_gdp_info_icon").css({"opacity":"1","filter":"alpha(opacity=100)"});$target.find("a>span").css("text-decoration", "underline");gdpcontext.clearRect(0,0,gdpc{%*i*%}anvas.width*2,gdpcanvas.height*2);for(var i=0;i<_data.length;i++){var lineColor = color[_this.data.data[i].order-1];var lineWidth = QueryLineWidth;if(i != _target.index()){lineColor = acolor[_this.data.data[i].order-1];lineWidth = 1;}op_gdp_drawData(gdpcontext,_data[i],lineColor,lineWidth);}}}function op_gdp_getOffset(e){var x = 0, y = 0;while (e != null) {x += e.offsetLeft;y += e.offsetTop;e = e.offsetParent;}return { left: x, top: y };}function op_gdp_getClosest(goal, _data){var closest = null{%*i*%};for(var i = 0;i< _data.length; i++){for(var j = 0;j<_data[i].length; j++){if(closest === null || Math.abs(_data[i][j]['x'] - goal) < Math.abs(closest['x'] - goal)){closest = _data[i][j];}}}return closest;}function op_gdp_getY(x,arr){for(var i = 0;i< arr.length; i++){if(arr[i].x == x){return arr[i].y;}}return -10;}function op_gdp_vX(sx){return Math.round(sx/_this.data.escaped_canvasWidth*(_this.data.xmax - _this.data.xmin)) + parseInt(_this.data.xmin);}function op_gdp_sX(x){var sx = Math.round(_{%*i*%}this.data.escaped_canvasWidth*(x-_this.data.xmin)/(_this.data.xmax - _this.data.xmin));if(sx > _this.data.escaped_canvasWidth){return sx - 0.5;}else{return sx + 0.5;}}function op_gdp_sY(y){if(y < 0){return -100}var sy = Math.round(_this.data.escaped_canvasHeight - _this.data.escaped_canvasHeight*(y - _this.data.ymin)/(_this.data.ymax - _this.data.ymin))+5;if(sy > gdpcanvas.height){return sy - 0.5;}else{return sy + 0.5;}}function op_gdp_drawData(context,data,c,l){context.strokeStyle = c;context.b{%*i*%}eginPath();var firstPoint = data[0],firstPointX = firstPoint.x,firstPointY = firstPoint.y;var lastPoint = data[data.length-1],lastPointX = lastPoint.x,lastPointY = lastPoint.y;context.moveTo(op_gdp_sX(firstPointX),op_gdp_sY(firstPointY));for(var j=0;j<data.length-1;j++){context.lineWidth = l; op_gdp_drawLine(context,op_gdp_sX(data[j].x),op_gdp_sY(data[j].y),op_gdp_sX(data[j+1].x),op_gdp_sY(data[j+1].y));}context.stroke();}function op_gdp_drawLine(context,x1,y1,x2,y2){context.lineTo(x2,y2);}funct{%*i*%}ion op_gdp_drawSingleLine(context,x1,y1,x2,y2){context.beginPath(); context.moveTo(x1,y1);context.lineTo(x2,y2);context.stroke();}function op_gdp_drawDashedLine(context, x1, y1, x2,y2, dashLength) {dashLength = dashLength === undefined ? 5 :dashLength; var deltaX = x2 - x1; var deltaY = y2 - y1; var numDashes = Math.floor( Math.sqrt(deltaX * deltaX + deltaY *deltaY) / dashLength); context.beginPath();for (var i=0; i < numDashes; ++i) { context[ i % 2 === 0 ? 'moveTo' :'lineTo' ] (x1 + (deltaX / {%*i*%}numDashes) * i, y1 +(deltaY / numDashes) * i); } context.closePath();context.stroke(); }; function op_gdp_drawCircle(context,x,y,r){context.beginPath(); context.arc(x,y,r,0,Math.PI*2);context.closePath(); context.fill(); }function op_gdp_showNumber(num){if(_this.data.ycell[0].text.indexOf("万亿")!=-1){if(num>1){return parseFloat(num).toFixed(2) +"万亿";}else if(num*10000 >1){return (num*10000).toFixed(2) +"亿";}else{return (num*100000000).toFixed(2) +"万";}}else if(_this.data.ycell[0].text.indexOf("亿"{%*i*%})!=-1){if(num>1){return parseFloat(num).toFixed(2) +"亿";}else{return (num*10000).toFixed(2) +"万";}}else{return parseFloat(num).toFixed(2) +"万";}}this.dispose = function(){};});</script>{%/block%}