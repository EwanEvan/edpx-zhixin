{%extends 'c_base.tpl'%} {%block name="data_modifier"%}{%$tplData.showurl = ''%}{%$tplData.showlamp ='' %}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='img'%}{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='dropdown2'%}.op-calendar-title{font-size:1.08em;font-weight:bold}.op-calendar-content{font-size:1.69em;font-family:Microsoft Yahei}.op-calendar-content-mult .op-calendar-content{font-size:1.23em}.op-calendar-order{color:#999;text-align:right;margin-bottom:-3px}.op-calendar-report{color:#999;text-decoration:none}.op-calendar-sp{margin:0 8px;color:#d1d1d1;font-size:.92em;position:relative;top:-1px}.op-calendar-reportover{display:none}.op-calendar-btn i{vertical-align:text-bottom;_vertical-align:text-top}.op-c{%*i*%}alendar-openlink{color:#999;text-decoration:none}.op-calendar-openlink:hover{text-decoration:underline}.op-calendar-box{display:none}.op-calendar-new-box{margin-top:24px}.op-calendar-new-box{border:2px solid #57abff;border-right:0;height:405px;position:relative;z-index:1}.op-calendar-new-year-box,.op-calendar-new-month-box,.op-calendar-new-holiday-box{float:left}.op-calendar-new-year-box,.op-calendar-new-month-box{margin-right:8px}.op-calendar-new-year-box{width:90px}.op-calendar-new-month-box{w{%*i*%}idth:65px;padding:0 22px;position:relative;z-index:1}.op-calendar-new-holiday-box{width:107px}.op-calendar-new-select-box{height:26px;float:left;zoom:1;visibility:hidden}.op-calendar-new-backtoday{float:right}.op-calendar-new-left{padding:10px;width:426px;position:absolute;z-index:1;left:0}.op-calendar-new-right{color:#fff;text-align:center;margin-left:446px;height:407px;background:#5caeff;background:-webkit-gradient(linear,0 0,0 100%,from(#5af),to(#73b9ff));background:-moz-linear-gradient(top,#{%*i*%}5af,#73b9ff)}.op-calendar-new-table-box{float:left;width:100%}.op-calendar-new-month-box .c-dropdown2-btn-icon-border{border-color:transparent;background-color:transparent!important}.op-calendar-new .c-dropdown2 .c-dropdown2-btn-icon{padding-left:0}.op-calendar-new-prev-month,.op-calendar-new-next-month{position:absolute;top:0;display:block;width:21px;border:1px solid #999;border-bottom-color:#d8d8d8;background:#fafafa;height:28px;text-align:center;line-height:28px;text-decoration:none;color:#7a{%*i*%}7a7a;font-weight:bold;font-family:Simsun,Simhei,sans-serif;z-index:205}.op-calendar-new-prev-month{left:0;border-right-color:#d8d8d8}.op-calendar-new-next-month{right:0;border-left-color:#d8d8d8}.op-calendar-new-prev-month:hover,.op-calendar-new-next-month:hover{color:#389cff;border-color:#389cff;border-left:1px solid #389cff}.op-calendar-new-table{width:100%;border-collapse:collapse;border-spacing:0}.op-calendar-new-table th,.op-calendar-new-table td{text-align:center;height:60px;border-top:1px{%*i*%} solid #c8cacc;padding:0}.op-calendar-new-relative{position:relative;width:100%;zoom:1}.op-calendar-new-table th{height:37px;border-color:#5af;font-weight:normal;font-size:1.08em}.op-calendar-new-table-six td{height:50px}.op-calendar-new-table td a{display:block;width:54px;border-right:1px solid #fff;height:38px;padding:11px 3px 10px;text-align:center;text-decoration:none;line-height:1;white-space:nowrap;overflow:hidden}.op-calendar-new-table td a *{cursor:pointer}.op-calendar-new-table-six td a{%*i*%}{padding:6px 3px}.op-calendar-new-table td .op-calendar-new-table-selected,.op-calendar-new-table td .op-calendar-new-table-border{padding:8px 0 7px;width:54px;border:3px solid #fb0}.op-calendar-new-table-six td .op-calendar-new-table-selected,.op-calendar-new-table-six td .op-calendar-new-table-border{padding:3px 0}.op-calendar-new-daynumber{display:block;height:22px;font-size:1.38em;color:#000}.op-calendar-new-table-almanac{display:block;color:#999;font-size:.92em}.op-calendar-new-table-festiv{%*i*%}al .op-calendar-new-table-almanac{color:#e02d2d}th.op-calendar-new-table-weekend,.op-calendar-new-table-weekend .op-calendar-new-daynumber{color:#e02d2d}.op-calendar-new-table-other-month .op-calendar-new-daynumber,.op-calendar-new-table-other-month .op-calendar-new-table-almanac{color:#bfbfbf}.op-calendar-new-table-today .op-calendar-new-daynumber,.op-calendar-new-table-today .op-calendar-new-table-almanac{color:#fff}.op-calendar-new-table-today{background:#fb0}.op-calendar-new-table td .op-cal{%*i*%}endar-new-table-rest,.op-calendar-new-table td .op-calendar-new-table-work{background:#fff0f0}.op-calendar-new-table td .op-calendar-new-table-work{background:#f5f5f5}.op-calendar-new-table-holiday-sign{position:absolute;left:0;top:0;display:block;width:17px;height:17px;color:#fff;background:#f43;text-align:left;text-indent:1px;line-height:1.08;overflow:hidden}.op-calendar-new-table-work .op-calendar-new-table-holiday-sign{background:#969799}.op-calendar-new-table-other-month .op-calendar-new-ta{%*i*%}ble-holiday-sign{filter:alpha(opacity = 50);opacity:.5}.op-calendar-new-right-date{height:48px;line-height:48px}.op-calendar-new-right-day{position:relative;width:75px;height:75px;margin:0 auto;line-height:76px;font-size:52px;background:#fb0;border-radius:3px;box-shadow:1px 2px 5px rgba(0,0,0,0.1),-1px 2px 5px rgba(0,0,0,0.1)}.op-calendar-new-right-lunar span{display:block}.op-calendar-new-right-almanac{margin:10px auto 0;width:125px;border-top:2px solid #94c9ff;padding-top:10px;line-height:18px{%*i*%};height:155px}.op-calendar-new-right-almanac span{display:block;width:62px;float:left;white-space:nowrap;overflow:hidden}.op-calendar-new-right-almanac i{display:block;width:30px;height:30px;margin:0 auto 5px}.op-calendar-new-right-almanac i,.op-calendar-hover-suit i,.op-calendar-hover-avoid i{font-style:normal;font:24px/30px 'Microsoft Yahei';text-shadow:2px 2px 1px rgba(0,0,0,0.1);text-align:center;color:#fff}.op-calendar-new-right-hover .op-calendar-hover-almanac{display:block}.op-calendar-ho{%*i*%}ver-almanac{display:none;position:absolute;z-index:100;width:210px;right:-231px;top:198px;background:#fff;padding:15px 10px;border:1px solid #5fafff;color:#333;box-shadow:4px 4px rgba(0,0,0,0.05);z-index:100}.op-calendar-almanac-arrow{position:absolute;top:20px;left:-11px;font:22px Simsun;color:#fff;text-shadow:0 -1px rgba(0,0,0,0.05);z-index:1}.op-calendar-hover-suit,.op-calendar-hover-avoid{padding-left:40px;position:relative;display:block;min-height:30px;_height:30px;text-align:left}.op-calen{%*i*%}dar-hover-suit i,.op-calendar-hover-avoid i{display:block;position:absolute;top:0;left:0;width:30px;height:30px;background:#67b3ff}.op-calendar-hover-avoid i{background:#ff5040}.op-calendar-new-holidaytip{display:none;position:relative;background:#f7f7f7;padding:10px 10px 10px 0}.op-calendar-new-holidaytip p{margin-left:35px}.op-calendar-new-holidaytip-icon{position:absolute;left:0;top:5px;padding-left:10px;width:20px;height:20px;text-align:center;font:30px/30px Simsun;color:#61b0ff}.op-calendar{%*i*%}-new-holidaytip-icon i{font-style:normal;font:14px/30px Tahoma,Arial;position:absolute;width:20px;height:20px;right:0;top:0}.op-calendar-new-holidaystyle .op-calendar-new-box,.op-calendar-new-red-bg .op-calendar-new-box{border-color:#cb1c18}.op-calendar-new-holidaystyle .op-calendar-new-right,.op-calendar-new-red-bg .op-calendar-new-right{color:#fff;text-align:center;margin-left:446px;height:407px;background:#cb1c18;background:-webkit-gradient(linear,0 0,0 100%,from(#cb1c18),to(#f44f23));backgro{%*i*%}und:-moz-linear-gradient(top,#cb1c18,#f44f23)}.op-calendar-new-holidaystyle .op-calendar-new-right-almanac,.op-calendar-new-red-bg .op-calendar-new-right-almanac{border-top-color:#eb7563}.op-calendar-new-holidaystyle .op-calendar-new-table th,.op-calendar-new-red-bg .op-calendar-new-table th{border-color:#f55c4e}.op-calendar-new-holidaystyle .op-calendar-hover-almanac,.op-calendar-new-red-bg .op-calendar-hover-almanac{border-color:#cb1c18}</style><div class="c-border c-clearfix"> <div class="c-s{%*i*%}pan3"> <img src="http://www.baidu.com/aladdin/img/calendar/calendar.png" class="c-img c-img3" /> </div> <div class="c-span21 c-span-last {%if $tplData.hasSpContent && $tplData.spContent2%}op-calendar-content-mult{%/if%}"> <div class="op-calendar-title c-gray">万年历</div> <div class="op-calendar-content"> {%if $tplData.hasSpContent%} {%if $tplData.spContent1%} <span>{%$tplData.spContent1%}</span> {%/if%} {%/if%} <span> {%if $tplData.hasYear%}{%if $tplData.year%}{%$tplData.year|escape:'html'%}{%/if%}{%/if%}{%if $tplData.hasMonth%}{%if $tplData.month%}{%$tplData.month|escape:'html'%}{%/if%}{%/if%}{%if $tplData.hasDay%}{%if $tplData.day%}{%$tplData.day|escape:'html'%}{%/if%}{%/if%} </span> {%if $tplData.hasNumOfWeek%} {%if $tplData.numOfWeek%} <span>{%$tplData.numOfWeek|escape:'html'%}</span> {%/if%} {%/if%} {%if $tplData.hasWeek%} {%if $tplData.week%} <span>{%$tplData.week|escape:'html'%}</span> {%/if%} {%/if%} {%if $tplData.hasLunarMonth && !$tplData.hasLunarFestival%} <span> 农历 {%if $tplData.lunarMonth%}{%$tplData.lunarMonth|escape:'html'%}{%/if%}{%if $tplData.hasLunarDay%}{%if $tplData.lunarDay%}{%$tplData.lunarDay|escape:'html'%}{%/if%}{%/if%} </span> {%/if%} {%if $tplData.hasGanzhinian%} {%if $tplData.ganzhinian%} <span>{%$tplData.ganzhinian|escape:'html'%}</span> {%/if%} {%/if%} {%if $tplData.hasGanzhiyue%} {%if $tplData.ganzhiyue%} <span>{%$tplData.ganzhiyue|escape:'html'%}</span> {%/if%} {%/if%} {%if $tplData.hasGanzhiri%} {%if $tplData.ganzhiri%} <span>{%$tplData.ganzhiri|escape:'html'%}</span> {%/if%} {%/if%} {%if $tplData.hasShengxiaonian%} {%if $tplData.shengxiaonian%} <span> {%if $tplData.ganzhinian%} 农历{%$tplData.ganzhinian|escape:'html'%} {%/if%} （{%$tplData.shengxiaonian|escape:'html'%}） </span> {%/if%} {%/if%} {%if $tplData.hasFestival%} {%if $tplData.festival%} {%if $tplData.hasLunarFestival%} <span> 农历 {%if $tplData.lunarMonth%}{%$tplData.lunarMonth|escape:'html'%}{%/if%}{%if $tplData.lunarDay%}{%$tplData.lunarDay|escape:'html'%}{%/if%} </span> {%/if%} <span> {%$tplData.festival|escape:'html'%} </span> {%/if%} {%/if%} </div> {%if $tplData.hasSpContent && $tplData.spContent2%} <div class="op-calendar-content"> {%$tplData.spContent2%} </div> {%/if%} <div class="op-calendar-order"> 来自<a href="http://open.baidu.com/" target="_blank" class="op-calendar-openlink">百度开放平台</a><span class="op-calendar-sp">|</span><a class="op-calendar-report" href="javascript:;" data-click="{fm:'beha'}">报错</a><span class="op-calendar-reportover">感谢反馈</span></div> </div></div><div class="op-calendar-box"> <div class="op-calendar-new"> <div class="op-calendar-new-box"> <div class="op-calendar-new-left c-clearfix"> <div class="op-calendar-new-select-box"> <div class={%*i*%}"op-calendar-new-year-box"></div> <div class="op-calendar-new-month-box"> <a href="javascript:;" class="op-calendar-new-prev-month" hidefocus="true" onclick="return false">&lt;</a> <a href="javascript:;" class="op-calendar-new-next-month" hidefocus="true" onclick="return false">&gt;</a> </div> <div class="op-calendar-new-holiday-box"></div> </div> <a class="c-btn op-calendar-new-backtoday OP_LOG_BTN" hidefocus="true" data-click="{fm:\'beha\'}" href="javascript:;">返回今天</a> <div class="op-calendar{%*i*%}-new-table-box c-gap-top"></div> </div> <div class="op-calendar-new-right"></div> </div> <div class="op-calendar-new-holidaytip"></div> </div></div><div class="op-calendar-btn c-gap-top-small"> <a href="javascript:;" class="op-calendar-showbtn" data-click="{fm:'beha'}"><i class="c-icon c-icon-unfold c-gap-icon-right-small"></i>展开万年历</a> <a href="javascript:;" class="op-calendar-hidebtn" data-click="{fm:'beha'}" style="display: none"><i class="c-icon c-icon-fold c-gap-icon-right-small"></i>收起</a>{%*i*%}</div><script >
    A.setup({
        curDate: '{%time()|date_format:'%Y-%m-%d'%}',
        selectDate: '{%$tplData.selectday|escape:'javascript'%}'
    });
    
</script><script data-merge>A.setup(function() {var T = A.baidu,_this = this,buildCalendar,hasBuild = false,timer1,timer2,dropDown,report = _this.find( '.op-calendar-report' ), reportover = _this.find( '.op-calendar-reportover' ),calendarBox = _this.find( '.op-calendar-box' ),showBtn = _this.find( '.op-calendar-showbtn' ),hideBtn = _this.find( '.op-calendar-hidebtn' );report.click(function() {report.hide();reportover.show();});showBtn.click(function( e ) {e.preventDefault();showBtn.hide();if ( !{%*i*%}hasBuild ) {hasBuild = true;buildCalendar();}hideBtn.css( 'display', 'inline' );calendarBox.css( 'display', 'block' );});hideBtn.click(function() {hideBtn.hide();calendarBox.hide();showBtn.show();});buildCalendar = function() {var curDate = _this.data.curDate,selectDate = _this.data.selectDate.length ? _this.data.selectDate : curDate,srcid = 6018,tableBox = _this.find('.op-calendar-new-table-box'),rightBox = _this.find('.op-calendar-new-right')[0],dropDownBox = _this.find('.op-calendar-new-selec{%*i*%}t-box')[0],backTodayBtn = _this.find('.op-calendar-new-backtoday'),holidayTip = _this.find('.op-calendar-new-holidaytip')[0],prevMonth = _this.find('.op-calendar-new-prev-month'),nextMonth = _this.find('.op-calendar-new-next-month'),container = _this.find('.op-calendar-new'),holidayStyle = 'op-calendar-new-holidaystyle';A.use( 'dropdown21', function() {A.use( 'lunar', function() {var lunar = A.ui.lunar,ensureDateStr,Calendar,dataCache,getDateInfo,format,setHolidayStyle;format = function( str, ob{%*i*%}j ) {return str.replace( /#{([^}]+)}/g, function( match, ret ) {return obj[ ret ] || '';});};setHolidayStyle = function( flag ) {container.toggleClass( holidayStyle, !!flag );};ensureDateStr = function( str ) {return str.split( /-0?/ ).join( '-' );};getDateInfo = function( date ) {var ret;if ( typeof date === 'string' ) {ret = date.split( /-0?/ );date = new Date( ret[0], ret[1] - 1, ret[2] );} else {ret = [ date.getFullYear(), date.getMonth() + 1, date.getDate() ];}return {year: ret[0],month: re{%*i*%}t[1],date: ret[2],yearMonth: ret.slice( 0, 2 ).join( '-' ),dateStr: ret.join( '-' ),dateStrZero: [ ret[0], ( '0' + ret[1] ).slice( -2 ), ( '0' + ret[2] ).slice( -2 ) ].join( '-' ),Date: date}};selectDate = getDateInfo( selectDate );dataCache = {set: function( data, year, yearMonth ) {var arr = function( obj ) {return obj || [];};this.setHoliday( arr( data.holidaylist ) , year );this.setAlmanac( arr( data.almanac ), yearMonth );this.setHolidayDateList( arr( data.holiday ), yearMonth );this.setMod{%*i*%}( arr( data.day ), yearMonth );},_holiday: {},getHoliday: function( year ) {return this._holiday[ year ];},setHoliday: function( dataList, year ) {var ret = {}, i, l, tem;if ( this._holiday[ year ] ) {return;}for ( i = 0, l = dataList.length; i < l; i++ ) {ret[ dataList[i].name ] = {};}this._holiday[ year ] = ret;},_holidayDateList: {},_festival: {},setHolidayDateList: function( holidayList, yearMonth ) {var ret = {},year = yearMonth.split('-')[0],tem, i, j, k, l, holidayObj, festivalObj;if ( th{%*i*%}is._holidayDateList[ yearMonth ] ) {return;}if ( !holidayList.length && holidayList.festival ) {holidayList = [ holidayList ];}!this._holiday[ year ] && ( this._holiday[ year ] = {} );!this._festival[ year ] && ( this._festival[ year ] = {} );for ( i = 0, l = holidayList.length; i < l; i++ ) {tem = holidayList[ i ];holidayObj = this._holiday[ year ][ tem.name ] || {};if ( getDateInfo( tem.festival ).year == year ) {$.extend( holidayObj, tem );this._festival[ year ][ tem.festival ] = tem.name;}te{%*i*%}m = tem.list;for ( j = 0, k = tem.length; j < k; j++ ) {ret[ tem[ j ].date ] = tem[ j ].status;tem[ j ] = getDateInfo( tem[ j ].date ).dateStrZero;}holidayObj.startday = ensureDateStr( tem.sort()[0] );}this._holidayDateList[ yearMonth ] = ret;},getHolidayDateList: function( yearMonth ) {return this._holidayDateList[ yearMonth ];},getFestival: function( year ) {return this._festival[ year ];},_almanac: {},getAlmanac: function( yearMonth ) {return this._almanac[ yearMonth ];},setAlmanac: function({%*i*%} dataList, yearMonth ) {if ( this._almanac[ yearMonth ] ) {return;}var list = this._almanac[ yearMonth ] = {},i,l;for ( i = 0, l = dataList.length; i < l; i++ ) {list[ ensureDateStr( dataList[i].date ) ] = {suit: dataList[i].suit.replace(/\.$/,'').split('.').slice( 0, 15 ),avoid: dataList[i].avoid.replace(/\.$/,'').split('.').slice( 0, 15 )}}},_mod: {},setMod: function( modList ) {var mod = this._mod, i, l;for ( i = 0, l = modList.length; i < l; i++ ) {mod[ modList[ i ].date ] = modList[ i ]; }}{%*i*%},getMod: function() {return this._mod;},getData: function( yearMonth, callback ) {if ( this._almanac[ yearMonth ] ) {callback.call( this );} else {yearMonth = yearMonth.split( '-' );this.ajax( yearMonth[0] + '年' + yearMonth[1] + '月', callback, function() {return yearMonth.join( '-' );});}},getHolidayData: function( year, name, callback ) {var holiday = this.getHoliday( year );if ( holiday && holiday[ name ].festival ) {callback.call( this );} else {this.ajax( year + '年' + name, callback, functio{%*i*%}n( data ) {var holiday = data.holiday, i, l;if ( holiday && !holiday.length ) {holiday = [ holiday ];}for ( i = 0, l = holiday.length; i < l; i++ ) {if ( holiday[ i ].name == name ) {return getDateInfo( holiday[ i ].festival ).yearMonth;}}});}},ajax: function( query, callback, fn ) {var self = this;_this.ajax( query, srcid, {success: function( data ) {var yearMonth;data = data[0] || {};yearMonth = fn( data );if ( !yearMonth ) {return;}self.set( data, yearMonth.split('-')[0], yearMonth );callback{%*i*%}.call( self );}});}};Calendar = function( curDate, container, holidayTip) {var date,month,year,RESTClass = 'op-calendar-new-table-rest',WORKClass = 'op-calendar-new-table-work',WEEKENDClass = 'op-calendar-new-table-weekend',FESTIVALClass = 'op-calendar-new-table-festival',TODAYClass = 'op-calendar-new-table-today',OTHERMONTHClass = 'op-calendar-new-table-other-month',SELECTEDClass = 'op-calendar-new-table-selected',TODAYBORDERClass = 'op-calendar-new-table-border',buildTable,countDate,setCurDate{%*i*%},showLunar,selectedObj,setDate,monthChangeEvent = function() {},selectClass,cutWord,toggleHolidayTip,weekWord = '<tr>{一}{二}{三}{四}{五}{!六}{!日}</tr>',oneDay = 1000 * 24 * 60 * 60;weekWord = weekWord.replace(/\{\!?|\}/g, function( match ) {return match == '{' ? '<th>' : ( match == '{!' ? '<th class="' + WEEKENDClass + '">' : '</th>' );});cutWord = function( str, len) {var count = i = 0, code;while( str.charCodeAt( i ) ) {code = str.charCodeAt( i ) > 255 ? 2 : 1;if ( (code + count) > len ) {return st{%*i*%}r.slice( 0, --i ) + '...';}count += code;i ++;}return str.slice( 0, i );};setCurDate = function( dateObj ) {year = dateObj.year;month = dateObj.month;date = dateObj.date;};curDate = ensureDateStr( curDate );showLunar = function( dateInfo ) {var date = dateInfo.Date,lunarInfo = lunar( date ),buildAlmanacInfo,mod = dataCache.getMod()[ dateInfo.dateStr ] || {},almanacInfo = dataCache.getAlmanac( dateInfo.yearMonth ) || {},info = almanacInfo[ dateInfo.dateStr ] || {},almanacBox,suit = info.suit || [{%*i*%}],avoid = info.avoid || [],tpl = '<p class="op-calendar-new-right-date">#{date}</p>\<p class="op-calendar-new-right-day">#{day}</p>\<p class="op-calendar-new-right-lunar c-gap-top-small">\<span>#{lunarMonth}</span><span>#{lunarYear}</span><span>#{lunarDate}</span>\</p>\<div class="op-calendar-new-right-almanacbox">\<p class="op-calendar-new-right-almanac c-clearfix">\<span class="op-calendar-new-right-suit"><i>宜</i>#{suit}</span>\<span class="op-calendar-new-right-avoid"><i>忌</i>#{avoid}</span>\{%*i*%}</p>\<p class="op-calendar-hover-almanac">\<span class="op-calendar-almanac-arrow">◆</span>\<span class="op-calendar-hover-suit"><i>宜</i>#{suitAll}</span>\<span class="op-calendar-hover-avoid c-gap-top"><i>忌</i>#{avoidAll}</span>\</p>\</div>';buildAlmanacInfo = function( arr, length ) {return arr && arr.length ? arr.slice( 0, length ).join('<br />') : '';};rightBox.innerHTML = format( tpl, {date: dateInfo.dateStrZero + ' 星期' + lunarInfo.cnDay,day: dateInfo.date,lunarMonth: mod.lunarmonth || ( lu{%*i*%}narInfo.lMonth.replace( '十二', '腊' ) + '月' + lunarInfo.lDate ),lunarYear: mod.lunaryear || ( lunarInfo.gzYear + '年 【' + lunarInfo.animal + '年】' ),lunarDate: mod.lunardate || ( lunarInfo.gzMonth + '月 ' + lunarInfo.gzDate + '日' ),suit: buildAlmanacInfo( suit, 5 ),avoid: buildAlmanacInfo( avoid, 5 ),suitAll: suit.join('、'),avoidAll: avoid.join('、')});if ( suit.length + avoid.length > 0 ) {almanacBox = _this.find('.op-calendar-new-right-almanacbox');almanacBox.hover(function() {var self = this;clearT{%*i*%}imeout( timer1 );timer1 = setTimeout(function() {almanacBox.addClass( 'op-calendar-new-right-hover' );}, 300 );},function() {var self = this;clearTimeout( timer1 );timer1 = setTimeout(function() {almanacBox.removeClass( 'op-calendar-new-right-hover' );}, 100 );});}};buildTable = function( startDate, endDate, selectedDate ) {var ret = [],holidayList = dataCache.getHolidayDateList( getDateInfo( selectedDate ).yearMonth ),modList = dataCache.getMod(),flag = 1,tableClass = '',mod,classname,dateObj,a{%*i*%}lmanac,festival,rest,tdTpl,tableWord,cutTableWord;if ( ( endDate - startDate ) / oneDay < 28 ) {endDate = new Date( endDate.getTime() + oneDay * 7 );} tdTpl = '<td>\<div class="op-calendar-new-relative">\<a href="javascript:;" #{title} data-click="{fm:\'beha\'}" hidefocus="true" class="#{classname}" date="#{date}">\#{rest}\<span class="op-calendar-new-daynumber">#{day}</span>\<span class="op-calendar-new-table-almanac">#{almanac}</span>\</a>\</div>\</td>';while ( startDate <= endDate ) {if ( fla{%*i*%}g > 42 ) {break;}dateObj = getDateInfo( startDate );classname = [];rest = '';almanac = lunar( startDate );festival = almanac.festival();mod = modList[ dateObj.dateStr ] || {};if ( holidayList[ dateObj.dateStr ] ) {rest = '<span class="op-calendar-new-table-holiday-sign">#{text}</span>';if ( holidayList[ dateObj.dateStr ] == '1' ) {classname.push( RESTClass );rest = format( rest, { text: '休' } );} else if ( holidayList[ dateObj.dateStr ] == '2' ) {classname.push( WORKClass );rest = format( rest, {%*i*%}{ text: '班' } );} else {classname.push( RESTClass );rest = '';}}if ( ( flag + 1 ) % 7 == 0 || flag % 7 == 0 ) {classname.push( WEEKENDClass );}if ( festival.length || almanac.term || ( mod.red && mod.red == '1' ) ) {classname.push( FESTIVALClass );}if ( dateObj.dateStr == curDate ) {if ( holidayList[ dateObj.dateStr ] ) {classname.push( TODAYBORDERClass );} else {classname.push( TODAYClass );}}if ( dateObj.month != month ) {classname.push( OTHERMONTHClass );}if ( dateObj.dateStr == selectedDate {%*i*%}) {classname.push( SELECTEDClass );}flag % 7 == 1 && ret.push( '<tr>' );tableWord = mod.tableword || ( festival.length ? festival[ 0 ].desc.replace( /国际|世界/, '' ) : ( almanac.term || almanac.lDate ) );cutTableWord = cutWord( tableWord, 8 );ret.push( format( tdTpl, {classname: classname.join( ' ' ),day: dateObj.date,almanac: cutTableWord,date: dateObj.dateStr,rest: rest,title: cutTableWord == tableWord ? '' : (' title="' + tableWord + '"')}));flag % 7 == 0 && ret.push( '</tr>' );startDate = new D{%*i*%}ate( oneDay + startDate.getTime() );flag ++;}if ( flag > 36 ) {tableClass = ' op-calendar-new-table-six';}return '<table class="op-calendar-new-table' + tableClass +'">' + weekWord + ret.join('') + '</table>';};countDate = function( date, holiday ) {var first, last, i, l;first = new Date( date.getFullYear(), date.getMonth(), 1 );last = new Date( date.getFullYear(), date.getMonth() + 1, 1 );last = new Date( last.getTime() - oneDay );if ( holiday ) {first = getDateInfo( holiday ).Date;last = new D{%*i*%}ate( first.getTime() + oneDay * 28 );}return {startDate: new Date( first.getTime() - oneDay * ( (first.getDay() == 0 ? 7 : first.getDay()) - 1 ) ),endDate: new Date( last.getTime() + oneDay * ( 7 - ( last.getDay() == 0 ? 7 : last.getDay() ) ) )}};setDate = function( dateStr, holiday) {var dateObj = getDateInfo( dateStr ),oldDate = getDateInfo( [ year, month, date ].join('-') ),dater,festival,festivalName;dataCache.getData( dateObj.yearMonth, function() {festival = dataCache.getFestival( dateObj.{%*i*%}year );festivalName = festival[ dateObj.dateStr ] || null;if ( dateObj.year != year || dateObj.month != month ) {dater = countDate( dateObj.Date, holiday );setCurDate( dateObj );container.html( buildTable( dater.startDate, dater.endDate, dateStr ) );selectedObj = _this.find( '.' + SELECTEDClass );monthChangeEvent( dateObj, oldDate, holiday );} setCurDate( dateObj );setHolidayStyle( festivalName );showLunar( dateObj );toggleHolidayTip( dataCache.getHoliday( year )[ festivalName ] );});};toggleHol{%*i*%}idayTip = function( obj ) {var tpl;if ( !obj || ( !obj.desc && !obj.rest ) ) {holidayTip.style.display = 'none';} else {tpl = '<span class="op-calendar-new-holidaytip-icon">○<i>!</i></span>\<p>#{desc}</p>\<p>#{rest}</p>\</span>';holidayTip.style.display = 'block';holidayTip.innerHTML = format( tpl, {desc: obj.desc,rest: obj.rest});}};container.delegate( 'a', 'click', function( e ) {e.preventDefault();selectClass( this );setDate( this.getAttribute( 'date' ) );});selectClass = function( obj ) {sel{%*i*%}ectedObj && selectedObj.removeClass( SELECTEDClass );obj && $( obj ).addClass( SELECTEDClass );selectedObj = _this.find( '.' + SELECTEDClass );};return {getDate: function() {return getDateInfo( [ year, month, date ].join( '-' ) );},nextMonth: function() {var nextMonthDaynum,curDate = this.getDate(),nnMonth,nDays,newDate,date;nnMonth = new Date( curDate.year, parseInt( curDate.month, 10 ) + 1, 1 );nDays = new Date( nnMonth - oneDay ).getDate();date = curDate.date < nDays ? curDate.date : nDays;ne{%*i*%}wDate = getDateInfo( new Date( curDate.year, curDate.month, date ) );this.setDate( newDate.dateStr );},prevMonth: function() {var nDays,curDate = this.getDate(),newDate,date;nDays = new Date( ( new Date( curDate.year, curDate.month - 1, 1 ) - oneDay ) ).getDate();newDate = getDateInfo( new Date( curDate.year, curDate.month - 2, curDate.date < nDays ? curDate.date : nDays ) );this.setDate( newDate.dateStr );},set: function( name, value ) {var curDate = this.getDate(),newDate;curDate[ name ] = val{%*i*%}ue;newDate = getDateInfo( [ curDate.year, curDate.month, curDate.date ].join( '-' ) );if ( newDate.Date.getDate() != newDate.date ) {newDate = { dateStr: newDate.yearMonth + '-1' };}setDate( newDate.dateStr );return this;},setDate: function( dateStr  ) {setDate( dateStr );return this;},setHoliday: function( name, year ) {var self = this;dataCache.getHolidayData( year, name, function() {var holiday = this.getHoliday( year )[ name ];if ( !holiday ) {self.setHoliday( name, getDateInfo( curDate ).ye{%*i*%}ar );return;}month = null;setDate( ensureDateStr( holiday.festival ), ensureDateStr( holiday.startday ), true );toggleHolidayTip( holiday );});},backToday: function() {var evt = window.event || {};evt.returnValue = false;month = null;this.setDate( curDate );return this;},addMonthChangeEvent: function( fn, newDate, oldDate ) {var self = this;if ( typeof fn == 'function' ) {monthChangeEvent = function( newDate, oldDate, holiday ) {fn.call( self, newDate, oldDate, holiday );};}return this;}};};(fun{%*i*%}ction() {var calendar = Calendar( curDate, tableBox, holidayTip ),curYear = getDateInfo( curDate ).year;dropDown = A.ui.dropdown21;var initDropDown,buildSelectHtml,yearOnOpen,isFirstOpen,yearBox,yearMenu,defaultHolidaySelect = { value: 'default', text: '假期安排', selected: 1},resetHoliday,holidayChange,yearSelect,monthSelect,holidaySelect;calendar.setDate( selectDate.dateStr );initDropDown = function( data, defaultValue, box, onchange, onopen ) {var i, l, cache = [];if ( Object.prototype.toString.c{%*i*%}all( data ) != '[object Array]' ) {for ( i = data.min; i <= data.max; i ++ ) {cache.push( {value: i,text: i + data.unit,selected: i == defaultValue});}} else {cache = data;}return dropDown( cache, {appendTo: _this.find( '.' + box )[0],number: 12,onchange: onchange,onopen: onopen});};yearOnOpen = function( obj ) {var index, menuInner;if ( isFirstOpen ) {return;}isFirstOpen = true;index = obj.index;if ( index == 0 ) {return;}menuInner = $( '.c-dropdown2-menu-inner', yearBox )[0];menuInner.scrollTo{%*i*%}p = 0;timer2 = setInterval(function() {var scrollBar;if ( menuInner.scrollTop == 0 || !$( menuInner ).hasClass( 'opui-scroll-ctrl-content' ) ) {return;}clearInterval( timer2 );scrollBar = $( '.opui-scroll-ctrl-scroll', menuInner.parentNode )[ 0 ];timer2 = setInterval(function() {if ( scrollBar.style.cssText == '' ) {return;}menuInner.scrollTop = index * 26;clearInterval( timer2 );}, 10);}, 10);};yearSelect = initDropDown( {min: 1900,max: 2050,unit: '年'},selectDate.year, 'op-calendar-new-year-box{%*i*%}', function( obj ) {calendar.set( 'year', obj.item.value );},yearOnOpen);yearBox = _this.find( '.op-calendar-new-year-box' )[0];yearMenu = $( '.c-dropdown2-menu', yearBox )[0];yearMenu.style.left = '-9999px';yearSelect.open();yearSelect.close();yearMenu.style.left = '0';monthSelect = initDropDown( {min: 1,max: 12,unit: '月' }, selectDate.month, 'op-calendar-new-month-box',function( obj ) {calendar.set( 'month', obj.item.value );});holidayChange = function( obj ) {var value = obj.item.value;if ( v{%*i*%}alue == 'default' ) {return;}calendar.setHoliday( value, yearSelect.getValue() );};holidaySelect = initDropDown( [ defaultHolidaySelect ], 'default', 'op-calendar-new-holiday-box',holidayChange);resetHoliday = function( holidayList ) {holidaySelect.removeAll();holidaySelect.add( defaultHolidaySelect );for ( var name in holidayList ) {if ( holidayList.hasOwnProperty( name ) ) {holidaySelect.add( { value: name, text: name } );}}};dropDownBox.style.visibility = 'visible';calendar.addMonthChangeEven{%*i*%}t(function( newDate, oldDate, holiday ) {var date = this.getDate(),yearLength = yearSelect.getLength();monthSelect.setIndex( date.month - 1 );if ( date.year - 1900 > ( yearLength - 1 ) ) {yearSelect.add( { value: yearLength + 1900, text: yearLength + 1900 + '年' } );}yearSelect.setIndex( date.year - 1900 );if ( !holiday ) {holidaySelect.setIndex( 0 );}if ( newDate.year != oldDate.year ) {resetHoliday( dataCache.getHoliday( newDate.year ) );}});backTodayBtn.click(function() {calendar.backToday(); {%*i*%}});nextMonth.click(function() {calendar.nextMonth();});prevMonth.click(function() {calendar.prevMonth();});})();});});};this.dispose = function(){clearTimeout( timer1 );clearInterval( timer2 );dropDown&&dropDown.dispose&&dropDown.dispose();};});</script>{%/block%}