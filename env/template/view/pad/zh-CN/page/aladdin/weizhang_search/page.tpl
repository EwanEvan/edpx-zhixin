{%extends 'c_base.tpl'%} {%block name="data_modifier"%}{%$extData.feData.hasShowURLGap = true%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='dropdown2'%}{%fe_fn_c_css css='input'%}{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='table'%}.op-weizhang{visibility:hidden;position:relative;z-index:3}.op-weizhang-provinceselect,.op-weizhang-cityselect,.op-weizhang-citylabel{float:left}.op-weizhang-provinceselect{width:85px}.op-weizhang-cityselect{width:133px}.op-weizhang-citylabel{line-height:2}.op-weizhang-searchbox{position:relative;zoom:1}.op-weizhang-searchbox table{border-spacing:0;border-collapse:collapse}.op-weizhang-searchbox td{height:30px;padding:0 0 10px}.op-weizhang-searchbox .op-weizhang-nopadding{padding:0}.op-weizhang-{%*i*%}searchbox .op-weizhang-autoheight{height:auto}.op-weizhang-shortname{width:57px;float:left;height:30px}.op-weizhang-searchbox .op-weizhang-carid{float:left;width:141px}.op-weizhang-searchbox .op-weizhang-engineno,.op-weizhang-searchbox .op-weizhang-classno,.op-weizhang-searchbox .op-weizhang-registno{float:left;width:210px}.op-weizhang-searchbox .c-dropdown2-btn-icon{background-color:transparent}.op-weizhang-resulttable td,.op-weizhang-resulttable th{text-align:center}.op-weizhang-result{display{%*i*%}:none}.op-weizhang-errortip{display:inline-block;color:#f00;float:left;padding:3px 0 0 5px}.op-weizhang-loading{position:absolute;left:0;top:0;display:none;z-index:203}.op-weizhang-loadingbg{background:#fff;filter:alpha(opacity=75);opacity:.75;height:100%;width:100%}.op-weizhang-hasuserdata .op-weizhang-searchtable{display:none}.op-weizhang-searchtable{width:100%}.op-weizhang-searchtable input::-ms-clear{display:none}.op-weizhang-loadingtext{position:absolute;top:50%;left:190px;margin-top:-12px;{%*i*%}background:url(http://www.baidu.com/aladdin/img/weizhang_search/loading.gif) no-repeat;padding:2px 0 2px 28px;white-space:nowrap;color:#999}.op-weizhang-tindex{width:37px}.op-weizhang-tdate{width:85px}.op-weizhang-tarea{width:160px}.op-weizhang-tact{width:130px}.op-weizhang-tmoney{width:40px;white-space:nowrap}.op-weizhang-tfen{width:40px;white-space:nowrap}.op-weizhang-scoretip{position:absolute;top:-65px;right:0;color:#f00}.op-weizhang-errormsg{padding:25px 0 35px;text-align:center;font-size:1{%*i*%}.08em}.op-weizhang-result th,.op-weizhang-result td{padding-left:0}.op-weizhang-table-only td{border-bottom:0}.op-weizhang-label{width:80px}.op-weizhang-more{height:32px;line-height:32px;text-align:center}.op-weizhang-more-hide{display:none}.op-weizhang-backbtn i.c-icon,.op-weizhang-tip,.op-weizhang-phone-nologin i,.op-weizhang-phone-logintip .op-weizhang-phone-phoneicon,.op-weizhang-hphm,.op-weizhang-addmsg i,.op-weizhang-cars-remove,.op-weizhang-editbtn i{background-image:url('http://www.baidu{%*i*%}.com/aladdin/img/weizhang_search/bg.png');background-repeat:no-repeat;background-size:initial}.op-weizhang-backbtn i.c-icon{background-position:left 3px}.op-weizhang-tip{background-position:0 -20px;display:inline-block;width:20px;height:25px;position:absolute;left:198px;top:2px}.op-weizhang-tipcon{position:relative;display:inline-block;float:left}.op-weizhang-phone-nologin i{background-position:-40px 0}.op-weizhang-phone-logintip .op-weizhang-phone-phoneicon{height:16px;background-position:-40px{%*i*%} -80px}.op-weizhang-hphm{background-position:center bottom;width:100px;height:24px;color:#fff;text-align:center;line-height:24px;margin:0 auto}.op-weizhang-drivercard{display:none;width:247px;height:150px;position:absolute;right:0;bottom:0;z-index:1;background:url(http://www.baidu.com/aladdin/img/weizhang_search/card.png) no-repeat;background-size:cover}.op-weizhang-searchbox .op-weizhang-cencelAdd{display:none}.op-weizhang-hasuserdata .op-weizhang-addmsg,.op-weizhang-hasuserdata .op-weizhang-to{%*i*%}olbox{display:block}.op-weizhang-hasuserdata .op-weizhang-cencelAdd{display:inline-block}.op-weizhang-hasuserdata .op-weizhang-cars-list{display:table;*display:block}.op-weizhang-addmsg{text-align:center;cursor:pointer;display:none}.op-weizhang-addmsg i{background-position:0 -45px;width:16px;height:16px;position:relative;top:1px}.op-weizhang-cars-remove{display:none;background-position:0 -80px;position:relative;top:-1px;vertical-align:middle;width:14px;height:14px}.op-weizhang-cars-remove:hover{{%*i*%}background-position:-15px -80px}.op-weizhang-phonebox{border-top:1px solid #e5e5e5;background:#fafafa;box-shadow:0 -2px 0 #f8f8f8}.op-weizhang-phonebox i{_vertical-align:text-top}.op-weizhang-phone-savesuccess{text-align:center;background:#fdf6dd;height:28px;padding-top:8px;_height:26px;_padding-top:10px}.op-weizhang-phone-phonesuccess{height:65px;padding-top:45px;text-align:center}.op-weizhang-phone-nologin,.op-weizhang-phone-logintip{height:14px;line-height:1;padding:11px 0 12px 9px}.op-weizha{%*i*%}ng-phone-form{padding:0 0 8px 30px}.op-weizhang-phone-disnone{display:none}.op-weizhang-cars-list{display:none}.op-weizhang-cars-list td,.op-weizhang-cars-list th{text-align:center;padding-left:0}.op-weizhang-cars-list td{padding-top:0;padding-bottom:0;height:44px}.op-weizhang-cars-list span{display:block}.op-weizhang-toolbox{height:30px;display:none}.op-weizhang-editbtn{float:right;color:#999;text-decoration:none;margin:3px 0}.op-weizhang-editbtn i{background-position:0 -65px;width:14px;height:{%*i*%}14px}.op-weizhang-editbtn:hover{color:#0000d0}.op-weizhang-editbtn:hover i{background-position:-15px -65px}a.op-weizhang-editcancel{float:right;display:none}.op-weizhang-editstatus .op-weizhang-editcancel,.op-weizhang-editstatus .op-weizhang-cars-remove{display:inline-block}.op-weizhang-editstatus .op-weizhang-editbtn{display:none}.op-weizhang-cars-list .op-weizhang-carlist-last{width:125px;text-align:right}.op-weizhang-onadd .op-weizhang-searchtable{display:block}.op-weizhang-onadd .op-weizhang{%*i*%}-addmsg{display:none}.op-weizhang-weiche,.op-weizhang-weichecode i,.op-weizhang-weichecode-img{background:url('http://www.baidu.com/aladdin/img/weizhang_search/weiche.png') no-repeat}.op-weizhang-hasuserdata .op-weizhang-weiche{display:none}.op-weizhang-onadd .op-weizhang-weiche{display:block}.op-weizhang-weiche{position:absolute;right:0;bottom:0;height:20px}.op-weizhang-weiche a{text-decoration:none;color:#999!important;padding-left:45px}.op-weizhang-weiche a:hover{text-decoration:underline}.op{%*i*%}-weizhang-weichecode{margin-top:8px;line-height:1;position:relative;z-index:1}.op-weizhang-weiche-bigcode{position:absolute;left:0;top:20px;padding:8px;border:2px solid #e3e3e3;background:#fff;display:none}.op-weizhang-weichecode-img{width:90px;height:90px;background-position:0 -40px}.op-weizhang-weichecode i{display:inline-block;height:14px;width:14px;background-position:0 -20px;vertical-align:bottom;cursor:pointer}.op-weizhang-weiche-arrow{width:0;height:0;font-size:0;line-height:0;display:blo{%*i*%}ck;position:absolute;top:-16px;left:45px}.op-weizhang-weiche-arrow em,.op-weizhang-weiche-arrow ins{width:0;height:0;font-size:0;line-height:0;display:block;position:absolute;border:8px solid #000;border-style:dashed dashed solid dashed}.op-weizhang-weiche-arrow em{border-color:transparent transparent #d8d8d8 transparent}.op-weizhang-weiche-arrow ins{border-color:transparent transparent #fff transparent;top:2px}</style><div class="c-border op-weizhang"> <div class="op-weizhang-searchbox {%if $queryInfo.trafficData%}op-weizhang-hasuserdata{%/if%}"> <div class="op-weizhang-toolbox"> <a href="javascript:;" data-click="{fm:'beha'}" class="op-weizhang-editbtn"><i class="c-icon"></i>编辑</a> <a href="javascript:;" data-click="{fm:'beha'}"  class="c-btn c-btn-primary op-weizhang-editcancel OP_LOG_BTN">返回</a> <b>您好，以下为您的车辆信息</b> </div> <table class="c-table op-weizhang-cars-list c-gap-bottom"> <tr> <th>车牌号码</th> <th>发动机/车架号</th> <th>所在城市</th> <th></th> </tr> {%foreach $queryInfo.trafficData as $item%} <tr car-data='{"city":"{%$item.city|escape:"html"%}","cityname":"{%$item.cityname|escape:"html"%}","hphm":"{%$item.hphm|escape:"html"%}","engineno":"{%$item.engineno|escape:"html"%}","classno":"{%$item.classno|escape:"html"%}","registno":"{%$item.registno|escape:"html"%}"}'> <td><div class="op-weizhang-hphm">{%preg_replace('/(\w{5})$/',' $1',$item.hphm)%}</div></td> <td> {%if $item.engineno%} <span>{%$item.engineno|escape:'html'%}</span> {%/if%} {%if $item.classno%} <span>{%$item.classno|escape:'html'%}</span> {%/if%} </td> <td> {%$item.cityname|escape:'html'%} </td> <td class="op-weizhang-carlist-last"> <a href="javascript:;" class="op-weizhang-cars-search" data-click="{fm:'beha'}">查看违章详情</a> <a href="javascript:;" class="op-weizhang-cars-remove c-icon c-gap-left-small OP_LOG_BTN" hidefocus="true" data-click="{fm:'beha'}"></a> </td> </tr> {%/foreach%} </table> <div class="op-weizhang-addmsg"><i class="c-icon c-gap-icon-right-small"></i>继续添加车辆信息</div> <div class="op-weizhang-drivercard"></div> <table class="op-weizhang-searchtable"> <tr> <td class="op-weizhang-label">查询城市：</td> <td> <div class="op-weizhang-provinceselect c-gap-right"> <div class="c-dropdown2 op-weizhang-province"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tplData.province[0].name|escape:'html'%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <ul class="c-dropdown2-menubox"> <li class="c-dropdown2-option" data-value="{%$tplData.province[0].name|escape:'html'%}">{%$tplData.province[0].name|escape:'html'%}</li> </ul> </div> </div> </div> </div> <div class="op-weizhang-cityselect"> <div class="c-dropdown2 op-weizhang-city"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tplData.city[0].name|escape:'html'%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <ul class="c-dropdown2-menubox"> <li class="c-dropdown2-option" data-value="{%$tplData.city[0].name|escape:'html'%}">{%$tplData.city[0].name|escape:'html'%}</li> </ul> </div> </div> </div> </div> </td> </tr> <tr> <td class="op-weizhang-label">车牌号码：</td> <td> <div class="op-weizhang-shortname c-gap-right"> <div class="c-dropdown2 op-weizhang-abbreviate"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tplData.province[0].abbreviate|escape:'html'%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <ul class="c-dropdown2-menubox"> <li class="c-dropdown2-option" data-value="{%$tplData.province[0].abbreviate|escape:'html'%}">{%$tplData.province[0].abbreviate|escape:'html'%}</li> </ul> </div> </div> </div> </div> <input autocomplete="off" type="text" class="op-weizhang-carid c-input" maxlength="6" /> <span class="op-weizhang-errortip"></span> </td> </tr> <tr class="op-weizhang-engine" {%if !$tplData.engine[0].is_need%}style="display:none"{%/if%}> <td class="op-weizhang-label">发动机号：</td> <td> <span class="op-weizhang-tipcon"> <input autocomplete="off" type="text" class="op-weizhang-engineno c-input" maxlength="16" /> <i class="op-weizhang-tip"></i> </span> <span class="op-weizhang-errortip"></span> </td> </tr> <tr class="op-weizhang-class" {%if !$tplData.class[0].is_need%}style="display:none"{%/if%}> <td class="op-weizhang-label">车架号：</td> <td> <span class="op-weizhang-tipcon"> <input autocomplete="off" type="text" class="op-weizhang-classno c-input" /> <i class="op-weizhang-tip"></i> </span> <span class="op-weizhang-errortip"></span> </td> </tr> <tr class="op-weizhang-regist" {%if !$tplData.regist[0].is_need%}style="display:none"{%/if%}> <td class="op-weizhang-label">登记证书号：</td> <td> <input autocomplete="off" type="text" class="op-weizhang-registno c-input" /> <span class="op-weizhang-errortip"></span> </td> </tr> <tr> <td class="op-weizhang-autoheight"></td> <td class="op-weizhang-nopadding"> <a href="javascript:;" data-click="{fm:'beha'}" class="c-btn c-btn-primary op-weizhang-submit OP_LOG_BTN">结果查询</a> <a href="javascript:;" data-click="{fm:'beha'}" class="c-btn c-gap-left-small op-weizhang-cencelAdd OP_LOG_BTN">取消填写</a> </t{%*i*%}d> </tr> </table> <div class="op-weizhang-weiche"><a href="http://www.weiche.me" target="_blank">数据来自微车</a></div> </div> <div class="op-weizhang-loading"> <div class="op-weizhang-loadingbg"></div> <div class="op-weizhang-loadingtext">正在加载中，请稍候...</div> </div> <div class="op-weizhang-result"> <div class="op-weizhang-msg"> <a href="javascript:;" data-click="{fm:'beha'}" class="c-btn c-btn-primary op-weizhang-backbtn OP_LOG_BTN"><i class="c-icon"></i>继续查询</a> </div> <div class="op-weizhang-resultta{%*i*%}ble c-gap-top"></div> <div class="op-weizhang-phonebox"> <div class="op-weizhang-phone-savesuccess op-weizhang-phone-disnone"><i class="c-icon c-icon-right-large c-gap-icon-right-small"></i>保存成功！您的车辆信息将按照列表的形式展现</div> <div class="op-weizhang-phone-phonesuccess op-weizhang-phone-disnone"><i class="c-icon c-icon-right-large c-gap-icon-right-small"></i>订制成功！当您有新的违章时，我们会为您发送短信提醒</div> <div class="op-weizhang-phone-nologin op-weizhang-phone-disnone"><i class="c-icon c-gap-icon-right-small"></i>登录后可以<b{%*i*%}>保存查询信息</b>和<b>订阅免费短信提醒</b>，<a href="javascript:;" data-click="{fm:'beha'}" class="op-weizhang-phone-nologinbtn">请点此登录</a></div> <div class="op-weizhang-phone-islogin op-weizhang-phone-disnone"> <div class="op-weizhang-phone-logintip"><i class="c-icon c-gap-icon-right-small op-weizhang-phone-phoneicon"></i>推荐使用违章信息自动提醒功能：<a href="javascript:;" data-click="{fm:'beha'}" class="op-weizhang-phone-loginbtn">定制短信免费提醒<i class="c-icon c-icon-triangle-down c-gap-icon-left-small"></i></a></div> <div class{%*i*%}="op-weizhang-phone-form op-weizhang-phone-disnone"> </div> </div> </div> </div></div><div class="op-weizhang-weichecode c-gray"> <i class="c-gap-icon-right-small op-weizhang-weiche-icon"></i>扫描二维码安装微车APP，在手机订阅违章提醒 <div class="op-weizhang-weiche-bigcode"> <div class="op-weizhang-weiche-arrow"><em></em><ins></ins></div> <div class="op-weizhang-weichecode-img"></div> </div></div><script >
    A.setup({
        data: {%json_encode($tplData)%},
        hasData: {%if $queryInfo.trafficData%}true{%else%}false{%/if%}
    });
</script><script data-merge>A.setup(function() {var T = A.baidu,_this = this,data = _this.data.data,hasData = _this.data.hasData,provinceList,renderProvinceSelect,provinceSelect = _this.find( '.op-weizhang-province' )[0],citySelect = _this.find( '.op-weizhang-city' )[0],abbreviateSelect = _this.find( '.op-weizhang-abbreviate' )[0],engine = _this.find( '.op-weizhang-engine' )[0],weizhangClass = _this.find( '.op-weizhang-class' )[0],regist = _this.find( '.op-weizhang-regist' )[0],engineno = _this.{%*i*%}find( '.op-weizhang-engineno' )[0],classno = _this.find( '.op-weizhang-classno' )[0],registno = _this.find( '.op-weizhang-registno' )[0],carid = _this.find( '.op-weizhang-carid' )[0],queryBtn = _this.find( '.op-weizhang-submit' ),loading = _this.find( '.op-weizhang-loading' ),loadingText = _this.find( '.op-weizhang-loadingtext' ),searchBox = _this.find( '.op-weizhang-searchbox' ),resultTable = _this.find( '.op-weizhang-resulttable' ),resultBox = _this.find( '.op-weizhang-result' ),weizhangBox = {%*i*%}_this.find( '.op-weizhang' ),backBtn = _this.find( '.op-weizhang-backbtn' ),loginForm = _this.find( '.op-weizhang-phone-form' ),loginBtn = _this.find( '.op-weizhang-phone-loginbtn' ),arrow = $( 'i', loginBtn ),weicheCode = _this.find( '.op-weizhang-weiche-icon' ),bigCode = _this.find( '.op-weizhang-weiche-bigcode' ),addBtn = _this.find( '.op-weizhang-addmsg' ),cancelBtn = _this.find( '.op-weizhang-cencelAdd' ),carListTable = _this.find( '.op-weizhang-cars-list' ),pageChange = false,isLogin = !!b{%*i*%}ds.comm.user,smsObj,provinceStr = _this.data.data.province_list,exchangePro,codeList,timer, timerAni,timerCar,timerSMS,city,province, abbreviate,abbreviateList,storage,listScrollbar,N,input,focusBlur;codeList = {'1': '官网数据拥堵中，请稍后再试。','2': '官网数据拥堵中，请稍后再试。','3': '官网数据拥堵中，请返回重新查询。','4': '您输入的信息有误，请校验后重新查询。','5': '数据异常，请重新查询。','6': '您输入的信息有误，请校验后重新查询。','7': '官网数据拥堵中，请稍后再试。','629': '官网数据拥堵中，请稍后再试。' };weicheCode.hover(function() {bigCode.show();},function() {bigCode.hide();});abbreviateList =['京','津',{%*i*%}'冀','晋','蒙','辽','吉','黑','沪','苏','浙','皖','闽','赣','鲁','豫','鄂','湘','粤','桂','琼','渝','川','贵','云','藏','陕','甘','青','宁','新'];provinceList = {};exchangePro = function( dataStr ) {var list = dataStr.split(';');$.each( list, function( i, v ) {var province = v && v.split( '_' );if ( v.length ) {provinceList[ province[ 0 ] ] = province[ 1 ];}});};exchangePro( provinceStr );N = function( str ) {return Number( str );};focusBlur = function( obj ) {try {obj.focus();obj.blur();} catch( e ) {}};renderProvinceSelec{%*i*%}t = function() {var province = [],abbreviate = [],name,tpl = '<li class="c-dropdown2-option" data-value="#{value}" data-selected="#{select}">#{value}</li>';$.each( provinceList, function( i, v ) {province.push( $.format( tpl, { value: i, select: i == data.province[0].name ? 1 : '' } ) );});$.each( abbreviateList, function( i, v ) {abbreviate.push( $.format( tpl, { value: v, select: v == data.province[0].abbreviate ? 1 : '' } ));});$( '.c-dropdown2-menubox', provinceSelect ).html( province.join( {%*i*%}'' ) );$( '.c-dropdown2-menubox', abbreviateSelect ).html( abbreviate.join( '' ) );};input = {hasInit: false,init: function() {var code = [ N( data.engine[0].is_need ),data.engine[0].engineno,N( data['class'][0].is_need ),data['class'][0].classno,N( data.regist[0].is_need ),data.regist[0].registno ];if ( !this.hasInit ) {this.renderInput.apply( this, code );}carid.setAttribute( 'tip', '请输入您的车牌号码' );carid.setAttribute( 'tiplength', '6' );this.tipEvent();},tipEvent: function() {var tip = function({%*i*%} obj ) {var obj = $( obj ),errorObj = $( '.op-weizhang-errortip', obj.closest( 'td' ) );obj.blur(function() {if ( $.trim( this.value ) == '' ) {obj.css( 'color', '#666' );obj.val( obj.attr( 'tip' ) );}});obj.focus(function() {if ( $.trim( this.value ) == obj.attr( 'tip' ) ) {obj.val( '' );obj.css( 'color', '' );}errorObj.html( '' );});};$.each( [ engineno, classno, registno, carid ], function( i, v ) {tip( v );focusBlur( v );});},renderInput: function( needEngine, engineNum, needClass, classNum,{%*i*%} needRegist, registNum ) {var tips = [ '输入#{number}发动机号', '输入#{number}车架号', '输入#{number}登记证书号' ],boxes = [ engine, weizhangClass, regist ],inputs = [ engineno, classno, registno ],nums = [ engineNum, classNum, registNum ],needs = [ needEngine, needClass, needRegist ],tipsRule,dealInput,i;this.hasInit = true;tipsRule = function( index, number ) {return $.format( tips[ index ], { number : nums[ index ] == '0' ? '全部' : '后' + nums[ index ] + '位' } );};dealInput = function( index ) {if ( needs[ index{%*i*%} ] ) {boxes[ index ].style.display = '';inputs[ index ].setAttribute( 'isneed', 'true' );if ( inputs[ index ].getAttribute( 'tip' ) == inputs[ index ].value ) {inputs[ index].value = '';}inputs[ index ].setAttribute( 'tip', tipsRule( index, nums[ index ] ) );inputs[ index ].setAttribute( 'tiplength', nums[ index ] );} else {boxes[ index ].style.display = 'none';inputs[ index ].setAttribute( 'isneed', 'false' );inputs[ index ].value = '';}focusBlur( inputs[ index ] );};for ( i = 0; i < 3; i++ ) {{%*i*%} dealInput( i );}}};A.use( 'dropdown21', function() {A.use( 'localstorage', function() {var provinceChange, abbreviateChange, cityChange,isSelectAbbreviate, getCity, cityData = {}, clearInput,ajaxCount = 0,PROVINCE = 'op-weizhang-province',CITY = 'op-weizhang-city',ABBREVIATE = 'op-weizhang-abbreviate',CARID = 'op-weizhang-carid',ENGINEID = 'op-weizhang-engineid',CLASSID = 'op-weizhang-classid',REGISTID = 'op-weizhang-registid',save,restore,clearStorage,getValue,setValue,storageRendered,phone,ev{%*i*%}ent,carList,queryUrl = 'http://api.open.baidu.com/pae/traffic/api/query',carUrl = 'http://api.open.baidu.com/pae/traffic/data/record?ie=utf-8&oe=utf-8',query;renderProvinceSelect();clearInput = function() {$.each( [ carid, engineno, classno, registno ], function( i, v ) {v.value = '';focusBlur( v );});};timer = setTimeout(function(){if ( !storageRendered ) {clearInput();}},0);provinceChange = function( obj, callback ) {var value = obj.item.value;if ( !isSelectAbbreviate ) {abbreviate.setValue( p{%*i*%}rovinceList[ value ] );}getCity( value, callback );};abbreviateChange = function() {isSelectAbbreviate = true;this.onchange = null;};cityChange = function( obj ) {var text = obj.item.text,cityList = cityData[ province.getValue() ],curCity;if ( cityList && ( curCity = cityList[ text ] ) ) {input.renderInput( N( curCity.engine ), curCity.engineno, N( curCity['class'] ), curCity.classno,N( curCity.regist ), curCity.registno );}};getCity = function( province, callback ) {var record = ++ ajaxCount;_t{%*i*%}his.ajax( province, 12321, {success: function( data ) {if ( pageChange ) {return;}if ( record != ajaxCount ) {return;}var cityList = data[0].city;cityData[ province ] = {};city.removeAll();$.each( cityList, function( i, v ) {city.add( {value: v.name,text: v.name});cityData[ province ][ v.name ] = v;});if ( !callback ) {cityChange( { item: { text: cityList[0].name } } );} else {callback();}},error: function() {}});};province = A.ui.dropdown21( provinceSelect, { onchange: provinceChange } );abbrev{%*i*%}iate = A.ui.dropdown21( abbreviateSelect, { onchange: abbreviateChange } );city = A.ui.dropdown21( citySelect, { onchange: cityChange } );provinceChange( { item: { value: data.province[0].name } }, function() {city.setValue( data.city[0].name );});storage = A.ui.localstorage({fileName : 'op-weizhang-carmsg',expiresDay : 365});getValue = function() {var provinceName = province.getValue(),curCity = cityData[ provinceName ] && cityData[ provinceName ][ city.getValue() ];return {province: provinceNa{%*i*%}me,abbreviate: abbreviate.getValue(),city_name: city.getValue(),hphm: carid.value.toUpperCase(),engineval: engineno.value,classval: classno.value,registval: registno.value,city_code: curCity && curCity.code,isSave: 1,engineno: null,classno: null,registno: null,engine: null,'class': null,regist: null,time_used: curCity && curCity.time_used};};setValue = function( obj ) {province.setValue( obj.province );abbreviate.setValue( obj.abbreviate );city.setValue( obj.city_code );carid.value = obj.hphm ||{%*i*%} '';engineno.value = obj.engineval || '';classno.value = obj.classval || '';registno.value = obj.registval || '';};save = function() {var vals = getValue();$.extend( vals, cityData[ province.getValue() ][ city.getText() ] );storage.set( 'op-weizhang-msg', $.stringify( vals ) );};restore = function() {var vals = $.parseJSON( storage.get( 'op-weizhang-msg' ) || '{}' );if ( vals.isSave == 1 && vals.province in provinceList ) {input.renderInput( N( vals.engine ), vals.engineno,N( vals['class'] ), va{%*i*%}ls.classno,N( vals.regist ), vals.registno );city.removeAll();getCity( vals.province, function() {city.setValue( vals.city_name );weizhangBox.css( 'visibility', 'visible' );});setValue( vals );storageRendered = true;} else {weizhangBox.css( 'visibility', 'visible' );clearStorage();}};clearStorage = function() {storage.set( 'op-weizhang-msg', '' );};query = {lastParam: null,lastStatus: -1,init: function() {var self = this;queryBtn.click(function( e ) {e.preventDefault();if ( self.check() ) {save({%*i*%});self.loading();A.use('scrollbarv',function(){var vals = getValue();self.send({city: vals.city_code,hphm: vals.abbreviate + vals.hphm,engineno: vals.engineval,classno: vals.classval,registno: vals.registval,cityname: vals.city_name,provincename: vals.province,format: 'json',time_used: vals.time_used});});}});this.bindBackEvent();},clearTip: function( list ) {$.each( list, function( i, v ) {v.innerHTML = '';});},check: function() {var errorTip = [ '车牌号码', '发动机号', '车架号', '登记证书号' ],inputs = [ cari{%*i*%}d, engineno, classno, registno ],result = true,reg = /^[0-9A-Za-z]+$/,errortips = _this.find( '.op-weizhang-errortip' );this.clearTip( errortips );$.each( inputs, function( i, v ) {if ( v.getAttribute( 'isneed' ) == 'false' ) {return;}var length = v.getAttribute( 'tiplength' );if ( !reg.test( v.value ) || ( length != 0 && $.trim( v.value ).length != length ) ) {errortips[i].innerHTML = '请输入正确的' + errorTip[ i ];result = false;return false;} else {errortips[i].innerHTML = '';}});return result;},se{%*i*%}nd: function( vals ) {var self = this,progress = 0,isBack = false,params = {city: vals.city,hphm: vals.hphm,hpzl: data.hpzl,engineno: vals.engineno,classno: vals.classno,registno: vals.registno,cityname: vals.cityname,provincename: vals.provincename || '',format: 'json',time_used: vals.time_used || ''},loadingtime = N( vals.time_used );if ( loadingtime ) {loadingtime *= 1000;self.progress( 0 );timerAni = window.setInterval(function() {if ( progress > 80 || isBack ) {clearInterval( timer );return{%*i*%};}progress += 10;self.progress( progress );}, loadingtime / 10 );} else {self.progress();}$.ajax({ url: queryUrl,type : "GET",data: params,dataType : "jsonp",jsonp: 'cb',timeout: 20000,success: function( data ){isBack = true;if ( pageChange ) {return;}if ( loadingtime ) {self.progress( 100 );}self.lastStatus = data.status;self.lastParam = params;if ( data.status == 0 ) {if ( data.data.lists && data.data.lists.length ) {self.renderTable( data.data );} else {self.showMsg( '您目前没有未处理的交通违章记录。' );}if {%*i*%}( isLogin ) {timerCar = setTimeout(function() {carList.addToCarlist( params );cancelBtn.click();}, 0);}} else {self.showMsg( codeList[ data.status ] || codeList[ 1 ] );}self.showResult();},error:function(){self.lastStatus = -1;self.showMsg( codeList[1] );self.showResult();}});},loading: function() {var parent = loading.parent(),width = parent[0].clientWidth,height = parent[0].clientHeight;loading[0].style.cssText = 'display: block;width: ' + width + 'px;height: ' + height + 'px;';},progress: fun{%*i*%}ction( p ) {var inner = '正在加载中，请稍候...';if ( isFinite( p ) ) {p > 100 && ( p = 100 );inner = p + '% 数据查询中，请稍后'; }loadingText.html( inner );},hideLoading: function() {loading.hide();},renderTable: function( data ) {var tpl = '<tr>\<td class="op-weizhang-tindex">#{index}</td>\<td class="op-weizhang-tdate">#{date}</td>\<td class="op-weizhang-tarea">#{area}</td>\<td class="op-weizhang-tact">#{act}</td>\<td class="op-weizhang-tmoney">#{money}</td>\<td class="op-weizhang-tfen">#{fen}</td>\<td class="op{%*i*%}-weizhang-tchuli">#{chuli}</td>\<tr>',ret = [];$.each( data.lists, function( i, v ) {v.index = i + 1;v.date = v.date.split( ' ' ).join( '<br />' );ret.push( $.format( tpl, v ) );});if ( data.lists.length == 1 ) {data.numClass = 'op-weizhang-table-only';}data.hidemoreclass = data.flag == 1 ? '' : 'op-weizhang-more-hide';data.morelink = _this.data.data.url;resultTable.html($.format('<table class="c-table">\<tr>\<th class="op-weizhang-tindex">序号</th>\<th class="op-weizhang-tdate">违章时间</th>\<th clas{%*i*%}s="op-weizhang-tarea">违章地点</th>\<th class="op-weizhang-tact">违章行为</th>\<th class="op-weizhang-tmoney">罚款</th>\<th class="op-weizhang-tfen">记分</th>\<th class="op-weizhang-tchuli">处理情况</th>\</tr>\</table>\<div style="position:relative;zoom:1;">\<div class="op-weizhang-scoretip">待缴费金额#{forfeit}元，待处理积分#{score}分</div>\<div class="op-weizhang-resultcontent">\<table class="c-table #{numClass}">' + ret.join( '' ) +'</table>\<div class="op-weizhang-more #{hidemoreclass}"><a href="#{morelink}" target="_bl{%*i*%}ank">剩余违章信息请前往官网查看&gt;&gt;</a></div>\</div>\</div>', data ));if ( data.count > 5 ) {var content = $( '.op-weizhang-resultcontent', resultTable );content.css( 'height', '260px' );listScrollbar= A.ui.scrollbarv({content: content[0],length: 260,mousewheellock: true});}},showResult: function() {var tarHeight,srcHeight,self = this;srcHeight = searchBox.height();weizhangBox.css({height: searchBox.height() + 'px',overflow: 'hidden'});resultBox.show();tarHeight = resultBox.height();searchBox.hide();load{%*i*%}ing.animate( { height: tarHeight + 'px' } );weizhangBox.animate( { height: tarHeight + 'px' }, function() {self.hideLoading();weizhangBox.css( { height: '', overflow: '' } );});},hideResult: function() {searchBox.get(0).style.display = resultBox.get(0).style.display = '';},bindBackEvent: function() {var self = this;backBtn.click(function() {self.hideResult();phone.refresh();phone.toggleLoginForm( true );});},showMsg: function( msg ) {resultTable.html( '<div class="op-weizhang-errormsg">'+ msg + {%*i*%}'</div>' );}};carList = {data: {},thead: null,init: function() {var trs = $( 'tr', carListTable ),self = this;trs.each(function( i, v ) {if ( i == 0 ) {self.thead = $( v );return;}self.switchData( $( v ) );});this.addCarEvent();this.editCarsEvent();this.searchEvent();},switchData: function( obj ) {var carData = $.parseJSON( obj.attr( 'car-data' ) ),key = carData.hphm + carData.city,self = this,curKey,curData,tr = $( 'tr', carListTable );if ( this.data[ key ] ) {obj.remove();return;}if ( tr.size({%*i*%}) > 11 ) {tr = tr.eq( -1 );curData = $.parseJSON( tr.attr( 'car-data' ) );curKey = curData.hphm + curData.city;tr.remove();delete this.data[ curKey ];}if ( $.isEmptyObject( this.data ) ) {searchBox.addClass( 'op-weizhang-hasuserdata' );}this.data[ key ] = {obj: obj,data: carData};$.extend( carData, { cmdno: 'delete', hpzl: data.hpzl, format: 'json' } );$( '.op-weizhang-cars-remove' , obj ).click(function(e) {e.preventDefault();$.ajax({url: carUrl,type: 'GET',data: carData,dataType: 'jsonp',jsonp{%*i*%}: 'cb',success: function() {obj.remove();delete self.data[ key ];if ( $.isEmptyObject( self.data ) ) {searchBox.removeClass( 'op-weizhang-hasuserdata' );clearInput();}},error: function() {}});});return this.data[ key ];},addToCarlist: function( obj, flag ) {var tr = $('<tr></tr>');str = '<td><div class="op-weizhang-hphm">#{hphm}</div></td>\<td>#{engineno}#{classno}</td>\<td>#{city}</td>\<td class="op-weizhang-carlist-last">\<a href="javascript:;" class="op-weizhang-cars-search" data-click="{fm:\{%*i*%}'beha\'}">查看违章详情</a>\<a href="javascript:;" class="op-weizhang-cars-remove c-icon c-gap-left-small OP_LOG_BTN" hidefocus="true" data-click="{fm:\'beha\'}"></a>\</td>';str = $.format( str, {hphm: obj.hphm.replace( /^(.{2})/,'$1 ' ),engineno: obj.engineno ? '<span>' + obj.engineno + '</span>' : '',classno: obj.classno ? '<span>' + obj.classno + '</span>' : '',city: obj.cityname});tr.append( str ).attr( 'car-data', $.stringify( obj ) );tr.insertAfter( this.thead );this.switchData( tr );},addCarEven{%*i*%}t: function() {if ( addBtn.length ) {addBtn.click(function() {searchBox.addClass( 'op-weizhang-onadd' );clearInput();});}if ( cancelBtn.length ) {cancelBtn.click(function() {searchBox.removeClass( 'op-weizhang-onadd' );});}},editCarsEvent: function() {var editBtn = _this.find( '.op-weizhang-editbtn' ),cancelBtn = _this.find( '.op-weizhang-editcancel' );if ( !editBtn.length || !cancelBtn.length ) {return;}editBtn.click(function() {searchBox.addClass( 'op-weizhang-editstatus' );});cancelBtn.click({%*i*%}function() {searchBox.removeClass( 'op-weizhang-editstatus' );});},searchEvent: function() {carListTable.delegate( '.op-weizhang-cars-search', 'click', function( e ) {var data = $( e.target.parentNode.parentNode ).attr( 'car-data' );query.loading();A.use('scrollbarv', function() {query.send( $.parseJSON( data ) );});});}};phone = {obj: {savesuccess: _this.find( '.op-weizhang-phone-savesuccess' ),phonesuccess: _this.find( '.op-weizhang-phone-phonesuccess' ),nologin: _this.find( '.op-weizhang-phon{%*i*%}e-nologin' ),islogin: _this.find( '.op-weizhang-phone-islogin' )},init: function() {var self = this;this.refresh();this.bindEvent();},sms: function() {var self = this;smsObj && smsObj.dispose && smsObj.dispose();A.use('sms', function(){var code;smsObj = A.ui.sms({container: loginForm.get(0),type: 'weizhang',vcodeUrl: 'http://api.open.baidu.com/pae/sms/api/ORDER?appid=1&ie=utf-8&oe=utf-8',subscribeUrl: 'http://api.open.baidu.com/pae/sms/api/confirm?appid=1&ie=utf-8&oe=utf-8',phoneEmpty: '请输入手机号',{%*i*%}phoneError: '手机号有误，请重新输入',vcodeEmpty: '请输入校验码',vcodeError: '校验码有误，请重新输入',alreadySub: '该手机号已订制短信提醒',status: {'1': '参数错误','2': '该手机号已订制短信提醒','3': '请求过于频繁','4': '验证码错误','5': '未发送验证码','100': '请先登录'}, vcodeMaxLength: 6,setVcodeParam: function( phone ) {return { tele_number: phone, key: bds.comm.user };},setSubscribeParam: function( phone, code ) {return { tele_number: phone, key: bds.comm.user, code: code }},onsuccess: function(data){self.show( 'phonesuccess' );}}); }); },refresh: function() {this.sh{%*i*%}ow( isLogin ? 'islogin' : 'nologin' );},show: function() {var self = this;this.hideAll();$.each( arguments, function( i, v ) {if ( v = self.obj[ v ] ) {v.show();}}); },hideAll: function() {$.each( this.obj, function( i, v ) {v.hide(); });},login: function() {var self = this;bds.se.login.open(function(stat, user){if(stat == 1){$.ajax({url: carUrl,type: 'GET',data: $.extend( { cmdno: 'add', format: 'json', status: query.lastStatus }, query.lastParam ),dataType: 'jsonp',jsonp: 'cb',success: functio{%*i*%}n( data ) {if ( data.status == 0 ) {data.data.reverse();$.each( data.data, function( i, v ) {carList.addToCarlist( v );});}}});if ( query.lastStatus == 0 ) {self.show( 'savesuccess', 'islogin' );} else {self.show( 'islogin' );}loginBtn.click();self.sms();isLogin = true;}});},bindEvent: function() {var self = this;_this.find( '.op-weizhang-phone-nologinbtn' ).click(function(e) {e.preventDefault();self.login();});loginBtn.click(function(e) {e.preventDefault();loginForm.html( '' );self.toggleLoginF{%*i*%}orm();if ( arrow.hasClass( 'c-icon-triangle-up' ) ) {timerSMS = setTimeout(function() {self.sms();}, 0);}});},toggleLoginForm: function( flag ) {if ( arrow.hasClass( 'c-icon-triangle-down' ) && !flag ) {arrow.removeClass( 'c-icon-triangle-down' );arrow.addClass( 'c-icon-triangle-up' );loginForm.show();} else {arrow.removeClass( 'c-icon-triangle-up' );arrow.addClass( 'c-icon-triangle-down' );loginForm.hide();}}};event = {init: function() {this.tipEvent();},tipEvent: function() {var driverCard = _{%*i*%}this.find( '.op-weizhang-drivercard' ),inputs = $( [ classno, engineno ] ),tips = _this.find( '.op-weizhang-tip' ),show = function() {driverCard.show();},hide = function() {driverCard.hide();};tips.hover( show, hide );tips.click( show );inputs.focus( show );inputs.blur( hide );}};if ( !hasData ) {restore();} else {weizhangBox.css( 'visibility', 'visible' )}carList.init();event.init();query.init();input.init();phone.init();});});_this.dispose = function() {pageChange = true;clearTimeout( timer );{%*i*%}clearInterval( timerAni );clearTimeout( timerCar );clearTimeout( timerSMS );city && city.dispose && city.dispose();province && province.dispose && province.dispose();abbreviate && abbreviate.dispose && abbreviate.dispose();storage && storage.dispose && storage.dispose();listScrollbar && listScrollbar.dispose && listScrollbar.dispose();smsObj.dispose();};});</script>{%/block%}