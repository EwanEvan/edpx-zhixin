{%extends 'c_base.tpl'%} {%block name='data_modifier'%}{%$extData.feData.hasBorder=true%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='input'%}{%fe_fn_c_css css='btn'%}{%fe_fn_c_css css='tabs'%}.op_hangban{width:100%px;font-size:13px}.op_hangban_table td{padding-top:10px;text-align:left;vertical-align:middle;white-space:nowrap}.op_hangban_table .tangram_sug_wpr{border:0;z-index:999}.op_hangban_table .tangram_sug_wpr table{z-index:999;min-width:129px;width:auto;*width:136px;border:1px solid #d0d0d0}.op_hangban_table .tangram_sug_wpr td{white-space:nowrap;padding:0 0 0 5px}.op_hangban_number_err,.op_hangban_error{background-color:#d4443c;color:#fff;height:25px;line-height:25px;margin-lef{%*i*%}t:-5px;margin-right:0;padding-left:5px}.op_hangban_number_err{border:1px solid #d0d0d0;margin-left:0}.op_hangban_div{position:relative}.op_hangban_div .op_hangban_number_err{position:absolute;top:23px;left:-1px;text-align:center;padding-right:5px}.op_hangban_exchange{display:block;padding-left:5px;padding-right:5px}.tangram-suggestion{cursor:default}.tangram-suggestion table{width:100%;border:#d0d0d0 solid 1px;background:#fff;min-width:134px;_width:134px}.tangram-suggestion td{font-size:12px;lin{%*i*%}e-height:2;padding:0 5px;white-space:nowrap}.tangram-suggestion-current{background:#3a77d2;color:#fff}.tangram-suggestion td .op_hangban_red{margin:0 -5px;padding:0 5px;background:#d4443c;color:#fff}.op_hangban_hilight{color:#f00}</style>{%if $extData.feData.platform === 'ipad'%}<style>.tangram-suggestion td{font-size:1em}</style>{%/if%} <div class="op_hangban"> <ul class="c-tabs-nav c-tabs-nav-movetop"> <li class="c-tabs-nav-li op_hangban_tab{%if $tplData.areaflag%}{%else%} c-tabs-nav-selected{%/if%} OP_LOG_BTN">国内航班</li> <li class="c-tabs-nav-li op_hangban_tab{%if $tplData.areaflag%} c-tabs-nav-selected{%/if%} OP_LOG_BTN">国际&bull;港澳台航班</li> </ul> <table class="op_hangban_table" cellpadding="0" cellspacing="0"> {%if $tplData.showcnt%} <tr> <td><span class="c-gap-right">航线查询</span></td> <td> <span class="c-input c-input-small c-gap-right-small op_hanban_pos_start"> <i class="c-icon c-icon-map"></i> <input value="{%if $tplData.startcity%}{%$tplData.startcity|escape:'html'%}{%else%}{%if $extData.AutoExtendedLocation%}{%$extData.AutoExtendedLocation|escape:'html'|escape:'javascript'%}{%/if%}{%/if%}" class="op_hangban_start" name="op_hangban_start" id="op_hangban_start" type="text"> </span> </td> <td><a href="javascript:;" class="c-btn op_hangban_exchange c-gap-right-small"><i class="c-icon c-icon-exchange"></i></a></td> <td> <span class="c-input c-input-small c-gap-right op_hanban_pos_end"> <i class="c-icon c-icon-map"></i> <input value="{%if $tplData.destination%}{%$tplData.destination|escape:'html'%}{%/if%}" class="op_hangban_end" name="op_hangban_end" id="op_hangban_end" type="text"> </span> </td> <td> <a class="c-btn c-btn-primary op_hangban_line_btn OP_LOG_BTN" href="javascript:void(0)">查询</a></td> </tr> {%/if%} <tr> <td><span class="c-gap-right">航班号查询</span></td> <td colspan="5" > <div class="op_hangban_div"> <span class="c-input c-input-small c-gap-right"> <i class="c-icon c-icon-plane"></i> <input class="op_hangban_number_ipt" name="op_hangban_number_ipt" type="text" /> </span><a class="c-btn c-btn-primary op_hangban_flight_btn" href="javascript:void(0)" id="op_hangban_gtLine">查询</a> <div class="op_hangban_number_err" style="display:none;width:260px"></div> </div> </td> </tr> </table> </div><script {%*i*%}>A.setup(function() {var _this = this,ajaxFinished = false,timer,timer1,start,end,fnIpt = _this.find('.op_hangban_number_ipt')[0],fnErr = _this.find('.op_hangban_number_err')[0];{%if $tplData.showcnt%}var sFocus = false, eFocus = false, sIpFlag = 1, eIpFlag = 1, citys = [],scIpt = _this.find('.op_hangban_start')[0],ecIpt = _this.find('.op_hangban_end')[0],exchange = _this.find('.op_hangban_exchange')[0];{%if $tplData.areaflag%}var sugUrl = 'http://opendata.baidu.com/ala_sug/ala_s.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_ticket&t=#{1}';{%else%};var sugUrl = 'http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_guonei&t=#{1}';{%/if%}{%/if%}{%if $tplData.areaflag%}var areaFlag = 1;{%else%}var areaFlag = 0;{%/if%}if ( typeof exchange != 'undefined' ) {$(exchange).on('click', function(){var tmp = ecIpt.value;ecIpt.value = scIpt.value;scIpt.value = tmp;});}A.use('suggestion',function(){function changeTabs(e, i) {if (i === 1) {areaFlag = 1;{%if $tplData.showcnt%};sugUrl = 'http://opendata.baidu.com/ala_sug/ala_s.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_ticket&t=#{1}';{%/if%};} else {areaFlag = 0;{%if $tplData.showcnt%};sugUrl = 'http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_guonei&t=#{1}';{%/if%};}var tabCurClass="c-tabs-nav-selected";$(_this.find('.'+tabCurClass)[0]).removeClass(tabCurClass);$(e).addClass(tabCurClass);{%if $tplData.showcnt%};ecIpt.value = '';if (start) {start.dispose();}if (end) {end.dispose();}sug.view=function(){var s=_this.find('.op_hanban_pos_start')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};start = A.ui.suggestion(sug);sug.view=function(){var s=_this.find('.op_hanban_pos_end')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};end = A.ui.suggestion(sug);start.render('op_hangban_start');end.render('op_hangban_end');{%/if%};}$(_this.find('.op_hangban_tab')).each(function(i,e) {$(e).on('click', function() {changeTabs(e, i)});});{%if $tplData.showcnt%};$(scIpt).on('focus', function() {if (sIpFlag == 1) {scIpt.value = '';sIpFlag = 0;} else {scIpt.select();}});$(scIpt).on('mouseup', function(e) {if (!sFocus) {e.preventDefault();sFocus = true;} else {scIpt.focus();sFocus = false;}});$(scIpt).on('blur', function() {sFocus = false;});$(ecIpt).on('focus', function() {if (eIpFlag == 1) {ecIpt.value = '';eIpFlag = 0;} else {ecIpt.select();}});$(ecIpt).on('mouseup', function(e) {if (!eFocus) {e.preventDefault();eFocus = true;} else {ecIpt.focus();eFoc{%*i*%}us = false;}});$(ecIpt).on('blur', function() {eFocus = false;});var sug = {getData: function(word) {var _this = this;var fn = function(data) {if(ajaxFinished) return;var SD = [];if (data.status == 0) {var datas = data.data;var len = datas.length;if (len > 0) {$.each(datas, function(i,o) {SD.push(o.s);});}else {SD.push('dataerror');}fnSuccess(SD);}};var url = $.format(sugUrl, encodeURIComponent(word), new Date().getTime());$.ajax({url:url+'&cb=hang',dataType:'jsonp',success:function(data){ fn(da{%*i*%}ta);},timeout:5000,jsonpCallback:'hang'}); function fnSuccess(sd) {var FD = [];citys = [];if (sd[0] == 'dataerror') {FD.push('<p class="op_hangban_red">对不起，不支持该目的地</p>');citys.push('');}else {$.each(sd, function(i,o) {var da = o.split('|'),w = word.toLowerCase(),w1 = word.toUpperCase();if (areaFlag === 0) {var str = da[0] + '(' + da[1].toLowerCase() + ')',str2 = da[0] + '(' + da[2].toUpperCase() + ')';citys.push(da[0] + '|' + da[3]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span c{%*i*%}lass='op_hangban_hilight'>" + w + '</span>'));}else if (w1 && str2.indexOf(w1) != -1) {FD.push(str2.replace(w1, "<span class='op_hangban_hilight'>" + w1 + '</span>'));}} else {var str = da[0] + '(' + da[1] + ')',str2 = da[0] + '(' + da[2].toLowerCase() + ')',str3 = da[0] + '(' + da[3] + ')';citys.push(da[0] + '|' + da[4]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span class='op_hangban_hilight'>" + w + '</span>'));}else if (w && str2.indexOf(w) != -1) {FD.push(str2.replace(w, "<sp{%*i*%}an class='op_hangban_hilight'>" + w + '</span>'));}else if (w1 && o.indexOf(w1) != -1) {FD.push(str3.replace(w1, "<span class='op_hangban_hilight'>" + w1 + '</span>'));}}});}_this.show(word, FD);_this.highLight(0);}},onpick: function(ev) {if (isNaN(ev.data.index)) {return;}else {var cs = citys[ev.data.index].split('|');ev.data.item.value = cs[0];}}};sug.view=function(){var s=_this.find('.op_hanban_pos_start')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};start = A.{%*i*%}ui.suggestion(sug);sug.view=function(){var s=_this.find('.op_hanban_pos_end')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};end = A.ui.suggestion(sug);timer = setTimeout(function() {start.render('op_hangban_start');end.render('op_hangban_end');},0);var line_btn = _this.find('.op_hangban_line_btn')[0];$(line_btn).on('mousedown', function() {var lineUrl = '';if (areaFlag === 0) {lineUrl = 'http://flight.qunar.com/schedule/fsearch_list.jsp?&ex_track=bd_aladding_flight{%*i*%}sk_01';} else {lineUrl = 'http://flight.qunar.com/schedule/international/fsearch_list.jsp?ex_track=bd_aladding_intflightsk_01';}if ($.trim(scIpt.value) != '' && $.trim(ecIpt.value) != '') {lineUrl += '&departure=' + encodeURIComponent($.trim(scIpt.value)) + '&arrival=' + encodeURIComponent($.trim(ecIpt.value));} else {lineUrl = '{%$tplData.url|escape:'html'%}';if (areaFlag == 1) {lineUrl += '&type=2';}}line_btn.href = lineUrl;line_btn.target = '_blank';});{%/if%};});function op_hangban_fxEvent() {if (document.all) return window.event;func = op_hangban_fxEvent.caller;while (func != null) {var arg0 = func.arguments[0];if (arg0) {if ((arg0.constructor == Event || arg0.constructor == MouseEvent) || (typeof(arg0) == 'object' && arg0.preventDefault && arg0.stopPropagation)) {return arg0;}}func = func.caller;}return null;}$(fnIpt).on('keypress', function(event) {var event = op_hangban_fxEvent();if (event.keyCode == 13) {if (fnIpt.value == '') {window.open('{%$tplData.url|escape:'html'%}');return false;}if (checkFlightNum()) {if (areaFlag == 0) {window.open('http://flight.qunar.com/status/fquery.jsp?ex_track=bd_aladding_flightsk_02&flightCode=' + fnIpt.value.toLocaleUpperCase());} else {window.open('http://flight.qunar.com/schedule/international/fquery.jsp?ex_track=bd_aladding_intflightsk_02&flightCode=' + fnIpt.value.toLocaleUpperCase());}}}});function checkFlightNum() {var z1 = new RegExp('^\\w+' + decodeURIComponent('\u0024'));if (!z1.test(fnIpt.value) || fnIpt.value.length {%*i*%}> 7) {fnErr.style.display = 'block';fnErr.innerHTML = '您输入的航班号可能有误，请核对重新输入!';timer1 = window.setTimeout(function() {fnErr.style.display = 'none';}, 1500);return false;} else {return true;}}var flight_btn = _this.find('.op_hangban_flight_btn')[0];$(flight_btn).on('mousedown', function() {if (checkFlightNum()) {var flightUrl = '';if (areaFlag === 0) {flightUrl = 'http://flight.qunar.com/status/fquery.jsp?ex_track=bd_aladding_flightsk_02';} else {flightUrl = 'http://flight.qunar.com/schedule/intern{%*i*%}ational/fquery.jsp?ex_track=bd_aladding_intflightsk_02';}if ($.trim(fnIpt.value) != '') {flightUrl += '&flightCode=' + encodeURIComponent($.trim(fnIpt.value).toLocaleUpperCase());} else {flightUrl = '{%$tplData.url|escape:'html'%}';}flight_btn.href = flightUrl;flight_btn.target = '_blank';} else {flight_btn.href = 'javascript:void(0);';flight_btn.target = '_self';}});this.dispose = function(){clearTimeout(timer);window.clearTimeout(timer1);if(!ajaxFinished){ajaxFinished = true;}start&&start.dispose&&start.dispose();end&&end.dispose&&end.dispose();};});</script>{%/block%}