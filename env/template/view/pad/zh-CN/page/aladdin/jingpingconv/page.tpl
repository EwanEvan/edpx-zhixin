{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%$extData.feData.hasBorder = true%}{%/block%}{%block name='title'%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css="btn"%}{%fe_fn_c_css css="dropdown2"%}.op-jingpinconv-dropdown-outer{float:left}.op-jingpinconv-switch-btn-container .op-jingpinconv-switch-btn-active{border:1px solid #388bff}.op-jingpinconv-subtitle{font-family:微软雅黑;font-size:15px;font-weight:bold}.op-jingpinconv-tip{color:#999}.op-jingpinconv-bra-container .op-jingpinconv-dropdown-outer{width:140px}.op-jingpinconv-shoes-container .op-jingpinconv-dropdown-outer{width:110px}.op-jingpinconv-shoes-container .op-jingpinconv-dropdown-long-outer{width:120px}</style>{%if $tplData.data && !$tplData.data[0]%}{%$tplData.data=[$tplData.data]%}{%/if%}{%foreach $tplData.data as $data%}{%$tempDataImg=$data.info.img%}<div class="op-jingpinconv-container op-jingpinconv-{%$data.info.category|escape%}-container c-border c-row"> <div class="c-span6"> {%if $data.type%} {%foreach $data.type as $item%} {%$tempDataUrl=preg_replace('/^(.+?)\[(.+)\]$/', "$2", $item)%} <img class="c-img c-img6 op-jingpincon-img" src="{%$tempDataUrl%}" /> {%if $item@index==0%}{%break%}{%/if%} {%/foreach%} {%else%} <img class="c-img c-img6" src="{%$tempDataImg%}" /> {%/if%} </div> <div class="c-span18 c-span-last"> <div class="op-jingpinconv-subtitle c-gap-bottom-small">{%$data.info.title|escape%}</div> {%if $data.type%} <div class="op-jingpinconv-switch-btn-container c-gap-bottom c-clearfix"> {%foreach $data.type as $item%} {%$tempDataName=preg_replace('/^(.+?)\[(.+)\]$/', "$1", $item)%} {%$tempDataUrl=preg_replace('/^(.+?)\[(.+)\]$/', "$2", $item)%} <a href="javascript:;" class="op-jingpinconv-switch-btn c-btn{%if $item@first%}{%$tempDataTypeFirst=$item@key%} op-jingpinconv-switch-btn-active{%/if%} c-gap-right-small" data-click="{fm: 'beha'}" data-value="{%$item@key%}" data-img-url="{%$tempDataUrl%}">{%$tempDataName|escape%}</a> {%/foreach%} </div> {%/if%} <div class="op-jingpinconv-dropdown-container c-clearfix"> {%foreach $data.select as $item%} <div class="op-jingpinconv-dropdown-outer op-jingpinconv-dropdown-{%$item@key%}-outer c-gap-bottom c-gap-right"> <div class="c-dropdown2 op-jingpinconv-dropdown op-jingpinconv-{%$item@key|escape%}-dropdown" data-key="{%$item@key|escape%}"> <div class="c-dropdown2-btn-group"> <div class="c-dropdown2-btn">{%$tempDataSelectFirst=explode('|', $item.o[0])%}{%$tempDataSelectFirst[0]%}</div> <div class="c-dropdown2-btn-icon"> <div class="c-dropdown2-btn-icon-border"> <i class="c-icon c-icon-triangle-down"></i> </div> </div> </div> <div class="c-dropdown2-menu"> <div class="c-dropdown2-menu-inner"> <ul class="c-dropdown2-menubox"> {%foreach $item.o as $itemInner%} {%$tempDataSelectItem=explode('|', $itemInner)%} {%if !$tempDataTypeFirst || ($tempDataSelectItem[2] && $tempDataSelectItem[2] eq $tempDataTypeFirst)%} <li class="c-dropdown2-option" data-value="{%$tempDataSelectItem[1]|escape%}">{%$tempDataSelectItem[0]|escape%}</li> {%/if%} {%/foreach%} </ul> </div> </div> </div> </div> {%/foreach%} </div> <div class="op-jingpinconv-tip">{%$data.info.tip|escape%}</div> </div></div>{%/foreach%}<script >
    A.setup({
        data : {%json_encode($tplData.data)%}
    });
</script><script> A.setup(function(){var _this = this,data = _this.data.data;function Conv(options){this.data = options.data;this.maps = []; if(this.data && this.data.mapping && this.data.mapping.map){this.maps = this.data.mapping.map; }if(!this.maps.length){return;}this.selectData = this.data.select;this.category = this.data.info.category;this.dropdownui = {};this.init();}Conv.prototype = {init: function(){this.initData();this.initDropdown();this.specialProcess();},initData: function(){this.exc{%*i*%}ludeExp = /type|selected/;this.$con = _this.find('.op-jingpinconv-'+ this.data.info.category +'-container');this.$img = this.$con.find('.op-jingpincon-img');this.$dropdowns = this.$con.find('.op-jingpinconv-dropdown');if(this.category === 'shoes'){this.currentType = this.$con.find('.op-jingpinconv-switch-btn-active').attr('data-value');}},initDropdown: function(){var t = this; A.use('dropdown21', function(){t.$dropdowns.each(function(i, n){var key = $(n).attr('data-key');t.dropdownui[key] = A.ui{%*i*%}.dropdown21(n, {onchange : function(){var obj = {k: key, v: t.dropdownui[key].getValue()};var map = t.getMap(obj); t.doMap(map);}}); });t.initDefault();});},initDefault: function(){var t = this;var selectedMap = null;$.each(t.maps, function(j, map){if(!!map.selected){selectedMap = map;return false;}});var selectedMap = selectedMap ? selectedMap: t.maps[0];t.doMap(selectedMap);},doMap: function(map){var t = this;if(!map){return;}$.each(map, function(k, v){if(!t.excludeExp.test(k)){t.dropdownui[k]{%*i*%}.setValue(v); }});},getMap: function(obj){var t = this;var find = null;var mapKey = {'upper': 'under','under': 'upper'};var mutex = mapKey[obj.k];var match = false;var braNotMatchButFirst = null;$.each(t.maps, function(i, map){match = false;if(t.category === 'shoes'){match = (map[obj.k] === obj.v && map.type === t.currentType) ? true : false;}if(t.category === 'bra'){if(mutex){if(map[obj.k] === obj.v){if(!braNotMatchButFirst){braNotMatchButFirst = map;}if(map[mutex] && t.dropdownui[mutex] && map{%*i*%}[mutex] === t.dropdownui[mutex].getValue()){match = true;}}}else{ match = (map[obj.k] === obj.v) ? true : false;}}if(match){find = map;return false;}});if(t.category === 'bra' && mutex && !match && braNotMatchButFirst){ match = true;find = braNotMatchButFirst;}return find;},specialProcess: function(){var t = this; if(t.category === 'shoes'){t.$btns = t.$con.find('.op-jingpinconv-switch-btn'); t.$btns.click(function(){t.$btns.removeClass('op-jingpinconv-switch-btn-active');var $btn = $(this); t.c{%*i*%}urrentType = $btn.addClass('op-jingpinconv-switch-btn-active').attr('data-value');t.$img.attr("src", $btn.attr('data-img-url'));t.resetDropdown({k: 'type', v: t.currentType}); }); }},resetDropdown: function(obj){var t = this;var filtedData = t.filterData(obj);$.each(t.dropdownui, function(k, dropdown){dropdown.removeAll().add(filtedData[k]); });var key = t.$dropdowns.eq(0).attr('data-key');var dropdown = t.dropdownui[key];var obj = {k: key, v: dropdown.getValue()};t.doMap(t.getMap(obj));},filter{%*i*%}Data: function(obj){var t = this;var rs = {};$.each(t.selectData, function(key, val){rs[key] = [];$.each(t.selectData[key].o, function(i, o){var arr = o.split('|');var text = arr[0];var value = arr[1];var type = arr[2];if(type === obj.v){rs[key].push({text: text, value: value});}});});return rs;},getDropdownui: function(){return this.dropdownui;}};if(!data || !data.length){return;}var convs = [];$.each(data, function(i, d){convs.push(new Conv({data: d}));});_this.dispose = function(){$.each(conv{%*i*%}s, function(i, conv){var dropdowns = conv.getDropdownui(); $.each(dropdowns, function(k, dp){dp && dp.dispose && dp.dispose();});});};});</script>{%/block%}