{%extends 'c_right_base.tpl'%} {%block name="data_modifier"%}{%$extData.feData.narrow = true%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css="table"%}.opr-tieba-main h3{font-weight:normal}.opr-tieba-summary{margin-bottom:8px}.opr-tieba-summary span{padding-left:5px}.opr-tieba-table{display:none}.opr-tieba-table i{font-style:normal;color:#ff8a00}.opr-tieba-table a{text-decoration:underline;color:#666}.opr-tieba-table table{width:100%}.opr-tieba-replynum{float:right}.opr-tieba-table td.opr-tieba-table-ltd{text-align:left}.opr-tieba-table td.opr-tieba-table-rtd{text-align:right;width:40px}</style><div class="opr-tieba-main"> <div class="cr-title{%*i*%}"> {%$tplData.title|limitlen:30%} </div> <div class="opr-tieba-summary c-gap-top-small"> {%$tplData.summary|limitlen:60|highlight:0%}<span><a target="_blank" href="{%$tplData.url%}">查看贴吧&gt;&gt;</a></span> </div> <div class="opr-tieba-table"> <table class="c-table" cellpadding="0" cellspacing="0"> <tbody> <tr> <th class="opr-tieba-table-ltd c-clearfix" colspan="2"><span style="float:left">{%$tplData.tabletitle[0].left%}</span><span class="opr-tieba-replynum"></span></th> </tr> </tbody> </table> </div> {%if $tplData.foot%} <div class="opr-tieba-foot c-gap-top-small"> <a target="_blank" href="{%$tplData.foot[0].link%}">{%$tplData.foot[0].txt%}</a> </div> {%/if%}</div><script>A.setup({'fid': '{%$tplData.fid%}','tid': '{%$tplData.tid%}','talkid':'{%$tplData.talkid%}','titlemid':'{%$tplData.tabletitle[0].middle%}','titleright':'{%$tplData.tabletitle[0].right%}'});</script><script data-merge>A.setup(function(){var _this = this,talkArr = [],postArr = [],ajaxFinished = false,timer = null,$table = $('.opr-tieba-table'),fid = _this.data.fid,tid = _this.data.tid,talkid = _this.data.talkid,t = (new Date().getTime()),guestUrl = 'http://tieba.baidu.com/zhibo/talk/talk?rn=2&cb=bd_cb_tieba_broadcast&direction=0&fid='+fid+'&tid='+tid+'&talkid='+talkid+'&t='+t,holderUrl = 'http://tieba.baidu.com/zhibo/talk/post?rn=3&cb=bd_cb_tieba_broadcast&fid='+fid+'&tid='+tid+{%*i*%}'&t='+t;$.ajax({url:holderUrl,dataType:'jsonp',timeout:5000});$.ajax({url:guestUrl,dataType:'jsonp',timeout:5000});window.bd_cb_tieba_broadcast = function(data){if(ajaxFinished)return;if (data && data.data && data.data.talk) { var serverTime = data.data.server_time;var info = data.data.talk;for(var i=info.length-1;i>0;i--){if(info[i].comment && info[i].comment.del == 1 ){continue;}else if(info[i].answer){continue; }else if(info[i].question){continue;}else{var auth = '嘉宾';var byteNum = 6;var type{%*i*%} = info[i].comment.user.type;if(type == 1){txtCon = '主持';}else if(type == 2){txtCon = '嘉宾';}if (info[i] && info[i].comment) { var html = ['<tr><td class="opr-tieba-table-ltd"><i>[', auth, ']</i><a target="_blank" href="http://www.baidu.com/p/'];byteNum = byteNum + getLen(info[i].comment.user.name);html = html.concat([info[i].comment.user.name,'?from=ala_right_tieba">',info[i].comment.user.name,'</a>：',$.subByte(info[i].comment.contents, 54-byteNum),'</td><td class="opr-tieba-table-rtd">',formatT{%*i*%}ime(serverTime, info[i].comment.time),'</td></tr>']);}talkArr.push(html.join(''));break;} }}if(data && data.data && data.data.post_list){var serverTime = data.data.server_time;var info = data.data.post_list;var num = data.data.join_num;$('.opr-tieba-replynum').html(_this.data.titlemid + num + _this.data.titleright);for(var i=0;i<info.length && i<4;i++){var byteNum = getLen(info[i].user.name);var html = ['<tr><td class="opr-tieba-table-ltd"><a target="_blank" href="http://www.baidu.com/p/',info[i{%*i*%}].user.name,'?from=ala_right_tieba">',info[i].user.name,'</a>：',$.subByte(info[i].contents,54-byteNum),'</td><td class="opr-tieba-table-rtd">',formatTime(serverTime, info[i].time),'</td></tr>'];postArr.push(html.join(''));} }};timer = setInterval(function(){if(postArr.length < 0) return;var html = [];if (talkArr.length > 0) {html = html.concat(talkArr); }html = html.concat(postArr);_this.find('.opr-tieba-table tbody').append($(html.join('')));var height = $table.height();$table.slideDown(1000);c{%*i*%}learInterval(timer);},1000);function formatTime(serverTime, time){ var leftTime = serverTime - parseInt(time, 10); var thatTime = parseInt(time, 10);var rsTime = '';if (leftTime <= 0){ rsTime = '刚刚';}else if (leftTime < 60) {rsTime = leftTime + '秒前';} else if (leftTime < 60*60) {rsTime = parseInt(leftTime/60) + '分前';} else if (leftTime < 60*60*24) { rsTime = calcTime(thatTime, serverTime);} else {return parseInt(leftTime/60/60/24) + '天前';} return rsTime;};function calcTime(thatTime, serverTime){{%*i*%}var oServerTime = new Date(serverTime*1000);var oServerDate = oServerTime.getDate();var oFatie = new Date(thatTime*1000); var oOneDate = oFatie.getDate();var hoursNum = oFatie.getHours();var minutesNum = oFatie.getMinutes();if(hoursNum<10){hoursNum = "0" + hoursNum; } if(minutesNum<10){minutesNum = "0" + minutesNum; } var str = hoursNum + ":" + minutesNum ;if(oServerDate == oOneDate){return str;}else{return "1天前";};};function getLen(str){var d = [];var g = str.split("");for (var f = 0, c = g.len{%*i*%}gth; f < c; f++) {if (g[f].charCodeAt(0) > 255) {d.push("*")}d.push(g[f])}return d.length;}_this.dispose = function(){ajaxFinished = true;$table.stop();clearInterval(timer);bd_cb_tieba_broadcast = function(){};};});</script>{%/block%}