{%extends 'c_base.tpl'%} {%block name="data_modifier"%}{%$extData.feData.hasBorder = true%}{%/block%}{%block name="title"%}{%/block%}{%block name="foot"%}{%/block%}{%block name='content'%}<style data-merge>{%fe_fn_c_css css='tabs'%}{%fe_fn_c_css css='img'%}.op-ingredients-title{font-weight:bold;font-size:1.07em}.op-ingredients-pages{margin-top:15px}.op-ingredients-cont{border-top:1px solid #f1f1f1}.op-ingredients-tab{display:inline-block;padding:3px 6px;text-align:center;vertical-align:text-bottom;line-height:100%;font-style:normal;overflow:hidden;color:#00c;cursor:pointer}.op-ingredients-sel{background-color:#2b99ff;color:#fff}.op-ingredients-img{position:relative;display:block;text-decoration:none;overflow:hidden}.op-ingreditents-tip{position:ab{%*i*%}solute;right:0;bottom:0}.op-ingreditents-tipinfo{color:#fff;padding:0 8px;position:relative;z-index:100}.op-ingreditents-tipbg{width:100%;height:100%;position:absolute;left:0;top:0;background:#000;opacity:.65;filter:alpha(opacity=65);z-index:10}.op-ingredients-hidden{display:none}a.op-ingredients-noline{text-decoration:none}a.op-ingredients-noline:hover{text-decoration:underline}.op-ingredients-center{text-align:center}.op-ingredients-gapbtm{margin-bottom:7px}.op-ingredients-tip{text-align:right{%*i*%};margin-bottom:-4px}.op-ingredients-gray{color:#999}.op-ingredients-split{color:#ccc}.op-ingredients-loading{margin:150px auto}</style><style>.op-ingredients-img,.op-ingredients-img img{height:{%fe_fn_c_get_img_height col=12 rate=144/254%}px}</style><p class="c-gray op-ingredients-title op-ingredients-gapbtm">{%$tplData.title|limitlen:78|escape:html%}</p><p class="c-gap-bottom"> <span class="c-gray">{%$tplData.tip|limitlen:10|escape:html%}</span> {%foreach array_slice($tplData.tab,0,8) as $item%} <i class="c-gap-left-small op-ingredients-tab {%if $item@first %}op-ingredients-sel{%/if%}" data-key='{%$item.name%}'>{%$item.name|limitlen:20|escape:html%}</i> {%/foreach%}</p>{%foreach array_slice($tplData.tab,0,8) as $item%} <div class="op-ingredients-cont {%if !$item@first%}op-ingredients-hidden{%/if%}" data-flag="{%if !$item@first%}0{%else%}1{%/if%}"> <div class="c-row op-ingredients-tags"> {%if $item@first%} {%$escaped_resultnum=0%} {%foreach $tplData.tag as $itemtag%} {%if $item.name==$itemtag.key%} {%$escaped_resultnum=$escaped_resultnum+1%} <div class="c-gap-top c-span12 op-ingredients-page{%floor($itemtag@index/4)+1 %} {%if $itemtag@index%2==1%}c-span-last{%/if%} {%if $itemtag@index>=4%}op-ingredients-hidden{%else%}op-ingredients-show{%/if%}" pagenum="{%floor($itemtag@index/4)+1 %}"> <a href="{%$itemtag.link%}" target="_blank" class="op-ingredients-img"> <img class="c-img c-img12" {%if $itemtag@index<=3%}src="{%$itemtag.poster%}"}{%else%}srctxt="{%$itemtag.poster%}"}{%/if%} /> {%if $itemtag.sumpic%} <div class="op-ingreditents-tip"> <span class="op-ingreditents-tipinfo">{%$itemtag.sumpic|limitlen:20|escape:html%}</span> <span class="op-ingreditents-tipbg">&nbsp;</span> </div> {%/if%} </a> <p class="c-gap-top-small op-ingredients-center"> <a href="{%$itemtag.link%}" target="_blank" class="op-ingredients-noline">{%$itemtag.name|limitlen:20|escape:html%}</a> <span class="c-gray">{%$itemtag.sumper|limitlen:16|escape:html%}</span> </p> </div> {%/if%} {%/foreach%} {%else%} <i class="c-loading op-ingredients-loading"></i> {%/if%} </div> </div>{%/foreach%}<div class="op-ingredients-pages" ></div>{%foreach array_slice($tplData.tab,0,8) as $item%} <p class="c-gap-top op-ingredients-gray op-ingredients-tip {%if !$item@first%}op-ingredients-hidden{%/if%}"> <span>来自{%$item.name|limitlen:40|escape:html%}</span><span class="c-gap-left-small c-gap-right-small op-ingredients-split">|</span> <a class="op-ingredients-gray op-ingredients-err op-ingredients-noline " href="javascript:;" data-click="{info:'报错'}">报错</a> <span class="op-ingredients-tks op-ingredients-hidden">感谢反馈</span> </p>{%/foreach%}<script data-compress='off'>A.setup({"key":"{%$tplData.key|escape:'html'|escape:'javascript'%}","sid":"{%$extData.resourceid|escape:'html'|escape:'javascript'%}","resultnum":"{%$escaped_resultnum|escape:'html'|escape:'javascript'%}"});</script><script data-merge>A.setup(function(){var _this = this;var $tab=_this.find('.op-ingredients-tab');var $cont=_this.find('.op-ingredients-cont');var $err=_this.find('.op-ingredients-err');var $tip=_this.find('.op-ingredients-tip');var $page=_this.find('.op-ingredients-pages');var pagePrm = { listNum : Number(_this.data.resultnum), nowPage : 1,endPage : undefined,pn : 0, rn : 4 };var pg;var ajaxFinished = false;$tab.on('click',function(){$page.hide(); var $this=$(this);var nIndex=$tab.{%*i*%}index($this);var tagkey=$this.attr('data-key');var $fa=$cont.eq(nIndex);$this.addClass('op-ingredients-sel').siblings('.op-ingredients-sel').removeClass('op-ingredients-sel');if($fa.attr('data-flag')==0){var url='http://opendata.baidu.com/api.php?format=json&ie=utf-8&oe=utf-8&query='+encodeURIComponent(_this.data.key)+'&apn=0&arn=96&resource_id='+encodeURIComponent(_this.data.sid)+'&co=tag[key='+encodeURIComponent(tagkey)+']';$.ajax({url:url,dataType:"jsonp",jsonp:"cb",timeout:6000,success: func{%*i*%}tion(data){if(data.data[0] && data.data[0].tag ){if(ajaxFinished) return;var data=data.data[0];$fa.find('.op-ingredients-tags').html(initData(data.tag));initPage($fa);$fa.attr('data-flag','1');}}});}else{pagePrm.listNum=$fa.find('.c-span12').length;pagePrm.nowPage=parseInt($fa.find('.op-ingredients-show').attr('pagenum'));initPage($fa); }$fa.removeClass('op-ingredients-hidden').siblings('.op-ingredients-cont:visible').addClass('op-ingredients-hidden');$tip.eq(nIndex).removeClass('op-ingredients-{%*i*%}hidden').siblings('.op-ingredients-tip:visible').addClass('op-ingredients-hidden');});$err.on('click',function(){$(this).addClass('op-ingredients-hidden').next('.op-ingredients-tks').removeClass('op-ingredients-hidden');});function initData(data){var innerHtml='';pagePrm.listNum=data.length;for(var i=0;i<pagePrm.listNum;i++){var tag=data[i];var pagenum=Math.floor(i/4)+1;var islast='';var isshow='';var issrc='';if(i>=4){isshow=' op-ingredients-hidden';issrc=' srctxt="'+tag.poster+'"}';}else{issho{%*i*%}w=' op-ingredients-show';issrc=' src="'+tag.poster+'"}';}if(i%2==1){islast=' c-span-last';}innerHtml+='<div class="c-gap-top c-span12 op-ingredients-page'+pagenum+islast+isshow+'" pagenum="'+pagenum+'">';innerHtml+='<a href="'+tag.link+'" target="_blank" class="op-ingredients-img">';innerHtml+='<img class="c-img c-img12" '+issrc+' />';if(tag.sumpic){innerHtml+='<div class="op-ingreditents-tip"><span class="op-ingreditents-tipinfo">'+$.subByte(tag.sumpic,20)+'</span><span class="op-ingreditents-t{%*i*%}ipbg">&nbsp;</span></div>';}innerHtml+='</a>';innerHtml+='<p class="c-gap-top-small op-ingredients-center">';innerHtml+='<a href="'+tag.link+'" target="_blank" class="op-ingredients-noline">'+$.subByte(tag.name,20)+'</a>';innerHtml+='<span class="c-gray">'+$.subByte(tag.sumper,16)+'</span>';innerHtml+='</p>';innerHtml+='';innerHtml+='</div>';}return innerHtml;}function initPage($fa){if(pagePrm.listNum>4){$page.show();pagePrm.endPage = Math.ceil(pagePrm.listNum / pagePrm.rn);A.use('page', functio{%*i*%}n(){pg=A.ui.page($page[0], pagePrm.nowPage, pagePrm.endPage, {prePageText: '上一页',nextPageText: '下一页',onChange: function(nowPage, endPage){$fa.find('.op-ingredients-show').removeClass('op-ingredients-show').addClass('op-ingredients-hidden');$fa.find('.op-ingredients-page'+nowPage).removeClass('op-ingredients-hidden').addClass('op-ingredients-show').find('img').each(function(i, e) {var srctxt=e.getAttribute('srctxt');if(srctxt){e.setAttribute('src',srctxt);e.setAttribute('srctxt','');}});;}});});}{%*i*%}else{$page.hide(); }}initPage($cont.eq(0));this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}pg&&pg.dispose&&pg.dispose();};});</script>{%/block%}