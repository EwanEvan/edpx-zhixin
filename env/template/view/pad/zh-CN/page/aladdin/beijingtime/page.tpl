{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%if !$tplData.showurl%} {%$tplData.showurl = 'open.baidu.com/'%} {%/if%} {%if !$tplData.daylight%}{%$tplData.daylight = [ ['start' => '8:00:00','end' => '20:00:00' ] ]%} {%/if%} {%if !$tplData.timezone%}{%$tplData.timezone = 8%} {%/if%}{%/block%}{%block name='content'%}<style data-merge>.op-beijingtime{position:relative;height:105px}.op-beijingtime-box{position:absolute;left:0;top:0;height:65px;padding:18px 0 17px 51px;font-family:'Microsoft Yahei',Arial}.op-beijingtime-mark{position:absolute;left:51px;top:18px}.op-beijingtime-box{color:#fff;font-family:Microsoft Yahei}.op-beijingtime-hands{position:relative;display:block;float:left;margin-right:20px}.op-beijingtime-box p{float:left;white-space:nowrap}.op-beijingtime-time{margin-right:7px;font-size:55px;line-h{%*i*%}eight:65px;width:228px;letter-spacing:1px}.op-beijingtime-time span{position:relative;top:-5px}.op-beijingtime-time .op-beijingtime-small{top:0;font-size:30px}.op-beijingtime-datebox{padding-top:6px}.op-beijingtime-datebox span{display:block;text-align:center}.op-beijingtime-datebox .op-beijingtime-week{text-align:left;font-size:20px}.op-beijingtime-date{font-size:15px}</style><div class="op-beijingtime"></div><script >
    A.setup({
        {%if $tplData.dst%}
        dst: {%json_encode($tplData.dst[0])%},
        {%/if%}
        timeZone: '{%$tplData.timezone|escape:'javascript'%}',
        dayLight: {%json_encode($tplData.daylight[0])%}
    });
</script><script data-merge>A.setup(function(){var baidu = A.baidu,_this = this,getServerTime,drawBackground,drawMark,drawHands,STAR_NUM = 200,TIME_ZONE = 8,now,countTimeZone,timeZone = _this.data.timeZone || 8,ensureTime,bjConmunu,dst = _this.data.dst,countDayLight,dayLight = _this.data.dayLight,dayLightStatus,secondTimer,minuteTimer,timeFormat,setDateTime,dateSetter,contextFlag,contextEvent,initialize,initForIE,hourTime = 60 * 60 * 1000,supportCanvas = !!document.createElement('canvas').getCon{%*i*%}text,$container = _this.find( '.op-beijingtime' ),bgCanvas,markCanvas,handsCanvas;countTimeZone = function( time, timeZone ) {var curZone = time.getTimezoneOffset(),curDate,month,day,hour;curDate = new Date( time.getTime() + curZone * 60000 );curDate.setTime( curDate.getTime() + timeZone * hourTime );if ( dst ) {if ( new Date( curDate.year, dst.month - 1, dst.day, dst.hour, 0, 0 ) < curDate &&new Date( curDate.year, dst.endMonth - 1, dst.endDay, dst.endHour, 0, 0 ) ) {curDate.setTime( curDate.ge{%*i*%}tTime() + hourTime );}}return curDate;};ensureTime = function( time, timeZone) {var curTimezone = time.getTimezoneOffset();return new Date( time.getTime() + ( time.getTimezoneOffset() - timeZone ) * 60000 );};getServerTime = function( callback ) {if ( typeof callback != 'function' ) {return;} $.ajax({url: '/?t=' + new Date().getTime(),type: 'HEAD'}).done(function(data, textStatus, jqXHR){oncallback(jqXHR);}).fail(function(jqXHR, textStatus, errorThrown){oncallback(jqXHR);});function oncallback(j{%*i*%}qXHR) {var time = jqXHR && jqXHR.getResponseHeader("Date");if ( time ) {callback( new Date( time ) );}}};setDateTime = function( date, time ) {var t = time.split( ':' );date.setHours( t[0] );date.setMinutes( t[1] || 0 );date.setSeconds( t[2] || 0 );return date;};countDayLight = function() {var startTime = dayLight.start,endTime = dayLight.end;startTime = setDateTime( new Date( now.getTime() ), startTime );endTime = setDateTime( new Date( now.getTime() ), endTime );return startTime < now && endTi{%*i*%}me > now ? 'daylight' : 'night';};drawBackground = function( isNight ) {var ctx = bgCanvas.getContext( '2d' ),width = bgCanvas.offsetWidth,height = bgCanvas.offsetHeight,grd,drawStar;if ( dayLightStatus && dayLightStatus == isNight ) {return;}dayLightStatus = isNight;ctx.clearRect( 0, 0, width, height );drawStar = function() {var i, x, y, radGrd, radius, startColor, opacity, unit;unit = supportCanvas ? 1 : 0.5;for ( i = 0; i < STAR_NUM; i++ ) {x = Math.random() * width;y = Math.random() * height{%*i*%};radius = Math.random() + unit;opacity = radius - unit;supportCanvas && ( opacity /= 2 );radGrd = ctx.createRadialGradient( x, y, 1, x, y, radius );radGrd.addColorStop( 0, 'rgba( 175, 175, 175, ' + opacity + ' )' );radGrd.addColorStop( 1, 'rgba( 175, 175, 175, 0 )' );ctx.fillStyle = radGrd;ctx.beginPath();ctx.arc( x, y, radius, 0, Math.PI * 2, true );ctx.fill();ctx.closePath();}};if ( isNight ) {grd = ctx.createLinearGradient( 0, 0, 0, height );grd.addColorStop( 0, 'rgb(24, 50, 89)' );grd.addCol{%*i*%}orStop( 1, 'rgb(52, 130, 186)' );} else {grd = ctx.createLinearGradient( 0, 0, 0, height );grd.addColorStop( 0, '#0067bf' );grd.addColorStop( 1, '#6eabe2' );}ctx.fillStyle = grd;ctx.fillRect( 0, 0, width, height );if ( isNight ) {drawStar();}};drawMark = function() {var ctx = markCanvas.getContext( '2d' ),i,lineLength,radius = markCanvas.offsetWidth / 2;ctx.translate( radius, radius ); for ( i = 0; i < 60; i++ ) {ctx.lineWidth = 1;ctx.strokeStyle = 'rgba( 255, 255, 255, 0.3 )';lineLength = 4;if {%*i*%}( i % 5 == 0 ) {lineLength = 8;ctx.strokeStyle = '#fff';}ctx.beginPath();ctx.moveTo( 0, lineLength - radius );ctx.lineTo( 0, -radius );ctx.stroke();ctx.closePath();ctx.rotate( Math.PI / 30 );}};drawHands = function( date ) {var hour = date.getHours(),minute = date.getMinutes(),second = date.getSeconds(),ctx = handsCanvas.getContext( '2d' ),radius = handsCanvas.offsetWidth / 2,draw;hour > 12 && ( hour -= 12 );hour += minute / 60;minute += second / 60;ctx.clearRect( 0, 0, radius * 2, radius * 2 );{%*i*%}draw = function( lineWidth, strokeStyle, rotate, start, end ) {ctx.save();ctx.lineWidth = lineWidth;ctx.strokeStyle = strokeStyle;ctx.translate( radius, radius );ctx.rotate( rotate );ctx.beginPath();ctx.moveTo( 0, start );ctx.lineTo( 0, end );ctx.stroke();ctx.closePath();ctx.restore();};draw( 3, '#fff', Math.PI / 6 * hour, 6, -16 );draw( 2, '#fff', Math.PI / 30 * minute, 6, -24 );draw( 1, '#d93c3c', Math.PI / 30 * second, 6, -24 );};timeFormat = function( str ) {return ( '0' + str ).slice( -2 );{%*i*%}};dateSetter = {time: null,week: null,date: null,init: function() {this.time = _this.find( '.op-beijingtime-time' )[0];this.week = _this.find( '.op-beijingtime-week' )[0];this.date = _this.find( '.op-beijingtime-date' )[0];this.setTime();this.minuteSet();},setTime: function() {this.time.innerHTML = timeFormat( now.getHours() ) + '<span>:</span>' + timeFormat( now.getMinutes() )+ '<span class="op-beijingtime-small c-gap-left">' + timeFormat( now.getSeconds() ) + '</span>';},setWeek: function() {t{%*i*%}his.week.innerHTML = '星期' + '日一二三四五六'.charAt( now.getDay() );},setDate: function() {this.date.innerHTML = now.getFullYear() + '年' + ( now.getMonth() + 1 ) + '月' + now.getDate() + '日';},minuteSet: function() {this.setWeek();this.setDate();}};minuteTimer = function() {getServerTime(function( time ) {now = countTimeZone( time, timeZone );dateSetter.minuteSet();drawBackground( countDayLight() == 'night' );});};bjConmunu = function(){contextFlag = true;};contextEvent = function() {$(document).bind('c{%*i*%}ontextmenu' ,bjConmunu);};initialize = function() {var tpl = '<canvas class="op-beijingtime-background" width="#{width}" height="100"></canvas>\<div class="op-beijingtime-box c-clearfix">\<canvas class="op-beijingtime-hands" width="65" height="65"></canvas>\<canvas class="op-beijingtime-mark" width="65" height="65"></canvas>\<p class="op-beijingtime-time"></p>\<p class="op-beijingtime-datebox"><span class="op-beijingtime-week"></span><span class="op-beijingtime-date"></span>\</div>';$container.h{%*i*%}tml($.format( tpl, { width: _this.container.offsetWidth } ));bgCanvas = _this.find( '.op-beijingtime-background' )[0];markCanvas = _this.find( '.op-beijingtime-mark' )[0];handsCanvas = _this.find( '.op-beijingtime-hands' )[0];if ( !supportCanvas ) {A.ui.canvas.init( [ bgCanvas, markCanvas, handsCanvas ] );}$(document).ready(function(){getServerTime(function( time ) {now = time;contextEvent();now = countTimeZone( now, timeZone );drawBackground( countDayLight() == 'night' );drawMark();drawHands( n{%*i*%}ow );dateSetter.init();secondTimer = window.setInterval(function() {var timeObj,timezone;if ( now.getSeconds() == 0 || contextFlag == true ) {minuteTimer();contextFlag = false;}timezone = now.getTimezoneOffset();now = new Date( now.getTime() + 1000 );if ( now.getTimezoneOffset() != timezone ) {now = ensureTime( now, timezone );}drawHands( now );dateSetter.setTime();}, 1000);});});};if ( supportCanvas ) {initialize();} else {A.use('canvas', function(){initialize();});}this.dispose = function(){wi{%*i*%}ndow.clearInterval(secondTimer);$(document).unbind('contextmenu' ,bjConmunu);};});</script>{%/block%}