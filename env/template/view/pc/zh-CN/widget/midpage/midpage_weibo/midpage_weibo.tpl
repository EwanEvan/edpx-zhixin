{%*
* @fileOverview 微博结果组件
* @author  刘悦
* @version 1.0
* @date 2013/01/23
*%}{%fis_widget%}{%function name=weibotype%}{%if $type == 't.qq'%}腾讯{%/if%}{%if $type == 't.sohu'%}搜狐{%/if%}{%if $type == 't.163'%}网易{%/if%}{%if $type == 't.sina'%}新浪{%/if%}微博{%/function%}{%function name=weibourltype%}{%if $type == 't.sina'%}?c=spr_qdhz_bd_baidusmt_weibo_s{%/if%}{%/function%}{%$weiboFactor.needmerge = "//<a href=\"%s?c=spr_qdhz_bd_baidusmt_weibo_s\" target=\"_blank\" name=\"weibo_nick\">@%s</a>："%}{%$weiboFactor.needmergecall = "<a href=\"%s?c=spr_qdhz_bd_baidusmt_weibo_s\" target=\"_blank\" name=\"weibo_nick\">@%s</a> "%}{%$weiboFactor.url = "<a href=\"%s?c=spr_qdhz_bd_baidusmt_weibo_s\" target=\"_blank\" name=\"weibo_link\">%s</a>"%}{%$weiboFactor.picurl = "<div class=\"weibo_img_holder\"><div class=\"weibo_img_small\" style=\"height: 120px;\"><img src=\"%s\" data-mdimg=\"%s\" data-bgimg=\"%s\" onerror=\"setError(this)\"></div></div>"%}{%$weiboFactor.picurl_qq = "<div class=\"weibo_img_holder\"><div class=\"weibo_img_small\" style=\"height: 120px;\"><img src=\"%s/160\" data-mdimg=\"%s/460\" data-bgimg=\"%s/460\" onerror=\"setError(this)\"></div></div>"%}{%$weiboFactor.videourl = "<a href=\"%s\" target=\"_blank\" name=\"weibo_video\">[查看视频]</a>"%}{%$weiboFactor.topicurl = "#<a href=\"%s\" target=\"_blank\"  name=\"weibo_topic\">%s</a>#"%}{%$weiboUrl["t.sohu"] = "http://t.sohu.com/n/%s"%}{%$weiboUrl["t.qq"] = "http://t.qq.com/%s"%}{%$weiboUrl["t.163"] = "http://t.163.com/?nickName=%s"%}{%$weiboUrl["t.sina"] = "http://weibo.com/n/%s"%}{%function name=display_weibo_factor%}{%if $pusher == "t.qq"%}{%$urlComponent=$cont|escape:'html'%}{%else%}{%$urlComponent=$url|escape:'html'%}{%/if%}{%if $type == "needmerge"%}{%sprintf($weiboFactor.needmerge,sprintf($weiboUrl[$pusher],$urlComponent),$url|escape:'html')%}{%/if%}{%if $type == "needmergecall"%}{%sprintf($weiboFactor.needmergecall,sprintf($weiboUrl[$pusher],$urlComponent),$url|escape:'html')%}{%/if%}{%if $type == "url"%}{%sprintf($weiboFactor.url,$url,$url|escape:'html')%}{%/if%}{%if $type == "picurl"%}{%if $pusher == "t.sina"%}{%$urlMid =  str_replace("thumbnail","bmiddle",$url)%}{%$urlBig =  str_replace("thumbnail","large",$url)%}{%else%}{%$urlMid =  $url%}{%/if%}{%if $pusher == "t.qq"%}{%sprintf($weiboFactor.picurl_qq,$url|escape:'html',$url|escape:'html',$url|escape:'html')%}{%else%}{%sprintf($weiboFactor.picurl,$url|escape:'html',$urlMid|escape:'html',$urlBig|escape:'html')%}{%/if%}{%/if%}{%if $type == "videourl"%}{%sprintf($weiboFactor.videourl,$url|escape:'html')%}{%/if%}{%if $type == "topicurl"%}{%sprintf($weiboFactor.topicurl,$url|escape:'html',$cont|escape:'html')%}{%/if%}{%/function%}{%function name=display_weibo_content%}{%$_weiBoUrl = $data.WeiBoUrl%}{%$contArray = split("\21",$data[$contName]|highlight:3)%}{%$_count = "`$prefix`Num"%}{%$offset = 1%}{%foreach $contArray as $cont%}{%$cont%}{%if $offset<=$data[$_count]%}{%$_url = "`$prefix`Url`$offset`"%}{%$_type = "`$prefix`Type`$offset`"%}{%$_cont = "`$prefix`Cont`$offset`"%}{%display_weibo_factor pusher=$data.WeiBoPusherName type=$data[$_type] wurl=$_weiBoUrl url=$data[$_url] cont=$data[$_cont]%}{%/if%}{%$offset = $offset + 1%}{%/foreach%}{%/function%}{%$weiboData = $res.dispData%}{%$sina_args =($weiboData.WeiBoPusherName=="t.sina")?"?c=spr_qdhz_bd_baidusmt_weibo_s":""%}<li id="{%$resIndex|escape:'html'%}"{%if $classType=='1'%} class="weibo_first"{%/if%}><div class="weibo_face"><a target="_blank" name="weibo_face" href=
                {%if $weiboData.WeiBoUserID || $weiboData.WeiBoNick%}
                {%if $weiboData.WeiBoPusherName == 't.qq'%}"{%enc_url url="http://t.qq.com/`$weiboData.WeiBoUserID`"%}"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.sohu'%}"{%enc_url url="http://t.sohu.com/n/`$weiboData.WeiBoNick`"%}"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.163'%}"{%enc_url url="http://t.163.com/?nickName=`$weiboData.WeiBoNick`"%}"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.sina'%}"{%enc_url url="http://weibo.com/n/`$weiboData.WeiBoNick`?c=spr_qdhz_bd_baidusmt_weibo_s"%}"{%/if%}
                {%/if%}
                ><img name="weibo_face" src="{%if $weiboData.weibo_head_pic.icon%}{%$weiboData.weibo_head_pic.icon|escape:'html'%}{%else%}/cache/midpage/baiduwb/img/weibo_face_default.png{%/if%}"/></a></div><div class="weibo_detail"><p>{%if $weiboData.WeiBoUserID || $weiboData.WeiBoNick%}{%if $weiboData.WeiBoPusherName == 't.qq'%}<a href="{%enc_url url="http://t.qq.com/`$weiboData.WeiBoUserID`"%}" target="_blank" name="weibo_rootnick">{%$weiboData.WeiBoNick|escape:'html'%}</a>{%/if%}{%if $weiboData.WeiBoPusherName == 't.sohu'%}<a href="{%enc_url url="http://t.sohu.com/n/`$weiboData.WeiBoNick`"%}" target="_blank" name="weibo_rootnick">{%$weiboData.WeiBoNick|escape:'html'%}</a>{%/if%}{%if $weiboData.WeiBoPusherName == 't.163'%}<a href="{%enc_url url="http://t.163.com/?nickName=`$weiboData.WeiBoNick`"%}" target="_blank" name="weibo_rootnick">{%$weiboData.WeiBoNick|escape:'html'%}</a>{%/if%}{%if $weiboData.WeiBoPusherName == 't.sina'%}<a href="{%enc_url url="http://weibo.com/n/`$weiboData.WeiBoNick`?c=spr_qdhz_bd_baidusmt_weibo_s"%}" target="_blank" name="weibo_rootnick">{%$weiboData.WeiBoNick|escape:'html'%}</a>{%/if%}{%if $weiboData.weibo_head_pic.userLevel%}<span class="weibo_level_icon weibo_level_icon_{%$weiboData.weibo_head_pic.userLevel|escape:'html'%}"></span>{%/if%}：{%/if%}{%display_weibo_content data=$weiboData contName="WeiBoContent" prefix="WeiBoContIn" %}{%if $weiboData.WeiBoPushType != 1%}<a class="weibo_all" data-click="{'rsv_wb':'weibo_detail'}" target="_blank" href="{%enc_url url="`$weiboData.WeiBoUrl|encodeURI``$sina_args`"%}">查看全文>></a>{%/if%}</p>{%if $weiboData.WeiBoPushType == 1%}<div class="weibo_tip"><span></span></div><p class="weibo_from">{%if $weiboData.WeiBoRUserID || $weiboData.WeiBoRNick%}{%if $weiboData.WeiBoPusherName == 't.qq'%}<a href="{%enc_url url="http://t.qq.com/`$weiboData.WeiBoRUserID`"%}" target="_blank" name="weibo_nick">{%$weiboData.WeiBoRNick|escape:'html'%}</a>：{%/if%}{%if $weiboData.WeiBoPusherName == 't.sohu'%}<a href="{%enc_url url="http://t.sohu.com/n/`$weiboData.WeiBoRNick`"%}" target="_blank" name="weibo_nick">{%$weiboData.WeiBoRNick|escape:'html'%}</a>：{%/if%}{%if $weiboData.WeiBoPusherName == 't.163'%}<a href="{%enc_url url="http://t.163.com/?nickName=`$weiboData.WeiBoRNick`"%}" target="_blank" name="weibo_nick">{%$weiboData.WeiBoRNick|escape:'html'%}</a>：{%/if%}{%if $weiboData.WeiBoPusherName == 't.sina'%}<a href="{%enc_url url="http://weibo.com/n/`$weiboData.WeiBoRNick`?c=spr_qdhz_bd_baidusmt_weibo_s"%}" target="_blank" name="weibo_rootnick">{%$weiboData.WeiBoRNick|escape:'html'%}</a>：{%/if%}{%/if%}{%display_weibo_content data=$weiboData contName="WeiBoRootContent" prefix="WeiBoRContIn"%}</p><p><a class="weibo_all" data-click="{'rsv_wb':'weibo_detail'}" target="_blank" href="{%enc_url url="`$weiboData.WeiBoUrl|encodeURI``$sina_args`"%}">查看全文>></a></p>{%/if%}{%$sina_suffix_comment = ($weiboData.WeiBoPusherName=="t.sina")?"?c=spr_qdhz_bd_baidusmt_weibo_s&type=comment":""%}{%$sina_suffix_repost = ($weiboData.WeiBoPusherName=="t.sina")?"?c=spr_qdhz_bd_baidusmt_weibo_s&type=repost":""%}<div class="weibo_info"><div class="weibo_pz"><a href="{%enc_url url="`$weiboData.WeiBoUrl|encodeURI``$sina_suffix_repost`"%}" name="weibo_trans" target="_blank">转发({%if isset($weiboData.weibo.trans)%}{%$weiboData.weibo.trans|escape:'html'%}{%else%}0{%/if%})</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="{%enc_url url="`$weiboData.WeiBoUrl|encodeURI``$sina_suffix_comment`"%}" target="_blank" name="weibo_ping">评论({%if isset($weiboData.weibo.review)%}{%$weiboData.weibo.review|escape:'html'%}{%else%}0{%/if%})</a></div><div class="m"><a target="_blank" href="{%enc_url url="`$weiboData.WeiBoUrl|encodeURI``$sina_args`"%}">{%display_time serverTime=$serverTime second=$weiboData.WeiBoPubTime%}</a>&nbsp;-&nbsp;<a target="_blank" href=
                {%if $weiboData.WeiBoUserID || $weiboData.WeiBoNick%}
                {%if $weiboData.WeiBoPusherName == 't.qq'%}"http://t.qq.com/"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.sohu'%}"http://t.sohu.com/"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.163'%}"http://t.163.com/"{%/if%}
                {%if $weiboData.WeiBoPusherName == 't.sina'%}"http://weibo.com/?c=spr_qdhz_bd_baidusmt_weibo_s"{%/if%}
                {%/if%}
                >{%weibotype type=$weiboData.WeiBoPusherName%}</a></div></div></div></li>{%/fis_widget%}