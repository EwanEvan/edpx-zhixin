<?php 
  class CssJs_Util_curve
   {
      private static $cssStr = '.op_curve_title{font-size:1.07em;color:#666;font-weight:bold;}.op_curve_subtitle{font-size:1.84em;color:#000;font-family:"Microsoft YaHei",SimHei;}.op_curve_map_canvas{margin:0 140px 35px 50px;display:block;}.op_curve_map_mask,.op_curve_map_bg{position:absolute;top:0;left:50px;}.op_curve_map_bg{z-index:-1;}.op_curve_map_x{position:absolute;bottom:0;left:50px;height:25px;}.op_curve_map_y{position:absolute;left:0;top:0;width:50px;}.op_curve_info{position:absolute;right:0;top:0;width:130px;}.op_curve_map_x span,.op_curve_map_y span{position:absolute;font-size:.92em;white-space:nowrap;color:#666;}.op_curve_map_y span{display:block;text-align:right;width:90%;}.op_curve_map_x span i{position:absolute;left:50%;top:-10px;border:none;border-left:1px solid #ebebeb;width:1px;height:4px;line-height:4px;display:block;}.op_curve_info li{padding-left:30px;font-size:.92em;}.op_curve_info_icon{position:absolute;left:15px;}.op_curve_info a{text-decoration:none;color:#333;}.op_curve_map_x .op_curve_tips{position:absolute;background:#bdc1c7;color:#fff;white-space:nowrap;padding:0 5px;height:20px;line-height:20px;font-size:.77em;}.op_curve_tools a{text-decoration:none;}.op_curve_tools a:hover{text-decoration:underline;}.op_curve_tools{color:#999;font-size:.92em;text-align:right;}.op_curve_tools a{color:#999;}.op_curve_tools_sep{color:#ccc;margin:0 8px;}';  // css字串，不含<style>和</style>标签
      private static $jsStr  = 'A.merge("curve",function(){A.setup(function(){var s=this;var t=["rgb(56,139,255)","rgb(255,179,26)","rgb(88,199,88)"];var n=["rgba(56,139,255,0.3)","rgba(255,179,26,0.3)","rgba(88,199,88,0.3)"];var r=["rgba(255,185,178,0.1)","rgba(178,217,255,0.1)","rgba(179,255,178,0.1)"];var i=s.find(".op_curve_map_canvas")[0];var m=s.find(".op_curve_map_bg",s)[0];var B=s.find(".op_curve_map_mask",s)[0];var u=s.data.queryLineWidth||3,g=s.data.normalLineWidth||1,f=s.data.hoverLineWidth||3,x=s.data.queryPoint||5,y=s.data.normalPoint||3;var p=null;var c=null;var e=null;var b=s.find(".op_curve_info");s.find(".op_curve_tools_fb").on("click",function(){$(this).hide().after("<span>感谢反馈</span>")});if(i){var q=!!document.createElement("canvas").getContext;if(!q){A.use("canvas",function(){A.ui.canvas.init(i);A.ui.canvas.init(B);A.ui.canvas.init(m);l()})}else{l()}}function l(){var S=i.getContext("2d");var W=B.getContext("2d");var N=m.getContext("2d");var M=[];for(var Q=0;Q<s.data.data.length;Q++){s.data.data[Q].p=s.data.data[Q].p.replace(/\\;$/,"");var D=s.data.data[Q].p.split(";");M[Q]=[];for(var P=0;P<D.length;P++){var J=D[P].split(",")[0];var G=D[P].split(",")[1];var R=D[P].split(",")[2];var H=D[P].split(",")[3];M[Q].push({x:J,y:G,sx:w(J),sy:v(G),xText:R,yText:H})}if(s.data.data[Q].order=="1"){p=M[Q][M[Q].length-1].x}}N.strokeStyle="#ebebeb";var I=[];s.data.ycell.reverse();for(var Q=0;Q<s.data.ycell.length;Q++){var O=v(s.data.ycell[Q].value);if(O>0){C(N,0,O,i.width,O);I.push("<span style=\'top:"+O+"px\'>"+s.data.ycell[Q].text+"</span>")}}if(s.data.xzero&&s.data.xzero=="false"){}else{C(N,0,i.height-0.5,i.width,i.height-0.5);I.push("<span style=\'top:100%\'>0</span>")}s.find(".op_curve_map_y").html(I.join(""));var T=[];for(var Q=0;Q<s.data.xcell.length;Q++){var U=w(s.data.xcell[Q].value);T.push("<span class=\'c-gap-top\' style=\'left:"+U+"px\'><i></i>"+s.data.xcell[Q].text+"</span>")}s.find(".op_curve_map_x").html(T.join(""));$("span",".op_curve_map_y").each(function(){$(this).css("margin-top",-($(this).height()/2))});$("span",".op_curve_map_x").each(function(){$(this).css("margin-left",-($(this).width()/2))});var L=[];for(var Q=0;Q<M.length;Q++){if(s.data.data[Q].order==1){c=M[Q]}var K=M[Q][0];var E=M[Q][M[Q].length-1];z(S,M[Q],t[s.data.data[Q].order-1],s.data.data[Q].order==1?u:g);if(p==M[Q][M[Q].length-1].x){var V=E.yText}else{var V="-"}L.push("<li class=\'c-gap-bottom\'><span class=\'op_curve_info_icon\' style=\'color:"+t[s.data.data[Q].order-1]+"\'>●</span><a href=\'http://wwww.baidu.com/s?ie=utf-8&wd="+s.data.data[Q].queryWord+"\'><span>"+s.data.data[Q].name+"</span>：<p>"+V+"</p><p>"+E.xText+"</p></a></li>")}if(c){z(S,c,t[0],u)}b.html(L.join(""));var F=null;s.find(B).on("mousemove",function(af){var Y=h(i);var ag={x:(af.pageX||(af.clientX+document.documentElement.scrollLeft))-Y.left,y:(af.pageY||(af.clientY+document.documentElement.scrollTop))-Y.top};var ac=d(ag.x,M);var Z={x:ac.sx,y:ac.sy};if(F===null||Z.x!==F){W.clearRect(0,0,this.width,this.height);W.strokeStyle="#bdc1c7";j(W,Z.x,0,Z.x,i.height,1);var ab=null;for(var ad=0;ad<M.length;ad++){if(s.data.data[ad].order==1){ab=M[ad]}W.fillStyle=t[s.data.data[ad].order-1];var X=(s.data.data[ad].order==1)?x:y;o(W,Z.x,a(ac.x,M[ad]).sy,X)}W.fillStyle=t[0];o(W,Z.x,a(ac.x,ab).sy,5);F=Z.x;if(s.find(".op_curve_tips").length<=0){s.find(".op_curve_map_x").append("<span class=\'op_curve_tips\'></span>")}var ae=s.find(".op_curve_tips");ae.html(ac.xText);ae.show();ae.each(function(){$(this).css({left:Z.x,"margin-left":-($(this).outerWidth()/2)})});var aa=b.find("li");aa.each(function(ah){var ai=a(ac.x,M[ah]);if(ai=="-10"){$("p:first",this).html("-");$("p:last",this).html("")}else{$("p:first",this).html(ai.yText);$("p:last",this).html(ac.xText)}})}});s.find(B).on(navigator.userAgent.indexOf("msie")!=-1?"mouseleave":"mouseout",function(Y){F=null;W.clearRect(0,0,this.width,this.height);s.find(".op_curve_tips").hide();var X=b.find("li");X.each(function(Z){if(p==M[Z][M[Z].length-1].x){$("p:first",this).html(M[Z][M[Z].length-1].yText)}else{$("p:first",this).html("-")}$("p:last",this).html(M[Z][M[Z].length-1].xText)})});b.find("li").hover(function(){clearTimeout(e);b.find("a").css("color","#999");b.find(".op_curve_info_icon").css({opacity:"0.3",filter:"alpha(opacity=50)"});$("a",this).css("color","#333");$(".op_curve_info_icon",this).css({opacity:"1",filter:"alpha(opacity=100)"});$("a>span",this).css("text-decoration","underline");S.clearRect(0,0,i.width,i.height);for(var Y=0;Y<M.length;Y++){var Z=t[s.data.data[Y].order-1];var X=f;if(Y!=$(this).index()){Z=n[s.data.data[Y].order-1];X=1}z(S,M[Y],Z,X)}},function(){b.find("a>span").css("text-decoration","none");e=setTimeout(function(){b.find("a").css("color","#333");b.find(".op_curve_info_icon").css({opacity:"1",filter:"alpha(opacity=100)"});S.clearRect(0,0,i.width,i.height);for(var X=0;X<M.length;X++){z(S,M[X],t[s.data.data[X].order-1],s.data.data[X].order==1?u:g)}if(c){z(S,c,t[0],u)}},100)})}function h(E){var D=0,F=0;while(E!=null){D+=E.offsetLeft;F+=E.offsetTop;E=E.offsetParent}return{left:D,top:F}}function d(E,G){var H=null;for(var F=0;F<G.length;F++){for(var D=0;D<G[F].length;D++){if(H===null||Math.abs(G[F][D]["sx"]-E)<Math.abs(H.sx-E)){H=G[F][D]}}}return H}function a(E,D){for(var F=0;F<D.length;F++){if(D[F].x==E){return D[F]}}return -10}function w(E){if(s.data.xtype&&s.data.xtype=="date"){var F=(new Date(E)).getTime();var G=(new Date(s.data.xmax)).getTime();var D=(new Date(s.data.xmin)).getTime();var H=Math.round(s.data.escaped_canvasWidth*(F-D)/(G-D))}else{var H=Math.round(s.data.escaped_canvasWidth*(E-s.data.xmin)/(s.data.xmax-s.data.xmin))}if(H>s.data.escaped_canvasWidth){return H-0.5}else{return H+0.5}}function v(H){if(H<0){return -10}if(s.data.ytype&&s.data.ytype=="date"){var E=(new Date(H)).getTime();var D=(new Date(s.data.ymax)).getTime();var F=(new Date(s.data.ymin)).getTime();var G=Math.round(s.data.escaped_canvasHeight-s.data.escaped_canvasHeight*(E-F)/(D-F))}else{var G=Math.round(s.data.escaped_canvasHeight-s.data.escaped_canvasHeight*(H-s.data.ymin)/(s.data.ymax-s.data.ymin))}G+=5;if(G>i.height){return G-0.5}else{return G+0.5}}function z(F,H,J,D){F.strokeStyle=J;F.beginPath();var I=H[0];var G=H[H.length-1];F.moveTo(I.sx,I.sy);for(var E=0;E<H.length-1;E++){F.lineWidth=D;k(F,H[E].sx,H[E].sy,H[E+1].sx,H[E+1].sy)}F.stroke()}function k(G,E,H,D,F){G.lineTo(D,F)}function C(G,E,H,D,F){G.beginPath();G.moveTo(E,H);G.lineTo(D,F);G.stroke()}function j(F,G,M,D,L,E){E=E===undefined?5:E;var I=D-G;var H=L-M;var K=Math.floor(Math.sqrt(I*I+H*H)/E);F.beginPath();for(var J=0;J<K;++J){F[J%2===0?"moveTo":"lineTo"](G+(I/K)*J,M+(H/K)*J)}F.closePath();F.stroke()}function o(E,D,G,F){E.beginPath();E.arc(D,G,F,0,Math.PI*2);E.closePath();E.fill()}this.dispose=function(){clearTimeout(e)}})});';   // js字串，不含<script标签
      private static $uiList = '';   // 包含的组件，以','分割的字符串，比如'input,text,button'这样
      
      public static function getHeadCss()
      {
         if (!is_string(self::$cssStr))
         {
            return '';
         }
         return self::$cssStr;
      }
      
      public static function getFootJs()
      {
         if (!is_string(self::$jsStr))
         {
            return '';
         }
         return self::$jsStr;
      }
      
      // 返回数组
      public static function getCssUI()
      {
		 if ( empty(self::$uiList) ) return array();

         $arr = @explode(',', self::$uiList);
         if (!is_array($arr))
         {
            $arr = array();
         }
         return $arr;
      }
   }
