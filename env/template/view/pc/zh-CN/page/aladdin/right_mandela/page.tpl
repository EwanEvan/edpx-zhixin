{%extends 'right_base.tpl'%} {%block name='content'%}<style>.opr-bless{font-size:12px;color:#333;height:52px;background:url(http://www.baidu.com/aladdin/img/bless/mandela.png) no-repeat;padding-top:13px;position:relative;zoom:1;overflow:hidden}.container_l .opr-bless{width:440px}.container_s .opr-bless{width:270px}.opr-bless .opr-bless-prey{margin:24px 0 0 13px;color:#fff;*margin-top:36px}.opr-bless-btn{background:url(http://www.baidu.com/aladdin/img/bless/mandela.png) no-repeat 0 -77px;width:57px;height:23px;line-height:22px;*line-height:23px;pad{%*i*%}ding-left:35px;display:inline-block;cursor:pointer;color:#784624}.opr-bless-btn2{background-position:-128px -77px;cursor:default}.opr-bless-heart{position:absolute;top:80px;left:175px}.opr-bless-num{margin-left:10px;color:#a6580c}.opr-bless-num b{color:#b58122;margin:0 2px}.opr-bless-player{width:0;height:1;overflow:hidden}.opr-bless-fly{width:100px;height:90px;position:absolute;overflow:hidden;top:30px;zoom:1;display:none}.container_l .opr-bless-fly{left:420px}.container_s .opr-bless-fly{left:2{%*i*%}50px}.opr-bless-dove{width:200px;height:90px;background:url('http://www.baidu.com/aladdin/img/right_bless/dove.png') no-repeat;position:absolute;top:0;left:0;_background:0;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://www.baidu.com/aladdin/img/right_bless/dove.png')}.opr-bless-version{color:#666;font-size:12px;margin-top:3px}</style><div class="opr-bless-style"> <style type="text/css">html{filter:grayscale(100%);-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);{%*i*%}-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);-webkit-filter:grayscale(1)}</style></div><div class="opr-bless"> <div class="opr-bless-prey"> <span class="opr-bless-btn">送上祝福</span><span class="opr-bless-num">已有<b></b>人祝福</span> </div> <div class="opr-bless-fly"><div class="opr-bless-dove"></div></div> <div class="opr-bless-player"></div></div>{%if $tplData.version%}<div class="opr-bless-version">{%$tplData.version%}</div>{%/if%}<script >
    A.setup({ 'musicUrl': '{%$tplData.music%}' });
</script><script>A.setup(function(){var _this = this,isMotionPlay = false,isFirstClick = false,$btn = _this.find('.opr-bless-btn').eq(0),playerBox = _this.find('.opr-bless-player')[0],styleBox = _this.find('.opr-bless-style')[0],playMusic,num = 0,rmtimer,flyCir, doveCir;var ajaxFinished = false;$btn.on('click', function(){if(isFirstClick)return;$btn.addClass('opr-bless-btn2');fly();var numDom = _this.find('.opr-bless-num b')[0];if (numDom && numDom.innerHTML != '') {num = parseInt(numDom.innerHT{%*i*%}ML, 10);numDom.innerHTML = num + 1;}up();styleBox.parentNode.removeChild( styleBox );isFirstClick = true;});function fly() {var oldLeft, oldTop, flag, doveSpeed, totalTime,flySpeed, doveObj, flyObj, stop, curTime, perX, perY;doveObj = _this.find( '.opr-bless-dove' )[0];flyObj = _this.find( '.opr-bless-fly' )[0];doveSpeed = 200;flySpeed = 30;doveCir = window.setInterval(function() {if ( flag ) {doveObj.style.left = '-100px';flag = 0;} else {doveObj.style.left = '0';flag = 1;}}, doveSpeed );oldLef{%*i*%}t = parseInt( flyObj.style.left, 10 );oldTop = parseInt( flyObj.style.top, 10 );curTime = 0;totalTime = 70;perX = ( -100 - oldLeft ) / totalTime;perY = ( -70 - oldTop ) / totalTime;flyObj.style.display = 'block';flyCir = window.setInterval(function() {flyObj.style.left = ( oldLeft += perX ) + 'px';flyObj.style.top = ( oldTop += perY ) + 'px';if ( curTime == totalTime ) {stop();return;}curTime ++;}, flySpeed );stop = function() {clearInterval( doveCir );clearInterval( flyCir );doveObj = null;flyO{%*i*%}bj.parentNode.removeChild( flyObj );flyObj = null;};};playMusic = (function() {var support, audio, swf;if ( isFirstClick ) {return;}try{if(document.createElement("audio").play && (/firefox\/(\d+\.\d+)/i.test(navigator.userAgent) ? + RegExp['\x241'] : undefined) == undefined){support = true;playerBox.innerHTML = '<audio id="GaokaoAudioPlayer"></audio>';audio = _this.find("#GaokaoAudioPlayer")[0];}}catch(e){}if ( !support ) {playerBox.innerHTML = '<object id="GaokaoFlashPlayer" width="1" height="1{%*i*%}" type="application/x-shockwave-flash" data="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="movie" value="http://www.baidu.com/aladdin/img/right_gaokao/audioplayer.swf"><param name="allowScriptAccess" value="always" /></object>';swf = _this.find("#GaokaoFlashPlayer")[0];}return {play: function( src ) {var self = this;try {audio && ( audio.src = src, audio.play() );swf && ( swf.uri(src), swf.playMp3() );} catch( e ) {rmtimer = setTimeout(function() {self.play( src );}{%*i*%}, 13);}},pause: function() {audio ? ( audio.pause() ) : ( swf.stopMp3() );}}}());function up(){$.ajax({url:"http://codemonkey.baidu.com/bin/index.php?ie=utf-8&oe=utf-8&format=json&client_token=2d2d18dbcd408a334fc6b6497e5d95f1&client_id=4&add_count=true&t="+new Date().getTime()+'&cb=rmandela',dataType:'jsonp',success:function(data){},jsonpCallback:'rmandela'}); }$.ajax({url:"http://codemonkey.baidu.com/bin/index.php?ie=utf-8&oe=utf-8&format=json&client_token=2d2d18dbcd408a334fc6b6497e5d95f1&clien{%*i*%}t_id=4&get_count=true&t="+new Date().getTime()+'&cb=rmandela',dataType:'jsonp',success:function(data){ if(ajaxFinished) return;num = data.data.sum || 0;_this.find('.opr-bless-num b')[0].innerHTML = num;},error:function(){num = -1;_this.find('.opr-bless-num')[0].innerHTML = '点击送上祝福';},timeout:5000,jsonpCallback:'rmandela'});if ( _this.data.musicUrl.length > 0 ) {playMusic.play( _this.data.musicUrl );}this.dispose = function(){clearTimeout(rmtimer);window.clearInterval(doveCir);window.clearInterva{%*i*%}l(flyCir);if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}