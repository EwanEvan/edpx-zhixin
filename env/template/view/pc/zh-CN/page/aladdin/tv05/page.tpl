{%extends 'c_base.tpl'%} {%block name='content'%}<div class="op_tv05_content" data-distype="{%$tplData.distype%}"> {%if $tplData.distype==1%}<a class="op_tv05_tvmore" href="{%$tplData.tvtabcount[0]['moresrc']%}" target="_blank" {%if $tplData.tvtab|@count>4%}style="display:block;"{%else%}style="display:none;"{%/if%}>{%$tplData.tvtabcount[0]['tvtabmore']|escape:'html'%}>></a>{%/if%}<div class="c-tabs {%if $tplData.distype==1%} op_tv05_tvtabs op_tv05_tvtabs_all {%/if%}"> {%*电视台总 类型1*%} {%if $tplData.distype==1%} <ul class="c-tabs-nav"> {%$moreLength = 0%} {%foreach $tplData.tvtab as $item%} {%if $item@index>4%}{%break%}{%/if%} {%$item['tvtabname']=$item['tvtabname']|limitlen:22%} {%$moreLength=$moreLength +(mb_strlen($item['tvtabname'],'utf-8')+strlen($item['tvtabname']))/2%} {%if $moreLength<=38 %} {%if !$item@first%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN op_tv05_tvtab" data-tvtabid="{%$item['tvtabid']%}"> <a>{%$item['tvtabname']|limitlen:22|escape:'html'%}</a><span></span> </li> {%/if%} {%/foreach%} </ul> {%/if%} {%*电视台 类型2*%} {%if $tplData.distype==2 || $tplData.distype==3%} <ul class="c-tabs-nav"> {%*统计所有电视台天数*%} {%$weekdate=$smarty.now|date_format:'%m%d'%} {%$noday='true'%} {%foreach $tplData.weektab as $item%} {%$day=$item['weekdate']|replace:"-":""%} {%if $day>=$weekdate%} {%if $noday!='true'%}<li class="c-tabs-nav-sep"></li>{%/if%} <li class="c-tabs-nav-li OP_LOG_BTN op_tv05_tvtab " data-weekdate="{%$item['weekdate']%}" data-weekid="{%$item['weekid']%}"> <a>{%$item['weekday']|escape:'html'%}</a> <span style="display:none;">{%$item['weekdate']|escape:'html'%}</span> </li> {%$noday='false'%} {%/if%} {%/foreach%} </ul> {%/if%} </div> <div class="c-tabs "> <div class="c-tabs c-tabs-content zz_tv05_tvcontent"> {%if $tplData.distype==1%} {%*统计所有电视台周*%} <ul class="c-tabs-nav op_tv05_table"> </ul> {%/if%} <div class="op_tv05_table_list"></div> </div> </div> <div class="op_tv05_open op_tv05_hidden OP_LOG_BTN" ><a href="#" onclick="return false;"  class="c-icon c-icon-chevron-unfold c-gap-right-small"></a>展开查看更多</div> <div class="op_tv05_close op_tv05_hidden OP_LOG_BTN"><a href="#" onclick="return false;"  class="c-icon c-icon-chevron-fold c-gap-right-small"></a>收起</div></div><script type="text/javascript">A.setup({'originQuery': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}','srcid':'{%$extData.resourceid%}'});</script><script>A.setup(function() {var _this = this,tableList = _this.find('.op_tv05_table_list').eq(0),open = _this.find('.op_tv05_open').eq(0),close = _this.find('.op_tv05_close').eq(0),disType = _this.find('.op_tv05_content').get(0),tab = _this.find('.c-tabs-nav-li'),tabActive = tab[0],count=0,day = new Date({%time()%}*1000),distypenum = disType.getAttribute('data-distype'),ajaxCount = 0;var originQuery = _this.data.originQuery,srcid = _this.data.srcid;A.use('tabs5', function(){function setString(str,len){if(str.length*2 <= len){return str;}var strlen = 0; var newstr = "";for(var i = 0;i < str.length; i++){if(str.charCodeAt(i) > 128){ strlen = strlen + 2;if(strlen > len){return newstr.substring(0,newstr.length-1) + "...";}}else{strlen = strlen + 1;if(strlen > len){return newstr.substring(0,newstr.length-2) + {%*i*%}"...";}}newstr = newstr + str.charAt(i);}return newstr;};function hideBr() {var next = _this.container.nextSibling;if (next && next.nodeType == 1 && next.tagName == 'BR') {next.style.display = 'none';}}function toDouble(num){return parseInt(num,10)<10?'0'+parseInt(num,10):''+num;}function strTime(time){return time.replace(/[\:|：|\-]/g,'');}function nowTime(){return day.getHours()+''+day.getMinutes();}function nowDay(){var month = toDouble(day.getMonth()+1);var days = toDouble(day.getDate());retu{%*i*%}rn month+''+days;}function compareTime(t1,t2){return parseInt(t1,10)<parseInt(strTime(t2),10)?1:0;}function tabPro(obj){var strtit='';if(obj['href'] && obj['href']!='' && distypenum==3){strtit += '<a href="'+obj["href"]+'" target="_blank">'+setString(obj["title"],28)+'</a>';}else if(obj['href'] && obj['href']!='' && distypenum==2){strtit += '<a href="'+obj["href"]+'" target="_blank">'+setString(obj["title"],28)+'</a>';}else if(obj['href'] && obj['href']=='' && distypenum==3){strtit += setString({%*i*%}obj["title"],28);}else{strtit += setString(obj["title"],28);}strtit += '<div class="op_tv05_abs"> ';if(obj['plot'] && obj['plot']!='' && obj['plotname'] && obj['plotname']!=''){strtit += '<a class="c-gap-right-small" href="'+obj['plot']+'" target="_blank">'+setString(obj['plotname'],5)+'</a>';}if(obj['castlist'] && obj['castlist']!='' && obj['castlistname'] && obj['castlistname']!=''){strtit += '<a class="c-gap-right-small" href="'+obj['castlist']+'" target="_blank">'+setString(obj['castlistname{%*i*%}'],8)+'</a>';}if(obj['picture'] && obj['picture']!='' && obj['picturename'] && obj['picturename']!=''){strtit += '<a class="c-gap-right-small" href="'+obj['picture']+'" target="_blank">'+setString(obj['picturename'])+'</a>';}strtit += '</div>';return strtit;}function strListVisible(str,dataNumber){if(str!='' && dataNumber>6){str='<table class="c-table ">'+str+'</table>';tableList.removeClass('op_tv05_nodata');open.removeClass('op_tv05_hidden');tableList.html(str);}else if(str!=''){str='<table cl{%*i*%}ass="c-table ">'+str+'</table>';tableList.removeClass('op_tv05_nodata');open.addClass('op_tv05_hidden');tableList.html(str);}else{tableList.addClass('op_tv05_nodata');tableList.html('<div style="text-align: center;">暂无本日节目信息，请稍后查询</div>');open.addClass('op_tv05_hidden');}}function listPro(data,weekid){var data=data[0],tvname=data['tvname'],tvprogram=data['tvprogram'],strSpan='',str='',dataNumber=0;$.each(tvname,function(i,o){if(o['weekid']==weekid ){if(dataNumber<6){str += '<span class="op_tv05_{%*i*%}tvpro">'+o['tvname']+'</span>';dataNumber++;}else{str += '<span class="op_tv05_tvpro op_tv05_lihidden">'+o['tvname']+'</span>';dataNumber++;}$.each(tvprogram,function(i,obj){if(obj['tvnameid']==o['tvnameid'] && obj['weekid']==weekid){if(dataNumber<6){str += '<tr data-tvnameid="'+obj["tvnameid"]+'" data-weekid="'+obj["weekid"]+'">';}else{str += '<tr class="op_tv05_lihidden" data-tvnameid="'+obj["tvnameid"]+'" data-weekid="'+obj["weekid"]+'">';}str += '<td class="op_tv05_tvtime">'+obj["time"]+'</t{%*i*%}d>'+'<td class="op_tv05_tvtitle"><div class="op_tv05_tvrlt">'+tabPro(obj)+'</div></td>'+'<td class="op_tv05_tvstatus"></td>'+'</tr>';dataNumber++;}});}});strListVisible(str,dataNumber);}function sinTvStatus(obj){var statusstr = '';if(obj['stah'] && obj['stah']=='回放'||obj['stah'] && obj['stah']=='直播中'){statusstr += '<a href="'+obj['stahlink']+'" target="_blank">'+obj['stah']+'</a>';}else if(obj['stah'] && obj['stah']=='本期预告'){statusstr += '<a class="op_tv05_status_bg" href="'+obj['stahlink']+'" t{%*i*%}arget="_blank">'+obj['stah']+'</a>';}return statusstr;}function strUlListSecond(obj){if(distypenum==1){strs='<tr data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'" style="font-weight:bold;">'}else if(distypenum==2){strs='<tr data-weekid="'+obj["weekid"]+'" style="font-weight:bold;">'}str=strs+'<td class="op_tv05_tvtime">'+obj["time"]+'</td>'+'<td class="op_tv05_tvtitle"><div class="op_tv05_tvrlt">'+tabPro(obj)+'</div></td>'+'<td class="op_tv05_tvstatus">'+sinTvStatus(obj)+'</td>'+{%*i*%}'</tr>';return str;}function sinTv(data,weekid,tvtabid){var data=data[0],program=data['program'],str='',topnum=0,dataArr=[];sinTv.UlListTop=function(program){str = '';$.each(program,function(i,obj){if(parseInt(strTime(obj['time'])) == parseInt(nowTime())){topnum=i;return false;}else if(parseInt(strTime(program[program.length-1]['time'])) < parseInt(nowTime())){topnum=program.length-1;return false;}else if(parseInt(strTime(obj['time'])) > parseInt(nowTime())){topnum=i-1;return false;}});};$.each({%*i*%}program,function(i,obj){if(tvtabid && obj['weekid']==weekid && obj['tvtabid']==tvtabid && distypenum==1){dataArr.push(obj);}else if(arguments.length==2 && obj['weekid']==weekid && distypenum==2){dataArr.push(obj);}});if(weekid==day.getDay()){sinTv.UlListTop(dataArr);}if(distypenum==1){$.each(dataArr,function(i,obj){if(weekid==day.getDay(topnum)){if(i<6 && (i<topnum || i>topnum)){str += '<tr data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'">';}else if(i<6 && i==topnum){str += '<tr{%*i*%} data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'" style="font-weight:bold;">';}else if(i>=6 && (i<topnum || i>topnum)){str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'">';}else if(i>=6 && i==topnum){str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'" style="font-weight:bold;">';}}else{if(i<6){str += '<tr data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'">';}else{%*i*%}{str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'" data-tvtabid="'+obj["tvtabid"]+'">';}}str += '<td class="op_tv05_tvtime">'+obj["time"]+'</td>'+'<td class="op_tv05_tvtitle"><div class="op_tv05_tvrlt">'+tabPro(obj)+'</div></td>'+'<td class="op_tv05_tvstatus">'+sinTvStatus(obj)+'</td>'+'</tr>';});}if(distypenum==2){$.each(dataArr,function(i,obj){if(weekid==day.getDay()){if(i<6 && (i<topnum || i>topnum)){str += '<tr data-weekid="'+obj["weekid"]+'">';}else if(i<6 && i==topnum){s{%*i*%}tr += '<tr data-weekid="'+obj["weekid"]+'" style="font-weight:bold;">';}else if(i>=6 && (i<topnum || i>topnum)){str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'">';}else if(i>=6 && i==topnum){str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'" style="font-weight:bold;">';}}else{if(i<6){str += '<tr data-weekid="'+obj["weekid"]+'">';}else{str += '<tr class="op_tv05_lihidden" data-weekid="'+obj["weekid"]+'">';}}str += '<td class="op_tv05_tvtime">'+obj["time"]+'</t{%*i*%}d>'+'<td class="op_tv05_tvtitle"><div class="op_tv05_tvrlt">'+tabPro(obj)+'</div></td>'+'<td class="op_tv05_tvstatus">'+sinTvStatus(obj)+'</td>'+'</tr>';});}strListVisible(str,dataArr.length);}var gloabl='';function tvWeek(data,tvid){var tvWeek = _this.find('.op_tv05_table').get(0),weektab=data['weektab'],str='',slino=true;$.each(weektab,function(i,o){if(o['tvtabid']==tvid && parseInt(strTime(o['weekdate']),10)>=parseInt(nowDay(),10)){var strSing='';if(slino!=true){strSing+='<li class="c-tabs-na{%*i*%}v-sep"></li>';}strSing+='<li class="op_tv05_weektab" data-tvtabid="'+o['tvtabid']+'" data-weekid="'+o['weekid']+'"><span>'+o['weekday']+'</span><span>'+o['weekdate']+'</span><i></i></li>';str+=strSing;slino=false;}});tvWeek.innerHTML=str;}function disTypeAjax(clickid,tvtabid){open.addClass('op_tv05_hidden');close.addClass('op_tv05_hidden');if(distypenum==3){_this.ajax(originQuery, srcid, {co:'tvname[weekid='+clickid+']|tvprogram[weekid='+clickid+']',success:function(data){listPro(data,clickid);}{%*i*%},error: function(){_this.container.style.display="none";hideBr();}});}else if(distypenum==2){_this.ajax(originQuery, srcid, {co:'program[weekid='+clickid+']',success:function(data){sinTv(data,clickid);},error: function(){_this.container.style.display="none";hideBr();}});}else if(distypenum==1){if(tvtabid==undefined){tvtabid=tabActive.getAttribute('data-tvtabid');}_this.ajax(originQuery, srcid, {co:'weektab[tvtabid='+tvtabid+']|program[tvtabid='+tvtabid+',weekid='+clickid+']',success:function(dat{%*i*%}a){tvWeek(data[0],tvtabid);var weektab = _this.find('.op_tv05_weektab');$.each(weektab,function(i,o){if(clickid && o.getAttribute('data-weekid')==clickid){$(o).addClass('c-tabs-nav-selected zz_tv05_week_active '); weekActive=o;}else if(o.getAttribute('data-weekid')==day.getDay() && !clickid){$(o).addClass('c-tabs-nav-selected zz_tv05_week_active ');weekActive=o;}});if(!_this.find('.zz_tv05_week_active').get(0)){$(weektab[0]).addClass('c-tabs-nav-selected zz_tv05_week_active ');weekActive=weektab{%*i*%}[0]; }if(ajaxCount<3){if(!data[0].program.length){disTypeAjax(weekActive.getAttribute('data-weekid'),tvtabid);ajaxCount++;}}if(data[0].program.length){sinTv(data,weekActive.getAttribute('data-weekid'),tvtabid);}tabs(weektab,weekActive,'c-tabs-nav-selected');},error: function(){_this.container.style.display="none";hideBr();}});}}function tabs(tabobj,tabActive,className){$.each(tabobj,function(i,obj){$(obj).on('click',function(){ajaxCount=0;$(tabActive).removeClass(className);$(obj).addClass(class{%*i*%}Name);tabActive = obj;var weekid = obj.getAttribute('data-weekid');if(distypenum==1){if(weekid){var tvtabid = _this.find('.op_tv05_tvactive').get(0);disTypeAjax(weekid,tvtabid.getAttribute('data-tvtabid'));}else{disTypeAjax(day.getDay(),obj.getAttribute('data-tvtabid'));}}else{disTypeAjax(weekid);}})});}open.on('click',function(){var liHidden = _this.find('.op_tv05_lihidden');open.addClass('op_tv05_hidden');close.removeClass('op_tv05_hidden');$.each(liHidden,function(i,o){$(o).removeClass('op_tv{%*i*%}05_lihidden');$(o).addClass('op_tv05_openhidden');});});close.on('click',function(){var liHidden = _this.find('.op_tv05_openhidden');open.removeClass('op_tv05_hidden');close.addClass('op_tv05_hidden');$.each(liHidden,function(i,o){$(o).removeClass('op_tv05_openhidden');$(o).addClass('op_tv05_lihidden');});});var oActive=tab[0],weekid='',oTabActive=0;$(function(){if(distypenum==2){$.each(tab,function(i,o){if(o.getAttribute('data-weekid')==day.getDay()){$(o).addClass('op_tv05_tvactive2');oActive=o{%*i*%};oTabActive=i;disTypeAjax(day.getDay());}});tabs(tab,oActive,'op_tv05_tvactive2');}else if(distypenum==3){var nodataid='';$.each(tab,function(i,o){if(o.getAttribute('data-weekid')==day.getDay()){return false;}else if(parseInt(strTime(o.getAttribute('data-weekdate')),10)>parseInt(nowDay(),10)){nodataid=i;return false;}});$.each(tab,function(i,o){if(o.getAttribute('data-weekid')==day.getDay()){$(o).addClass('op_tv05_tvactive2');oActive=o;oTabActive=i;disTypeAjax(day.getDay());return false;}else if{%*i*%}(parseInt(strTime(o.getAttribute('data-weekdate')),10)>parseInt(nowDay(),10)){$(tab[nodataid]).addClass('op_tv05_tvactive2');oActive=o;oTabActive=i;disTypeAjax(tab[nodataid].getAttribute('data-weekid'));return false;}});tabs(tab,oActive,'op_tv05_tvactive2');}else{$(oActive).addClass('op_tv05_tvactive');tabs(tab,oActive,'op_tv05_tvactive');disTypeAjax(day.getDay());}});var tabsUi=A.ui.tabs5(_this.find('.c-tabs').get(0),{current:oTabActive});if(oActive){tabsUi.showTab(oTabActive);}});});</script>{%/block%}