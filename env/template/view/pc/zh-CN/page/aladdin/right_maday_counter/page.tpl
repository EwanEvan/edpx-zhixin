{%extends 'right_base.tpl'%} {%block name='content'%}<style>.opr-maday_counter{color:#747474;padding-bottom:10px;background:#f5f5f5 url(http://www.baidu.com/aladdin/img/51/fist.gif) right bottom no-repeat}.container_l .opr-maday_counter{width:440px}.container_s .opr-maday_counter{width:270px}.opr-maday_counter-title-s{display:none}.container_l .opr-maday_counter-title-l{display:block}.container_l .opr-maday_counter-title-s{display:none}.container_s .opr-maday_counter-title-l{display:none}.container_s .opr-maday_counter-title-s{display:block}.opr-m{%*i*%}aday_counter td{padding:0;vertical-align:top}.opr-maday_counter-left{width:58px}.opr-maday_counter-pot{width:30px;height:50px;overflow:hidden;margin:0 auto;background-color:#f5f5f5;background-image:url(http://www.baidu.com/aladdin/img/51/bg.gif)}.opr-maday_counter-pot1{background-position:-140px -50px}.opr-maday_counter-pot2{background-position:-140px 0}.opr-maday_counter-button{background:#de493b;padding:0;margin:0;border:0;width:84px;height:26px;text-align:center;color:#fff;cursor:pointer;marg{%*i*%}in-right:5px;float:left}.opr-maday_counter-button-disabled{background:#999;color:#ebebeb}.opr-maday_counter h3{font-family:'微软雅黑';font-size:18px;margin-top:8px}.opr-maday_counter-tip{position:absolute;display:none;color:#de493b;width:100px;text-align:center;left:0}.opr-maday_counter-counter-result{float:left;margin-top:3px}.opr-maday_counter-counter-result b{color:#d93535}</style><div class="opr-maday_counter"> <table style="margin:0;"> <tr> <td class="opr-maday_counter-left"> <div class="opr-ma{%*i*%}day_counter-pot opr-maday_counter-pot1" style="margin-top:10px;"> <div class="opr-maday_counter-pot opr-maday_counter-pot2"></div> </div> </td> <td> <h3 class="opr-maday_counter-title-l">{%$tplData.title|escape%}</h3> <h3 class="opr-maday_counter-title-s">{%$tplData.smalltitle|escape%}</h3> <div style="margin-top:7px;position:relative;" class="c-clearfix"> <span class="opr-maday_counter-tip">+1</span> <button class="opr-maday_counter-button">{%$tplData.buttontext%}</button> <span class="opr-maday_counter-counter-result"></span> <div> </td> </tr> </table></div> <script>A.setup('geturl', '{%$tplData.geturl|escape:'javascript'%}');A.setup('posturl', '{%$tplData.posturl|escape:'javascript'%}');</script><script>A.setup(function(){var _this = this;var ajaxFinished = false,an;var isCounterEnable = true, isLoading = false;var btn = _this.find('.opr-maday_counter-button').eq(0);btn.on('click', function(){if(isCounterEnable && !isLoading){addone();}else{}isLoading = true;});$.ajax({url:_this.data.geturl+'&cb=rmayday',dataType:'jsonp',success:function(data){ if(ajaxFinished) return;if(data.status == 0){shownum(data.data.sum);}},error:function(){shownum();},timeout:5000,jsonpCallback:'rmay{%*i*%}day'});function addone(){$.ajax({url:_this.data.posturl+'&cb=rmayday',dataType:'jsonp',success:function(data){ if(ajaxFinished) return;if(data.data){ animate(parseInt(data.data.sum));}isCounterEnable = false;isLoading = false;},error:function(){shownum();},timeout:5000,jsonpCallback:'rmayday'});}function shownum(num){var elem = _this.find('.opr-maday_counter-counter-result')[0];var num = parseInt(num);if(num >= 0){elem.innerHTML = '送出<b>'+num+'</b>份欢乐';}else{elem.innerHTML = '';}}function animat{%*i*%}e(num){A.use('animation', function(){an = A.ui.animation(function(){var from = {height:50}, to = {height:0};var pot = _this.find('.opr-maday_counter-pot2')[0];this.tween(from).to(to, 1000).delay(500).onUpdate(function(){pot.style.height = this.height + 'px';}).easing( this.Easing.Sinusoidal.In ).onComplete(function(){an.stop();btn.addClass('opr-maday_counter-button-disabled');btn.html('感谢支持');shownum(num);}).start();var tip = _this.find('.opr-maday_counter-tip')[0];tip.style.display = 'block';th{%*i*%}is.tween({x:0}).to({x:100}, 1000).onUpdate(function(){tip.style.top = 0 - this.x * 1.2 + 'px';tip.style.fontSize = this.x + 'px';tip.style.opacity = (100 - this.x)/100;tip.style.filter = 'alpha(opacity='+(100 - this.x)+');';tip.style.lineHeight = this.x + 'px';}).start();}).start();});}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}an&&an.dispose&&an.dispose();};});</script>{%/block%}