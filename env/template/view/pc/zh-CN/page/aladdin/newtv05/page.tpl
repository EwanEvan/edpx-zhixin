{%extends 'c_base.tpl'%} {%block name='content'%}<div class="c-border"><div class="c-tabs"> <ul class="c-tabs-nav c-tabs-nav-movetop op-newtv05-nav"> {%$week = array( '日', '一', '二', '三', '四', '五', '六' )%} {%$nowDate = strtotime(date("Y-m-d",time()))%} {%foreach array_slice($tplData.tab,0,8) as $item%} {%$itemDate = strtotime(str_replace('/','-',$item.time))%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}" data-tabid="{%$item.tabid%}" data-time='{%$item.time%}' {%if $itemDate<$nowDate%}style="display:none;"{%/if%}>星期{%$week[$item.week]|escape%}<span>{%$item.date%}</span></li> {%/foreach%} </ul> <div class="c-tabs-content op-newtv05-content"> {%$count = count($tplData.data)%} {%$ban = ceil($count/2)%} <div class="op-newtv05-contents c-clearfix" style="display:{%if $tplData.open%}block;{%else%}none;{%/if%}"> <div class="op-newtv05-left"> <ul class="op-newtv05-leftul"></ul> </div> <div class="op-newtv05-right"> <ul class="op-newtv05-rightul"></ul> </div> </div> <div class="op-newtv05-contblock c-clearfix" style="display:{%if $tplData.open%}none;{%else%}block;{%/if%}"> <div class="op-newtv05-leftopen"> <ul class="op-newtv05-leftulopen"></ul> </div> <div class="op-newtv05-rightopen"> <ul class="op-newtv05-rightulopen"></ul> </div> </div> {%if $tplData.open%}<div class="op-newtv05-open OP_LOG_BTN" data-click="{fm:'beha'}" style="display:none;">{%$tplData.openword|escape%}<i class="c-icon c-icon-chevron-bottom"></i></div>{%/if%} {%if $tplData.open%}<div class="op-newtv05-close OP_LOG_BTN" data-click="{fm:'beha'}" style="display:none;">收起<i class="c-icon c-icon-chevron-top"></i></div>{%/if%} </div></div></div><div class="c-gap-top-small"> <a href="{%$tplData.more[0].href%}" target="_blank">{%$tplData.more[0].title|escape%}</a></div><script >
    A.setup({
        'originQuery': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}',
        'srcid':'{%$extData.resourceid%}',
        'open':'{%$tplData.open%}'
    });
</script><script>A.setup(function(){var _this = this,contents = _this.find('.op-newtv05-contents')[0],contblock = _this.find('.op-newtv05-contblock')[0],left = _this.find('.op-newtv05-leftul')[0],right = _this.find('.op-newtv05-rightul')[0],leftopen = _this.find('.op-newtv05-leftulopen')[0],rightopen = _this.find('.op-newtv05-rightulopen')[0],tabLi = _this.find('.c-tabs-nav-li'),open = _this.find('.op-newtv05-open')[0],close = _this.find('.op-newtv05-close')[0],originQuery = _this.data.originQue{%*i*%}ry,srcid = _this.data.srcid,openData = _this.data.open,now = new Date({%time()%}*1000),startActive = tabLi[0],tabActive = tabLi[0],tabid = 1,maxHeight = 150,leftLiRemove = 0,rightLiRemove = 0;function getTime(time){return new Date(time).getTime();}$(tabLi).each(function(i,o){if(getTime($(tabLi[tabLi.length-1]).attr('data-time'))<=now){$(tabLi[tabLi.length-1]).addClass('c-tabs-nav-selected');tabActive = $(tabLi[tabLi.length-1]);tabid = tabActive.attr('data-tabid');startActive = tabActive.attr('data-tabid');ajaxData(tabid);}else{if((getTime($(tabLi[i]).attr('data-time'))<=now{%*i*%} && getTime($(tabLi[i+1]).attr('data-time'))>now) || getTime($(tabLi[tabLi.length-1]).attr('data-time'))<=now){$(this).addClass('c-tabs-nav-selected');tabActive = $(this);tabid = $(o).attr('data-tabid');startActive = $(o).attr('data-tabid');ajaxData(tabid);}}$(this).click(function(){if($(tabActive)[0]==$(this)[0]){return false;}if(openData){$(contents).css('display','block');$(contblock).css('display','none');}else{$(contents).css('display','none');$(contblock).css('display','block');}$(left).ht{%*i*%}ml('');$(right).html('');$(leftopen).html('');$(rightopen).html('');leftLiRemove = 0;rightLiRemove = 0;tabActive.removeClass('c-tabs-nav-selected');tabActive = $(this);$(this).addClass('c-tabs-nav-selected');tabid = $(this).attr('data-tabid');ajaxHeadTime(tabid);});});$(open).click(function(){$(contents).css('display','none');$(contblock).css('display','block');$(open).css('display','none');$(close).css('display','block');});$(close).click(function(){$(contents).css('display','block');$(contbloc{%*i*%}k).css('display','none');$(open).css('display','block');$(close).css('display','none');});function ajaxHeadTime(tabid){$.ajax({type: 'HEAD',url:"http://www.baidu.com/aladdin/img/newtv05/ico.png?t="+new Date(),}).done(function(data, textStatus, jqXHR){now = jqXHR && jqXHR.getResponseHeader("Date");if(now){now = new Date(now);}ajaxData(tabid);});}function ajaxData(tabid){_this.ajax(originQuery, srcid, {co:'data[tabid='+tabid+']|zhibo',success:function(data){var data = data[0],datas =data.data,zhib{%*i*%}o = data.zhibo,datasLength = datas.length,ban = Math.ceil(datasLength/2),strleft = '',strright = '',nowtime = '',zhibos = '';$(datas).each(function(i,o){if(startActive == tabid){if(getTime(datas[i].times)<=now){if((i!=datas.length-1 && getTime(datas[i+1].times)>=now) || (i==datas.length-1 && getTime(datas[i].times)>now)){zhibos = zhibo?'<a href="'+zhibo+'" target="_blank">'+o.title+'<i class="op-newtv05-play"></i></a>':o.title+'<i class="op-newtv05-play"></i>';nowtime = ' op-newtv05-ico';}else{z{%*i*%}hibos = o.title;nowtime = ' op-newtv05-oldprograme';}}else{nowtime = '';zhibos = o.title;}}else if(tabid<startActive){zhibos = o.title;nowtime = ' op-newtv05-oldprograme';}else{zhibos = o.title;}if(openData){var strli = '<li class="c-gap-top '+nowtime+'"><div class="op-newtv05-time">'+o.time+'</div><div class="op-newtv05-name">'+zhibos+'</div></li>';if($(left).height()<=maxHeight){if(leftLiRemove==0){$(left).append(strli);}if($(left).height()>maxHeight){leftLiRemove = 1;var liLast = $('.op-newtv{%*i*%}05-leftul li').eq(-1);liLast.remove();}}if(leftLiRemove && $(right).height()<=maxHeight){if(rightLiRemove==0){$(right).append(strli);}if($(right).height()>maxHeight){rightLiRemove = 1;var liLast = $('.op-newtv05-rightul li').eq(-1);liLast.remove();}}if(rightLiRemove){$(open).css('display','block');}else{$(open).css('display','none');}$(close).css('display','none');}if(i<ban){strleft += '<li class="c-gap-top '+nowtime+'"><div class="op-newtv05-time">'+o.time+'</div><div class="op-newtv05-name">'+{%*i*%}zhibos+'</div></li>';}else{strright += '<li class="c-gap-top '+nowtime+'"><div class="op-newtv05-time">'+o.time+'</div><div class="op-newtv05-name">'+zhibos+'</div></li>';}});$(leftopen).html(strleft);$(rightopen).html(strright);},error: function(){}});}});</script>{%/block%}