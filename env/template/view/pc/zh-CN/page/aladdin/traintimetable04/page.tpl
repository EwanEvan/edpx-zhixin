{%extends 'c_base.tpl'%} {%block name="data_modifier"%}{%$extData.feData.hasBorder = true%}{%/block%}{%block name='content'%}{%if $extData.feData.platform === 'ipad'%}<style>.tangram-suggestion td{font-size:1em}</style>{%/if%}<div class="op_traintimetable04_content"><table cellspacing="0" cellpadding="0"> <tr> <td><span class="c-gap-right">按线路查询</span></td> <td> <span class="c-input c-input-small c-gap-right-small op_traintimetable04_start_field"> <i class="c-icon c-icon-map"></i> <input type="text" class="op_traintimetable04_normal" id="op_traintimetable04_start" value="{%if $tplData.defaultcity%}{%$tplData.defaultcity|escape:'html'%}{%else%}{%if $extData.AutoExtendedLocation%}{%$extData.AutoExtendedLocation|escape:'html'%}{%/if%}{%/if%}"/> </span> </td> <td><a class="c-btn c-gap-right-small op_traintimetable04_swap OP_LOG_BTN" href="javascript:;"><i class="c-icon c-icon-exchange"></i></a></td> <td> <span class="c-input c-input-small c-gap-right op_traintimetable04_end_field"> <i class="c-icon c-icon-map"></i> <input type="text" class="op_traintimetable04_default" id="op_traintimetable04_end" value="城市名"/> </span> </td> <td><a class="c-btn c-btn-primary op_traintimetable04_submit" href="javascript:;">查询</a></td> </tr> {%if $tplData.station%} <tr class="op_traintimetable04_gap_top"> <td><span class="c-gap-right">汽车站查询</span></td> <td> <span class="c-input c-input-small c-gap-right"> <i class="c-icon c-icon-map"></i> <input type="text" class="op_traintimetable04_default" id="op_traintimetable04_station" value="城市名或汽车站名"/> </span> </td> <td colspan="3"><a class="c-btn c-btn-primary op_traintimetable04_submit" href="javascript:;">查询</a></td> </tr> {%/if%} <tr class="op_traintimetable04_gap_top_small"> <td colspan="5" style="color:#666;">{%$tplData.description|escape:'html'%}</td> </tr> {%if $tplData.morelink1[0]['txt'] || $tplData.morelink2[0]['txt'] || $tplData.morelink3[0]['txt']%} {%$morelinks=[$tplData.morelink1[0],$tplData.morelink2[0],$tplData.morelink3[0]]%} <tr class="op_traintimetable04_gap_top_small"> <td colspan="5" class="op_traintimetable04_c666"> {%foreach $morelinks as $item%} {%if $item%}<a href="{%$item['url']|escape:'html'%}" target="_blank">{%$item['txt']|escape:'html'%}</a>{%if !$item@last%}<span>&nbsp;-</span>{%/if%}{%/if%} {%/foreach%} </td> </tr> {%/if%}</table></div><script>A.setup(function() {var _this = this,tctimer1 = null,tctimer2 = null,start,end,aInp = _this.find('.op_traintimetable04_content').get(0).getElementsByTagName('input'),query_btn = _this.find('.op_traintimetable04_submit'),swap = _this.find('.op_traintimetable04_swap').eq(0);var ajaxFinished = false;var swapping = function() {return false;};$.each(aInp, function(i,o) {var b = true, a;$(o).on('focus', function() {if (this.value == '城市名' || this.value == '城市名或汽车站名') a = this.val{%*i*%}ue;if (b && this.className == 'op_traintimetable04_default') {this.value = '';this.className = 'op_traintimetable04_normal';}this.select();});$(o).on('blur', function() {if (b && this.value == '') {if (typeof a == 'undefined') {this.value = '城市名';}else {this.value = a;}this.className = 'op_traintimetable04_default';}});$(o).on('keypress', function() {this.value == '' ? true : false;});});swap.on('click', function() {var t = aInp[0].value;swapping = (function() {var count = 0;return function() {c{%*i*%}ount++;if (count >= 2) {swapping = function() {return false;}}return true;}})();aInp[0].value = aInp[1].value;aInp[1].value = t;});var sugCity = 'http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&ie=utf-8&sug_type=chezhan_chengshi&t=#{0}&cb=op_func';var citys = [];var sug = {getData: function(word) {if (swapping()) {return;}var t = this;var fn = function(data) {if(ajaxFinished) return;var SD = [];if (data.status == 0) {var datas = data.data;var len = datas.length;if (len > 0) {$.each(data{%*i*%}s, function(i,o) {SD.push(o.s);});}else {SD.push('dataerror');}fnSuccess(SD);}};$.ajax({url:$.format(sugCity, encodeURIComponent(word), new Date().getTime())+'&cb=traintb04',dataType:'jsonp',success:fn,jsonpCallback:'traintb04'});function fnSuccess(sd) {var FD = [];citys = [];if (sd[0] == 'dataerror') {if (word == '城市名') return false;FD.push('<p class="op_traintimetable04_red">不支持该目的地</p>');citys.push('');}else {$.each(sd, function(i,o) {var da = o.split('|'),w = word.toLowerCase(),w1 = word.toU{%*i*%}pperCase();var str = da[0] + '(' + da[1].toLowerCase() + ')',str2 = da[0] + '(' + da[2].toUpperCase() + ')';citys.push(da[0]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span class='op_traintimetable04_hilight'>" + w + '</span>'));}else if (w1 && str2.indexOf(w1) != -1) {FD.push(str2.replace(w1, "<span class='op_traintimetable04_hilight'>" + w1 + '</span>'));}});}t.show(word, FD);t.highLight(0);}},onpick: function(ev) {if (isNaN(ev.data.index)) {return;}else {var cs = citys[ev.data.{%*i*%}index].split('|');ev.data.item.value = cs[0];}}};$(function(){A.use('suggestion',function(){sug.view=function(){var s=_this.find('.op_traintimetable04_start_field')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};start = A.ui.suggestion(sug);sug.view=function(){var e=_this.find('.op_traintimetable04_end_field')[0],p=$(e).position();return {top:p.top+26,left:p.left,width:e.offsetWidth};};end = A.ui.suggestion(sug);tctimer1 = setTimeout(function() {start.render('op_tra{%*i*%}intimetable04_start');end.render('op_traintimetable04_end');},0);});});query_btn[0].onclick = function() {var valStart = _this.find('#op_traintimetable04_start')[0].value;var valEnd = _this.find('#op_traintimetable04_end')[0].value;if (valStart != '城市名' && valEnd != '城市名') {window.open('http://www.trip8080.com/chashike.jsp?s1=' + encodeURI(valStart) + '&s2=' + encodeURI(valEnd));tctimer2 = setTimeout(function(){bds.su = bds.su || {urdata:[],urSendClick:function(){}};bds.su.urSendClick({pid:'alad{%*i*%}din',resourceid:'{%$extData.resourceid%}',fetchkey:encodeURIComponent("{%$extData.fetchkey|escape:'javascript'%}")});},50); }else {window.open('http://www.trip8080.com/shike/');}};if (query_btn[1]) {query_btn[1].onclick = function() {var val = _this.find('#op_traintimetable04_station').get(0).value;if (val != '城市名或汽车站名') {window.open('http://www.trip8080.com/stationshike.jsp?s1=' + encodeURI(val));}else {window.open('http://www.trip8080.com/chezhan/');}};}this.dispose = function(){clearTimeout(tctimer1);clearTimeout(tctimer2);if(!ajaxFinished){ajaxFinished = true;}start&&start.dispose&&start.dispose();end{%*i*%}&&end.dispose&&end.dispose();};});</script>{%/block%}