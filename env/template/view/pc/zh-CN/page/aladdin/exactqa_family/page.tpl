{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='foot'%}{%/block%}{%block name='data_modifier'%} {%**********数据预处理开始**********%} {%*单实体标题*%} {%if count($tplData.result) == 1%} {%$tplData.SingleTitle = []%} {%if $tplData.search_property%} {%$tplData.SingleTitle.entity = $tplData.result[0].ename%} {%$tplData.SingleTitle.append = $tplData.result[0].appendinfo%} {%$tplData.SingleTitle.attr = $tplData.result[0].searchp%} {%/if%} {%if $tplData.trace.level && count(end($tplData.trace.level)) == 1%} {%$endLevel = end($tplData.trace.level)%} {%$tplData.SingleTitle.entity = ($tplData.SingleTitle.entity) ? $tplData.SingleTitle.entity : $tplData.hash[$endLevel[0].sign].ename%} {%$tplData.SingleTitle.append = ($tplData.SingleTitle.append) ? $tplData.SingleTitle.append : $tplData.hash[$endLevel[0].sign].appendinfo%} {%$tplData.SingleTitle.attr = ($tplData.SingleTitle.attr) ? $tplData.SingleTitle.attr : $endLevel[0].property%} {%/if%} {%/if%} {%**********数据预处理结束**********%} {%*****判断家庭称谓展现样式*****%} {%$ProcessView = '0'%} {%if $tplData.result[0].ename && $tplData.trace.level_num > 1%} {%$ProcessView = '1'%} {%foreach $tplData.trace.level as $level%} {%if count($level) > 1%} {%$ProcessView = '2'%} {%foreach $level as $item%} {%if $item.available == 'false'%} {%$ProcessView = '0'%} {%break%} {%/if%} {%/foreach%} {%break%} {%/if%} {%/foreach%} {%/if%} {%if $ProcessView == '1'%} {%$FamilyTree_TEXT_H = 22%}  {%$FamilyTree_LINE_H = 24%}  {%$FamilyTree = []%}  {%$FamilyTreeLevelMax = 0%}  {%$FamilyTreeLevelMin = 0%}  {%foreach $tplData.trace.level as $level%} {%if $level[0].path%} {%$level[0].path = json_decode($level[0].path, true)%} {%$level[0].path = array_slice($level[0].path, 1, count($level[0].path)-2)%} {%foreach $level[0].path as $path%} {%$FamilyTreeLeaf = []%} {%$FamilyTreeLeaf.level = $path.level%} {%$FamilyTreeLeaf.text = [$path.name]%} {%$FamilyTreeLevelMax = ($FamilyTreeLeaf.level > $FamilyTreeLevelMax) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMax%} {%$FamilyTreeLevelMin = ($FamilyTreeLeaf.level < $FamilyTreeLevelMin) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMin%} {%$arr = array_push($FamilyTree, $FamilyTreeLeaf)%} {%/foreach%} {%/if%} {%$FamilyTreeLeaf = []%} {%$FamilyTreeLeaf.level = $tplData.hash[$level[0].sign].jiatingchengwei_level%} {%$FamilyTreeLeaf.text = [$tplData.hash[$level[0].sign].ename]%} {%$FamilyTreeLevelMax = ($FamilyTreeLeaf.level > $FamilyTreeLevelMax) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMax%} {%$FamilyTreeLevelMin = ($FamilyTreeLeaf.level < $FamilyTreeLevelMin) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMin%} {%$arr = array_push($FamilyTree, $FamilyTreeLeaf)%} {%/foreach%} {%if $tplData.result[0].path%} {%$FamilyTreeLength = count($FamilyTree)%} {%$tplData.result[0].path = json_decode($tplData.result[0].path, true)%} {%$tplData.result[0].path = array_slice($tplData.result[0].path, 1, count($tplData.result[0].path)-2)%} {%foreach $tplData.result[0].path as $path%} {%$FamilyTreeLeaf = []%} {%$FamilyTreeLeaf.level = $path.level%} {%$FamilyTreeLeaf.text = [$path.name]%} {%$FamilyTreeLevelMax = ($FamilyTreeLeaf.level > $FamilyTreeLevelMax) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMax%} {%$FamilyTreeLevelMin = ($FamilyTreeLeaf.level < $FamilyTreeLevelMin) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMin%} {%$arr = array_push($FamilyTree, $FamilyTreeLeaf)%} {%/foreach%} {%foreach array_slice($tplData.result, 1) as $result%} {%$result.path = json_decode($result.path, true)%} {%$result.path = array_slice($result.path, 1, count($result.path)-2)%} {%foreach $result.path as $path%} {%if $path.name != $FamilyTree[$FamilyTreeLength + $path@index].text[0]%} {%$ProcessView = '2'%} {%/if%} {%/foreach%} {%/foreach%} {%/if%} {%$FamilyTreeLeaf = []%} {%$FamilyTreeLeaf.level = $tplData.result[0].jiatingchengwei_level%} {%$FamilyTreeLeaf.text = []%} {%$FamilyTreeLevelMax = ($FamilyTreeLeaf.level > $FamilyTreeLevelMax) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMax%} {%$FamilyTreeLevelMin = ($FamilyTreeLeaf.level < $FamilyTreeLevelMin) ? $FamilyTreeLeaf.level : $FamilyTreeLevelMin%} {%foreach $tplData.result as $item%} {%$FamilyTreeLeaf.text[$item@index] = $item.ename%} {%/foreach%} {%$arr = array_push($FamilyTree, $FamilyTreeLeaf)%} {%if $FamilyTree[0].level < $FamilyTree[1].level%} {%$preLevel = 0%} {%$changeKey = '+'%} {%$changeNum = 0%} {%foreach array_slice($FamilyTree, 1) as $tree%} {%if $tree.level > $preLevel%} {%if $changeKey == '-'%} {%$changeNum = $changeNum + 1%} {%$changeKey = '+'%} {%/if%} {%elseif $tree.level < $preLevel%} {%if $changeKey == '+'%} {%$changeNum = $changeNum + 1%} {%$changeKey = '-'%} {%/if%} {%/if%} {%if $tree.level == $preLevel || $changeNum > 1%} {%$ProcessView = '2'%} {%break%} {%/if%} {%$preLevel = $tree.level%} {%/foreach%} {%elseif $FamilyTree[0].level > $FamilyTree[1].level%} {%$preLevel = 0%} {%foreach array_slice($FamilyTree, 1) as $tree%} {%if $tree.level >= $preLevel%} {%$ProcessView = '2'%} {%break%} {%else%} {%$preLevel = $tree.level%} {%/if%} {%/foreach%} {%else%} {%$ProcessView = '2'%} {%/if%} {%/if%} {%if $ProcessView == '2' && $tplData.trace.level_num <= 2%} {%$ProcessView = '0'%} {%/if%} {%*****判断家庭称谓展现样式结束*****%} {%*跳转链接方法 优先级jumpquery>jumplink>ename*%} {%$EndParams = "&rsv_cq={%$extData.OriginQuery%}&rsv_dl=0_left_exactqa_{%$extData.resourceid%}"%} {%function op_exactqa_family_get_href jumpquery='' jumplink='' ename=''%}{%strip%} {%if $jumpquery%} {%$escaped_jumpquery = $jumpquery%} {%build_search_url params="wd={%$escaped_jumpquery%}"%}{%$EndParams|escape:'html'%} {%elseif $jumplink%} {%$jumplink|escape:'html'%} {%else%} {%$escaped_ename = $ename%} {%build_search_url params="wd={%$escaped_ename%}"%}{%$EndParams|escape:'html'%} {%/if%} {%/strip%}{%/function%}{%/block%}{%block name='content'%}<div class="c-border">  <div class="op_exactqa_family_main"> <div class="op_exactqa_family_s_item c-row"> <div class="op_exactqa_family_s_area c-span24 c-span-last"> <p class="op_exactqa_family_s_prop c-gap-bottom-small"> {%if $tplData.SingleTitle.entity && $tplData.SingleTitle.attr && $tplData.trace.level_num == 1%} <a href='{%op_exactqa_family_get_href ename=$tplData.SingleTitle.entity%}' target="_blank">{%$tplData.SingleTitle.entity|escape:'html'%}</a>{%if $tplData.SingleTitle.append%}<span>({%$tplData.SingleTitle.append|escape:'html'%})</span>{%/if%}{%$tplData.SingleTitle.attr|escape:'html'%}： {%else%} {%$extData.OriginQuery%}： {%/if%} </p> <p class="op_exactqa_family_s_answer"> {%$attrqueryArr = []%} {%foreach $tplData.result as $item%} {%$item.attrquery = ($item.ename) ? $item.ename : $item.property%} {%if !in_array($item.attrquery, $attrqueryArr)%} {%$arr = array_push($attrqueryArr, $item.attrquery)%} {%if !$item@first%}、{%/if%}<a href='{%op_exactqa_family_get_href jumpquery=$item.jumpquery jumplink=$item.jumplink ename=$item.attrquery%}' target="_blank">{%$item.attrquery|escape:'html'%}</a>{%if $item.basic_aliasname%}({%$item.basic_aliasname|escape:'html'%}){%/if%} {%/if%} {%/foreach%} </p> </div> </div> </div>   <div class="op_exactqa_family_tools"> 来自<a href="http://baike.baidu.com/view/31064.htm" target="_blank">百度百科</a><span class="op_exactqa_family_tools_sep">|</span><span class="op_exactqa_family_tools_fb_area"><a class="op_exactqa_family_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:'报错'}">报错</a></span> </div>   {%if $ProcessView != '0'%} <div class="op_exactqa_family_process_ext c-gap-top"> <p class="c-gap-top-small c-gap-bottom-small op_exactqa_family_process_ext_title">推理过程：</p> <div class="op_exactqa_family_process_ext_body"> {%if $ProcessView == '1'%} {%$FamilyTreeLevelNum = $FamilyTreeLevelMax - $FamilyTreeLevelMin%} <div class="op_exactqa_family_process_family" style="height:{%($FamilyTree_TEXT_H+$FamilyTree_LINE_H)*$FamilyTreeLevelNum+$FamilyTree_TEXT_H%}px"> <!--[if IE]><script>document.createElement('canvas');</script><![endif]--> <canvas class="op_exactqa_family_process_canvas" width="500" height="{%($FamilyTree_TEXT_H+$FamilyTree_LINE_H)*$FamilyTreeLevelNum+$FamilyTree_TEXT_H%}"></canvas> </div> {%elseif $ProcessView == '2'%} {%function op_exactqa_family_level levelitem='' itemindex='' levelindex=''%} {%$result = array()%} {%foreach $tplData.trace.level[$levelindex+1] as $item%} {%$uftArr = array_keys(str_split(strrev(decbin($item.uft))),"1")%} {%if in_array($itemindex, $uftArr)%} {%$result[$item@index] = $item%} {%/if%} {%/foreach%} {%***************************************************源码带换行**********************************************
                <a href='{%op_exactqa_family_get_href ename=$tplData.hash[$levelitem.sign].ename%}' target="_blank">{%$tplData.hash[$levelitem.sign].ename|escape:'html'%}</a>的{%$levelitem.property|escape:'html'%}是
                {%if count($result) == 0%}
                    {%if count($tplData.result) > 1%}
                        {%$firstIf = true%}
                        {%foreach $tplData.result as $item%}
                            {%$uftArr = array_keys(str_split(strrev(decbin($item.uft))),"1")%}
                            {%if in_array($itemindex, $uftArr)%}
                                {%if !$firstIf%}、{%/if%}<a href='{%op_exactqa_family_get_href ename=$item.ename%}' target="_blank">{%$item.ename|escape:'html'%}</a>
                                {%$firstIf = false%}
                            {%/if%}
                        {%/foreach%}
                    {%else%}
                        <a href='{%op_exactqa_family_get_href ename=$tplData.result[0].ename%}' target="_blank">{%$tplData.result[0].ename|escape:'html'%}</a>
                    {%/if%}
                    。</li>
                {%elseif count($result) == 1%}
                    {%foreach $result as $item%}
                        <a href='{%op_exactqa_family_get_href ename=$tplData.hash[$item.sign].ename%}' target="_blank">{%$tplData.hash[$item.sign].ename|escape:'html'%}</a>，
                    {%/foreach%}
                    {%foreach $result as $item%}
                        {%op_exactqa_family_level levelitem=$item itemindex=$item@key levelindex=$levelindex+1%}
                    {%/foreach%}
                {%else%}
                    {%foreach $result as $item%}
                        <a href='{%op_exactqa_family_get_href ename=$tplData.hash[$item.sign].ename%}' target="_blank">{%$tplData.hash[$item.sign].ename|escape:'html'%}</a>{%if !$item@last%}、{%/if%}
                    {%/foreach%}。</li><li><ul>
                    {%foreach $result as $item%}
                        <li class="op_exactqa_family_process_ext_icon">{%op_exactqa_family_level levelitem=$item itemindex=$item@key levelindex=$levelindex+1%}
                    {%/foreach%}</ul></li>
                {%/if%}
                *************************************************************************************************************%} {%*****以上内容压缩到一行以防止fis压缩出空格*****%} <a href='{%op_exactqa_family_get_href ename=$tplData.hash[$levelitem.sign].ename%}' target="_blank">{%$tplData.hash[$levelitem.sign].ename|escape:'html'%}</a>的{%$levelitem.property|escape:'html'%}是{%if count($result) == 0%}{%if count($tplData.result) > 1%}{%$firstIf = true%}{%foreach $tplData.result as $item%}{%$uftArr = array_keys(str_split(strrev(decbin($item.uft))),"1")%}{%if in_array($itemindex, $uftArr)%}{%if !$firstIf%}、{%/if%}<a href='{%op_exactqa_family_get_href ename=$item.ename%}' target="_blank">{%$item.ename|escape:'html'%}</a>{%$firstIf = false%}{%/if%}{%/foreach%}{%else%}<a href='{%op_exactqa_family_get_href ename=$tplData.result[0].ename%}' target="_blank">{%$tplData.result[0].ename|escape:'html'%}</a>{%/if%}。</li>{%elseif count($result) == 1%}{%foreach $result as $item%}<a href='{%op_exactqa_family_get_href ename=$tplData.hash[$item.sign].ename%}' target="_blank">{%$tplData.hash[$item.sign].ename|escape:'html'%}</a>，{%/foreach%}{%foreach $result as $item%}{%op_exactqa_family_level levelitem=$item itemindex=$item@key levelindex=$levelindex+1%}{%/foreach%}{%else%}{%foreach $result as $item%}<a href='{%op_exactqa_family_get_href ename=$tplData.hash[$item.sign].ename%}' target="_blank">{%$tplData.hash[$item.sign].ename|escape:'html'%}</a>{%if !$item@last%}、{%/if%}{%/foreach%}。</li><li><ul>{%foreach $result as $item%}<li class="op_exactqa_family_process_ext_icon">{%op_exactqa_family_level levelitem=$item itemindex=$item@key levelindex=$levelindex+1%}{%/foreach%}</ul></li>{%/if%} {%/function%} <ul class="op_exactqa_family_process_ext_text"> {%foreach $tplData.trace.level[1] as $item%} <li class="op_exactqa_family_process_ext_firsticon">{%op_exactqa_family_level levelitem=$item itemindex=$item@index levelindex=1%} {%/foreach%} </ul> {%/if%} </div> </div> {%/if%} </div><script type="text/javascript" >
    A.setup({
        EndParams: '{%$EndParams|escape:"javascript"%}',
        FamilyTree_TEXT_H: '{%$FamilyTree_TEXT_H|escape:"javascript"%}',
        FamilyTree_LINE_H: '{%$FamilyTree_LINE_H|escape:"javascript"%}',
        FamilyTreeLevelMax: '{%$FamilyTreeLevelMax|escape:"javascript"%}',
        FamilyTree: '{%json_encode($FamilyTree)%}'
    });
</script>{%/block%}