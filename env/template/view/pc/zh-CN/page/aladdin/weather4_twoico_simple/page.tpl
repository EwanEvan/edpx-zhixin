{%extends 'c_base.tpl'%} {%block name='title'%}{%/block%}{%block name='content'%}{%fe_fn_c_title_prefix%}{%if $tplData.nopage%}{%$tplData.title%}{%else%}{%fe_fn_c_title title="{%$tplData.title%}" url="{%$tplData.url%}"%}{%/if%} <b class="op_weather4_twoicon_simple_u"><i>- 最近访问：</i></b>{%fe_fn_c_title_suffix%}<div class="op_weather4_twoicon_simple"> {%for $i = 0 to 4%} {%$iconURL = $tplData["simplepic`$i`1"]%} {%$linkURL = $tplData.link1[0].linkurl%} {%$weathName = $tplData["weather$i"]%} {%$weathLen = mb_strlen($weathName)%} <a class="op_weather4_twoicon_simple_day OP_LOG_LINK" {%if $i==4%}style="border:none;"{%/if%} {%if $linkURL%}target="_blank"{%/if%} href='{%if $linkURL%}{%$linkURL%}{%else%}javascript:void(0);{%/if%}'>  <p class="op_weather4_twoicon_simple_date">{%if $i==0%}{%mb_substr($tplData["time$i"],0,2,'utf-8')%}{%else%}{%$tplData["time$i"]%}{%/if%}</p> <div class="op_weather4_twoicon_simple_icon" style="background:url({%$iconURL%});"></div> <p class="op_weather4_twoicon_simple_temp">{%$tplData["temp$i"]%}</p> <p class="op_weather4_twoicon_simple_weath"> {%if $i > 0 && $weathLen > 6%} {%mb_substr($weathName,0,5)%}... {%else%} {%($weathName)%} {%/if%} </p> </a> {%/for%}</div><div class="op_weather4_twoicon_simple_wlink">{%$tplData.support|limitlen:34|escape:'html'%} {%if $tplData.link1[0]['linkcontent']|escape:'html'%}<a target="_blank" href="{%$tplData.link1[0]['linkurl']%}"><span class="op_weather4_twoicon_aa">{%$tplData.link1[0]['linkcontent']|limitlen:36|escape:'html'%}</span></a>{%/if%}</div><script >
    A.setup({'oq':'{%$extData.OriginQuery%}','resourceid':'{%$extData.resourceid%}','fetchkey':'{%$extData.fetchkey%}'});
</script><script>A.setup(function() {var _this = this;var query = _this.data.oq;if(query.indexOf("天气") < 0)return;A.use('localstorage',function(){var storage = A.ui.localstorage({fileName : 'bd_weather_city',expiresDay : 30});storage.init();var curCity = _this.data.fetchkey.split(_this.data.resourceid+'_')[1]; curCity = (curCity.indexOf('天气') < 0 ) ? curCity + '天气' : curCity; var localStorElem = _this.qq('op_weather4_twoicon_u'); weatherHis(1); function wencodeHTML(source) {return String(source){%*i*%}.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g, "&quot;").replace(/'/g, "&#39;");};function weatherHis(cityNum){var cityStorage = storage.get('op_weather4_twoicon_city');var storageMax = cityNum;var cityList = (!cityStorage) ? new Array() : unescape(cityStorage).split(';'); for(var i=0, j=0; i<cityList.length; i++) {if( cityList[i] == curCity || j == 99) { cityList.splice(i,1);} else {j++;}}if(cityList && cityList.length > 0) {for(var j = 0; j < storageMax; j++) {v{%*i*%}ar cityA = document.createElement('a');var url = "http://www.baidu.com/s?wd=" + encodeURIComponent(cityList[j]) + "&ie=utf-8";var cityName=document.createTextNode(wencodeHTML(cityList[j]) );cityA.appendChild(document.createTextNode( wencodeHTML(cityList[j]) ));cityA.href = url;cityA.target = '_blank';cityA.className = 'OP_LOG_LINK';localStorElem.appendChild( cityA );}localStorElem.style.display = 'inline';c({'fm': 'inlo', rsv_wct : 1});}var setStorige = cityList.length > 0 ? curCity + ';' + city{%*i*%}List.join(';') : curCity;storage.set('op_weather4_twoicon_city', escape(setStorige));}});this.dispose = function(){};});</script>{%/block%}