{%extends 'c_base.tpl'%} {%block name="data_modifier"%} {%$extData.feData.hasTitleGap = false%}{%/block%}{%block name='content'%} {%if $tplData.des%}<div class="op-newtv0502-des c-gap-bottom-small">{%$tplData.des|escape%}</div>{%/if%}<div class="c-border"><div class="c-tabs"> <ul class="c-tabs-nav c-tabs-nav-movetop op-newtv0502-nav"> {%$week = array( '日', '一', '二', '三', '四', '五', '六' )%} {%$nowDate = strtotime(date("Y-m-d",time()))%} {%foreach array_slice($tplData.tab,0,8) as $item%} {%$itemDate = strtotime(str_replace('/','-',$item.time))%} <li class="c-tabs-nav-li OP_LOG_BTN" data-click="{fm:'beha'}" data-tabid="{%$item.tabid%}" data-time='{%$item.time%}' {%if $itemDate<$nowDate%}style="display:none;"{%/if%}>星期{%$week[$item.week]|escape%}<span>{%$item.date%}</span></li> {%/foreach%} </ul> <div class="c-tabs-content op-newtv0502-content"> {%$count = count($tplData.data)%} {%$ban = ceil($count/2)%} <div class="op-newtv0502-contents c-clearfix"> <table class="c-table op-newtv0502-table">  <thead> <tr class="c-table-nohihead"> <th class="op-newtv0502-tv">播出频道</th> <th class="op-newtv0502-time">时间</th> <th>节目</th> </tr> </thead> <tbody class="op-newtv0502-contentsul"></tbody> </table> </div> <div class="op-newtv0502-contblock c-clearfix" style="display:none;"> <table class="c-table op-newtv0502-table">  <thead> <tr class="c-table-nohihead"> <th class="op-newtv0502-tv">播出频道</th> <th class="op{%*i*%}-newtv0502-time">时间</th> <th>节目</th> </tr> </thead> <tbody class="op-newtv0502-contblockul"></tbody> </table> </div> <div class="op-newtv0502-open OP_LOG_BTN" data-click="{fm:'beha'}" style="display:none;">{%$tplData.openword|escape%}<i class="c-icon c-icon-chevron-bottom"></i></div> <div class="op-newtv0502-close OP_LOG_BTN" data-click="{fm:'beha'}" style="display:none;">收起<i class="c-icon c-icon-chevron-top"></i></div> </div></div></div>{%if $tplData.link%}<div class="op-newtv0502-more c-gap-top-small"> {%foreach $tplData.link as $item%} <a href="{%$item.href%}" target="_blank">{%$item.title|escape%}</a> {%/foreach%}</div>{%/if%}<script >
    A.setup({
        'originQuery': '{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)|escape:"javascript"%}',
        'srcid':'{%$extData.resourceid%}'
    });
</script><script>A.setup(function(){var _this = this,contents = _this.find('.op-newtv0502-contents')[0],contblock = _this.find('.op-newtv0502-contblock')[0],contentsul = _this.find('.op-newtv0502-contentsul')[0],contblockul = _this.find('.op-newtv0502-contblockul')[0],tabLi = _this.find('.c-tabs-nav-li'),open = _this.find('.op-newtv0502-open')[0],close = _this.find('.op-newtv0502-close')[0],originQuery = _this.data.originQuery,srcid = _this.data.srcid,now = new Date({%time()%}*1000),startActive = 1,tabActive = tabLi[0],tabid = 1;function getTime(time){return new Date(time).getTime();}$(tabLi).each(function(i,o){if((getTime($(tabLi[i]).attr('data-time'))<=now && getTime($(tabLi[i+1]).attr('data-time'))>now) || getTime($(tabLi[i]).attr('data-time'))>now || getTime($(tabLi[tabLi.length-1]).attr('data-time'))<=now){$(this).addClass('c-tabs-nav-selected');tabActive = $(this);tabid = tabActive.attr('data-tabid');startActive = tabActive.attr('data-tabid');ajaxData(tabid);re{%*i*%}turn false;}});$(tabLi).each(function(i,o){$(this).click(function(){if($(tabActive)[0]==$(this)[0]){return false;}$(contents).css('display','block');$(contblock).css('display','none');tabActive.removeClass('c-tabs-nav-selected');tabActive = $(this);$(this).addClass('c-tabs-nav-selected');tabid = $(this).attr('data-tabid');ajaxData(tabid);});});$(open).click(function(){$(contents).css('display','none');$(contblock).css('display','block');$(open).css('display','none');$(close).css('display','block{%*i*%}');});$(close).click(function(){$(contents).css('display','block');$(contblock).css('display','none');$(open).css('display','block');$(close).css('display','none');});function setString(str,len){if(str.length*2 <= len){return str;}var strlen = 0; var newstr = "";for(var i = 0;i < str.length; i++){if(str.charCodeAt(i) > 128){ strlen = strlen + 2;if(strlen > len){return newstr.substring(0,newstr.length-1) + "...";}}else{strlen = strlen + 1;if(strlen > len){return newstr.substring(0,newstr.length-2{%*i*%}) + "...";}}newstr = newstr + str.charAt(i);}return newstr;};function ajaxData(tabid){_this.ajax(originQuery, srcid, {co:'data[tabid='+tabid+']',success:function(data){var data = data[0],datas =data.data,closeStr = '',openStr = '';datas.length>5?$(open).css('display','block'):$(open).css('display','none');$(close).css('display','none');if(datas.length<=5){var noborder = '';}$(datas).each(function(i,o){if(i<5){var noborder = i==datas.length-1 || i==4?' class="c-table-noborder"':'';closeStr += '<t{%*i*%}r'+noborder+'><td>'+setString(o.tvname,24)+'</td><td>'+o.time+'</td><td><a href="javascript:void(0);"  class="OP_LOG_BTN" data-click="{fm:\'beha\'}" title="'+o.title+'">'+setString(o.title,36)+'</a></td></tr>';}var noborder = i==datas.length-1?' class="c-table-noborder"':''; openStr += '<tr'+noborder+'><td>'+setString(o.tvname,24)+'</td><td>'+o.time+'</td><td><a href="javascript:void(0);" class="OP_LOG_BTN" data-click="{fm:\'beha\'}" title="'+o.title+'">'+setString(o.title,36)+'</a></td></tr>';}{%*i*%});$(contentsul).html(closeStr);if(datas.length>5){$(contblockul).html(openStr);}},error: function(){}});}});</script>{%/block%}