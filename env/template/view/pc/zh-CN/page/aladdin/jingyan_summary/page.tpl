{%extends 'c_base.tpl'%} {%block name='data_modifier'%}{%$extData.feData.hasBorder = true%}{%foreach $tplData.img as $item%} {%$tplData.img[$item@index].imgtext = $item.imgtext|limitlen:38|escape%}{%/foreach%}{%$tplData.showurl=$tplData.showurl|host%}{%/block%}{%block name='content'%}{%if !("true" == $tplData.detailFlag ) && isset($tplData.tip)%}<p class="c-gap-bottom">{%$tplData.tip|limitlen:78|highlight:0%}</p>{%/if%}<div class="c-row {%if count($tplData.img) >4 %}c-gap-bottom{%/if%} op_jingyan_list1"> {%foreach array_slice($tplData.img,0,4) as $item%} <div class="c-span6{%if $item@last%} c-span-last{%/if%} op_jingyan_list"> <a href="{%if $item.imglinkurl%}{%$item.imglinkurl%}{%/if%}" target="_blank"><img class="c-img c-img6" src="{%if $item.imgurl%}{%$item.imgurl%}{%/if%}" /> {%if $item.imgtext && ("true" == $tplData.detailFlag )%}<p class="c-gap-top-small">{%$item.imgtext%}</p>{%/if%} </a> <span class="op_jingyan_index">{%$item@iteration%}</span> </div> {%/foreach%}</div>{%if count($tplData.img) > 4%}<div class="c-row  op_jingyan_list2"> {%foreach array_slice($tplData.img,4,4) as $item%} <div class="c-span6{%if $item@last%} c-span-last{%/if%} op_jingyan_list"> <a href="{%if $item.imglinkurl%}{%$item.imglinkurl%}{%/if%}" target="_blank"><img class="c-img c-img6" src="{%if $item.imgurl%}{%$item.imgurl%}{%/if%}" /> {%if $item.imgtext && ("true" == $tplData.detailFlag )%}<p class="c-gap-top-small">{%$item.imgtext%}</p>{%/if%} </a> <span class="op_jingyan_index">{%$item@iteration+4%}</span> </div> {%/foreach%}</div>{%if count($tplData.img) > 8%}<div class="op_jingyan_pager c-gap-top"></div>{%/if%}<p class="c-gap-top-small op_jingyan_list_showmore"><span class="OP_LOG_BTN">显示全部 <i class="c-icon c-icon-chevron-bottom"></i></span></p><p class="c-gap-top-small op_jingyan_list_hide"><span class="OP_LOG_BTN">收起 <i class="c-icon c-icon-chevron-top "></i></span></p><script >
    A.setup({
        'detailFlag':'{%$tplData.detailFlag%}',
        'images': {%json_encode($tplData.img)%}
    });
</script><script>A.setup(function(){var _this = this;var pageSize = 8;var $pager = _this.find(".op_jingyan_pager");var $showmore = _this.find(".op_jingyan_list_showmore");var $hiedmore = _this.find(".op_jingyan_list_hide");var $list1 = _this.find(".op_jingyan_list1");var $list2 = _this.find(".op_jingyan_list2");var currentPage=1;var count=_this.data.images.length;var pageCount=Math.ceil(count/pageSize);$showmore.find("span").click(function(){$list2.show();$hiedmore.show();$pager.show();$showmore{%*i*%}.hide();});$hiedmore.find("span").click(function(){$list2.hide();$hiedmore.hide();$pager.hide();$showmore.show();currentPage=1;renderRow(1); renderPager();});var renderPager=function(){var count=pageCount;if(count<1){return;}var html=[];var shown={};var draw=function(index){if(shown[index]){return '';}shown[index]=true;if(index==currentPage){return '<span class="op_jingyan_pager_current">'+currentPage+'</span>';}else{return '<span class="op_jingyan_pager_item" data-page="'+index+'">'+index+'</sp{%*i*%}an>';}};if(currentPage>1){html.push('<span class="op_jingyan-prev op_jingyan_pager_item" data-page="'+(currentPage-1)+'">上一页</span>');}var point=currentPage;if(count-2<point){point=count-2;}if(point<5){if(count<5){point=count;}else{point=5;}}if(point>5){html.push(draw(1));html.push('<span class="op_jingyan_pager_seperator">...</span>');html.push(draw(point-2));html.push(draw(point-1));}else{for( var i=1; i<point; i++){html.push(draw(i));}}html.push(draw(point));point=currentPage;if(point<3){poin{%*i*%}t=3;}if(count-point<4){point=count-2;if(point<1){point=1;}}if(count-point>4){html.push(draw(point+1));html.push(draw(point+2));html.push('<span class="op_jingyan_pager_seperator">...</span>');html.push(draw(count));}else{for( var i=point; i<=count; i++){html.push(draw(i));}}if(currentPage<count){html.push('<span class="op_jingyan-next op_jingyan_pager_item" data-page="'+(currentPage+1)+'">下一页</span>');}$pager.html(html.join(''));var items=$pager.find('.op_jingyan_pager_item');items.each(function{%*i*%}(){var index=parseInt($(this).attr('data-page'),10);$(this).click(function(){renderRow(index);var oldPage=currentPage;currentPage=index;$pager.html('<span class="op_jingyan_pager_loading">加载中...</span>');renderPager();});});};var renderRow =function(index){index = index -1;var imgData = _this.data.images.slice(index*pageSize,index*pageSize+pageSize);var list1Html =[],list2Html=[];for (var i = 0; i < pageSize/2; i++) {if(imgData[i]){list1Html.push(renderCell(imgData[i],index*pageSize+i))}};for (v{%*i*%}ar i = pageSize/2; i <= pageSize; i++) {if(imgData[i]){list2Html.push(renderCell(imgData[i],index*pageSize+i))}};$list1.html(list1Html.join(""));$list2.html(list2Html.join(""));};var renderCell = function(data,index){var cellHtml = [];if(3 === index%(pageSize/2)){cellHtml.push('<div class="c-span6 c-span-last op_jingyan_list">');}else{cellHtml.push('<div class="c-span6 op_jingyan_list">');}if(data.imglinkurl){cellHtml.push('<a href="'+data.imglinkurl+'" target="_blank">');}if(data.imgurl){cellHt{%*i*%}ml.push('<img class="c-img c-img6" src="'+data.imgurl+'" />');}if(data.imgtext && _this.data.detailFlag == "true"){cellHtml.push('<p class="c-gap-top-small">'+data.imgtext+'</p>');}if(data.imglinkurl){cellHtml.push('</a>');}cellHtml.push('<span class="op_jingyan_index">'+(parseInt(index,10)+1)+'</span>');cellHtml.push('</div>');return cellHtml.join('');};renderPager();});</script>{%/if%}{%/block%}