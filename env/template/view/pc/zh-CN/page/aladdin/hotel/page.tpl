{%extends 'c_base.tpl'%} {%block name="foot"%}{%/block%}{%block name="data_modifier"%}{%$extData.feData.hasTitleGap = false%}{%/block%}{%block name='content'%} <div class="op_hotel_main"> <form name="op_hotel_form1" method="get" accept-charset="gb2312"> {%if $tplData.brand[0]['name']%}{%if $tplData.brand[0]['content']%}<p style="padding-top:2px;">{%$tplData.brand[0]['content']|highlight:0%}</p>{%/if%} <input type="hidden" class="op_hotel_brand" value="{%$tplData.brand[0]['name']|escape:'html'%}" />{%/if%} <table cellspacing="0" cellpadding="0"> <tr> <td><span class="op_hotel_sub">城市</span>&nbsp;</td> <td><div class="op_hotel_ci op_hotel_ci1"><input class="op_hotel_city" autocomplete="off" type="text" maxlength="10" value="{%if $tplData.curcity%}{%$tplData.curcity|escape:'html'%}{%else%}{%if $extData.AutoExtendedLocation%}{%$extData.AutoExtendedLocation|escape:'html'%}{%else%}北京{%/if%}{%/if%}" /><span class="op_hotel_detail_btn op_hotel_city_btn OP_LOG_BTN"></span> <div class="op_hotel_topcity op_hotel_hide"><span class="op_hotel_topclose OP_LOG_BTN"></span><div class="op_hotel_citytitle">{%$tplData.citytitle|escape:'html'%}</div> <ul class="op_hotel_clearfix"> {%$loop_maxcount=count($tplData.hotcity)%}{%for $op_loop_count=0 to 99%}{%if $op_loop_count<$loop_maxcount%} <li><span class="op_hotel_citys">{%$tplData.hotcity[$op_loop_count]['name']|escape:'html'%}</span></li> {%else%}{%break%}{%/if%}{%/for%} </ul> </div> <ul class="op_hotel_city_sug op_hotel_hide"></ul> </div></td> <td><div class="op_hotel_ci op_hotel_ci2"><input class="op_hotel_city2" autocomplete="off" type="text"{%if $tplData.district%} value="{%$tplData.district|escape:'html'%}"{%/if%} maxlength="38" tip="{%$tplData.tip|escape:'html'%}" /><span class="op_hotel_detail_btn op_hotel_city_btn2 OP_LOG_BTN"></span> <ul class="op_hotel_hide op_hotel_city_detail"></ul> </div> </td> </tr> <tr> <td colspan="3"> <table cellspacing="0" cellpadding="0" class="op_hotel_cal_table"><tr><td><span class="op_hotel_sub">入住</span>&nbsp;</td> <td><div class="op_hotel_cal op_hotel_cal1"><input class="op_hotel_input1" type="text" readonly="readonly" /><span class="op_hotel_cal_btn OP_LOG_BTN op_hotel_cal_btn1"></span></div></td> <td><span class="op_{%*i*%}hotel_sub" style="margin-left:15px;">离店</span>&nbsp;</td> <td><div class="op_hotel_cal op_hotel_cal2"><input class="op_hotel_input2" type="text" readonly="readonly" /><span class="op_hotel_cal_btn OP_LOG_BTN op_hotel_cal_btn2"></span></div></td> </tr></table> </td> <td><a target="_blank" href="javascript:void(0);" hidefocus="true" class="op_hotel_normal op_hotel_submit OP_LOG_BTN">查询</a></td> </tr> </table> <div class="op_hotel_cc1"></div> <div class="op_hotel_cc2"></div> </form> {%if $tplData.district%} <div class="op_hotel_map"></div> {%* {%if $tplData.brand[0]['name']%}
            {%else%}
                <div class="op_hotel_map"><!--<iframe class="op_hotel_map_i" frameborder="0" scrolling="no" src="http://www.baidu.com/aladdin/js/hotel/qunar/getQunarMap-1.0.html"></iframe>--></div>
            {%/if%}*%} {%else%} {%if $tplData.brand[0]['name']%} <div class="op_hotel_map"></div> {%else%} {%if !$tplData.pan%} <ul class="op_hotel_options op_hotel_hide"></ul> {%/if%} {%/if%} {%/if%} <div class="op_hotel_showurl"><span class="g">{%$tplData.showurl|escape:'html'%}</span>{%if $tplData.showlamp%} - <a class="op_LAMP op_hotel_dl" href="http://open.baidu.com/" target="_blank"></a>{%/if%}</div> </div><script >A.setup(function(){var op_hotel_district,op_hotel_pan;{%if $tplData.district%} op_hotel_district='{%$tplData.district|escape:'html'%}';{%/if%}{%if $tplData.pan%}op_hotel_pan = '{%$tplData.pan|escape:'html'%}';{%/if%}var op_hotel_dataid = '{%$tplData.dataid|escape:'html'%}';var me = this, time = (new Date()).getTime(); var ajaxFinished = false;var main = me.find(".op_hotel_main")[0],city1 = me.find(".op_hotel_city")[0],city2 = me.find(".op_hotel_city2")[0],div_city1 = me.find(".op_hotel_ci1")[0],div_city2 = me.find(".op_hotel_ci2")[0],city1_btn = me.find(".op_hotel_city_btn")[0],city2_btn = me.find(".op_hotel_city_btn2")[0],topcity = me.find(".op_hotel_topcity")[0],top_close = me.find(".op_hotel_topclose")[0],citydetail = me.find(".op_hotel_city_detail")[0],city_{%*i*%}sug = me.find(".op_hotel_city_sug")[0],submit_btn = me.find(".op_hotel_submit")[0],city_value = "", sug_value = "", city1_temp = "", init_city1_value = city1.value || "",sug_err = false,timer = null,htimer = null,bapp,sug_err_temp = false, set_focus = false, ht_brand = me.find(".op_hotel_brand")[0] || null, _cal1 = me.find(".op_hotel_cal1")[0],_cal2 = me.find(".op_hotel_cal2")[0],_cc1 = me.find(".op_hotel_cc1")[0],_cc2 = me.find(".op_hotel_cc2")[0],cal_input1 = me.find(".op_hotel_input1")[0],cal{%*i*%}_input2 = me.find(".op_hotel_input2")[0],cal_btn1 = me.find(".op_hotel_cal_btn1")[0],cal_btn2 = me.find(".op_hotel_cal_btn2")[0],iframeHeight = 374,c0=0,c1=0;var ht_map, paraoptions, child_map;if(!op_hotel_district){if(ht_brand){ht_map = me.find(".op_hotel_map_i")[0];}else{paraoptions = me.find(".op_hotel_options")[0];}} else {ht_map = me.find(".op_hotel_map_i")[0];}fn_city = function(data){ if(ajaxFinished) return;if(data["status"]=="0"){sug_err = false;var das = data["data"] || [],len = das.le{%*i*%}ngth;if(len != 0){var li = [];for(var i=0; i<len; i++){var da = das[i],opts = da.s.split("|"),str = (opts[0] + "(" + opts[1] + ")").replace(sug_value, ['<span class="op_hotel_hilight">', sug_value, '</span>'].join(''));if(i == 0){li.push(['<li class="op_hotel_sug op_hotel_sug_hilight">',str,'</li>'].join(''));}else{li.push(['<li class="op_hotel_sug">',str,'</li>'].join(''));}}city_sug.innerHTML = li.join(''); }else{var err = '<li class="op_hotel_error">对不起，不支持该目的地</li>';city_sug.innerHTML = err;{%*i*%}sug_err = true;}domShow(city_sug);}else{}};fn_citydetail = function(data){if(ajaxFinished) return;citydetail.innerHTML = "";if(!op_hotel_district && !ht_brand){domHide(paraoptions);paraoptions.innerHTML = "";}if(data["status"]=="0"){var da = data["data"][0] || {}; var lis = [];if(da.list){lis.push(getCityDetail(da.subtitle, da.list));}if(!ht_brand){if(da.hotbrand){lis.push(getHotelBrand((da.hotbrandtitle || ""), da.hotbrand));}if(!op_hotel_district){if(da.parameter){paraoptions.innerHTML = getOp{%*i*%}tions(da.paratype, da.parameter);domShow(paraoptions);}}}citydetail.innerHTML = lis.join('');}else{ var image = window["BD_PS_E" + (new Date()).getTime()] = new Image();image.src="http://open.baidu.com/stat/al_e.gif?ajax_err_url=" + encodeURIComponent(getUrl($.trim(city1.value))); }};function getCitySug(){if(timer)clearTimeout(timer);var ci = $.trim(city1.value);if((ci != "") && (ci != sug_value)){sug_value = ci; var url = $.format("http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&ie=utf{%*i*%}-8&sug_type=hotel&t=#{1}", encodeURIComponent(sug_value), new Date().getTime());$.ajax({url:url+'&cb=hotel',dataType:'jsonp',success:fn_city,timeout:5000,jsonpCallback:'hotel'}); }else if(ci == ""){domHide(city_sug);city_sug.innerHTML = ""; }timer = setTimeout(getCitySug, 200);}function getAjaxResult(city){var ci = $.trim(city.value);if(ci != "" && (ci != city_value)){city_value = ci;sug_value = city_value; $.ajax({url:getUrl(city_value)+'&cb=hotel1',dataType:'jsonp',success:fn_citydetail,timeou{%*i*%}t:5000,jsonpCallback:'hotel1'}); if(!op_hotel_district){if(ht_brand){op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value),{'brand':$.trim(ht_brand.value)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],0);}} else {if(!ht_brand && (ci == init_city1_value) ){if(!op_hotel_pan){op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.m{%*i*%}atch(/^\d+-\d\d-\d\d/)[0],1);}else{op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],3);}}else{if(!op_hotel_pan && ht_brand){op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'brand':$.trim(ht_brand.value),'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],2);}{%*i*%}else{op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],3);}}}}}function getUrl(cityname){var t = (new Date()).getTime();return $.format("http://opendata.baidu.com/api.php?resource_id=#{0}&query=#{1}&ie=utf-8&oe=gbk&tn=op_hoteljson&format=json&t=#{2}", encodeURIComponent(op_hotel_dataid), encodeURIComponent(cityname), t);}function getOptions(types, lists{%*i*%}){var li = [];for(var i=0,l=types.length; i<l; i++){var tp = types[i].id,name = types[i].name;li.push(['<li>按<strong class="op_hotel_subtitle">', name, '：</strong>'].join(''));var k = 0;for(var j=0,ll=lists.length; j<ll; j++){if(lists[j].id == tp){k++;var list = lists[j],url = getFullUrl(list.url);if(k <= 4){if(k == 1){li.push(['<a target="_blank" hidefocus="true" class="op_hotel_link op_hotel_first_col op_hotel_dl" href="', url, '">', list.name, '</a>'].join(''));}else{li.push(['<a target="_bla{%*i*%}nk" hidefocus="true" class="op_hotel_link op_hotel_dl" href="', url, '">', list.name, '</a>'].join(''));}if(parseInt(list.count, 10) != 0){li.push(['<span class="op_hotel_count">(', list.count, '家)</span>'].join(''));}}else{break;}}}li.push('</li>');}return li.join('');}function getCityDetail(titles, lists){var li = [];for(var i=0,l=titles.length; i<l; i++){var tp = titles[i].id,name = titles[i].name;if(i == 0){li.push(['<li><strong>', name, '</strong><p>'].join(''));}else{li.push(['<li class="o{%*i*%}p_hotel_li"><strong>', name, '</strong><p>'].join(''));}for(var j=0,ll=lists.length; j<ll; j++){if(lists[j].id == tp){var list = lists[j];li.push(['<span class="op_hotel_place">', list.name, '</span>'].join(''));}}li.push('</p></li>');}return li.join('');}function getHotelBrand(brandtitle, brands){var li = [];if(brandtitle != ""){li.push(['<li class="op_hotel_li"><strong>', brandtitle, '</strong><p>'].join(''));for(var i=0,l=brands.length; i<l; i++){var brand = brands[i];li.push(['<span class="o{%*i*%}p_hotel_place">', brand.name, '</span>'].join(''));}li.push("</p></li>");}return li.join('');}function showSug(o){if(o){var str = $(o).text(),index = str.indexOf("-"),index2 = str.indexOf("(");if(index == -1){sug_value = str.slice(0, index2);}else{sug_value = str.slice(index + 3, index2);}city1.value = sug_value; }}function updateUrls(){$.each(me.find(".op_hotel_link"), function(i,item){item.href = getFullUrl(item.href);});}function getFullUrl(url){var d1 = cal_input1.value.match(/^\d+-\d\d-\d\d{%*i*%}/)[0], d2 = cal_input2.value.match(/^\d+-\d\d-\d\d/)[0];var _url = replaceDate(url, "fromDate", d1);_url = replaceDate(_url, "toDate", d2);return _url;}function replaceDate(url, pattern, d){var reg1 = new RegExp(pattern, "i"),reg2 = new RegExp(pattern + "=\\d+\\-\\d+\\-\\d+", "i");var _url = reg1.test(url) ? url.replace(reg2, pattern + "=" + d) : [url, '&', pattern, '=', d].join('');return _url;}function domToggle(dom){if($(dom).hasClass("op_hotel_hide"))domShow(dom);else{domHide(dom);}}function{%*i*%} domHide(dom){switch(dom){case citydetail:div_city2.style.zIndex = '0';break;case topcity:case city_sug :div_city1.style.zIndex = '0';} $(dom).addClass("op_hotel_hide");}function domShow(dom){switch(dom){case citydetail:div_city2.style.zIndex = '5';break;case topcity:case city_sug:div_city1.style.zIndex = '5';}$(dom).removeClass("op_hotel_hide");}function domSelect(e, className, input, div){var o = e.target || e.srcElement;if($(o).hasClass(className)){input.value = $(o).text();return true;}retur{%*i*%}n false;}function stopBubble(e){e = e || window.event;if (e.stopPropagation) {e.stopPropagation();} else {e.cancelBubble = true;} }function showTip(city){$(city).addClass("op_hotel_tip");city.value = $(city).attr("tip"); } function setFocusPos(input, start){if(document.selection){ var range = input.createTextRange();range.moveStart("character", start);range.collapse(true);range.select();}else if("selectionStart" in input){input.selectionStart = start;input.selectionEnd = start;input.focus();}}va{%*i*%}r hclickfn = function(){domHide(topcity);domHide(citydetail);};$(document.body).on("click", hclickfn);$(city1).on("keydown", function(e){e = e || window.event;var sugs = me.find(".op_hotel_sug"),l = sugs.length,key = e.keyCode || e.which; if(key == 38){ if(city_sug.innerHTML != ""){domShow(city_sug);}for(var i=0; i<l; i++){var sug = sugs[i];if($(sug).hasClass("op_hotel_sug_hilight")){$(sug).removeClass("op_hotel_sug_hilight");if(i != 0){$(sugs[i-1]).addClass("op_hotel_sug_hilight");showSug(sugs[{%*i*%}i-1]);}else{$(sugs[l-1]).addClass("op_hotel_sug_hilight");showSug(sugs[l-1]); }setFocusPos(this, this.value.length);e.preventDefault(); return false;}}}else if(key == 40){ if(city_sug.innerHTML != ""){domShow(city_sug);}for(var i=0; i<l; i++){var sug = sugs[i];if($(sug).hasClass("op_hotel_sug_hilight")){$(sug).removeClass("op_hotel_sug_hilight");if(i != (l-1)){$(sugs[i+1]).addClass("op_hotel_sug_hilight");showSug(sugs[i+1]);}else{$(sugs[0]).addClass("op_hotel_sug_hilight");showSug(sugs[0]);}brea{%*i*%}k;}};}else if(key == 13){ if(!sug_err){if(!$(city_sug).hasClass("op_hotel_hide")){showSug(me.find(".op_hotel_sug_hilight")[0]);getAjaxResult(city1);domHide(city_sug);}}else{city_value = $.trim(city1.value); if(!op_hotel_district && !ht_brand){domHide(paraoptions);}}}});$(city1).on("mouseup", function(e){if(!set_focus){e = e || window.event;e.preventDefault(); set_focus = true;}else{city1.focus();}});$(city1).on("focus", function(){if(!set_focus){city1.select();}city1_temp = $.trim(this.value);su{%*i*%}g_err_temp = sug_err;});$(city1).on("blur", function(){set_focus = false; if($.trim(this.value) == ""){sug_value = city1_temp; this.value = city1_temp;sug_err = sug_err_temp;}if(sug_err){city_value = $.trim(city1.value); citydetail.innerHTML = "";if(!op_hotel_district && !ht_brand){paraoptions.innerHTML = "";domHide(paraoptions);}}else{if(!$(city_sug).hasClass("op_hotel_hide")){showSug(me.find(".op_hotel_sug_hilight")[0]);getAjaxResult(city1);}}domHide(city_sug);});$(city2).on("focus", function({%*i*%}){if($(this).hasClass("op_hotel_tip")){this.value = "";$(this).removeClass("op_hotel_tip"); }var n = this.value.length;if(n > 0){setFocusPos(this, n);} });$(div_city2).on("keydown", function(e){e = e || window.event;var key = e.keyCode || e.which;if(key == 9){if($.trim(city2.value) == ""){showTip(city2);}}});var hmousedfn = function(e){if($.trim(city2.value) == ""){showTip(city2);}};$(document.body).on("mousedown", hmousedfn);$(city1_btn).on("click", function(e){domHide(citydetail);if(c0)c0.hide{%*i*%}();if(c1)c1.hide();domToggle(topcity);stopBubble(e); });$(city2_btn).on("click", function(e){domHide(topcity);if(c0)c0.hide();if(c1)c1.hide();if(citydetail.innerHTML != ""){domToggle(citydetail);}else{domHide(citydetail);}city2.focus();stopBubble(e); });$(topcity).on("click", function(e){var o = e.target || e.srcElement;if(domSelect(e, "op_hotel_citys", city1, topcity)){set_focus = true;setFocusPos(city1, city1.value.length); city_sug.innerHTML = ""; if ( !(!ht_brand && op_hotel_district) ) {get{%*i*%}AjaxResult(city1);} else { sug_value = $.trim(city1.value);if(!op_hotel_pan){city2.value = city2.getAttribute('tip');}if (!$(city2).hasClass('op_hotel_tip') && !op_hotel_pan){$(city2).addClass("op_hotel_tip");}getAjaxResult(city1);}}else if(!$(o).hasClass("op_hotel_topclose")){stopBubble(e); }});$(citydetail).on("click", function(e){if(domSelect(e, "op_hotel_place", city2, citydetail)){$(city2).removeClass("op_hotel_tip");setFocusPos(city2, city2.value.length); }else{stopBubble(e); }});$(city_su{%*i*%}g).on("mouseover", function(e){var o = e.target || e.srcElement;if($(o).hasClass("op_hotel_sug")){$.each(me.find(".op_hotel_sug"), function(i,item){if(item != o){$(item).removeClass("op_hotel_sug_hilight");}else{$(o).addClass("op_hotel_sug_hilight");}});}});$(submit_btn).on("click", function(){if(!sug_err){var city2_value = $(city2).hasClass("op_hotel_tip") ? "" : $.trim(city2.value);if(ht_brand){city2_value = [ht_brand.value, city2_value].join(' ');}this.href = $.format("http://hotel.qunar.com/s{%*i*%}earch.jsp?toCity=#{0}&q=#{1}&fromDate=#{2}&toDate=#{3}&ex_track=bd_aladding_hotelsearch_01", encodeURIComponent($.trim(city1.value)), encodeURIComponent(city2_value), cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0]);}else{this.href = "http://hotel.qunar.com/#ex_track=bd_aladding_hotelsearch_01";}});$(submit_btn).on("mouseover", function(){$(this).removeClass("op_hotel_normal");});$(submit_btn).on("mouseout", function(){$(this).addClass("op_hotel_normal");{%*i*%}});var now = (typeof(bdServerTime)=='undefined') ? new Date() : new Date(bdServerTime*1000); var endTime = new Date(now.getFullYear(), now.getMonth(), (now.getDate() + 88));now = now.getFullYear()*10000 + (now.getMonth() + 1)*100 + now.getDate(); endTime = endTime.getFullYear()*10000 + (endTime.getMonth() + 1)*100 + endTime.getDate();showStr(now+2, cal_input1);showStr(now+3, cal_input2);var D1 = formatDate(cal_input1),D2 = formatDate(cal_input2);function formatDate(input){var a = input.value.mat{%*i*%}ch(/^(\d+)-(\d\d)-(\d\d)/);if(a && a.length==4){return parseInt(''+a[1]+a[2]+a[3]);}else{return false;}}function getNormalDate(date){return ''+date.getFullYear()+'-'+('0'+(date.getMonth()+1)).slice(-2)+'-'+('0'+date.getDate()).slice(-2);}function getRightDate(str){str = str.toString().match(/^(\d+)(\d\d)(\d\d)/);str.shift();return new Date(str[0],str[1]-1,str[2]);}function showStr(d, input){var date = getRightDate(d);input.value = getNormalDate(date) +'('+'周'+('日一二三四五六'.charAt(date.getDay()))+'){%*i*%}';}A.use('calendar', function(){c0 = A.ui.calendar({position:_cal1,input:cal_input1,element:_cc1,count:2,today:now,between:[now, endTime],onShow:function(){domHide(topcity);domHide(citydetail);if(c1)c1.hide();this.setHtml(D1);},onChange:function(){this.setDay(D1);},onSelectDay:function(date,week){D1 = date;if(D2 <= D1){D2 = getNormalDate(getRightDate(D1 + 1)).replace(/-/g, '');showStr(D2, cal_input2);}if(!op_hotel_district){if(!ht_brand){updateUrls();}else{if(!sug_err){op_hotel_qunar_map.Qunar.i{%*i*%}nitialize(child_map, $.trim(city_value), {'brand':$.trim(ht_brand.value)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],0);}}} else{if(!ht_brand && !sug_err && (init_city1_value == city1.value) ) {if(!op_hotel_pan){op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],1);}else{op_hotel_qunar_map.Qunar.initialize(c{%*i*%}hild_map, $.trim(city_value), {'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],3);}}else{if(!op_hotel_pan && ht_brand){op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {'brand':$.trim(ht_brand.value),'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],2);}else{op_hotel_qunar_map.Qunar.initialize(child_map, $.trim(city_value), {%*i*%}{'keyword':$.trim(op_hotel_district)}, cal_input1.value.match(/^\d+-\d\d-\d\d/)[0], cal_input2.value.match(/^\d+-\d\d-\d\d/)[0],3);}}}}});c1 = A.ui.calendar({position:_cal2,input:cal_input2,element:_cc2,count:2,today:now,onShow:function(){domHide(topcity);domHide(citydetail);if(c0)c0.hide();this.setHtml(D2);this.setBetween([D1 + 1, endTime + 1]);},onChange:function(){this.setDay(D2);},onSelectDay:function(date,week){D2 = date;if(!op_hotel_district){if(!ht_brand){updateUrls();}else{if(!sug_err){o{%*i*%}p_hotel_qunar_map.Qunar.toDate = cal_input2.value.match(/^\d+-\d\d-\d\d/)[0];}}}}});c0.addEvent(cal_btn1,'click',function(){c0.show();},true);c1.addEvent(cal_btn2,'click',function(){c1.show();},true);});function getQunarMapObject(){if(typeof(op_hotel_qunar_map) == "undefined"){htimer = setTimeout(getQunarMapObject, 100);}else{child_map = op_hotel_qunar_map.document.getElementById('map');getAjaxResult(city1);getCitySug();}}if(me.find('.op_hotel_map')[0]){var op_hotel_map_div = me.find('.op_hotel_{%*i*%}map')[0];var appinfo_json = {app_id:{%if $tplData.appid%}{%$tplData.appid%}{%else%}''{%/if%},src:'http://www.baidu.com/aladdin/js/hotel/qunar2/getQunarMap-1.2.html?p1value='+me.p1+'&mu='+encodeURIComponent(me.mu),height:374};window['OP_HOTEL_CHANGEHEIGHT'] = function(iframeHeight){op_hotel_map_div.style.height = iframeHeight + 'px';op_hotel_map_div.getElementsByTagName('iframe')[0].style.height = iframeHeight + 'px';};A.use("renderIframe3",function(){bapp = A.ui.renderIframe3({container:op_hotel_map_div,relay : 'http://www.baidu.com/cache/app/aladdin/bd_aladdin_relay.html',zone:'app-li{%*i*%}st',width : 540});bapp.render(appinfo_json,{});bapp.addEventListener("setHeight",function(e,o){iframeHeight = o.height;});});}if(!op_hotel_district){showTip(city2);if(ht_brand){getQunarMapObject();}else{getAjaxResult(city1);getCitySug();}}else{if(ht_brand){getQunarMapObject();} else {getQunarMapObject();} }this.dispose = function(){clearTimeout(timer);clearTimeout(htimer);window['OP_HOTEL_CHANGEHEIGHT'] = function(){};window.op_hotel_qunar_map = undefined;$(document.body).unbind("click", hclickf{%*i*%}n);$(document.body).unbind("mousedown", hmousedfn);if(!ajaxFinished){ajaxFinished = true;}bapp&&bapp.dispose&&bapp.dispose();};});</script>{%/block%}