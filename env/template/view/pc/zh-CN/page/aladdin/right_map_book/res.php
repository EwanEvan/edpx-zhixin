<?php 
  class CssJs_Util_right_map_book
   {
      private static $cssStr = '.opr-map-book-container{padding:10px 4px;}.opr-map-booking{background-color:#fafafa;}.opr-map-book-container .opr-map-book-radio{position:relative;top:2px;right:2px;margin:0;padding:0;+width:13px;+height:13px;}.opr-map-book-container label{zoom:1;+position:relative;+top:4px;}.opr-map-unbooking .opr-map-book-box{display:none;}.opr-map-booking .opr-map-book-box{display:block;}.opr-map-unbooking .opr-map-book-expand-btn{display:inline;}.opr-map-unbooking .opr-map-book-fold-btn{display:none;}.opr-map-booking .opr-map-book-expand-btn{display:none;}.opr-map-booking .opr-map-book-fold-btn{display:inline;}.opr-map-book-expand-btn{color:#00c;_position:relative;_top:2px;}.opr-map-book-fold-btn{color:#999;_position:relative;_top:2px;}.opr-map-book-price{color:#f70;}.opr-map-book-comment{color:#999;zoom:1;}.opr-map-book-title{padding:0 4px;}.opr-map-book-title span{float:left;}.opr-map-book-title a{float:right;color:#999;font-weight:normal;font-size:13px;}.opr-map-book-right{position:relative;top:-3px;float:left;width:158px;overflow-y:hidden;}.opr-map-book-input{width:118px;padding-left:10px;}.opr-map-book-customer-name-container{float:left;}.opr-map-book-sex-container{float:left;margin-left:13px;+margin-left:9px;margin-top:2px;}.opr-map-book-date-container{background-color:#fff;float:left;}.opr-map-book-date-container .opr-map-book-input-date{width:108px;width:106px\\9;+width:103px;padding-left:6px;}.opr-map-book-date-input-container{width:124px;}.opr-map-book-time-container{float:left;}.opr-map-book-customer-number-dropdown-container{width:134px;float:left;margin-right:4px;}.opr-map-book-room-or-hall-container{float:left;margin-top:2px;margin-left:9px;}.opr-map-book-time-dropdown-container{width:80px;+width:90px;}.opr-map-book-error-input{border:1px solid #c00;color:#c00;}.opr-map-book-error-dropdown .c-dropdown2 .c-dropdown2-btn-group{border:1px solid #c00;border-bottom-color:#c00;border-right-color:#c00;-moz-user-select:none;-webkit-user-select:none;user-select:none;}.opr-map-book-error-dropdown .c-dropdown2 .c-dropdown2-btn{color:#c00;}.opr-map-book-getvcode-btn{margin-left:8px;}.opr-map-book-getvcode-btn-disable{padding:0 4px;}.opr-map-book-result{position:relative;padding-left:44px;display:none;line-height:1.4em;color:#666;zoom:1;}.opr-map-book-result i{position:absolute;top:1px;left:22px;}.opr-map-book-result-success .opr-map-book-result-success-box{display:block;}.opr-map-book-result-success .opr-map-book-result-fail-box{display:none;}.opr-map-book-result-fail .opr-map-book-result-fail-box{display:block;}.opr-map-book-result-fail .opr-map-book-result-success-box{display:none;}.opr-map-book-container .c-icon-chevron-bottom{margin-left:2px;}.opr-map-book-container .c-icon-chevron-top{margin-left:2px;}.opr-map-book-submit-container{position:relative;}.opr-map-book-more{position:absolute;right:15px;top:4px;}';  // css字串，不含<style>和</style>标签
      private static $jsStr  = 'A.merge("right_map_book",function(){A.setup(function(){var e=this;var j=false;var c="http://map.baidu.com/detail?";var h="placeholder" in document.createElement("input");var d=[];var b=(bds&&bds.comm&&bds.comm.serverTime)?bds.comm.serverTime*1000:(+new Date());var i=new Date(b);var g=k(i);function f(l){this.$container=l.container;this.init()}f.prototype={init:function(){var l=this;l.id=l.$container.attr("data-id");l.thirdId=l.$container.attr("data-shopid");l.vcoding=false;l.commiting=false;l.loaded=false;l.calendar=null;l.timeDropdown=null;l.numberDropdown=null;l.thirdName="";l.shopId="";l.fd=[];l.$formBox=l.$container.find(".opr-map-book-box");l.$cInput=l.$container.find(".opr-map-book-input-date");l.$timeDropdownContainer=l.$container.find(".opr-map-book-time-dropdown-container");l.$dateDropdownContainer=l.$container.find(".opr-map-book-date-container");l.fd.push(l.$numberDropdownContainer=l.$container.find(".opr-map-book-customer-number-dropdown-container"));l.fd.push(l.$customerNameInput=l.$container.find(".opr-map-book-customer-name"));l.fd.push(l.$phoneInput=l.$container.find(".opr-map-book-customer-phone"));l.fd.push(l.$vcodeInput=l.$container.find(".opr-map-book-vcode"));l.$bookExpandBtn=l.$container.find(".opr-map-book-expand-btn");l.$bookFoldBtn=l.$container.find(".opr-map-book-fold-btn");l.$getVcodeBtn=l.$container.find(".opr-map-book-getvcode-btn");l.$submitBtn=l.$container.find(".opr-map-book-submit-btn");l.$roomOrHallContainer=l.$container.find(".opr-map-book-room-or-hall-container");l.$sexRadio=l.$container.find(\'input[name="opr-map-book-customer-sex-\'+l.id+\'"]\');l.$cBox=l.$container.find(".opr-map-book-calendar-container");l.$result=l.$container.find(".opr-map-book-result");l.bindEvent()},bindEvent:function(){var l=this;l.$bookExpandBtn.bind("click",function(){if(!l.loaded){l.loadInfo();l.loaded=true}l.open()});l.$bookFoldBtn.bind("click",function(){l.close()});l.$dateDropdownContainer.bind("click",function(){l.calendar&&l.calendar.show();return false});$.each(l.fd,function(n,o){var p=o.attr("data-form-type");var m="opr-map-book-error-"+p;if(p==="input"){o.bind("focus",function(){if(o.is("."+m)){var q=o.data("preValue");if(q){o.val(q);if(!h){o.css("color","#000")}}else{o.val(h?"":o.attr("data-placeholder"))}o.removeClass(m)}}).bind("blur",function(){var q=$.trim(o.val());o.data("preValue",q);if(q&&q!==o.attr("data-placeholder")){l.check(o)}})}else{}});l.$submitBtn.bind("click",function(){if(l.commiting===true){return}var n=true;$.each(l.fd,function(r,s){var t=l.check(s);n=t?n:t});if(!n){return}l.disableSubmit();var q={qt:"cater_bookconfirm",personNum:parseInt(l.numberDropdown.getValue(),10),userName:$.trim(l.$customerNameInput.val()),mobile:$.trim(l.$phoneInput.val()),shopId:l.shopId,thirdName:l.thirdName,needRoom:0,acceptHall:0,orderTime:l.calendar.value+" "+l.timeDropdown.getValue(),pcode:$.trim(l.$vcodeInput.val()),from:"pc",srcFrom:"right_map_book_"+e.data.srcid,gender:parseInt(l.$sexRadio.filter(":checked").val())};var m=l.$container.find(\'input[type=radio][name^="opr-map-book-room-or-hall"]:checked\');if(m.length===1){var p=m.eq(0).attr("data-name");if(p==="hall"){q.acceptHall=1}else{q.needRoom=1}}var o=l.$submitBtn.text();l.$submitBtn.text(l.$submitBtn.attr("data-ajaxing"));$.ajax({url:c+$.param(q),dataType:"jsonp"}).done(function(s,u,r){if(j){return}l.$submitBtn.text(o);if(s&&s.errorNo==0){var t="";if(s.data&&s.data.book_feedback){t=s.data.book_feedback}l.success(t)}else{if(parseInt(s.errorNo,10)===9001){l.tip("error",l.$vcodeInput)}else{l.fail(s.errorMsg)}}l.enableSubmit()}).fail(function(r,t,s){if(j){return}l.$submitBtn.text(o);l.bookFail();l.enableSubmit()}).error(function(r,t,s){if(j){return}l.$submitBtn.text(o);l.bookFail();l.enableSubmit()})});l.$getVcodeBtn.bind("click",function(){if(l.vcoding===true){return}if(!l.check(l.$phoneInput)){return}l.$getVcodeBtn.addClass("c-btn-disable opr-map-book-getvcode-btn-disable");l.vcoding=true;l.$phoneInput.attr("disabled",true);l.vcodeTimerCount=60;if(l.vcodeTimer){clearInterval(l.vcodeTimer)}l.$getVcodeBtn.html((l.vcodeTimerCount--)+"秒后重新获取");l.vcodeTimer=setInterval(function(){if(l.vcodeTimerCount>0){l.$getVcodeBtn.html((l.vcodeTimerCount--)+"秒后重新获取")}else{l.vcoding=false;if(l.vcodeTimer){clearInterval(l.vcodeTimer)}l.$phoneInput.removeAttr("disabled");l.$getVcodeBtn.html("获取验证码").removeClass("c-btn-disable opr-map-book-getvcode-btn-disable")}},1000);var n={qt:"cater_phonecaptcha",phone_num:$.trim(l.$phoneInput.val())};var m=l.$getVcodeBtn.text();l.$getVcodeBtn.text(l.$getVcodeBtn.attr("data-ajaxing"));$.ajax({url:c+$.param(n),dataType:"jsonp"}).done(function(p,q,o){if(j){return}l.$getVcodeBtn.text(m)}).fail(function(o,q,p){l.$getVcodeBtn.text(m)}).error(function(o,q,p){l.$getVcodeBtn.text(m)})});if(!h){a(l.$customerNameInput.get(0));a(l.$phoneInput.get(0));a(l.$vcodeInput.get(0))}},loadInfo:function(l){var m=this,n={qt:"cater_bookinfo",thirdId:m.thirdId};if(l){n.date=l}$.ajax({url:c+$.param(n),dataType:"jsonp"}).done(function(L,u,B){if(j){return}if(L&&L.data&&L.errorNo==0){L=L.data;var o=L.book_info,p=L.shop_info,G=p.have_hall,q=p.have_room,r=o.book_date,H=o.time.date_list,J=o.time.detail,K=[],x=[],z="hall",v,C,I;m.thirdName=p.agent;m.shopId=p.shop_id;if(G==="1"&&q==="1"){}else{if(G==="1"){m.$roomOrHallContainer.find(\'[data-name="room"]\').remove()}else{if(q==="1"){z="room";m.$roomOrHallContainer.find(\'[data-name="hall"]\').remove()}else{m.$roomOrHallContainer.remove()}}}m.$container.find(\'input[type=radio][name^="opr-map-book-room-or-hall"][data-name="\'+z+\'"]\').attr("checked",true);var t=o.person,F,D,w=[{value:0,text:"请选择人数"}];if(t){F=t.max?parseInt(t.max,10):50;D=t.min?parseInt(t.min,10):1}for(var E=D;E<=F;E++){w.push({value:E,text:E+"人"})}for(var E=0;E<H.length;E++){var s=H[E].replace(/(\\d{4})\\-(\\d{1,2})\\-(\\d{1,2})/,function(O,M,N,y){v=M;C=N*1<10?"0"+N*1:N;I=y*1<10?"0"+y*1:y;return v+C+I});K.push({sDate:s,dDate:new Date(v*1,C*1-1,I*1)})}for(var E=0;E<J.length;E++){if(J[E]&&J[E].bookable==1){x.push({value:J[E].time,text:J[E].time})}}m.setCalendar(K);m.setDropdown(x,w)}}).fail(function(o,q,p){if(j){return}}).error(function(o,q,p){if(j){return}})},setCalendar:function(m){var l=this;if(!l.calendar){A.use("calendar",function(){l.calendar=A.ui.calendar({input:l.$cInput.get(0),element:l.$cBox.get(0),position:l.$dateDropdownContainer.get(0),count:1,between:[m[0].sDate,m[m.length-1].sDate],onShow:function(n){$(n).css("zIndex",250);l.timeDropdown&&l.timeDropdown.close();l.numberDropdown&&l.numberDropdown.close()},onSelectDay:function(n,o){n=k(n);if(n!==l.calendar.value){l.loadInfo(n)}l.calendar.value=n}});l.calendar.toInput(m[0].sDate,m[0].dDate.getDay());l.calendar.value=k(m[0].sDate)})}},setDropdown:function(n,m){var l=this;if(!l.timeDropdown){A.use("dropdown21",function(){l.timeDropdown=A.ui.dropdown21(n,{number:6,appendTo:l.$timeDropdownContainer.get(0),onopen:function(){l.calendar&&l.calendar.hide()}});l.numberDropdown=A.ui.dropdown21(m,{number:6,appendTo:l.$numberDropdownContainer.get(0),onopen:function(){l.$numberDropdownContainer.removeClass("opr-map-book-error-"+l.$numberDropdownContainer.attr("data-form-type"));l.calendar&&l.calendar.hide()}})})}else{l.timeDropdown.removeAll().add(n);l.numberDropdown.removeAll().add(m)}},open:function(){var l=this;l.$formBox.show();l.$result.hide();l.$container.removeClass("opr-map-unbooking").addClass("opr-map-booking");if(d.length>0){$.each(d,function(m,o){if(l!==o&&o.close){o.close()}})}},close:function(){var l=this;l.$formBox.hide();l.$result.hide();l.$container.removeClass("opr-map-booking").addClass("opr-map-unbooking")},disableSubmit:function(){var l=this;l.commiting=true;l.$submitBtn.removeClass("c-btn-primary").addClass("c-btn-disable")},enableSubmit:function(){var l=this;l.commiting=false;l.$submitBtn.removeClass("c-btn-disable").addClass("c-btn-primary")},reset:function(){var l=this;l.timeDropdown.setIndex(0);l.numberDropdown.setIndex(0);l.$customerNameInput.val(h?"":l.$customerNameInput.attr("data-placeholder"));l.$phoneInput.val(h?"":l.$phoneInput.attr("data-placeholder"));l.$vcodeInput.val(h?"":l.$vcodeInput.attr("data-placeholder"));l.enableSubmit()},success:function(m){var l=this;m=$.trim(m);m=m?m:"您已预订成功，<br>订单详情请见手机短信。";l.$formBox.hide();l.reset();l.$result.removeClass("opr-map-book-result-fail").addClass("opr-map-book-result-success").show().find(".opr-map-book-result-success-box>span").html(m)},fail:function(m){var l=this;m=$.trim(m);m=m?m:"预订失败，<br>系统繁忙，请稍后再试。";l.$formBox.hide();l.$result.removeClass("opr-map-book-result-success").addClass("opr-map-book-result-fail").show().find(".opr-map-book-result-fail-box>span").html(m)},tip:function(m,l){var n=l.attr("data-form-type");l.addClass("opr-map-book-error-"+n).val(l.attr("data-"+m));if(!h&&n==="input"){l.css("color","#cc0000")}},check:function(n){if(n.is(".opr-map-book-error-"+n.attr("data-form-type"))){return false}var q=$.trim(n.val()),l=true,p=n.attr("data-type"),m=this;var r={number:{empty:function(){return !m.numberDropdown.getValue()}},customer:{empty:function(){return !q||q===n.attr("data-placeholder")},error:function(){var o=new RegExp("[`~!@#$^&*()=|{}\':;\',\\\\[\\\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“\'。，、？]");return/^\\d+$/.test(q)||o.test(q)}},phone:{empty:function(){return !q||q===n.attr("data-placeholder")},error:function(){return !/^(1(([35][0-9])|(47)|(45)|[8]\\d{1}))\\d{8}$/.test(q)}},vcode:{empty:function(){return !q||q===n.attr("data-placeholder")}}};if(p in r){for(var s in r[p]){if(r[p].hasOwnProperty(s)){var l=!r[p][s]();if(l){continue}else{m.tip(s,n);return l}}}}return true}};function k(r,n){var q=r,p=n;if(arguments.length===1){q="#{y}-#{m}-#{d}";p=arguments[0]}var t,l,s,o;if($.type(p)==="date"){t=p.getFullYear();l=p.getMonth()+1;s=p.getDate()}else{p=String(p);o=p.match(/(\\d{4})\\-(\\d{1,2})-(\\d{1,2})/)||p.match(/(\\d{4})(\\d{2})(\\d{2})/);t=o[1];l=o[2];s=o[3]}l=l*1<10?"0"+l*1:l;s=s*1<10?"0"+s*1:s;return $.format(q,{y:t,m:l,d:s})}function a(m){var o=m.getAttribute("data-placeholder");var n=m.getAttribute("data-error");var l=m.getAttribute("data-empty");if(o){var p=$(m);m.value=o;m.style.color="#666";p.on("focus",function(){if(m.value==o||m.value==n||m.value==l){m.value="";m.style.color="#000"}});p.on("blur",function(){if($.trim(m.value)==""){m.value=o;m.style.color="#666"}})}}e.find(".opr-map-book-container").each(function(l,o){if(l<=1){var m=$(o);d.push(new f({container:m}))}});e.dispose=function(){j=true;$.each(d,function(l,m){if(m){if(m.vcodeTimer){clearInterval(m.vcodeTimer)}if(m.calendar&&m.calendar.dispose){m.calendar.dispose()}if(m.timeDropdown&&m.timeDropdown.dispose){m.timeDropdown.dispose()}if(m.numberDropdown&&m.numberDropdown.dispose){m.numberDropdown.dispose()}}})}})});';   // js字串，不含<script标签
      private static $uiList = 'btn,input,img,dropdown2';   // 包含的组件，以','分割的字符串，比如'input,text,button'这样
      
      public static function getHeadCss()
      {
         if (!is_string(self::$cssStr))
         {
            return '';
         }
         return self::$cssStr;
      }
      
      public static function getFootJs()
      {
         if (!is_string(self::$jsStr))
         {
            return '';
         }
         return self::$jsStr;
      }
      
      // 返回数组
      public static function getCssUI()
      {
		 if ( empty(self::$uiList) ) return array();

         $arr = @explode(',', self::$uiList);
         if (!is_array($arr))
         {
            $arr = array();
         }
         return $arr;
      }
   }
