{%extends 'c_base.tpl'%} {%block name="title"%}{%/block%}{%block name="foot"%}{%/block%}{%block name='data_modifier'%} {%*数据预处理开始*%} {%*additional逻辑*%} {%if $tplData.search_property%} {%$AdditionalKey = $tplData.search_property%} {%elseif $tplData.cmpbrief[0]%} {%$AdditionalKey = $tplData.cmpbrief[0]%} {%elseif count($tplData.result) > 1%} {%$AdditionalKey = "remark"%} {%/if%} {%*单实体答案*%} {%if !$tplData.result[0].attrquery%} {%if $tplData.result[0].additional%} {%$tplData.result[0].attrquery = $tplData.result[0].additional%} {%else%} {%$tplData.result[0].attrquery = $tplData.result[0].ename%} {%/if%} {%/if%} {%*单实体标题*%} {%if count($tplData.result) == 1%} {%$tplData.SingleTitle = []%} {%if $tplData.search_property%} {%$tplData.SingleTitle.entity = $tplData.result[0].ename%} {%$tplData.SingleTitle.append = $tplData.result[0].appendinfo%} {%$tplData.SingleTitle.attr = $tplData.result[0].searchp%} {%/if%} {%if $tplData.trace.level && count(end($tplData.trace.level)) == 1%} {%$endLevel = end($tplData.trace.level)%} {%$tplData.SingleTitle.entity = ($tplData.SingleTitle.entity) ? $tplData.SingleTitle.entity : $tplData.hash[$endLevel[0].sign].ename%} {%$tplData.SingleTitle.append = ($tplData.SingleTitle.append) ? $tplData.SingleTitle.append : $tplData.hash[$endLevel[0].sign].appendinfo%} {%$tplData.SingleTitle.attr = ($tplData.SingleTitle.attr) ? $tplData.SingleTitle.attr : $endLevel[0].property%} {%/if%} {%/if%} {%*P属性字符串to数组*%} {%$tplData.search_property = explode('|', $tplData.search_property)%} {%$tplData.result[0].searchp = explode('|', $tplData.result[0].searchp)%} {%*数据预处理结束*%} {%*跳转链接方法 优先级jumpquery>jumplink>ename*%} {%$EndParams = "&rsv_cq={%$extData.OriginQuery%}&rsv_dl=0_left_exactqa_{%$extData.resourceid%}"%} {%function op_exactqa_spp_get_href jumpquery='' jumplink='' ename=''%}{%strip%} {%if $jumpquery%} {%$escaped_jumpquery = $jumpquery%} {%build_search_url params="wd={%$escaped_jumpquery%}"%}{%$EndParams|escape%} {%elseif $jumplink%} {%$jumplink|escape%} {%else%} {%$escaped_ename = $ename%} {%build_search_url params="wd={%$escaped_ename%}"%}{%$EndParams|escape%} {%/if%} {%/strip%}{%/function%} {%*判断整体展现样式*%} {%if count($tplData.result) > 1%} {%*多实体*%} {%$EntityNumber = 'M'%} {%else%} {%*单实体*%} {%$EntityNumber = 'S'%} {%/if%} {%*$EntityNumber    实体类型 S-单实体 M-多实体*%}{%/block%}{%block name='content'%}<style>.op_exactqa_spp_main a,.op_exactqa_spp_tools a{text-decoration:none}.op_exactqa_spp_main a:hover,.op_exactqa_spp_tools a:hover{text-decoration:underline}.op_exactqa_spp_tools{color:#999;font-size:.92em;text-align:right;margin:-15px 0 -3px 0}.op_exactqa_spp_tools a{color:#999}.op_exactqa_spp_tools_sep{color:#ccc;margin:0 8px}{%if $EntityNumber == 'S'%}.op_exactqa_spp_s_item{overflow:auto}.op_exactqa_spp_s_area{padding-bottom:20px}.op_exactqa_spp_s_prop{font-size:1.07em;font-weight:bold;color:#999}.op_exactqa_spp_s_prop a,.op_exactqa_spp_s_prop a:hover{color:#999}.op_exactqa_spp_s_answer td{font-family:"Microsoft YaHei",SimHei;font-size:1.38em}.op_exactqa_spp_s_answer_th{color:#999;white-space:nowrap;vertical-align:top}{%elseif $EntityNumber == 'M'%}.op_exactqa_spp_body{padding-bottom:15px;*zoom:1}.op_exactqa_spp_body_bold{font-weight:bold}.op_exactqa_spp_itemsArea a{color:#333}.op_exactqa_spp_item_img{display:inline-block;vertical-align:middle}.op_exactqa_spp_item_noimg{background:#dee0e3 url(http://www.baidu.com/aladdin/img/exactqa/exactqa_nopic.png) center center no-repeat;cursor:pointer}.op_exactqa_spp_page{clear:both}{%/if%}</style><div class="c-border"> <div class="op_exactqa_spp_main"> {%if $EntityNumber == 'S'%} {%$ViewPicS = reset(explode(',', $tplData.result[0].selpic))%} <div class="op_exactqa_spp_s_item c-row"> {%if $tplData.result[0].selpic && $tplData.result[0][$ViewPicS]%} <div class="op_exactqa_spp_s_img c-span6"> <a href='{%op_exactqa_spp_get_href jumpquery=$tplData.result[0].jumpquery jumplink=$tplData.result[0].jumplink ename=$tplData.result[0].ename%}' target="_blank" title="{%$tplData.result[0].ename|escape:'html'%}"> <img class="c-img c-img6" src="{%$tplData.result[0][$ViewPicS]|escape:'html'%}"/> </a> </div> {%/if%} <div class="op_exactqa_spp_s_area {%if $tplData.result[0].selpic && $tplData.result[0][$ViewPicS]%}c-span18{%else%}c-span24{%/if%} c-span-last"> <p class="op_exactqa_spp_s_prop c-gap-bottom-small"> {%if $tplData.SingleTitle.entity%} <a href='{%op_exactqa_spp_get_href ename=$tplData.SingleTitle.entity%}' target="_blank">{%$tplData.SingleTitle.entity|escape%}</a>{%if $tplData.SingleTitle.append%}<span>({%$tplData.SingleTitle.append|escape%})</span>{%/if%} {%else%} {%$extData.OriginQuery%} {%/if%} </p> <table class="op_exactqa_spp_s_answer"> {%foreach array_slice($tplData.search_property, 0, 5) as $item%} <tr> <td class="op_exactqa_spp_s_answer_th">{%$tplData.result[0].searchp[$item@index]|escape:'html'%}：</td> <td>{%if $tplData.result[0][$item]%}{%$tplData.result[0][$item]|escape:'html'%}{%else%}-{%/if%}</td> </tr> {%/foreach%} </table> </div> </div> {%elseif $EntityNumber == 'M'%} <div class="op_exactqa_spp_body"> <table class="c-table c-gap-bottom"> <thead> <tr> <th style="width:200px;"><span class="op_exactqa_spp_body_bold">{%if $tplData.SingleTitle.entity%}{%$tplData.SingleTitle.entity|limitlen:28|escape%}{%else%}{%$extData.OriginQuery|limitlen:28%}{%/if%}</span></th> {%foreach array_slice($tplData.search_property, 0, 5) as $item%} <th>{%$tplData.result[0].searchp[$item@index]%}</th> {%/foreach%} </tr> </thead> <tbody class="op_exactqa_spp_itemsArea"> {%foreach array_slice($tplData.result, 0, 4) as $item%} {%$imgSrc = $item[end(explode(',', $tplData.result[0].selpic))]%} <tr> <td><a href='{%op_exactqa_spp_get_href jumpquery=$item.jumpquery jumplink=$item.jumplink ename=$item.ename%}' title="{%$item.ename|escape:'html'%}" target="_blank">{%if $imgSrc%}<img class="c-img c-img3 c-gap-right op_exactqa_spp_item_img" src="{%$imgSrc|escape:'html'%}"/>{%else%}<span class="c-img c-img3 op_exactqa_spp_item_noimg"></span>{%/if%}</a><a href='{%op_exactqa_spp_get_href jumpquery=$item.jumpquery jumplink=$item.jumplink ename=$item.ename%}' title="{%$item.ename|escape:'html'%}" target="_blank">{%$item.ename|limitlen:13|escape:'html'%}</a></td> {%foreach array_slice($tplData.search_property, 0, 5) as $prop%} <td>{%if $tplData.result[$item@index][$prop]%}{%$tplData.result[$item@index][$prop]%}{%else%}-{%/if%}</td> {%/foreach%} </tr> {%/foreach%} </tbody> </table>  <div class="op_exactqa_spp_page" style="display:none"><p data-click="{'fm':'beha'}"></p></div>  </div> {%/if%} </div>   <div class="op_exactqa_spp_tools"> {%if ($EntityNumber == 'S' && $tplData.result[0].sourcename) || ($EntityNumber == 'M' && strpos($tplData.result[0].sourcelink, 'http://lvyou.baidu.com') !== false)%}来自<a href="{%if $EntityNumber == 'S'%}{%$tplData.result[0].sourcelink|escape%}{%elseif $EntityNumber == 'M' && strpos($tplData.result[0].sourcelink, 'http://lvyou.baidu.com') !== false%}http://lvyou.baidu.com{%/if%}" target="_blank">{%$tplData.result[0].sourcename|escape%}</a><span class="op_exactqa_spp_tools_sep">|</span>{%/if%}<span class="op_exactqa_spp_tools_fb_area"><a class="op_exactqa_spp_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:'报错'}">报错</a></span> </div> </div><script type="text/javascript" >
    A.setup({
        OriginQuery: "{%$extData.OriginQuery|escape:'html'|escape:'javascript'%}",
        EndParams: "{%$EndParams|escape:'javascript'%}",
        EntityNumber: "{%$EntityNumber|escape:'javascript'%}",  //实体类型S/M
        ListNumber: "{%$tplData.listNum|escape:'javascript'%}"  //结果总数
    });
</script><script>A.setup(function(){String.prototype.styleFilterPX = function(){ return Number(this.match(/(\-?\d+)/) ? RegExp.$1 : 0);};var Ala = this,ajaxFinished = false;var $dom_pageArea = Ala.find('.op_exactqa_spp_page'), originQuery = Ala.data.OriginQuery,endParams = Ala.data.EndParams,entityNumber = Ala.data.EntityNumber, srcid = Ala.srcid; var asynPrm = { sortKey : '', sortType : '1', stat0 : '', stat1 : '', stat2 : '', pn : 0, rn : 4 };var pagePrm = { listNum : Number(Ala.data.ListNumbe{%*i*%}r), nowPage : 1,endPage : undefined};A.use('page', function(){initPageComp(); initFeedback(); });function asyncGetData(sortKey,sortType,stat0,stat1,stat2,pn,rn){var asyncUrl = 'http://opendata.baidu.com/api.php?resource_id=' + srcid + '&format=json&ie=utf-8&oe=utf-8&query=' + encodeURIComponent(originQuery) + '&sort_key=' + encodeURIComponent(sortKey) + '&sort_type=' + sortType + '&stat0=' + encodeURIComponent(stat0) + '&stat1=' + encodeURIComponent(stat1) + '&stat2=' + encodeURIComponent(stat2){%*i*%} + '&pn=' + pn + '&rownum=' + rn;$.ajax({dataType : 'jsonp',scriptCharset : 'utf-8',jsonp : 'cb',timeout : 6000,url : asyncUrl,success : initData});}function initData(data){ if (ajaxFinished) return;if (data.status == '0' && data.data.length > 0) { var dispData = data.data[0].result,dispHtml = [],dispDataPropKey = data.data[0].search_property.split("|");if (data.data[0].search_property) {var additionalKey = data.data[0].search_property;} else if (data.data[0].cmpbrief[0]){var additionalKey = dat{%*i*%}a.data[0].cmpbrief[0];} else {var additionalKey = 'remark';};for (var i = 0; i < dispData.length; i++) {var imgSrc = dispData[i][dispData[i].selpic.split(',')[1]],imgHtml = (imgSrc) ? '<img class="c-img c-img3 c-gap-right op_exactqa_spp_item_img" src="' + imgSrc + '"/>' : '<span class="c-img c-img3 op_exactqa_spp_item_noimg"></span>';dispHtml = dispHtml.concat(['<tr>','<td>','<a href="', getJumpLink(dispData[i]), '" title="', dispData[i].ename, '" target="_blank">', imgHtml, '</a>','<a href="', {%*i*%}getJumpLink(dispData[i]), '" title="', dispData[i].ename, '" target="_blank">', $.subByte(dispData[i].ename, 13), '</a>','</td>']);for (var j = 0; j < dispDataPropKey.length; j++) {dispHtml = dispHtml.concat(['<td>', dispData[i][dispDataPropKey[j]] ? dispData[i][dispDataPropKey[j]] : '-', '</td>']);};dispHtml = dispHtml.concat(['</tr>']);};pagePrm.listNum = data.data[0].listNum || pagePrm.listNum; showData(dispHtml.join(''));} else {};function getJumpLink(dispData){if (dispData.jumpquery) {var j{%*i*%}umplink = "http://www.baidu.com/s?wd=" + encodeURIComponent(dispData.jumpquery) + endParams;} else if (dispData.jumplink) {var jumplink = dispData.jumplink;} else {var jumplink = "http://www.baidu.com/s?wd=" + encodeURIComponent(dispData.ename) + endParams;}return jumplink;}}function showData(data){ var $dom_dataArea = Ala.find('.op_exactqa_spp_itemsArea');$dom_dataArea.html(data);initFeedback(); }function initPageComp(){ if ($dom_pageArea.length) {if (pagePrm.listNum > asynPrm.rn) {$dom_pageAre{%*i*%}a.css({display: 'block'}); pagePrm.endPage = Math.ceil(pagePrm.listNum / asynPrm.rn);A.ui.page($dom_pageArea[0], pagePrm.nowPage, pagePrm.endPage, {onChange: function(nowPage, endPage){pagePrm.nowPage = nowPage;asynPrm.pn = (pagePrm.nowPage - 1) * asynPrm.rn;asyncGetData(asynPrm.sortKey,asynPrm.sortType,asynPrm.stat0,asynPrm.stat1,asynPrm.stat2,asynPrm.pn,asynPrm.rn);}});} else {$dom_pageArea.css({display: 'none'}); };};}function initFeedback(){ Ala.find('.op_exactqa_spp_tools_fb_area').html('<a{%*i*%} class="op_exactqa_spp_tools_fb OP_LOG_BTN" href="javascript:;" data-click="{info:\'报错\'}">报错</a>');Ala.find('.op_exactqa_spp_tools_fb').on('click', function(){var _this = this;$(_this).replaceWith('<span>感谢反馈</span>');});}this.dispose = function(){if(!ajaxFinished){ajaxFinished = true;}};});</script>{%/block%}