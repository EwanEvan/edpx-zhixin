{%extends 'c_base.tpl'%} {%block name='content'%} {%if $tplData.cinema%}<div class="op_cinema_summary_c"> <span class="op_cinema_summary_s"> <p>{%$tplData.summary[0]['text']|limitlen:74|highlight:0%}</p> </span> </div><div class="op_cinema_cinema_mainTab"></div><div class="op_cinema_cinema_subTab"></div><div class="op_cinema_scrollbar_box"> <div id="op_cinema_scrollbar_cinema" style="position:absolute;top:0;right:0;background-color:#FFF"></div> <div class="op_cinema_tabContent" class="op_cinema_cinema"> <ul id="op_cinema_cinema_cntTb" class="op_cinema_cinema_cntTb"> </ul> </div></div><div class="op_cinema_summary_sub">{%$tplData.summarySub[0]['text']|escape:'html'%}</div>{%else%}<div class="op_cinema_summary"> {%if $tplData.movieA%} <p>{%$tplData.summary[0]['text']|limitlen:74|highlight:0%} <a href="{%$tplData.summary[0]['mapUrl']|escape:'html'%}" target="_blank">{%$tplData.summary[0]['map']|escape:'html'%}</a></p> {%else%} {%$loop_maxcount=count($tplData.summary)%}{%for $op_loop_count=0 to 5%}{%if $op_loop_count<$loop_maxcount%} <p>{%$tplData.summary[$op_loop_count]['text']|limitlen:74|highlight:0%} <a href="{%$tplData.summary[$op_loop_count]['mapUrl']|escape:'html'%}" target="_blank">{%$tplData.summary[$op_loop_count]['map']|escape:'html'%}</a></p> {%else%}{%break%}{%/if%}{%/for%} {%/if%} </div>{%if $tplData.movieA%}<div class="op_cinema_movieA_tab"></div><div class="op_cinema_scrollbar_box"> <div id="op_cinema_scrollbar_movieA" style="position:absolute;top:0;right:0;background-color:#FFF"></div> <div class="op_cinema_tabContent" class="op_cinema_movieA"> <ul id="op_cinema_cntTb_movieA" class="op_cinema_cntTb_movieA"> </ul> </div></div><div class="op_cinema_summary_sub">{%$tplData.summarySub[0]['text']|escape:'html'%}</div>{%else%}<div class="op_cinema_movieB_mainTab"></div><div class="op_cinema_movieB_subTab"></div><div class="op_cinema_scrollbar_box"> <div id="op_cinema_scrollbar_movieB" style="position:absolute;top:0;right:0;background-color:#FFF"></div> <div class="op_cinema_tabContent" class="op_cinema_movieB"> <ul id="op_cinema_cntTb_movieB" class="op_cinema_cntTb_movieB"> </ul> </div></div><div class="op_cinema_summary_sub">{%$tplData.summarySub[0]['text']|escape:'html'%}</div>{%/if%} {%/if%} <script >A.init(function() {var _this = this; var scrollbar1, scrollbar2, scrollbar3;A.use('baidu',function(){function emptyDiv_fun(element) {while (element.firstChild) {element.removeChild(element.firstChild);}return element;}function getNormalDate(date) {return '' + ('0' + (date.getMonth() + 1)).slice(- 2) + '.' + ('0' + date.getDate()).slice(- 2);}function getRightDate(str) {str = str.toString().match(/^(\d+)(\d\d)(\d\d)/);str.shift();return new Date(str[0], str[1] - 1, str[2]);}var date = n{%*i*%}ew Date(bdServerTime * 1000),_today = Number(date.getFullYear() + ('0' + (date.getMonth() + 1)).slice(- 2) + ('0' + date.getDate()).slice(- 2)),today = getNormalDate(getRightDate(_today)),tomorrow = getNormalDate(getRightDate(_today + 1)),aftertomorrow = getNormalDate(getRightDate(_today + 2));var op_cinema_attrData = 'data-tab',op_cinema_timeTab = '';function domContent_fun(target,targetTag,tabContent,scrollBox,scrollCtrl) {var getContentUl = _this.find("."+target)[0],getContentLi = getContentU{%*i*%}l.getElementsByTagName('li'),_getshowLi = '',getshowLi = '';$(getContentLi).each(function(i,e){if (e.getAttribute(op_cinema_attrData) == targetTag) {$(e).show();_getshowLi += e.getAttribute(op_cinema_attrData) + ',';}else {$(e).hide();}});getshowLi = _getshowLi.substring(0, _getshowLi.length - 1).split(',');var op_cinema_tabContent = _this.find("."+tabContent)[0],op_cinema_scrollbar_box = _this.find("."+scrollBox)[0],opui_scrollbar_ctrl_scroll = _this.find("."+scrollCtrl)[0];if (getshowLi.length{%*i*%} > 3) {op_cinema_tabContent.style.height = '305px';}else {op_cinema_tabContent.style.height = 'auto';}}function formatTimeTab_fun(targetArray) {var _dataArray = '';for (i = 0; i < targetArray.length; i++) {if (targetArray[i] == '今天') {targetArray[i] = '今天(' + today + ')';}if (targetArray[i] == '明天') {targetArray[i] = '明天(' + tomorrow + ')';}if (targetArray[i] == '后天') {targetArray[i] = '后天(' + aftertomorrow + ')';}_dataArray += targetArray[i] + ',';}op_cinema_timeTab = _dataArray.substring(0, _d{%*i*%}ataArray.length - 1).split(',');return op_cinema_timeTab;}function domTabLine_fun(target) {var getTabU = target.parentNode.getElementsByTagName('u');$(getTabU).each(function(e){$(e).show();});if (target.nextSibling != null) {$(target.nextSibling).hide();}if (target.previousSibling != null) {$(target.previousSibling).hide();}}{%if $tplData.cinema%};var op_cinema_tabsA_Array = '{%$tplData.tabA[0]['text']|escape:'html'|escape:'javascript'%}'.split(','),op_cinema_tabsB_Array = '{%$tplData.tabB[0]['text']|escape:'html'|escape:'javascript'%}'.split(','),op_cinema_tabStart = '{%$tplData.tabA[0]['on']|escape:'html'|escape:'javascript'%}',op_cinema_window = '',getListContent = _this.find('.op_cinema_cinema_cntTb')[0];window.op_cinema_getSubTab = '{%$tplData.tabB[0]['on']|escape:'html'|escape:'javascript'%}';_this.ajax('{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)%}', {%$extData.resourceid|escape:'html'|escape:'javascript'%}, {co: 'content',success: successData});function successData(data) {if (!data)return;var contentHTML = '';contentData = data[0].content;$(contentData).each(function(i,e){contentHTML += $.format('<li data-tab="#{tabTag}" style="display:none"><table cellpadding="0" cellspacing="0" width="100%" class="op_cinema_cntTable"><tr><td><dl><dt><a href="#{titleLink}" target="_blank">#{title}</a>{%if $tplData.content[0]['titleSub']%}<i>#{titleSub}</i>{%/if%}</dt><dd>#{subInfo}</dd><dd class="op_cinema_ddTime">#{time}{%if $tplData.content[0]['more']%}<a href="#{moreLink}" target="_blank">#{more}</a>{%/if%}</dd></dl></td><th>{%if $tplData.content[0]['btn']%}<a href="#{btnLink}" target="_blank" class="op_cinema_btn"><span>#{btn}</span><i></i></a>{%/if%}</th></tr></table></li>', e);});getListContent.innerHTML = contentHTML;A.use('scrollbarv',function(){scrollbar1 = A.ui.scrollbarv({content : _this.find('.op_cinema_cinema')[0]});});formatTimeTab_fun(op_cinema_tabsB_Array);function subTabAction_fun() {window.op_cinema_getSubTab = this.getAttribute(op_cinema_attrData);op_cinema_window = window.op_cinema_getMainTab + '-' + window.op_cinema_getSubTab;domContent_fun('op_cinema_cinema_cntTb', op_cinema_window, 'op_cinema_tabContent', 'op_cinema_scroll{%*i*%}bar_box', 'opui-scroll-ctrl-scroll');domTabLine_fun(this);scrollbar1 && scrollbar1.render();}function mainTabAction_fun() {window.op_cinema_getMainTab = this.getAttribute(op_cinema_attrData);op_cinema_window = window.op_cinema_getMainTab + '-' + window.op_cinema_getSubTab;domContent_fun('op_cinema_cinema_cntTb', op_cinema_window, 'op_cinema_tabContent', 'op_cinema_scrollbar_box', 'opui-scroll-ctrl-scroll');emptyDiv_fun(_this.find('.op_cinema_cinema_subTab')[0]);A.use('tab',function(){A.ui.tab('o{%*i*%}p_cinema_cinema_subTab', 'afterBegin', op_cinema_timeTab, window.op_cinema_getSubTab, subTabAction_fun);});}A.use('tab',function(){A.ui.tab('op_cinema_cinema_mainTab', 'afterBegin', op_cinema_tabsA_Array, op_cinema_tabStart, mainTabAction_fun);});}{%else%};{%if $tplData.movieA%};var op_cinema_tabsA_Array = '{%$tplData.tabA[0]['text']|escape:'html'|escape:'javascript'%}'.split(','),op_cinema_tabStart = '{%$tplData.tabA[0]['on']|escape:'html'|escape:'javascript'%}',getListContentA = _this.find('.op_cinema_cntTb_movieA')[0];_this.ajax('{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)%}', {%$extData.resourceid|escape:'html'|escape:'javascript'%}, {co: 'content',success: successData});function successData(data) {if (!data)return;var contentHTML = '';contentData = data[0].content; $(contentData).each(function(i,e){contentHTML += $.format('<li data-tab="#{tabTag}" style="display:none"><table cellpadding="0" cellspacing="0" width="100%" class="op_cinema_cntTable"><tr><td><dl><dt><a href="#{titleLink}" target="_blank">#{title}</a>{%if $tplData.content[0]['titleSub']%}<i>#{titleSub}</i>{%/if%}</dt><dd>#{subInfo}</dd><dd class="op_cinema_ddTime">#{time}{%if $tplData.content[0]['more']%}<a href="#{moreLink}" target="_blank">#{more}</a>{%/if%}</dd></dl></td><th>{%if $tplData.content[0]['btn']%}<a href="#{btnLink}" target="_blank" class="op_cinema_btn"><span>#{btn}</span><i></i></a>{%/if%}</th></tr></table></li>', e);});getListContentA.innerHTML = contentHTML;A.use('scrollbarv',function(){scrollbar2 = A.ui.scrollbarv({content : _this.find('.op_cinema_movieA')[0]});});formatTimeTab_fun(op_cinema_tabsA_Array);function mainTabAction_fun() {window.op_cinema_getMainTab = this.getAttribute(op_cinema_attrData);domContent_fun('op_cinema_cntTb_movieA', window.op_cinema_getMainTab, 'op_cinema_tabContent', 'op_cinema_scrollbar_box', 'opui-scroll-ctrl-scroll');domTabLine_fun(this);scrollbar2{%*i*%} && scrollbar2.render();}A.use('tab',function(){A.ui.tab('op_cinema_movieA_tab', 'afterBegin', op_cinema_timeTab, op_cinema_tabStart, mainTabAction_fun);});}{%else%};var op_cinema_tabsA_Array = '{%$tplData.tabA[0]['text']|escape:'html'|escape:'javascript'%}'.split(','),op_cinema_tabsB_Array = '{%$tplData.tabB[0]['text']|escape:'html'|escape:'javascript'%}'.split(','),op_cinema_tabStart = '{%$tplData.tabA[0]['on']|escape:'html'|escape:'javascript'%}',op_cinema_window = '',getLIstContentB = _this.find('.op_cinema_cntTb_movieB')[0];window.op_cinema_getSubTab = '{%$tplData.tabB[0]['on']|escape:'html'|escape:'javascript'%}';_this.ajax('{%str_replace($extData.resourceid|cat:'_','',$extData.fetchkey)%}', {%$extData.resourceid|escape:'html'|escape:'javascript'%}, {co: 'content',success: successData});function successData(data) {if (!data)return;var contentHTML = '';contentData = data[0].content; $(contentData).each(function(i,e){contentHTML += $.format('<li data-tab="#{tabTag}" style="display:none"><table cellpadding="0" cellspacing="0" width="100%" class="op_cinema_cntTable"><tr><td><dl><dt><a href="#{titleLink}" target="_blank">#{title}</a>{%if $tplData.content[0]['titleSub']%}<i>#{titleSub}</i>{%/if%}</dt><dd>#{subInfo}</dd><dd class="op_cinema_ddTime">#{time}{%if $tplData.content[0]['more']%}<a href="#{moreLink}" target="_blank">#{more}</a>{%/if%}</dd></dl></td><th>{%if $tplData.content[0]['btn']%}<a href="#{btnLink}" target="_blank" class="op_cinema_btn"><span>#{btn}</span><i></i></a>{%/if%}</th></tr></table></li>', e);});getLIstContentB.innerHTML = contentHTML;A.use('scrollbarv',function(){scrollbar3 = A.ui.scrollbarv({content : _this.find('.op_cinema_movieB')[0]});});formatTimeTab_fun(op_cinema_tabsB_Array);function subTabAction_fun() {window.op_cinema_getSubTab = this.getAttribute(op_cinema_attrData);op_cinema_window = window.op_cinema_getMainTab + '-' + window.op_cinema_getSubTab;domContent_fun('op_cinema_cntTb_movieB', op_cinema_window, 'op_cinema_tabContent', 'op_cinema_scrol{%*i*%}lbar_box', 'opui-scroll-ctrl-scroll');}function mainTabAction_fun() {window.op_cinema_getMainTab = this.getAttribute(op_cinema_attrData);op_cinema_window = window.op_cinema_getMainTab + '-' + window.op_cinema_getSubTab;domContent_fun('op_cinema_cntTb_movieB', op_cinema_window, 'op_cinema_tabContent', 'op_cinema_scrollbar_box', 'opui-scroll-ctrl-scroll');emptyDiv_fun(_this.find('.op_cinema_movieB_subTab')[0]);A.use('tab',function(){A.ui.tab('op_cinema_movieB_subTab', 'afterBegin', op_cinema_timeT{%*i*%}ab, window.op_cinema_getSubTab, subTabAction_fun);});domTabLine_fun(this);scrollbar3 && scrollbar3.render();}A.use('tab',function(){A.ui.tab('op_cinema_movieB_mainTab', 'afterBegin', op_cinema_tabsA_Array, op_cinema_tabStart, mainTabAction_fun);});}{%/if%};{%/if%};});this.dispose = function(){scrollbar1&&scrollbar1.dispose&&scrollbar1.dispose();scrollbar2&&scrollbar2.dispose&&scrollbar2.dispose();scrollbar3&&scrollbar3.dispose&&scrollbar3.dispose();};});</script>{%/block%}