{%extends 'c_base.tpl'%} {%block name='data_modifier'%} {%$extData.feData.hasTitleGap=false%}{%/block%}{%block name='content'%}<div class="op_ticket_tab_safetip c-gap-bottom-small"> <i class="c-icon c-icon-safe c-gap-icon-right-small"></i>已通过百度认证，请放心使用</div><div class="c-border c-gap-bottom-small"><div class="c-tabs op_ticket_tab_main"> <ul class="c-tabs-nav c-tabs-nav-movetop"> <li class="op_ticket_tab_tab c-tabs-nav-li {%if $tplData.areaflag%}{%else%} c-tabs-nav-selected{%/if%}">国内机票</li> <li class="op_ticket_tab_tab c-tabs-nav-li {%if $tplData.areaflag%} c-tabs-nav-selected{%/if%}">国际&bull;港澳台机票</li> </ul> <table class="op_ticket_tab_table"> <tr class="op_ticket_tab_large"> <td><span class="c-gap-right">出发城市</span></td> <td colspan="3"><span class="c-input c-gap-right-small op_ticket_tab_pos_start"> <i class="c-icon c-icon-map"></i> <input value="{%if $extData.AutoExtendedLocation%}{%$extData.AutoExtendedLocation|escape:'html'|escape:'javascript'%}{%/if%}" class="op_ticket_tab_text" name="op_ticket_tab_start" id="op_ticket_tab_start" type="text"> </span> <a href="javascript:;" class="c-btn op_ticket_tab_exchange c-gap-right-small"><i class="c-icon c-icon-exchange"></i></a> <span class="c-input op_ticket_tab_pos_end"> <i class="c-icon c-icon-map"></i> <input class="op_ticket_tab_text" name="op_ticket_tab_end" id="op_ticket_tab_end" type="text"> </span></td> </tr> <tr> <td><span class="c-gap-right">航班类型</span></td> <td> <form style="position:stati{%*i*%}c" autocomplete="off"> <label><input class="OP_LOG_BTN op_ticket_tab_type2" checked="checked" type="radio" name="op_ticket_tab_type" value="1" />单程</label> <label><input class="OP_LOG_BTN op_ticket_tab_type1" type="radio" name="op_ticket_tab_type" value="0" />往返</label> </form> </td> <td colspan="2"></td> </tr> <tr> <td><span class="c-gap-right">出发时间</span></td> <td> <span class="c-input c-gap-right op_ticket_tab_input1 OP_LOG_BTN"> <i class="c-icon c-icon-calendar op_ticket_tab_cbtn1"></i> <inp{%*i*%}ut readonly="readonly" type="text" class="op_ticket_tab_time1" /> </span> </td> <td><span class="op_ticket_tab_span2 op_ticket_tab_none c-gap-right">返程时间</span></td> <td> <span class="c-input op_ticket_tab_input2 OP_LOG_BTN"> <i class="c-icon c-icon-calendar op_ticket_tab_cbtn2"></i> <input readonly="readonly" type="text" class="op_ticket_tab_time2" /> </span> </td> </tr> <tr class="op_ticket_tab_large"> <td></td> <td colspan="3"> <div class="OP_LOG_BTN op_ticket_tab_btns"> {%if $tplData.button1%}<a class="c-btn c-btn-primary op_ticket_tab_b1" href="javascript:void(0)">去哪儿网查询</a>{%/if%}{%if $tplData.button2%}<a class="c-btn c-btn-primary op_ticket_tab_b2" href="javascript:void(0)">携程网查询</a>{%/if%}{%if $tplData.button3%}<a class="c-btn c-btn-primary op_ticket_tab_b3" href="javascript:void(0)">同程网查询</a>{%/if%}{%if $tplData.button4%}<a class="c-btn c-btn-primary op_ticket_tab_b4" href="javascript:void(0)">芒果网查询</a>{%/if%}{%if $tplData.button5%}<a class="c-btn c-btn-primary op_ticket_tab_b5" href="javascript:void(0)">去哪儿网查询</a>{%/if%}{%if $tplData.button6%}<a class="c-btn c-btn-primary op_ticket_tab_b6" href="javascript:void(0)">天巡网查询</a>{%/if%} </div> </td> </tr> </table></div><div class="op_ticket_tab_cc1"> </div><div class="op_ticket_tab_cc2"> </div></div><script >A.setup(function() {var _this = this, areaFlag,exchange=_this.find('.op_ticket_tab_exchange').eq(0);var scIpt = _this.find('#op_ticket_tab_start')[0];var ajaxFinished = false;var op_ticket_tab_gsvalue = scIpt.value,ecIpt = _this.find('#op_ticket_tab_end')[0],op_ticket_tab_gevalue = ecIpt.value,ipflags = 1,ipflage = 1,set_focus1 = false,set_focus2 = false;exchange.on('click{%*i*%}', function(){var tmp = ecIpt.value;ecIpt.value = scIpt.value;scIpt.value = tmp;});{%if $tplData.areaflag%};areaFlag = 1;{%else%};areaFlag = 0;{%/if%};var curTabClass='c-tabs-nav-selected';function changeTabs(e, i) {if (i === 1) {areaFlag = 1;sugUrl = 'http://opendata.baidu.com/ala_sug/ala_s.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_ticket&t=#{1}';} else {areaFlag = 0;sugUrl = 'http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_guonei&t=#{1}';}btnMod();_this.find('.'+curTabClass).eq(0).removeClass(curTabClass);$(e).addClass(curTabClass);ecIpt.value = '';if (start) {start.dispose();}if (end) {end.disp{%*i*%}ose();}sug.view=function(){var s=_this.find('.op_ticket_tab_pos_start')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};start = A.ui.suggestion(sug);sug.view=function(){var s=_this.find('.op_ticket_tab_pos_end')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};end = A.ui.suggestion(sug);start.render('op_ticket_tab_start');end.render('op_ticket_tab_end');}$.each(_this.find('.op_ticket_tab_tab'), function(i, e) {$(e).on('click', function() {{%*i*%}changeTabs(e, i)});});$(scIpt).on('focus', function() {scIpt.select();});$(scIpt).on('mouseup', function(e) {if (!set_focus1) {e.preventDefault();set_focus1 = true;}else {$(scIpt).focus();set_focus1 = false;}});$(scIpt).on('blur', function() {set_focus1 = false;});$(ecIpt).on('focus', function() {ecIpt.select();});$(ecIpt).on('mouseup', function(e) {if (!set_focus2) {e.preventDefault();set_focus2 = true;}else {$(ecIpt).focus();set_focus2 = false;}});$(ecIpt).on('blur', function() {set_focus2 = f{%*i*%}alse;});{%if $tplData.areaflag%};var sugUrl = 'http://opendata.baidu.com/ala_sug/ala_s.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_ticket&t=#{1}';{%else%};var sugUrl = 'http://opendata.baidu.com/ala_sug/ala_sug.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_guonei&t=#{1}';{%/if%};var citys = [];var s_szm = '';var e_szm = '';var sug = {getData: function(word) {var _this = this;var fn = function(data) {if(ajaxFinished) return;var SD = [];if (data.status == 0) {var datas = data.data;var len = datas.length;if (len > 0) {$.each(datas, function(i,o) {SD.push(o.s);});}else {SD.push('dataerror');}fnSuccess(SD);}};$.ajax({url:$.format(sugUrl, encodeURIComponent(word), new Date().getTime()),dataType:'jsonp',success:fn,jsonp:'cb'});function fnSuccess(sd) {var FD = [];citys = [];if{%*i*%} (sd[0] == 'dataerror') {FD.push('<p class="op_ticket_tab_red">对不起，不支持该目的地</p>');citys.push('');}else {$.each(sd, function(i, o) {var da = o.split('|'),w = word.toLowerCase(),w1 = word.toUpperCase();if (areaFlag === 0) {var str = da[0] + '(' + da[1].toLowerCase() + ')',str2 = da[0] + '(' + da[2].toUpperCase() + ')';citys.push(da[0] + '|' + da[3]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span class='op_ticket_tab_hilight'>" + w + '</span>'));}else if (w1 && str2.indexOf(w1) != -1){%*i*%} {FD.push(str2.replace(w1, "<span class='op_ticket_tab_hilight'>" + w1 + '</span>'));}} else {var str = da[0] + '(' + da[1] + ')',str2 = da[0] + '(' + da[2].toLowerCase() + ')',str3 = da[0] + '(' + da[3] + ')';citys.push(da[0] + '|' + da[4]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span class='op_ticket_tab_hilight'>" + w + '</span>'));}else if (w && str2.indexOf(w) != -1) {FD.push(str2.replace(w, "<span class='op_ticket_tab_hilight'>" + w + '</span>'));}else if (w1 && o.indexOf({%*i*%}w1) != -1) {FD.push(str3.replace(w1, "<span class='op_ticket_tab_hilight'>" + w1 + '</span>'));}}});}_this.show(word, FD);_this.highLight(0);}},onpick: function(ev) {if (isNaN(ev.data.index)) {return;}else {var cs = citys[ev.data.index].split('|');ev.data.item.value = cs[0];if ((this.getTarget().id) == 'op_ticket_tab_start') {s_szm = cs[1];}else if ((this.getTarget().id) == 'op_ticket_tab_end') {e_szm = cs[1];}}}};var start,end,tbtimer;function sugInit(){sug.view=function(){var s=_this.find('.op{%*i*%}_ticket_tab_pos_start')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};start = A.ui.suggestion(sug),sug.view=function(){var s=_this.find('.op_ticket_tab_pos_end')[0],p=$(s).position();return {top:p.top+26,left:p.left,width:s.offsetWidth};};end = A.ui.suggestion(sug);}$(function(){A.use('suggestion',function() {sugInit();tbtimer = setTimeout(function(){start.render('op_ticket_tab_start');end.render('op_ticket_tab_end');},100);});});var b1 = _this.find('.op_ticket_tab{%*i*%}_b1')[0],b2 = _this.find('.op_ticket_tab_b2')[0],b3 = _this.find('.op_ticket_tab_b3')[0],b4 = _this.find('.op_ticket_tab_b4')[0],b5 = _this.find('.op_ticket_tab_b5')[0],b6 = _this.find('.op_ticket_tab_b6')[0];{%if $tplData.button1%}$(b1).on('click', function() {btnFn(this, 'qunar');});{%/if%};{%if $tplData.button2%}$(b2).on('click', function() {btnFn(this, 'ctrip');});{%/if%};{%if $tplData.button3%}$(b3).on('click', function() {btnFn(this, '17u');});{%/if%};{%if $tplData.button4%}$(b4).on('click', function() {btnFn(this, 'mg');});{%/if%};{%if $tplData.button5%}$(b5).on('click', function() {btnFn(this, 'qunar');});{%/if%};{%if $tplData.button6%}$(b6).on('click', function() {btnFn(this, 'tianxun');});{%/if%};function btnFn(obj,w) {if (!D1) return false;var s = start.getTargetValue(),e = end.getTargetValue(),s1 = s_szm,e1 = e_szm;if (s == '' || e == '') {var url = {'qunar': 'http://flight.qunar.com/?ex_track=bd_aladding','ctrip': 'http://flights.ctrip.com/','17u': 'http://www.17u.cn/FlightQuery.aspx?TCAllianceID=1562159&RefId=1562159&','kuxun': 'http://jipiao.kuxun.cn/?fromid=Khslhuoche-S1169701-T1137511&est=marketing','mg' : 'http://flight.mangocity.com/flights-search-cn.shtml?queryPara.lineType=in{%*i*%}dex&projectcode=0020010','tianxun': 'http://www.tianxun.cn/'};obj.href = url[w];obj.target = '_blank';}else {var info = {tt: t2.checked ? '0' : '1',a1: s,a2: e,s1: s1,s2: e1,d1: D1.toString().replace(/^(\d+)(\d\d)(\d\d)\b/,function(a, b, c, d) {return [b, c, d].join('-');}),d2: D2.toString().replace(/^(\d+)(\d\d)(\d\d)\b/,function(a, b, c, d) {return [b, c, d].join('-');})};var url = {'ctrip': ['http://flights.ctrip.com/Domestic/ShowFareFirst.aspx?DCityName1=' + escape(info.a1) + '&ACityName1=' {%*i*%}+ escape(info.a2) + '&DDatePeriod1=' + info.d1 + '&sourcepage=openbaidu', 'http://flights.ctrip.com/Domestic/ShowFareFirst.aspx?DCityName1=' + escape(info.a1) + '&ACityName1=' + escape(info.a2) + '&DDatePeriod1=' + info.d1 + '&ADatePeriod1=' + info.d2 + '&FlightWay=D&sourcepage=openbaidu'],'17u': ['http://www.17u.cn/flight/FlightBaiDuALaDing.aspx?DepartCity=' + encodeURIComponent(info.a1) + '&DestCity=' + encodeURIComponent(info.a2) + '&Date=' + info.d1 + '&ReturnFlag=0', 'http://www.17u.cn/flig{%*i*%}ht/FlightBaiDuALaDing.aspx?DepartCity=' + encodeURIComponent(info.a1) + '&DestCity=' + encodeURIComponent(info.a2) + '&Date=' + info.d1 + '&ReturnDate=' + info.d2 + '&ReturnFlag=1'],'kuxun': ['http://jipiao.kuxun.cn/fcgi-bin/fast_air_search_wrap?t=' + encodeURIComponent(info.a1) + '&q=' + encodeURIComponent(info.a2) + '&ie=utf8&fromid=Khslhuoche-S1169701-T1003551&est=marketing&date=' + info.d1, 'http://jipiao.kuxun.cn/fcgi-bin/fast_air_search_wrap?t=' + encodeURIComponent(info.a1) + '&q=' + enco{%*i*%}deURIComponent(info.a2) + '&ie=utf8&fromid=Khslhuoche-S1169701-T1183261&est=marketing&date=' + info.d1 + '&Rtdate=' + info.d2 + '&type=2'],'mg' : ['http://flight.mangocity.com/flights-search-cn.shtml?queryPara.lineType=ow&queryPara.depCityCn=' + encodeURIComponent(info.a1) + '&queryPara.arrCityCn=' + encodeURIComponent(info.a2) + '&queryPara.depDate=' + info.d1 + '&projectcode=0020010', 'http://flight.mangocity.com/flights-search-cn.shtml?queryPara.lineType=rt&queryPara.depCityCn=' + encodeURICo{%*i*%}mponent(info.a1) + '&queryPara.arrCityCn=' + encodeURIComponent(info.a2) + '&queryPara.depDate=' + info.d1 + '&queryPara.arrDate=' + info.d2 + '&projectcode=0020010'],'tianxun': ['http://www.tianxun.cn/search.html?ot=' + encodeURIComponent(info.a1) + '&it=' + encodeURIComponent(info.a2) + '&odate=' + info.d1 + '&rtn=no&associateid=INT_DIR_00069_00001', 'http://www.tianxun.cn/search.html?ot=' + encodeURIComponent(info.a1) + '&it=' + encodeURIComponent(info.a2) + '&odate=' + info.d1 + '&idate=' + {%*i*%}info.d2 + '&rtn=yes&associateid=INT_DIR_00069_00001']};if (areaFlag == 0) {url['qunar'] = ['http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=&searchType=OnewayFlight&charset=utf8&ex_track=bd_aladding', 'http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=' + info.d2 + '&{%*i*%}searchType=RoundtripFlight&charset=utf8&ex_track=bd_aladding'];}else {url['qunar'] = ['http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=&searchType=OnewayFlight&charset=utf8&ex_track=bd_aladding_int', 'http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=' + info.d2 + '&s{%*i*%}earchType=RoundtripFlight&charset=utf8&ex_track=bd_aladding_int'];}obj.href = url[w][info.tt];obj.target = '_blank';}}var in1 = _this.find('.op_ticket_tab_time1')[0],in2 = _this.find('.op_ticket_tab_time2')[0],el1 = _this.find('.op_ticket_tab_cc1')[0],el2 = _this.find('.op_ticket_tab_cc2')[0];var getD = function(dom) {var a = dom.value.match(/^(\d+)-(\d\d)-(\d\d)/);if (a && a.length == 4) return parseInt('' + a[1] + a[2] + a[3]);else return false;};var getS = function(d) {d = d.toString().match({%*i*%}/^(\d+)(\d\d)(\d\d)\b/);d = new Date(d[1], d[2] - 1, d[3]);return '' + d.getFullYear() + '-' + ('0' + (d.getMonth() + 1)).slice(- 2) + '-' + ('0' + d.getDate()).slice(- 2) + '(' + '周' + ('日一二三四五六'.charAt(d.getDay())) + ')';};function hiDate() {var d = [D1];if (t1.checked) {d.push(D2);}this.setDay(d, function(td) {this.addClass(td, 'op_ticket_tab_cell_seledted');});}var c0, c1, D1, D2, bdate, Today;function getNormalDate(date) {return '' + date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).{%*i*%}slice(- 2) + '-' + ('0' + date.getDate()).slice(- 2);}function getRightDate(str) {str = str.toString().match(/^(\d+)(\d\d)(\d\d)/);str.shift();return new Date(str[0], str[1] - 1, str[2]);}var newDate = new Date(bdServerTime * 1000);var oTimer = setTimeout(function() {Today = newDate.getFullYear() * 10000 + (newDate.getMonth() + 1) * 100 + newDate.getDate();in1.value = getS(Today + 1);in2.value = getS(Today + 3);D1 = getD(in1),D2 = getD(in2);function calendarInit(){c0 = A.ui.calendar({input: in1,{%*i*%}position: _this.find('.op_ticket_tab_input1')[0],element: el1,count: 2,date: 20090921,today: Today,between: [Today, 99999999],onShow: function() {this.setHtml(D1);c1.hide();hiDate.call(this);},onChange: function() {hiDate.call(this);},onSelectDay: function(date, week) {D1 = date;c1.setBetween([date, 99999999]);if (D2 <= D1) {D2 = getNormalDate(getRightDate(date + 3)).replace(/-/g, '');in2.value = getS(D2);}}});c1 = A.ui.calendar({input: in2,position: _this.find('.op_ticket_tab_input2')[0],elemen{%*i*%}t: el2,count: 2,today: Today,onShow: function() {this.setHtml(D2);c0.hide();this.setBetween([getD(in1), 99999999]);hiDate.call(this);},onChange: function() {hiDate.call(this);},onSelectDay: function(date, week) {D2 = date;}});c0.addEvent(_this.find('.op_ticket_tab_cbtn1')[0], 'click', function() {c0.show();},true);c1.addEvent(_this.find('.op_ticket_tab_cbtn2')[0], 'click', function() {c1.show();},true);}A.use('calendar',calendarInit);},1);var t1 = _this.find('.op_ticket_tab_type1')[0],t2 = _this{%*i*%}.find('.op_ticket_tab_type2')[0],span2 = _this.find('.op_ticket_tab_span2').eq(0),input2 = _this.find('.op_ticket_tab_input2')[0];$(t1).on('click', function() {span2.removeClass('op_ticket_tab_none');input2.style.display = 'block';});$(t2).on('click', function() {span2.addClass('op_ticket_tab_none');input2.style.display = 'none';});btnMod();function btnMod() {if (areaFlag == 1) {{%if $tplData.button1%};b1.style.display = 'none';{%/if%};{%if $tplData.button2%};b2.style.display = 'none';{%/if%};{%if $tplData.button3%};b3.style.display = 'none';{%/if%};{%if $tplData.button4%};b4.style.display = 'none';{%/if%};{%if $tplData.button5%};b5.style.display = 'inline-block';b5.style.marginRight = '10px';{%/if%};{%if $tplData.button6%};b6.style.display = 'inline-block';{%/if%};} else {{%if $tplData.button1%};b1.style.display = 'inline-block';b1.style.marginRight = '10px';{%/if%};{%if $tplData.button2%};b2.style.display = 'inline-block';b2.style.marginRight = '10px';{%/if%};{%if $tplData.button3%};b3.style.display = 'inline-block';b3.style.marginRight = '10px';{%/if%};{%if $tplData.button4%};b4.style.display = 'inline-block';{%/if%};{%if $tplData.button5%};b5.style.display = 'none';{%/if%};{%if $tplData.button6%};b6.style.display = 'none';{%/if%};}}this.dispose = function(){clearTimeout(oTimer);clearTimeout(tbtimer);if(!ajaxFinished){ajaxFinished = true;}start&&start.dispose&&start.dispose();end&&end.dispose&&end.dispose();};});</script>{%/block%}