{%extends 'base.tpl'%} {%block name='content'%}<style >.op_int_ticket{width:451px;margin-top:6px}.op_int_ticket,.op_int_ticket td,.op_int_ticket_showurl,.op_int_ticket_input input{font-size:13px}.op_int_ticket td{padding:0 5px;height:28px;text-align:left;vertical-align:middle}.op_int_ticket_key{padding:0 8px 10px 0}.op_int_ticket_text{width:134px;*width:128px;border:1px solid #b5b5b5;height:23px;*height:21px;line-height:21px;padding-left:3px}.op_int_ticket_value{padding:0 22px 10px 0}.op_int_ticket_value td{font-family:verdana}.op_int_ticket{%*i*%}_btn_cont{padding:7px 0 3px 67px;zoom:1}.op_int_ticket_btn_cont:after{content:'\20';display:block}.op_int_ticket_btn_cont:after,.op_int_ticket_showurl{clear:both}.op_int_ticket_hilight{color:#f00}a.op_int_ticket_btn{margin-right:20px;text-decoration:none;color:#000;float:left}a.op_int_ticket_btn div,a.op_int_ticket_btn div div,a.op_int_ticket_btn div div div,a.op_int_ticket_btn:hover div,a.op_int_ticket_btn:focus div,a.op_int_ticket_btn:hover div div,a.op_int_ticket_btn:focus div div,a.op_int_ti{%*i*%}cket_btn:hover div div div,a.op_int_ticket_btn:focus div div div{background:url(http://open.baidu.com/stat/ticket/temp_ticket.btn.gif) 0 0 no-repeat}a.op_int_ticket_btn div{background-position:0 -48px;background-repeat:repeat-x;line-height:24px;height:24px;cursor:pointer;float:left}a.op_int_ticket_btn div div div{background-position:right -24px;padding:0 5px;white-space:nowrap}a.op_int_ticket_btn:hover,a.op_int_ticket_btn:focus{border:0}a.op_int_ticket_btn:hover div,a.op_int_ticket_btn:focus div{%*i*%}{background-position:0 -96px;background-repeat:repeat-x;border:0}a.op_int_ticket_btn:hover div div,a.op_int_ticket_btn:focus div div{background-position:0 -72px}a.op_int_ticket_btn:hover div div div,a.op_int_ticket_btn:focus div div div{background-position:right -120px}.tangram-suggestion{cursor:default}.tangram-suggestion table{width:100%;border:#d0d0d0 solid 1px;background:#fff;min-width:134px;_width:134px}.tangram-suggestion td{font:12px verdana;height:22px;line-height:22px;padding:0 5px;whit{%*i*%}e-space:nowrap}.tangram-suggestion-current{background:#3a77d2;color:#fff}.tangram-suggestion td .op_int_ticket_red{margin:0 -5px;padding:0 5px;background:#d4443c;color:#fff}.op_int_ticket_input{width:132px;border:1px solid #b5b5b5;overflow:hidden}.op_int_ticket_input input{border:0;margin:0;height:19px;width:100px;vertical-align:middle;padding-left:3px}.op_int_ticket_input .op_int_ticket_time{font-size:12px;width:101px;height:18px;line-height:18px;border:0 none #fff;vertical-align:middle}.op_int{%*i*%}_ticket_none,#op_int_ticket_input2{display:none}.op_int_ticket_cbtn{width:17px;height:17px;float:right;background:url(http://open.baidu.com/stat/ticket/cbtn.gif);margin:2px 2px 2px 0;display:inline;cursor:pointer}</style>{%$FE_GBVAR.wrapper_prefix%}{%fe_fn_title_prefix%}<a href="about:blank" target="_blank" class="op_int_ticket_titlelink">{%$tplData.title|highlight:0%}</a>{%fe_fn_title_suffix title="{%$tplData.title%}" url="{%$tplData.url%}"%}<div class="op_int_ticket"> <table class="op_int_ticket_table" cellpadding="0" cellspacing="0"> <tr> <td class="op_int_ticket_key"> 出发城市 </td> <td class="op_int_ticket_value"><input value="{%if $tplData.startcity!=""%}{%$tplData.startcity%}{%/if%}" class="op_int_ticket_text" name="op_int_ticket_start" id="op_int_ticket_start" type="text"></td> <td class="op_int_ticket_key"> 目的城市 </td> <td class="op_int_ticket_value"><input value="{%if $tplData.destination!=""%}{%$tplData.destination%}{%/if%}" class="op_int_ticket_text" name="op_int_ticket_end" id="op_int_ticket_end" type="text"></td> </tr> <tr> <td class="op_int_ticket_key"> 航班类型 </td> <td class="op_int_ticket_value"><form style="position:static" autocomplete="off"> <input class="OP_LOG_BTN" checked="checked" type="radio" name="op_int_ticket_type" id="op_int_ticket_type2"value="1" /> <label for="op_int_ticket_type2"> 单程 </label> <input class="OP_LOG_BTN" type="radio" name="op_int_ticket_type" id="op_int_ticket_type1" value="0" /> <l{%*i*%}abel for="op_int_ticket_type1"> 往返 </label> </form></td> <td colspan="2"><form action="#" method="get" target="_blank" id="ticketHideForm"></form></td> </tr> <tr> <td class="op_int_ticket_key"> 出发时间 </td> <td class="op_int_ticket_value"><div class="op_int_ticket_input" id="op_int_ticket_input1"> <div id="op_int_ticket_cbtn1" class="op_int_ticket_cbtn OP_LOG_BTN"> </div> <input readonly="readonly" type="text" id="op_int_ticket_time1" class="op_int_ticket_time"> </div></td> <td class="op_int_ticke{%*i*%}t_key"><span id="op_int_ticket_span2" class="op_int_ticket_none"> 返程时间 </span></td> <td class="op_int_ticket_value"><div class="op_int_ticket_input" id="op_int_ticket_input2"> <div id="op_int_ticket_cbtn2" class="op_int_ticket_cbtn OP_LOG_BTN"> </div> <input readonly="readonly" type="text" id="op_int_ticket_time2" class="op_int_ticket_time"> </div></td> </tr> </table> <div class="op_int_ticket_btn_cont OP_LOG_BTN"> {%if $tplData.button1!=""%}<a class="op_int_ticket_btn op_int_ticket_b1" href="javascript:void(0)"><div><div><div> 去哪儿网查询 </div></div></div></a>{%/if%} {%if $tplData.button2!=""%}<a class="op_int_ticket_btn op_int_ticket_b2" href="javascript:void(0)"><div><div><div> 艺龙网查询 </div></div></div></a>{%/if%} </div></div><div id="op_int_ticket_cc1"> </div><div id="op_int_ticket_cc2"> </div><div class="op_int_ticket_showurl"><span class="g"> {%$tplData.showurl%} </span> {%if $tplData.showlamp!=""%} - <a target="_blank" href="http://open.baidu.com/" class="op_LAMP"> </a> {%/if%} </div>{%$FE_GBVAR.wrapper_suffix%}<script >A.init(function() {var t = this, start,end,D1,D2,s_szm,e_szm;function getNormalDate(date) {return '' + date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(- 2) + '-' + ('0' + date.getDate()).slice(- 2);}function getRightDate(str) {str = str.toString().match(/^(\d+)(\d\d)(\d\d)/);str.shift();return new Date(str[0], str[1] - 1, str[2]);}var newDate = new Date(bdServerTime * 1000);var titlelink = t.find('.op_int_ticket_titlelink')[0];var strLink = getNormalDate(getRightDate('' +{%*i*%} newDate.getFullYear() + (newDate.getMonth() + 1) + (newDate.getDate() + 1)));var op_int_ticket_svalue = t.find('#op_int_ticket_start')[0];var set_focus = false;{%if $tplData.startcity!=""%};titlelink.href = 'http://flight.qunar.com/twell/flight/Search.jsp?searchType=OnewayFlight&fromCity=' + encodeURIComponent('{%$tplData.startcity%}') + '&toCity=' + encodeURIComponent('{%$tplData.destination%}') + '&fromDate=' + strLink + '&charset=utf8&ex_track=bd_aladding_inttitle';{%else%};op_int_ticket_svalue.value = '{%$extData.AutoExtendedLocation|escape:'javascript'%}';titlelink.href = 'http://flight.qunar.com/';{%/if%};var op_int_ticket_gsvalue = op_int_ticket_svalue.value,op_int_ticket_evalue = t.find('#op_int_ticket_end')[0],op_int_ticket_gevalue = op_int_ticket_evalue.value,ipflags = 1,ipflage = 1,set_focus1 = false,set_focus2 = false,ajaxFinished = false,oTimer;$(op_int_ticket_svalue).on('focus', function() {op_int_ticket_svalue.select();});$(op_int_ticket_svalue).on('mouseup', function(e) {if (!set_focus1) {e.preventDefault();set_focus1 = true;}else {op_int_ticket_svalue.focus();set_focus1 = false;}});$({%*i*%}op_int_ticket_svalue).on('blur', function() {set_focus1 = false;});$(op_int_ticket_evalue).on('focus', function() {op_int_ticket_evalue.select();});$(op_int_ticket_evalue).on('mouseup', function(e) {if (!set_focus2) {e.preventDefault();set_focus2 = true;}else {op_int_ticket_evalue.focus();set_focus2 = false;}});$(op_int_ticket_evalue).on('blur', function() {set_focus2 = false;});A.use('suggestion',function(){var call_sug = ['op_flight_ticket', new Date().getTime()].join('');function getUrl(sug) {%*i*%}{var url = $.format('http://opendata.baidu.com/ala_sug/ala_s.php?query=#{0}&oe=gbk&ie=utf-8&sug_type=flight_ticket&t=#{1}', encodeURIComponent(sug), new Date().getTime());$.ajax({url:url+'&cb=ticket',dataType:'jsonp',success:window[call_sug],timeout:5000,jsonpCallback:'ticket'});}var citys = [];s_szm = '{%if $tplData.startszm!=""%}{%$tplData.startszm%}{%/if%}';e_szm = '{%if $tplData.destinationszm!=""%}{%$tplData.destinationszm%}{%/if%}';var sug = {getData: function(word) {var _this = this;window[call_sug] = function(data) {if(ajaxFinished) return;var SD = [];if (data.status == 0) {var datas = data.data;var len = datas.length;if (len > 0) {$.each(datas, function(i,o) {SD.push(o.s);});}else {SD.push('dataerror');}fnSuccess(SD);}};getUrl(word);function fnSuccess(sd) {var FD = [];citys = [];if (sd[0] == 'dataerror') {FD.push('<p class="op_int_ticket_red">对不起，不支持该目的地</p>');citys.push('');}else {$.each(sd, function(i,o) {var da = o{%*i*%}.split('|'),w = word.toLowerCase(),w1 = word.toUpperCase(),str = da[0] + '(' + da[1] + ')',str2 = da[0] + '(' + da[2].toLowerCase() + ')',str3 = da[0] + '(' + da[3] + ')';citys.push(da[0] + '|' + da[4]);if (w && str.indexOf(w) != -1) {FD.push(str.replace(w, "<span class='op_int_ticket_hilight'>" + w + '</span>'));}else if (w && str2.indexOf(w) != -1) {FD.push(str2.replace(w, "<span class='op_int_ticket_hilight'>" + w + '</span>'));}else if (w1 && o.indexOf(w1) != -1) {FD.push(str3.replace(w1, "<s{%*i*%}pan class='op_int_ticket_hilight'>" + w1 + '</span>'));}});}_this.show(word, FD);_this.highLight(0);}},onpick: function(ev) {if (isNaN(ev.data.index)) {return;}else {var cs = citys[ev.data.index].split('|');ev.data.item.value = cs[0];if ((this.getTarget().id) == 'op_int_ticket_start') {s_szm = cs[1];}else if ((this.getTarget().id) == 'op_int_ticket_end') {e_szm = cs[1];}}}};start = A.ui.suggestion(sug);end = A.ui.suggestion(sug);$(function() {start.render('op_int_ticket_start');end.render('op_in{%*i*%}t_ticket_end');});});var b1 = t.find('.op_int_ticket_b1')[0];var b2 = t.find('.op_int_ticket_b2')[0];{%if $tplData.button1!=""%};$(b1).on('click', function() {btnFn(this, 'qunar');});{%/if%};{%if $tplData.button2!=""%};$(b2).on('click', function() {btnFn(this, 'ctrip');});{%/if%};function btnFn(obj,w) {if (!D1) return false;var s = start.getTargetValue(),e = end.getTargetValue();s1 = s_szm;e1 = e_szm;if (s == '' || e == '') {var url = {'qunar': 'http://www.qunar.com/','ctrip': 'http://flights.ctrip.com/'};obj.href = url[w];obj.target = '_blank';}else {var info = {tt: t.find('#op_int_ticket_type2')[0].checked ? '0' : '1',a1: s,a2: e,s1: s1,s2: e1,d1: D1.toString().replace(/^(\d+)(\d\d)(\d\d)\b/,function(a, b, c, d) {return [b, c, d].join('-');}),d2: D2.toString().replace{%*i*%}(/^(\d+)(\d\d)(\d\d)\b/,function(a, b, c, d) {return [b, c, d].join('-');})};var url = {'qunar': ['http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=&searchType=OnewayFlight&charset=utf8&ex_track=bd_aladding_int', 'http://www.qunar.com/twell/flight/Search.jsp?fromCity=' + encodeURIComponent(info.a1) + '&toCity=' + encodeURIComponent(info.a2) + '&fromDate=' + info.d1 + '&toDate=' + i{%*i*%}nfo.d2 + '&searchType=RoundtripFlight&charset=utf8&ex_track=bd_aladding_int'],'ctrip': ['http://flights.ctrip.com/Domestic/ShowFareFirst.aspx?HomeCity=' + info.s1 + '&DestCity1=' + info.s2 + '&DDatePeriod1=' + info.d1 + '&sourcepage=openbaidu', 'http://flights.ctrip.com/Domestic/ShowFareFirst.aspx?HomeCity=' + info.s1 + '&DestCity1=' + info.s2 + '&DDatePeriod1=' + info.d1 + '&ADatePeriod1=' + info.d2 + '&FlightWay=D&sourcepage=openbaidu']};obj.href = url[w][info.tt];obj.target = '_blank';}}A.use{%*i*%}('calendar',function(){var in1 = 'op_int_ticket_time1',in2 = 'op_int_ticket_time2',el1 = 'op_int_ticket_cc1',el2 = 'op_int_ticket_cc2';var getD = function(id) {var a = t.find('#'+id)[0].value.match(/^(\d+)-(\d\d)-(\d\d)/);if (a && a.length == 4) return parseInt('' + a[1] + a[2] + a[3]);else return false;};var getS = function(d) {d = d.toString().match(/^(\d+)(\d\d)(\d\d)\b/);d = new Date(d[1], d[2] - 1, d[3]);return '' + d.getFullYear() + '-' + ('0' + (d.getMonth() + 1)).slice(- 2) + '-' + ('0' {%*i*%}+ d.getDate()).slice(- 2) + '(' + '周' + ('日一二三四五六'.charAt(d.getDay())) + ')';};function hiDate() {var d = [D1];if (t.find('#op_int_ticket_type1')[0].checked) {d.push(D2);}this.setDay(d, function(td) {$(td).addClass('op_int_ticket_cell_seledted');});}var c0, c1, bdate, Today;oTimer = setTimeout(function() {Today = newDate.getFullYear() * 10000 + (newDate.getMonth() + 1) * 100 + (newDate.getDate());t.find('#'+in1)[0].value = getS(Today + 1);t.find('#'+in2)[0].value = getS(Today + 3);D1 = getD(in1){%*i*%},D2 = getD(in2);c0 = A.ui.calendar({input: in1,position: 'op_int_ticket_input1',element: el1,count: 2,date: 20090921,today: Today,between: [Today, 99999999],onShow: function() {this.setHtml(D1);c1.hide();hiDate.call(this);},onChange: function() {hiDate.call(this);},onSelectDay: function(date, week) {D1 = date;c1.setBetween([date, 99999999]);if (D2 <= D1) {D2 = getNormalDate(getRightDate(date + 3)).replace(/-/g, '');t.find('#'+in2)[0].value = getS(D2);}}});c1 = A.ui.calendar({input: in2,position:{%*i*%} 'op_int_ticket_input2',element: el2,count: 2,today: Today,onShow: function() {this.setHtml(D2);c0.hide();this.setBetween([getD('op_int_ticket_time1'), 99999999]);hiDate.call(this);},onChange: function() {hiDate.call(this);},onSelectDay: function(date, week) {D2 = date;}});c0.addEvent(t.find('#op_int_ticket_cbtn1')[0], 'click', function() {c0.show();},true);c1.addEvent(t.find('#op_int_ticket_cbtn2')[0], 'click', function() {c1.show();},true);},1);});var t1 = t.find('#op_int_ticket_type1')[0],t2 {%*i*%}= t.find('#op_int_ticket_type2')[0],span2 = t.find('#op_int_ticket_span2')[0],input2 = t.find('#op_int_ticket_input2')[0];t1.onclick = function() {span2.className = '';input2.style.display = 'block';};t2.onclick = function() {span2.className = 'op_int_ticket_none';input2.style.display = 'none';};var tTimer = setTimeout(function() {t2.setAttribute('checked', 'checked');span2.className = 'op_int_ticket_none';input2.style.display = 'none';},100);this.dispose = function(){clearTimeout(oTimer);clearT{%*i*%}imeout(tTimer);if(!ajaxFinished){ajaxFinished = true;}start&&start.dispose&&start.dispose();end&&end.dispose&&end.dispose();};});</script>{%/block%}